(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[129],{64335:function(It,$,V){"use strict";var ce=V(67294),pe=(0,ce.createContext)({});$.Z=pe},21349:function(It,$,V){"use strict";var ce=V(84305),pe=V(73893),v=V(53645),de=V.n(v),U=V(67294),te=V(94184),se=V.n(te),Re=V(64335),he=function(tt){var gt=(0,U.useContext)(Re.Z),Jt=tt.children,ir=tt.contentWidth,yt=tt.className,Qt=tt.style,Ct=(0,U.useContext)(pe.ZP.ConfigContext),st=Ct.getPrefixCls,ht=tt.prefixCls||st("pro"),Wt=ir||gt.contentWidth,X="".concat(ht,"-grid-content");return U.createElement("div",{className:se()(X,yt,{wide:Wt==="Fixed"}),style:Qt},U.createElement("div",{className:"".concat(ht,"-grid-content-children")},Jt))};$.Z=he},62611:function(It,$,V){"use strict";V.d($,{Ie:function(){return ZP},JE:function(){return Q3}});var ce={};V.r(ce),V.d(ce,{add:function(){return Te},adjoint:function(){return Bn},clone:function(){return it},copy:function(){return Gt},create:function(){return gr},determinant:function(){return tr},equals:function(){return Se},exactEquals:function(){return Bi},frob:function(){return Sl},fromQuat:function(){return $o},fromQuat2:function(){return uo},fromRotation:function(){return rn},fromRotationTranslation:function(){return Xa},fromRotationTranslationScale:function(){return Ko},fromRotationTranslationScaleOrigin:function(){return bo},fromScaling:function(){return Yr},fromTranslation:function(){return ri},fromValues:function(){return _r},fromXRotation:function(){return Yn},fromYRotation:function(){return hi},fromZRotation:function(){return Fi},frustum:function(){return Zo},getRotation:function(){return za},getScaling:function(){return qo},getTranslation:function(){return ki},identity:function(){return cr},invert:function(){return Gr},lookAt:function(){return Li},mul:function(){return oe},multiply:function(){return rr},multiplyScalar:function(){return xt},multiplyScalarAndAdd:function(){return vn},ortho:function(){return ns},orthoNO:function(){return Yi},orthoZO:function(){return ni},perspective:function(){return to},perspectiveFromFieldOfView:function(){return Vo},perspectiveNO:function(){return rs},perspectiveZO:function(){return _i},rotate:function(){return Er},rotateX:function(){return Ur},rotateY:function(){return Xr},rotateZ:function(){return mi},scale:function(){return Nr},set:function(){return Br},str:function(){return Eo},sub:function(){return Ve},subtract:function(){return Dt},targetTo:function(){return sa},translate:function(){return fn},transpose:function(){return Ir}});var pe={};V.r(pe),V.d(pe,{add:function(){return jE},angle:function(){return H0},bezier:function(){return eS},ceil:function(){return GE},clone:function(){return UE},copy:function(){return ZE},create:function(){return cd},cross:function(){return xy},dist:function(){return pS},distance:function(){return dy},div:function(){return hS},divide:function(){return py},dot:function(){return _y},equals:function(){return cS},exactEquals:function(){return lS},floor:function(){return HE},forEach:function(){return gS},fromValues:function(){return Sc},hermite:function(){return JE},inverse:function(){return $E},len:function(){return vS},length:function(){return cy},lerp:function(){return QE},max:function(){return XE},min:function(){return WE},mul:function(){return fS},multiply:function(){return hy},negate:function(){return yy},normalize:function(){return fd},random:function(){return tS},rotateX:function(){return iS},rotateY:function(){return aS},rotateZ:function(){return oS},round:function(){return YE},scale:function(){return qE},scaleAndAdd:function(){return KE},set:function(){return VE},sqrDist:function(){return dS},sqrLen:function(){return mS},squaredDistance:function(){return vy},squaredLength:function(){return gy},str:function(){return uS},sub:function(){return W0},subtract:function(){return fy},transformMat3:function(){return rS},transformMat4:function(){return sv},transformQuat:function(){return nS},zero:function(){return sS}});var v=V(67294),de=(0,v.createContext)({});function U(){return(0,v.useContext)(de)}var te={},se={},Re=function(n){return se[n]},he=function(n,r){se[n]=r},$e=function(n){return te[n]},tt=function(n,r){te[n]=r},gt={},Jt={},ir=34,yt=10,Qt=13;function Ct(e){return new Function("d","return {"+e.map(function(n,r){return JSON.stringify(n)+": d["+r+'] || ""'}).join(",")+"}")}function st(e,n){var r=Ct(e);return function(i,a){return n(r(i),a,e)}}function ht(e){var n=Object.create(null),r=[];return e.forEach(function(i){for(var a in i)a in n||r.push(n[a]=a)}),r}function Wt(e,n){var r=e+"",i=r.length;return i<n?new Array(n-i+1).join(0)+r:r}function X(e){return e<0?"-"+Wt(-e,6):e>9999?"+"+Wt(e,6):Wt(e,4)}function Xt(e){var n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":X(e.getUTCFullYear(),4)+"-"+Wt(e.getUTCMonth()+1,2)+"-"+Wt(e.getUTCDate(),2)+(a?"T"+Wt(n,2)+":"+Wt(r,2)+":"+Wt(i,2)+"."+Wt(a,3)+"Z":i?"T"+Wt(n,2)+":"+Wt(r,2)+":"+Wt(i,2)+"Z":r||n?"T"+Wt(n,2)+":"+Wt(r,2)+"Z":"")}function ft(e){var n=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function i(I,k){var D,W,J=a(I,function(ie,Oe){if(D)return D(ie,Oe-1);W=ie,D=k?st(ie,k):Ct(ie)});return J.columns=W||[],J}function a(I,k){var D=[],W=I.length,J=0,ie=0,Oe,qe=W<=0,rt=!1;I.charCodeAt(W-1)===yt&&--W,I.charCodeAt(W-1)===Qt&&--W;function pt(){if(qe)return Jt;if(rt)return rt=!1,gt;var zt,nr=J,dr;if(I.charCodeAt(nr)===ir){for(;J++<W&&I.charCodeAt(J)!==ir||I.charCodeAt(++J)===ir;);return(zt=J)>=W?qe=!0:(dr=I.charCodeAt(J++))===yt?rt=!0:dr===Qt&&(rt=!0,I.charCodeAt(J)===yt&&++J),I.slice(nr+1,zt-1).replace(/""/g,'"')}for(;J<W;){if((dr=I.charCodeAt(zt=J++))===yt)rt=!0;else if(dr===Qt)rt=!0,I.charCodeAt(J)===yt&&++J;else if(dr!==r)continue;return I.slice(nr,zt)}return qe=!0,I.slice(nr,W)}for(;(Oe=pt())!==Jt;){for(var kt=[];Oe!==gt&&Oe!==Jt;)kt.push(Oe),Oe=pt();k&&(kt=k(kt,ie++))==null||D.push(kt)}return D}function s(I,k){return I.map(function(D){return k.map(function(W){return w(D[W])}).join(e)})}function h(I,k){return k==null&&(k=ht(I)),[k.map(w).join(e)].concat(s(I,k)).join(`
`)}function m(I,k){return k==null&&(k=ht(I)),s(I,k).join(`
`)}function y(I){return I.map(E).join(`
`)}function E(I){return I.map(w).join(e)}function w(I){return I==null?"":I instanceof Date?Xt(I):n.test(I+="")?'"'+I.replace(/"/g,'""')+'"':I}return{parse:i,parseRows:a,format:h,formatBody:m,formatRows:y,formatRow:E,formatValue:w}}var He=ft(","),lt=He.parse,Qe=He.parseRows,Ut=He.format,xr=He.formatBody,Dr=He.formatRows,Kr=He.formatRow,Me=He.formatValue,A=V(96156),_e=V(85061),Et=V(38163),dt=V.n(Et);function Ft(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function qt(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ft(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ft(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Sr(e,n){var r=n.x,i=n.y,a=n.x1,s=n.y1,h=n.coordinates,m=[];return e.forEach(function(y,E){var w=[];if(r&&i&&(w=[parseFloat(y[r]),parseFloat(y[i])]),r&&i&&a&&s){var I=[parseFloat(y[r]),parseFloat(y[i])],k=[parseFloat(y[a]),parseFloat(y[s])];w=[I,k]}if(h){var D="Polygon";Array.isArray(h[0])||(D="Point"),Array.isArray(h[0])&&!Array.isArray(h[0][0])&&(D="LineString");var W={type:D,coordinates:(0,_e.Z)(y[h])};dt()(W,!0),w=W.coordinates}var J=qt(qt({},y),{},{_id:E,coordinates:w});m.push(J)}),{dataArray:m}}var Qn=[{lng1:100,lat1:30,lng2:130,lat2:30}],gn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function ea(e,n){var r=lt(e);return Sr(r,n)}var wn=63710088e-1,ii={centimeters:wn*100,centimetres:wn*100,degrees:wn/111325,feet:wn*3.28084,inches:wn*39.37,kilometers:wn/1e3,kilometres:wn/1e3,meters:wn,metres:wn,miles:wn/1609.344,millimeters:wn*1e3,millimetres:wn*1e3,nauticalmiles:wn/1852,radians:1,yards:wn*1.0936},Si={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/wn,yards:1.0936133},si={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Wn(e,n,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=n||{},i.geometry=e,i}function ma(e,n,r){switch(r===void 0&&(r={}),e){case"Point":return zi(n).geometry;case"LineString":return vo(n).geometry;case"Polygon":return Wi(n).geometry;case"MultiPoint":return ra(n).geometry;case"MultiLineString":return Ui(n).geometry;case"MultiPolygon":return qi(n).geometry;default:throw new Error(e+" is invalid")}}function zi(e,n,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Rn(e[0])||!Rn(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return Wn(i,n,r)}function ji(e,n,r){return r===void 0&&(r={}),la(e.map(function(i){return zi(i,n)}),r)}function Wi(e,n,r){r===void 0&&(r={});for(var i=0,a=e;i<a.length;i++){var s=a[i];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<s[s.length-1].length;h++)if(s[s.length-1][h]!==s[0][h])throw new Error("First and last Position are not equivalent.")}var m={type:"Polygon",coordinates:e};return Wn(m,n,r)}function ga(e,n,r){return r===void 0&&(r={}),la(e.map(function(i){return Wi(i,n)}),r)}function vo(e,n,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return Wn(i,n,r)}function Va(e,n,r){return r===void 0&&(r={}),la(e.map(function(i){return vo(i,n)}),r)}function la(e,n){n===void 0&&(n={});var r={type:"FeatureCollection"};return n.id&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.features=e,r}function Ui(e,n,r){r===void 0&&(r={});var i={type:"MultiLineString",coordinates:e};return Wn(i,n,r)}function ra(e,n,r){r===void 0&&(r={});var i={type:"MultiPoint",coordinates:e};return Wn(i,n,r)}function qi(e,n,r){r===void 0&&(r={});var i={type:"MultiPolygon",coordinates:e};return Wn(i,n,r)}function Ts(e,n,r){r===void 0&&(r={});var i={type:"GeometryCollection",geometries:e};return Wn(i,n,r)}function ge(e,n){if(n===void 0&&(n=0),n&&!(n>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,n||0);return Math.round(e*r)/r}function ui(e,n){n===void 0&&(n="kilometers");var r=ii[n];if(!r)throw new Error(n+" units is invalid");return e*r}function no(e,n){n===void 0&&(n="kilometers");var r=ii[n];if(!r)throw new Error(n+" units is invalid");return e/r}function ru(e,n){return ar(no(e,n))}function Vt(e){var n=e%360;return n<0&&(n+=360),n}function ar(e){var n=e%(2*Math.PI);return n*180/Math.PI}function Ar(e){var n=e%360;return n*Math.PI/180}function on(e,n,r){if(n===void 0&&(n="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return ui(no(e,n),r)}function In(e,n,r){if(n===void 0&&(n="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=si[n];if(!i)throw new Error("invalid original units");var a=si[r];if(!a)throw new Error("invalid final units");return e/i*a}function Rn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function bi(e){return!!e&&e.constructor===Object}function gi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(n){if(!Rn(n))throw new Error("bbox must only contain numbers")})}function En(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Oi(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ii(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ja(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return ja(e[0]);throw new Error("coordinates must only contain numbers")}function ps(e,n,r){if(!n||!r)throw new Error("type and name required");if(!e||e.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.type)}function Ho(e,n,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.geometry.type)}function ka(e,n,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,a=e.features;i<a.length;i++){var s=a[i];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+s.geometry.type)}}function ya(e){return e.type==="Feature"?e.geometry:e}function j(e,n){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function K(e,n,r){if(e!==null)for(var i,a,s,h,m,y,E,w=0,I=0,k,D=e.type,W=D==="FeatureCollection",J=D==="Feature",ie=W?e.features.length:1,Oe=0;Oe<ie;Oe++){E=W?e.features[Oe].geometry:J?e.geometry:e,k=E?E.type==="GeometryCollection":!1,m=k?E.geometries.length:1;for(var qe=0;qe<m;qe++){var rt=0,pt=0;if(h=k?E.geometries[qe]:E,h!==null){y=h.coordinates;var kt=h.type;switch(w=r&&(kt==="Polygon"||kt==="MultiPolygon")?1:0,kt){case null:break;case"Point":if(n(y,I,Oe,rt,pt)===!1)return!1;I++,rt++;break;case"LineString":case"MultiPoint":for(i=0;i<y.length;i++){if(n(y[i],I,Oe,rt,pt)===!1)return!1;I++,kt==="MultiPoint"&&rt++}kt==="LineString"&&rt++;break;case"Polygon":case"MultiLineString":for(i=0;i<y.length;i++){for(a=0;a<y[i].length-w;a++){if(n(y[i][a],I,Oe,rt,pt)===!1)return!1;I++}kt==="MultiLineString"&&rt++,kt==="Polygon"&&pt++}kt==="Polygon"&&rt++;break;case"MultiPolygon":for(i=0;i<y.length;i++){for(pt=0,a=0;a<y[i].length;a++){for(s=0;s<y[i][a].length-w;s++){if(n(y[i][a][s],I,Oe,rt,pt)===!1)return!1;I++}pt++}rt++}break;case"GeometryCollection":for(i=0;i<h.geometries.length;i++)if(K(h.geometries[i],n,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function re(e,n,r,i){var a=r;return K(e,function(s,h,m,y,E){h===0&&r===void 0?a=s:a=n(a,s,h,m,y,E)},i),a}function ye(e,n){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&n(e.features[r].properties,r)!==!1;r++);break;case"Feature":n(e.properties,0);break}}function ke(e,n,r){var i=r;return ye(e,function(a,s){s===0&&r===void 0?i=a:i=n(i,a,s)}),i}function je(e,n){if(e.type==="Feature")n(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&n(e.features[r],r)!==!1;r++);}function Je(e,n,r){var i=r;return je(e,function(a,s){s===0&&r===void 0?i=a:i=n(i,a,s)}),i}function le(e){var n=[];return K(e,function(r){n.push(r)}),n}function De(e,n){var r,i,a,s,h,m,y,E,w,I,k=0,D=e.type==="FeatureCollection",W=e.type==="Feature",J=D?e.features.length:1;for(r=0;r<J;r++){for(m=D?e.features[r].geometry:W?e.geometry:e,E=D?e.features[r].properties:W?e.properties:{},w=D?e.features[r].bbox:W?e.bbox:void 0,I=D?e.features[r].id:W?e.id:void 0,y=m?m.type==="GeometryCollection":!1,h=y?m.geometries.length:1,a=0;a<h;a++){if(s=y?m.geometries[a]:m,s===null){if(n(null,k,E,w,I)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(s,k,E,w,I)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<s.geometries.length;i++)if(n(s.geometries[i],k,E,w,I)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function vt(e,n,r){var i=r;return De(e,function(a,s,h,m,y){s===0&&r===void 0?i=a:i=n(i,a,s,h,m,y)}),i}function fr(e,n){De(e,function(r,i,a,s,h){var m=r===null?null:r.type;switch(m){case null:case"Point":case"LineString":case"Polygon":return n(Wn(r,a,{bbox:s,id:h}),i,0)===!1?!1:void 0}var y;switch(m){case"MultiPoint":y="Point";break;case"MultiLineString":y="LineString";break;case"MultiPolygon":y="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var w=r.coordinates[E],I={type:y,coordinates:w};if(n(Wn(I,a),i,E)===!1)return!1}})}function Rt(e,n,r){var i=r;return fr(e,function(a,s,h){s===0&&h===0&&r===void 0?i=a:i=n(i,a,s,h)}),i}function Lt(e,n){fr(e,function(r,i,a){var s=0;if(!!r.geometry){var h=r.geometry.type;if(!(h==="Point"||h==="MultiPoint")){var m,y=0,E=0,w=0;if(K(r,function(I,k,D,W,J){if(m===void 0||i>y||W>E||J>w){m=I,y=i,E=W,w=J,s=0;return}var ie=lineString([m,I],r.properties);if(n(ie,i,a,J,s)===!1)return!1;s++,m=I})===!1)return!1}}})}function vr(e,n,r){var i=r,a=!1;return Lt(e,function(s,h,m,y,E){a===!1&&r===void 0?i=s:i=n(i,s,h,m,y,E),a=!0}),i}function yn(e,n){if(!e)throw new Error("geojson is required");fr(e,function(r,i,a){if(r.geometry!==null){var s=r.geometry.type,h=r.geometry.coordinates;switch(s){case"LineString":if(n(r,i,a,0,0)===!1)return!1;break;case"Polygon":for(var m=0;m<h.length;m++)if(n(lineString(h[m],r.properties),i,a,m)===!1)return!1;break}}})}function ln(e,n,r){var i=r;return yn(e,function(a,s,h,m){s===0&&r===void 0?i=a:i=n(i,a,s,h,m)}),i}function wt(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,a=n.geometryIndex||0,s=n.segmentIndex||0,h=n.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),h=h||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":h=h||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var y=m.coordinates;switch(m.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=y.length+s-1),lineString([y[s],y[s+1]],h,n);case"Polygon":return a<0&&(a=y.length+a),s<0&&(s=y[a].length+s-1),lineString([y[a][s],y[a][s+1]],h,n);case"MultiLineString":return i<0&&(i=y.length+i),s<0&&(s=y[i].length+s-1),lineString([y[i][s],y[i][s+1]],h,n);case"MultiPolygon":return i<0&&(i=y.length+i),a<0&&(a=y[i].length+a),s<0&&(s=y[i][a].length-s-1),lineString([y[i][a][s],y[i][a][s+1]],h,n)}throw new Error("geojson is invalid")}function nn(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,a=n.geometryIndex||0,s=n.coordIndex||0,h=n.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),h=h||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":h=h||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var y=m.coordinates;switch(m.type){case"Point":return point(y,h,n);case"MultiPoint":return i<0&&(i=y.length+i),point(y[i],h,n);case"LineString":return s<0&&(s=y.length+s),point(y[s],h,n);case"Polygon":return a<0&&(a=y.length+a),s<0&&(s=y[a].length+s),point(y[a][s],h,n);case"MultiLineString":return i<0&&(i=y.length+i),s<0&&(s=y[i].length+s),point(y[i][s],h,n);case"MultiPolygon":return i<0&&(i=y.length+i),a<0&&(a=y[i].length+a),s<0&&(s=y[i][a].length-s),point(y[i][a][s],h,n)}throw new Error("geojson is invalid")}function Fr(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Vr(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Fr(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fr(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function di(e,n){var r=[],i={};if(e.features=e.features.filter(function(s){var h=s.geometry;return s!=null&&h&&h.type&&h.coordinates&&h.coordinates.length>0}),dt()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:i};var a=0;return fr(e,function(s,h){var m=Ii(s),y=h,E=Vr(Vr({},s.properties),{},{coordinates:m,_id:y});r.push(E)}),{dataArray:r,featureKeys:i}}function en(e){var n=131,r=137,i=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)i>a&&(i=Math.floor(i/r)),i=i*n+e.charCodeAt(s);return i}function Ai(e){e=e.toString();for(var n=5381,r=e.length;r;)n=n*33^e.charCodeAt(--r);return n>>>0}var Vn=V(28481),li="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ci(e){this.message=e}Ci.prototype=new Error,Ci.prototype.name="InvalidCharacterError";function Ei(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new Ci("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",i=0,a,s,h=0;s=n.charAt(h++);~s&&(a=i%4?a*64+s:s,i++%4)?r+=String.fromCharCode(255&a>>(-2*i&6)):0)s=li.indexOf(s);return r}function Xn(e){e=String(e);for(var n,r,i,a,s="",h=0,m=e.length%3;h<e.length;){if((r=e.charCodeAt(h++))>255||(i=e.charCodeAt(h++))>255||(a=e.charCodeAt(h++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");n=r<<16|i<<8|a,s+=li.charAt(n>>18&63)+li.charAt(n>>12&63)+li.charAt(n>>6&63)+li.charAt(n&63)}return m?s.slice(0,m-3)+"===".substring(m):s}var Bt=V(6610),Yt=V(5991),Ki=function(){function e(n,r){(0,Bt.Z)(this,e),this.buffers=n,this.type=r}return(0,Yt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,i,a){throw new Error("not implemented")}}]),e}(),Jn;typeof window=="undefined"?Jn={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(n){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,r,i){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(n){return!0},Event:function(n,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Jn=window;var Di=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Sa=Di?my.getSystemInfoSync().pixelRatio:Jn.devicePixelRatio,bn=V(10379),Wr=V(46070),At=V(77608),Ro=(0,Yt.Z)(function e(n,r){(0,Bt.Z)(this,e),(0,A.Z)(this,"cancelBubble",void 0),(0,A.Z)(this,"cancelable",void 0),(0,A.Z)(this,"target",void 0),(0,A.Z)(this,"currentTarget",void 0),(0,A.Z)(this,"preventDefault",void 0),(0,A.Z)(this,"stopPropagation",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=n,this.timeStamp=Date.now()}),be=V(63349);function $i(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Au(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function Au(e,n){if(!!e){if(typeof e=="string")return $a(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $a(e,n)}}function $a(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var _a=new WeakMap,La=function(){function e(){(0,Bt.Z)(this,e),_a.set(this,{})}return(0,Yt.Z)(e,[{key:"addEventListener",value:function(r,i){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=_a.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(i),_a.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,i){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=_a.get(this);if(s){var h=s[r];if(h&&h.length>0){for(var m=h.length;m--;m>0)if(h[m]===i){h.splice(m,1);break}}}}},{key:"dispatchEvent",value:function(r){var i=_a.get(this)[r.type];if(i){var a=$i(i),s;try{for(a.s();!(s=a.n()).done;){var h=s.value;h(r)}}catch(m){a.e(m)}finally{a.f()}}}}]),e}();function ta(e){var n=ko();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lo=function(e){(0,bn.Z)(r,e);var n=ta(r);function r(){var i;return(0,Bt.Z)(this,r),i=n.call(this),(0,A.Z)((0,be.Z)(i),"childNodes",void 0),i.childNodes=[],i}return(0,Yt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(h){return h===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(La);function Tu(e){var n=mo();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function mo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wo=function(e){(0,bn.Z)(r,e);var n=Tu(r);function r(){var i;return(0,Bt.Z)(this,r),i=n.call(this),(0,A.Z)((0,be.Z)(i),"className",void 0),(0,A.Z)((0,be.Z)(i),"children",void 0),i.className="",i.children=[],i}return(0,Yt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Lo),aa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ga,Do,Ha,Ls;if(aa){var Uu=my.getSystemInfoSync();Ga=Uu.screenWidth,Do=Uu.screenHeight,Ha=Uu.windowWidth,Ls=Uu.windowHeight}else{var ds=Jn.innerWidth,ee=Jn.innerHeight;Ga=ds,Do=ee,Ha=ds,Ls=ee}var Ee={width:Ga,height:Do,availWidth:Ha,availHeight:Ls,availLeft:0,availTop:0},Xe=Ee.availWidth,Pt=Ee.availHeight,Pr={style:[]};function An(e,n){if(!("parentNode"in e)){var r;n===0?r=function(){return null}:n===1?r=function(){return Pr}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var i;n===0?i=function(){return null}:n===1?i=function(){return Pr}:i=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:i})}}function Ti(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:Xe+"px",height:Pt+"px",margin:"0px",padding:"0px"})}function Qa(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=Xe,e.clientHeight=Pt),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var n={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return n})}function Aa(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=Xe,e.offsetHeight=Pt)}function Fa(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=Xe,e.scrollHeight=Pt)}function Fo(e){var n=function(){return!0};e.classList=[],e.classList.add=n,e.classList.remove=n,e.classList.contains=n,e.classList.toggle=n}function vs(e){var n=Wo();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Wo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Ao(){}var To=function(e){(0,bn.Z)(r,e);var n=vs(r);function r(){var i,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,Bt.Z)(this,r),i=n.call(this),(0,A.Z)((0,be.Z)(i),"className",void 0),(0,A.Z)((0,be.Z)(i),"children",void 0),(0,A.Z)((0,be.Z)(i),"focus",void 0),(0,A.Z)((0,be.Z)(i),"blur",void 0),(0,A.Z)((0,be.Z)(i),"insertBefore",void 0),(0,A.Z)((0,be.Z)(i),"appendChild",void 0),(0,A.Z)((0,be.Z)(i),"removeChild",void 0),(0,A.Z)((0,be.Z)(i),"remove",void 0),(0,A.Z)((0,be.Z)(i),"innerHTML",void 0),(0,A.Z)((0,be.Z)(i),"tagName",void 0),i.className="",i.children=[],i.focus=Ao,i.blur=Ao,i.insertBefore=Ao,i.appendChild=Ao,i.removeChild=Ao,i.remove=Ao,i.innerHTML="",i.tagName=a.toUpperCase(),An((0,be.Z)(i),s),Ti((0,be.Z)(i)),Fo((0,be.Z)(i)),Qa((0,be.Z)(i)),Aa((0,be.Z)(i)),Fa((0,be.Z)(i)),i}return(0,Yt.Z)(r)}(wo);function Ms(e){var n=Hs();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Hs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ws=function(e){(0,bn.Z)(r,e);var n=Ms(r);function r(i){return(0,Bt.Z)(this,r),n.call(this,i)}return(0,Yt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(To);function ms(e){var n=va();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function va(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var go=function(e){(0,bn.Z)(r,e);var n=ms(r);function r(){return(0,Bt.Z)(this,r),n.call(this,"video")}return(0,Yt.Z)(r)}(Ws),Qo={},gs={};function Pl(e,n){Qo=e,Qo.id=n,"tagName"in Qo||(Qo.tagName="CANVAS"),Qo.type="canvas",Mixin.parentNode(Qo),Mixin.style(Qo),Mixin.classList(Qo),Mixin.clientRegion(Qo),Mixin.offsetRegion(Qo),Qo.focus=function(){},Qo.blur=function(){}}function rf(e,n){var r=1024,i=1024;gs={width:r,height:i,clientWidth:r/devicePixelRatio,clientHeight:i/devicePixelRatio,id:n,type:"canvas"},"tagName"in gs||(gs.tagName="CANVAS"),Mixin.parentNode(gs),Mixin.style(gs),Mixin.classList(gs),Mixin.clientRegion(gs),Mixin.offsetRegion(gs),gs.getContext=function(a){if(a==="2d")return e},gs.focus=function(){},gs.blur=function(){}}function Ps(){return Qo}function Il(){return gs}var Xs=(0,Yt.Z)(function e(){(0,Bt.Z)(this,e);var n=Ps(),r=n.createImage&&n.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),An(r),Fo(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),rl={href:"",protocol:"",host:""};function _(e){var n=T();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function T(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F=function(e){(0,bn.Z)(r,e);var n=_(r);function r(){return(0,Bt.Z)(this,r),n.call(this,"body",0)}return(0,Yt.Z)(r,[{key:"addEventListener",value:function(a,s){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,h){}},{key:"dispatchEvent",value:function(a){}}]),r}(To),O=function(e){(0,bn.Z)(r,e);var n=_(r);function r(){return(0,Bt.Z)(this,r),n.call(this,"html",0)}return(0,Yt.Z)(r,[{key:"addEventListener",value:function(a,s){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(To),Y={},me={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:rl,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(n){return n=n.toLowerCase(),n==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):n==="img"?new Xs:n==="video"?new go:new To(n)},createElementNS:function(n,r){return this.createElement(r)},createTextNode:function(n){return n},getElementById:function(n){return null},getElementsByTagName:function(n){return n=n.toLowerCase(),[]},getElementsByTagNameNS:function(n,r){return this.getElementsByTagName(r)},getElementsByName:function(n){return[]},querySelector:function(n){return null},querySelectorAll:function(n){return[]},addEventListener:function(n,r,i){Y[n]||(Y[n]=[]),Y[n].push(r)},removeEventListener:function(n,r){var i=Y[n];if(i&&i.length>0){for(var a=i.length;a--;a>0)if(i[a]===r){i.splice(a,1);break}}},dispatchEvent:function(n){var r=n.type,i=Y[r];if(i)for(var a=0;a<i.length;a++)i[a](n);n.target&&typeof n.target["on"+r]=="function"&&n.target["on"+r](n)},createEvent:function(n){return new Ro(n)}};me.documentElement=new O,me.head=new To("head"),me.body=new F;var Ge=Object,ut=V(90484),ct=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"_w",void 0),(0,A.Z)(this,"_h",void 0),(0,A.Z)(this,"_data",void 0);var n=arguments.length;if(n===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else n===3&&(0,ut.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Yt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),lr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",mr,cn,ei;if(lr){var Hn=my.getSystemInfoSync();mr=Hn.system,cn=Hn.platform,ei=Hn.language}else{var vi={versions:function(){var e=Jn.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Jn.navigator.browserLanguage||Jn.navigator.language).toLowerCase()};vi.versions.android?cn="android":vi.versions.trident?cn="IE":vi.versions.presto?cn="Opera":vi.versions.webKit?cn="webKit":vi.versions.gecko?cn="Firefox":vi.versions.mobile?cn="mobile":vi.versions.ios?cn="ios":vi.versions.iPhone?cn="iPhone":vi.versions.iPad?cn="ipad":vi.versions.webApp?cn="webApp":vi.versions.weixin?cn="weixin":vi.versions.qq&&(cn="qq"),mr=Jn.navigator.userAgent,ei=vi.language}var ca=mr.toLowerCase().indexOf("android")!==-1,xa=ca?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Zi="Mozilla/5.0 (".concat(xa,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(ei),ys={platform:cn,language:ei,appVersion:"5.0 (".concat(xa,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Zi},hu={mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,r,i){return{duration:0}},now:function(){}},Zu=0,Mc=0;function nl(e){var n=Date.now(),r=Math.max(Zu+23,n);return Mc=setTimeout(function(){e(Zu=r)},r-n),Mc}function Pc(e){var n=Ps();return n.requestAnimationFrame?n.requestAnimationFrame(e):nl(e)}function Mu(e){var n=Ps();return n.cancelAnimationFrame?n.cancelAnimationFrame(e):clearTimeout(e)}var Pu=function(){function e(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Bt.Z)(this,e),(0,A.Z)(this,"href",void 0),n.indexOf("http://")==0||n.indexOf("https://")==0){this.href=n;return}this.href=r+n}return(0,Yt.Z)(e,null,[{key:"createObjectURL",value:function(r){var i=r.buffers[0],a=r.type,s=Iu(i),h="data:".concat(a,";base64, ");return h+s}}]),e}();function Iu(e){for(var n="",r=new Uint8Array(e),i=r.byteLength,a=0;a<i;a++)n+=String.fromCharCode(r[a]);return Xn(n)}var io={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},kf={};function Lf(e){var n=_s();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function _s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kl=new Map,pu=new Map,Ys=new Map,Df={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function il(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,n)}function ba(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,il.call(this,"readystatechange",n)}var Jo=function(e){(0,bn.Z)(r,e);var n=Lf(r);function r(){var i;return(0,Bt.Z)(this,r),i=n.call(this),(0,A.Z)((0,be.Z)(i),"onabort",void 0),(0,A.Z)((0,be.Z)(i),"onerror",void 0),(0,A.Z)((0,be.Z)(i),"onload",void 0),(0,A.Z)((0,be.Z)(i),"onloadstart",void 0),(0,A.Z)((0,be.Z)(i),"onprogress",void 0),(0,A.Z)((0,be.Z)(i),"ontimeout",void 0),(0,A.Z)((0,be.Z)(i),"onloadend",void 0),(0,A.Z)((0,be.Z)(i),"onreadystatechange",void 0),(0,A.Z)((0,be.Z)(i),"readyState",void 0),(0,A.Z)((0,be.Z)(i),"response",void 0),(0,A.Z)((0,be.Z)(i),"responseText",void 0),(0,A.Z)((0,be.Z)(i),"_responseType",void 0),(0,A.Z)((0,be.Z)(i),"responseXML",void 0),(0,A.Z)((0,be.Z)(i),"status",void 0),(0,A.Z)((0,be.Z)(i),"statusText",void 0),(0,A.Z)((0,be.Z)(i),"upload",void 0),(0,A.Z)((0,be.Z)(i),"withCredentials",void 0),(0,A.Z)((0,be.Z)(i),"timeout",void 0),(0,A.Z)((0,be.Z)(i),"_url",void 0),(0,A.Z)((0,be.Z)(i),"_method",void 0),i.onabort=null,i.onerror=null,i.onload=null,i.onloadstart=null,i.onprogress=null,i.ontimeout=null,i.onloadend=null,i.onreadystatechange=null,i.readyState=0,i.response=null,i.responseText=null,i._responseType="text",i.responseXML=null,i.status=0,i.statusText="",i.upload={},i.withCredentials=!1,Kl.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),i}return(0,Yt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Ys.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=pu.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return pu.get("responseHeader")[a]}},{key:"open",value:function(a,s,h){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var h=Kl.get("requestHeader");h[a]=s,Kl.set("requestHeader",h)}},{key:"addEventListener",value:function(a,s){var h=this;typeof s=="function"&&(this["on"+a]=function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m.target=m.target||h,s.call(h,m)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(La);(0,A.Z)(Jo,"UNSEND",void 0),(0,A.Z)(Jo,"OPENED",void 0),(0,A.Z)(Jo,"HEADERS_RECEIVED",void 0),(0,A.Z)(Jo,"LOADING",void 0),(0,A.Z)(Jo,"DONE",void 0),Jo.UNSEND=0,Jo.OPENED=1,Jo.HEADERS_RECEIVED=2,Jo.LOADING=3,Jo.DONE=4;function ph(e){var n=al();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function al(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ff=function(e){(0,bn.Z)(r,e);var n=ph(r);function r(i){var a;return(0,Bt.Z)(this,r),a=n.call(this,i),(0,A.Z)((0,be.Z)(a),"touches",void 0),(0,A.Z)((0,be.Z)(a),"targetTouches",void 0),(0,A.Z)((0,be.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=Ps(),a.currentTarget=Ps(),a}return(0,Yt.Z)(r)}(Ro);function Bf(e){var n=e||{},r=n.x,i=r===void 0?0:r,a=n.y,s=a===void 0?0:a,h=n.clientX,m=h===void 0?0:h,y=n.clientY,E=y===void 0?0:y;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=i,e.pageY=e.clientY=s):(e.x=m,e.y=E)}function nf(e){return function(n){var r=new Ff(e);r.changedTouches=n.changedTouches,r.touches=n.touches,r.targetTouches=Array.prototype.slice.call(n.touches),r.timeStamp=n.timeStamp,r.changedTouches.forEach(function(i){return Bf(i)}),r.touches.forEach(function(i){return Bf(i)}),r.targetTouches.forEach(function(i){return Bf(i)}),me.dispatchEvent(r)}}function af(e){return function(n){n.type=e,me.dispatchEvent(n)}}var Ic=nf("touchstart"),$l=nf("touchmove"),Ql=nf("touchend"),Jl=af("mapCameaParams");function ol(e){var n=Ol();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Ol(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sl=function(e){(0,bn.Z)(r,e);var n=ol(r);function r(i){var a;return(0,Bt.Z)(this,r),a=n.call(this,i),(0,A.Z)((0,be.Z)(a),"buttons",void 0),(0,A.Z)((0,be.Z)(a),"which",void 0),(0,A.Z)((0,be.Z)(a),"pointerId",void 0),(0,A.Z)((0,be.Z)(a),"bubbles",void 0),(0,A.Z)((0,be.Z)(a),"button",void 0),(0,A.Z)((0,be.Z)(a),"width",void 0),(0,A.Z)((0,be.Z)(a),"height",void 0),(0,A.Z)((0,be.Z)(a),"pressure",void 0),(0,A.Z)((0,be.Z)(a),"isPrimary",void 0),(0,A.Z)((0,be.Z)(a),"pointerType",void 0),(0,A.Z)((0,be.Z)(a),"altKey",void 0),(0,A.Z)((0,be.Z)(a),"ctrlKey",void 0),(0,A.Z)((0,be.Z)(a),"metaKey",void 0),(0,A.Z)((0,be.Z)(a),"shiftKey",void 0),a.target=Ps(),a.currentTarget=Ps(),a}return(0,Yt.Z)(r)}(Ro),Ds=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],of=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],sf="touch";function Nf(e,n,r){for(var i=new sl(e),a=0;a<Ds.length;a++){var s=Ds[a];i[s]=n[s]||of[a]}return i.type=e,i.target=Ps(),i.currentTarget=Ps(),i.buttons=ul(e),i.which=i.buttons,i.pointerId=(n.identifier||0)+2,i.bubbles=!0,i.cancelable=!0,i.button=0,i.width=(n.radiusX||.5)*2,i.height=(n.radiusY||.5)*2,i.pressure=n.force||.5,i.isPrimary=Oc(n),i.pointerType=sf,i.altKey=r.altKey,i.ctrlKey=r.ctrlKey,i.metaKey=r.metaKey,i.shiftKey=r.shiftKey,r.preventDefault&&(i.preventDefault=function(){r.preventDefault()}),i}function ul(e){var n=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(n=1),n}var Ou=null;function Oc(e){return Ou===e.identifier}function uf(e){Ou===null&&(Ou=e.identifier)}function Rc(e){Ou===e.identifier&&(Ou=null)}function lf(e){return function(n){for(var r=n.changedTouches,i=0;i<r.length;i++){var a=r[i];i===0&&e==="pointerdown"?uf(a):(e==="pointerup"||e==="pointercancel")&&Rc(a);var s=Nf(e,a,n);me.dispatchEvent(s)}}}var cf=lf("pointerdown"),Rl=lf("pointermove"),zf=lf("pointerup");function ff(e){var n=ll();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function ll(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dh=function(e){(0,bn.Z)(r,e);var n=ff(r);function r(i){return(0,Bt.Z)(this,r),n.call(this,i)}return(0,Yt.Z)(r)}(Ro);function kc(e){return function(n){n.type=e,me.dispatchEvent(n)}}var vh=kc("mousedown"),ec=kc("mousemove"),np=kc("mouseup"),kl=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ba=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),es=kl||Ba,Ll={atob:Ei,btoa:Xn,devicePixelRatio:Sa,Blob:Ki,document:me,Element:wo,Event:Ro,EventTarget:La,HTMLCanvasElement:Ge,HTMLElement:To,HTMLMediaElement:Ws,HTMLVideoElement:go,Image:Xs,ImageData:ct,navigator:ys,Node:Lo,requestAnimationFrame:Pc,cancelAnimationFrame:Mu,screen:Ee,XMLHttpRequest:Jo,performance:hu,URL:Pu,WebGLRenderingContext:io,WebGL2RenderingContext:kf,addEventListener:function(n,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};me.addEventListener(n,r,i)},removeEventListener:function(n,r,i){me.removeEventListener(n,r)},dispatchEvent:function(n){me.dispatchEvent(n)},innerWidth:Ee.availWidth,innerHeight:Ee.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Xi=es?Ll:Jn,Vi=es?Jo:Jn.XMLHttpRequest,Ta=es?rl:Jn.location;function Is(e){var n=e;return typeof e=="string"&&(n=Xi.document.getElementById(e)),n}function tc(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Vu(e){return tc(e).split(/\s+/)}function Lc(e){var n,r,i=Xi==null||(n=Xi.document)===null||n===void 0||(r=n.documentElement)===null||r===void 0?void 0:r.style;if(!i)return e[0];for(var a in e)if(e[a]&&e[a]in i)return e[a];return e[0]}function ao(e,n,r){var i=Xi.document.createElement(e);return i.className=n||"",r&&r.appendChild(i),i}function rc(e){var n=e.parentNode;n&&n.removeChild(e)}function du(e,n){if(e.classList!==void 0)for(var r=Vu(n),i=0,a=r.length;i<a;i++)e.classList.add(r[i]);else if(!Gu(e,n)){var s=cl(e);yo(e,(s?s+" ":"")+n)}}function ju(e,n){e.classList!==void 0?e.classList.remove(n):yo(e,tc((" "+cl(e)+" ").replace(" "+n+" "," ")))}function Gu(e,n){if(e.classList!==void 0)return e.classList.contains(n);var r=cl(e);return r.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(r)}function yo(e,n){e instanceof HTMLElement?e.className=n:e.className.baseVal=n}function cl(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Dl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var _o=Lc(["transform","WebkitTransform"]);function dn(e,n){e.style[_o]=n}function Ja(){if(typeof Event=="function")Xi.dispatchEvent(new Event("resize"));else{var e=Xi.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Xi,0),Xi.dispatchEvent(e)}}function fl(e){var n=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,n.join(""))}function Fl(){var e,n=Xi.document.querySelector('meta[name="viewport"]');if(!n)return 1;var r=(e=n.content)===null||e===void 0?void 0:e.split(","),i=r.find(function(a){var s=a.split("="),h=(0,Vn.Z)(s,2),m=h[0],y=h[1];return m==="initial-scale"});return i?i.split("=")[1]*1:1}var fa=Fl()<1?1:Xi.devicePixelRatio,xs=V(14665);function hf(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var qr=V(51814);function Bl(e,n,r){return(0,qr.Z)()?Bl=Reflect.construct:Bl=function(a,s,h){var m=[null];m.push.apply(m,s);var y=Function.bind.apply(a,m),E=new y;return h&&(0,xs.Z)(E,h.prototype),E},Bl.apply(null,arguments)}function nc(e){var n=typeof Map=="function"?new Map:void 0;return nc=function(i){if(i===null||!hf(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n!="undefined"){if(n.has(i))return n.get(i);n.set(i,a)}function a(){return Bl(i,arguments,(0,At.Z)(this).constructor)}return a.prototype=Object.create(i.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,xs.Z)(a,i)},nc(e)}function hl(e){var n=Ma();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Ma(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ss=function(e){(0,bn.Z)(r,e);var n=hl(r);function r(i,a,s){var h;return(0,Bt.Z)(this,r),h=n.call(this,i),(0,A.Z)((0,be.Z)(h),"status",void 0),(0,A.Z)((0,be.Z)(h),"url",void 0),h.status=a,h.url=s,h.name=h.constructor.name,h.message=i,h}return(0,Yt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(nc(Error));function ic(e){var n=new Vi;n.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&n.setRequestHeader(r,e.headers[r]);return n.withCredentials=e.credentials==="include",n}var Hu=function(n,r){var i=ic(n);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var a;try{a=JSON.parse(i.response)}catch(s){return r(s)}r(null,a)}else i.status===401?r(new ss("".concat(i.statusText),i.status,n.url)):r(new ss(i.statusText,i.status,n.url))},i.send(),i},Os=function(n,r){var i=ic(n);return i.responseType="arraybuffer",i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){var a=i.response;if(a.byteLength===0&&i.status===200)return r(new Error("http status 200 returned without content."));i.status>=200&&i.status<300&&i.response?r(null,{data:a,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):r(new ss(i.statusText,i.status,n.url))},i.send(),i};function Wu(e){var n=$window.document.createElement("a");return n.href=e,n.protocol===$window.document.location.protocol&&n.host===$window.document.location.host}var mh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",ac=function(n,r){return Os(n,function(i,a){if(i)r(i);else if(a){var s=new Xi.Image;s.crossOrigin="anonymous";var h=Xi.URL||Xi.webkitURL;s.onload=function(){r(null,s),h.revokeObjectURL(s.src)};var m=new Xi.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?h.createObjectURL(m):mh}})},oc=2*Math.PI*6378137/2;function Uf(e){var n=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var i=r.coordinates;Fs(n,i)}),n}function Fs(e,n){return Array.isArray(n[0])?n.forEach(function(r){Fs(e,r)}):(e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])),e}function qs(e,n){return Mi(e,n)}function Mi(e,n){return Array.isArray(e[0])?e.map(function(r){return Mi(r,n)}):n(e)}function Ks(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=dl(e,n);var i=e[0],a=e[1],s=i*oc/180,h=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return h=h*oc/180,r.enable&&(s=Number(s.toFixed(r.decimal)),h=Number(h.toFixed(r.decimal))),e.length===3?[s,h,e[2]]:[s,h]}function vu(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],i=e[1],a=r/oc*180,s=i/oc*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),n!=null&&(a=Number(a.toFixed(n)),s=Number(s.toFixed(n))),e.length===3?[a,s,e[2]]:[a,s]}function Xo(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function pl(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function dl(e,n){if(n===!1)return e;var r=Xo(e[0]),i=pl(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[r,i,e[2]]:[r,i]}function fo(e){var n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=256<<20,a=Math.PI/180,s=e[0]*a,h=r*a;h=Math.log(Math.tan(Math.PI/4+h/2));var m=.5/Math.PI,y=.5,E=-.5/Math.PI;return a=.5,s=i*(m*s+y),h=i*(E*h+a),[Math.floor(s),Math.floor(h)]}function Rs(e){var n=.5/Math.PI,r=.5,i=-.5/Math.PI,a=.5,s=256<<20,h=_slicedToArray(e,2),m=h[0],y=h[1];m=(m/s-r)/n,y=(y/s-a)/i,y=(Math.atan(Math.pow(Math.E,y))-Math.PI/4)*2,a=Math.PI/180;var E=y/a,w=m/a;return[w,E]}function nu(e,n,r){var i=Ar(n[1]-e[1]),a=Ar(n[0]-e[0]),s=Ar(e[1]),h=Ar(n[1]),m=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(h);return ui(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),r="meters")}function kn(e){var n=Math.PI/180,r=85.0511287798,i=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*n),h=i*e[0]*n,m=i*Math.log((1+s)/(1-s))/2;return[h,m]}function Sn(e,n){var r=Math.abs(e[1][1]-e[0][1])*n,i=Math.abs(e[1][0]-e[0][0])*n;return[[e[0][0]-i,e[0][1]-r],[e[1][0]+i,e[1][1]+r]]}function sc(e,n){return e[0][0]<=n[0][0]&&e[0][1]<=n[0][1]&&e[1][0]>=n[1][0]&&e[1][1]>=n[1][1]}function us(e){return[[e[0],e[1]],[e[2],e[3]]]}function iu(e,n){return Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2))}function Yo(e,n){return e[0]*n[0]+e[1]*n[1]}function au(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Zf(e,n){return Math.acos(Yo(e,n)/(au(e)*au(n)))*180/Math.PI}function Dc(e,n){return n[0]>0?n[1]>0?90-Math.atan(n[1]/n[0])*180/Math.PI:90+Math.atan(-n[1]/n[0])*180/Math.PI:n[1]<0?180+(90-Math.atan(n[1]/n[0])*180/Math.PI):270+Math.atan(n[1]/-n[0])*180/Math.PI}function ha(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],i=0,a=[],s=0;s<e.length-1;s++){var h=e[s],m=e[s+1],y=iu(h,m);i+=y;var E=[h[0]-m[0],h[1]-m[1]],w=Dc(r,E);if(s>0){var I=a[s-1].rotation;I-w>360-I+w&&(w=w+360)}a.push({start:h,end:m,dis:y,rotation:w,duration:0})}return a.map(function(k){k.duration=n*(k.dis/i)}),a}}var Pa=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,Bt.Z)(this,e),(0,A.Z)(this,"limit",void 0),(0,A.Z)(this,"cache",void 0),(0,A.Z)(this,"destroy",void 0),(0,A.Z)(this,"order",void 0),this.limit=n,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Yt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(i){r.delete(i)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var i=this.cache[r];return i&&(this.deleteOrder(r),this.appendOrder(r)),i}},{key:"set",value:function(r,i){this.cache[r]?(this.delete(r),this.cache[r]=i,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=i,this.appendOrder(r))}},{key:"delete",value:function(r){var i=this.cache[r];i&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(i,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var i=this.order.findIndex(function(a){return a===r});i>=0&&this.order.splice(i,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,i){return null}}]),e}();function vl(e,n){e.forEach(function(r){!n[r]||(n[r]=n[r].bind(n))})}var uc=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,Bt.Z)(this,e),(0,A.Z)(this,"duration",16),(0,A.Z)(this,"timestamp",new Date().getTime()),this.duration=n}return(0,Yt.Z)(e,[{key:"run",value:function(r){var i=new Date().getTime(),a=i-this.timestamp;this.timestamp=i,a>=this.duration&&r()}}]),e}();function $s(e,n,r){e.prototype=n.prototype=r,r.constructor=e}function ou(e,n){var r=Object.create(e.prototype);for(var i in n)r[i]=n[i];return r}function oo(){}var Qs=.7,Bs=1/Qs,Ru="\\s*([+-]?\\d+)\\s*",mu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ks="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",pf=/^#([0-9a-f]{3,8})$/,lc=new RegExp("^rgb\\("+[Ru,Ru,Ru]+"\\)$"),Nl=new RegExp("^rgb\\("+[ks,ks,ks]+"\\)$"),Vf=new RegExp("^rgba\\("+[Ru,Ru,Ru,mu]+"\\)$"),ml=new RegExp("^rgba\\("+[ks,ks,ks,mu]+"\\)$"),gl=new RegExp("^hsl\\("+[mu,ks,ks]+"\\)$"),df=new RegExp("^hsla\\("+[mu,ks,ks,mu]+"\\)$"),Xu={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$s(oo,ku,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Ns,formatHex:Ns,formatHsl:vf,formatRgb:cc,toString:cc});function Ns(){return this.rgb().formatHex()}function vf(){return z(this).formatHsl()}function cc(){return this.rgb().formatRgb()}function ku(e){var n,r;return e=(e+"").trim().toLowerCase(),(n=pf.exec(e))?(r=n[1].length,n=parseInt(n[1],16),r===6?zl(n):r===3?new d(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):r===8?l(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):r===4?l(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=lc.exec(e))?new d(n[1],n[2],n[3],1):(n=Nl.exec(e))?new d(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=Vf.exec(e))?l(n[1],n[2],n[3],n[4]):(n=ml.exec(e))?l(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=gl.exec(e))?R(n[1],n[2]/100,n[3]/100,1):(n=df.exec(e))?R(n[1],n[2]/100,n[3]/100,n[4]):Xu.hasOwnProperty(e)?zl(Xu[e]):e==="transparent"?new d(NaN,NaN,NaN,0):null}function zl(e){return new d(e>>16&255,e>>8&255,e&255,1)}function l(e,n,r,i){return i<=0&&(e=n=r=NaN),new d(e,n,r,i)}function f(e){return e instanceof oo||(e=ku(e)),e?(e=e.rgb(),new d(e.r,e.g,e.b,e.opacity)):new d}function c(e,n,r,i){return arguments.length===1?f(e):new d(e,n,r,i==null?1:i)}function d(e,n,r,i){this.r=+e,this.g=+n,this.b=+r,this.opacity=+i}$s(d,c,ou(oo,{brighter:function(e){return e=e==null?Bs:Math.pow(Bs,e),new d(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Qs:Math.pow(Qs,e),new d(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:b,formatHex:b,formatRgb:C,toString:C}));function b(){return"#"+M(this.r)+M(this.g)+M(this.b)}function C(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function M(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function R(e,n,r,i){return i<=0?e=n=r=NaN:r<=0||r>=1?e=n=NaN:n<=0&&(e=NaN),new ne(e,n,r,i)}function z(e){if(e instanceof ne)return new ne(e.h,e.s,e.l,e.opacity);if(e instanceof oo||(e=ku(e)),!e)return new ne;if(e instanceof ne)return e;e=e.rgb();var n=e.r/255,r=e.g/255,i=e.b/255,a=Math.min(n,r,i),s=Math.max(n,r,i),h=NaN,m=s-a,y=(s+a)/2;return m?(n===s?h=(r-i)/m+(r<i)*6:r===s?h=(i-n)/m+2:h=(n-r)/m+4,m/=y<.5?s+a:2-s-a,h*=60):m=y>0&&y<1?0:h,new ne(h,m,y,e.opacity)}function H(e,n,r,i){return arguments.length===1?z(e):new ne(e,n,r,i==null?1:i)}function ne(e,n,r,i){this.h=+e,this.s=+n,this.l=+r,this.opacity=+i}$s(ne,H,ou(oo,{brighter:function(e){return e=e==null?Bs:Math.pow(Bs,e),new ne(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Qs:Math.pow(Qs,e),new ne(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*n,a=2*r-i;return new d(ue(e>=240?e-240:e+120,a,i),ue(e,a,i),ue(e<120?e+240:e-120,a,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function ue(e,n,r){return(e<60?n+(r-n)*e/60:e<180?r:e<240?n+(r-n)*(240-e)/60:n)*255}function fe(e){return typeof e=="string"?!!ku(e):!1}function Ce(e){var n=ku(e),r=[0,0,0,0];return n!=null&&(r[0]=n.r/255,r[1]=n.g/255,r[2]=n.b/255,r[3]=n.opacity),r}function Pe(e){var n=e&&e[0],r=e&&e[1],i=e&&e[2],a=n+r*256+i*65536-1;return a}function Ue(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Ae(e){var n=Xi.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],h=e.positions[e.positions.length-1],m=0;m<e.colors.length;++m){var y=(e.positions[m]-s)/(h-s);i.addColorStop(y,e.colors[m])}return r.fillStyle=i,r.fillRect(0,0,256,1),a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),es?{data:a,width:256,height:1}:new ImageData(a,256,1)}var Ze;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Ze||(Ze={}));var Ke={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mt(e,n,r){var i=e.classList;for(var a in Ke)Ke.hasOwnProperty(a)&&i.remove("l7-".concat(r,"-anchor-").concat(a));i.add("l7-".concat(r,"-anchor-").concat(n))}function St(e,n){return{enable:e,mask:255,func:{cmp:514,ref:n?1:0,mask:255}}}function Zt(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n*1}function Kt(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n*1}function pr(e){if(e.length===0)return 0;for(var n=e[0]*1,r=1;r<e.length;r++)n+=e[r]*1;return n}function kr(e){if(e.length===0)throw new Error("mean requires at least one data point");return pr(e)/e.length}function Or(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var n=e[0],r=NaN,i=0,a=1,s=1;s<e.length+1;s++)e[s]!==n?(a>i&&(i=a,r=n),a=1,n=e[s]):a++;return r*1}var tn={min:Kt,max:Zt,mean:kr,sum:pr,mode:Or};function Ln(e,n){return e.map(function(r){return r[n]})}function Fn(e,n){return tn[e](n)}function zn(e,n){var r=n.extent,i=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(h){Ri(e,function(m){h(m)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[i[0],i[1]],[i[2],i[3]]]}]};return s}function Ri(e,n){var r=e,i=[];if(typeof r=="string")ac({url:r},function(h,m){i.push(m),n(i)});else{var a=r.length,s=0;r.forEach(function(h){ac({url:h},function(m,y){s++,i.push(y),s===a&&n(i)})})}return zn}function sn(e,n){var r=n.extent,i=n.width,a=n.height,s=n.min,h=n.max,m={_id:1,dataArray:[{_id:1,data:Array.from(e),width:i,height:a,min:s,max:h,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return m}var ai=V(30236),fi=V.n(ai),ti=V(47037),On=V.n(ti),yi=V(23560),Un=V.n(yi),jn=V(50361),eo=V.n(jn),Da=V(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Bo(e,n,r,i){function a(s){return s instanceof r?s:new r(function(h){h(s)})}return new(r||(r=Promise))(function(s,h){function m(w){try{E(i.next(w))}catch(I){h(I)}}function y(w){try{E(i.throw(w))}catch(I){h(I)}}function E(w){w.done?s(w.value):a(w.value).then(m,y)}E((i=i.apply(e,n||[])).next())})}function No(e,n){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,a,s,h;return h={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function m(E){return function(w){return y([E,w])}}function y(E){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,a&&(s=E[0]&2?a.return:E[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,E[1])).done)return s;switch(a=0,s&&(E=[E[0]&2,s.value]),E[0]){case 0:case 1:s=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,a=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!s||E[1]>s[0]&&E[1]<s[3])){r.label=E[1];break}if(E[0]===6&&r.label<s[1]){r.label=s[1],s=E;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(E);break}s[2]&&r.ops.pop(),r.trys.pop();continue}E=n.call(e,r)}catch(w){E=[6,w],a=0}finally{i=s=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function Wa(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),a,s=[],h;try{for(;(n===void 0||n-- >0)&&!(a=i.next()).done;)s.push(a.value)}catch(m){h={error:m}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(h)throw h.error}}return s}function so(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(Wa(arguments[n]));return e}function pa(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function na(e,n){return n={exports:{}},e(n,n.exports),n.exports}var Js=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1==0}e.exports=n.default});pa(Js);var ts=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];var s=i.pop();return r.call(this,i,s)}},e.exports=n.default});pa(ts);var ls=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fallback=a,n.wrap=s;var r=n.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,i=n.hasNextTick=typeof Da=="object"&&typeof Da.nextTick=="function";function a(m){setTimeout(m,0)}function s(m){return function(y){for(var E=[],w=arguments.length-1;w-- >0;)E[w]=arguments[w+1];return m(function(){return y.apply(void 0,E)})}}var h;r?h=setImmediate:i?h=Da.nextTick:h=a,n.default=s(h)});pa(ls);var su=ls.fallback,Fc=ls.wrap,fc=ls.hasSetImmediate,Yu=ls.hasNextTick,yl=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=s;var r=a(ts),i=a(ls);function a(y){return y&&y.__esModule?y:{default:y}}function s(y){return(0,bs.isAsync)(y)?function(){for(var E=[],w=arguments.length;w--;)E[w]=arguments[w];var I=E.pop(),k=y.apply(this,E);return h(k,I)}:(0,r.default)(function(E,w){var I;try{I=y.apply(this,E)}catch(k){return w(k)}if(I&&typeof I.then=="function")return h(I,w);w(null,I)})}function h(y,E){return y.then(function(w){m(E,null,w)},function(w){m(E,w&&w.message?w:new Error(w))})}function m(y,E,w){try{y(E,w)}catch(I){(0,i.default)(function(k){throw k},I)}}e.exports=n.default});pa(yl);var bs=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAsyncIterable=n.isAsyncGenerator=n.isAsync=void 0;var r=i(yl);function i(y){return y&&y.__esModule?y:{default:y}}function a(y){return y[Symbol.toStringTag]==="AsyncFunction"}function s(y){return y[Symbol.toStringTag]==="AsyncGenerator"}function h(y){return typeof y[Symbol.asyncIterator]=="function"}function m(y){if(typeof y!="function")throw new Error("expected a function");return a(y)?(0,r.default)(y):y}n.default=m,n.isAsync=a,n.isAsyncGenerator=s,n.isAsyncIterable=h});pa(bs);var gu=bs.isAsyncIterable,hc=bs.isAsyncGenerator,Lu=bs.isAsync,Na=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i,a){if(a===void 0&&(a=i.length),!a)throw new Error("arity is undefined");function s(){for(var h=this,m=[],y=arguments.length;y--;)m[y]=arguments[y];return typeof m[a-1]=="function"?i.apply(this,m):new Promise(function(E,w){m[a-1]=function(I){for(var k=[],D=arguments.length-1;D-- >0;)k[D]=arguments[D+1];if(I)return w(I);E(k.length>1?k:k[0])},i.apply(h,m)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+i.name+")"}),s}e.exports=n.default});pa(Na);var uu=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=s(Js),i=s(bs),a=s(Na);function s(h){return h&&h.__esModule?h:{default:h}}n.default=(0,a.default)(function(h,m,y){var E=(0,r.default)(m)?[]:{};h(m,function(w,I,k){(0,i.default)(w)(function(D){for(var W,J=[],ie=arguments.length-1;ie-- >0;)J[ie]=arguments[ie+1];J.length<2&&(W=J,J=W[0]),E[I]=J,k(D)})},function(w){return y(w,E)})},3),e.exports=n.default});pa(uu);var lu=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){function a(){for(var s=[],h=arguments.length;h--;)s[h]=arguments[h];if(i!==null){var m=i;i=null,m.apply(this,s)}}return Object.assign(a,i),a}e.exports=n.default});pa(lu);var Du=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=n.default});pa(Du);var Qi=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=y;var r=a(Js),i=a(Du);function a(E){return E&&E.__esModule?E:{default:E}}function s(E){var w=-1,I=E.length;return function(){return++w<I?{value:E[w],key:w}:null}}function h(E){var w=-1;return function(){var k=E.next();return k.done?null:(w++,{value:k.value,key:w})}}function m(E){var w=E?Object.keys(E):[],I=-1,k=w.length;return function(){var W=w[++I];return I<k?{value:E[W],key:W}:null}}function y(E){if((0,r.default)(E))return s(E);var w=(0,i.default)(E);return w?h(w):m(E)}e.exports=n.default});pa(Qi);var cs=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(i===null)throw new Error("Callback was already called.");var h=i;i=null,h.apply(this,a)}}e.exports=n.default});pa(cs);var zo=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={};n.default=r,e.exports=n.default});pa(zo);var Fu=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=a;var r=i(zo);function i(s){return s&&s.__esModule?s:{default:s}}function a(s,h,m,y){var E=!1,w=!1,I=!1,k=0,D=0;function W(){k>=h||I||E||(I=!0,s.next().then(function(Oe){var qe=Oe.value,rt=Oe.done;if(!(w||E)){if(I=!1,rt){E=!0,k<=0&&y(null);return}k++,m(qe,D,J),D++,W()}}).catch(ie))}function J(Oe,qe){if(k-=1,!w){if(Oe)return ie(Oe);if(Oe===!1){E=!0,w=!0;return}if(qe===r.default||E&&k<=0)return E=!0,y(null);W()}}function ie(Oe){w||(I=!1,E=!0,y(Oe))}W()}e.exports=n.default});pa(Fu);var pc=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=m(lu),i=m(Qi),a=m(cs),s=m(Fu),h=m(zo);function m(y){return y&&y.__esModule?y:{default:y}}n.default=function(y){return function(E,w,I){if(I=(0,r.default)(I),y<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!E)return I(null);if((0,bs.isAsyncGenerator)(E))return(0,s.default)(E,y,w,I);if((0,bs.isAsyncIterable)(E))return(0,s.default)(E[Symbol.asyncIterator](),y,w,I);var k=(0,i.default)(E),D=!1,W=!1,J=0,ie=!1;function Oe(rt,pt){if(!W)if(J-=1,rt)D=!0,I(rt);else if(rt===!1)D=!0,W=!0;else{if(pt===h.default||D&&J<=0)return D=!0,I(null);ie||qe()}}function qe(){for(ie=!0;J<y&&!D;){var rt=k();if(rt===null){D=!0,J<=0&&I(null);return}J+=1,w(rt.value,rt.key,(0,a.default)(Oe))}ie=!1}qe()}},e.exports=n.default});pa(pc);var Ul=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=s(pc),i=s(bs),a=s(Na);function s(m){return m&&m.__esModule?m:{default:m}}function h(m,y,E,w){return(0,r.default)(y)(m,(0,i.default)(E),w)}n.default=(0,a.default)(h,4),e.exports=n.default});pa(Ul);var Bc=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=a(Ul),i=a(Na);function a(h){return h&&h.__esModule?h:{default:h}}function s(h,m,y){return(0,r.default)(h,1,m,y)}n.default=(0,i.default)(s,3),e.exports=n.default});pa(Bc);var eu=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=s;var r=a(uu),i=a(Bc);function a(h){return h&&h.__esModule?h:{default:h}}function s(h,m){return(0,r.default)(i.default,h,m)}e.exports=n.default}),Zl=pa(eu),Mo=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return this.args=r,Zl(this.tasks)},e.prototype.tap=function(n,r){var i=this;this.tasks.push(function(a){r.apply(void 0,so(i.args)),a(null,n)})},e}(),qu=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=E(Js),i=E(zo),a=E(Ul),s=E(lu),h=E(cs),m=E(bs),y=E(Na);function E(D){return D&&D.__esModule?D:{default:D}}function w(D,W,J){J=(0,s.default)(J);var ie=0,Oe=0,qe=D.length,rt=!1;qe===0&&J(null);function pt(kt,zt){kt===!1&&(rt=!0),rt!==!0&&(kt?J(kt):(++Oe===qe||zt===i.default)&&J(null))}for(;ie<qe;ie++)W(D[ie],ie,(0,h.default)(pt))}function I(D,W,J){return(0,a.default)(D,Infinity,W,J)}function k(D,W,J){var ie=(0,r.default)(D)?w:I;return ie(D,(0,m.default)(W),J)}n.default=(0,y.default)(k,3),e.exports=n.default});pa(qu);var Nc=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=s;var r=a(qu),i=a(uu);function a(h){return h&&h.__esModule?h:{default:h}}function s(h,m){return(0,i.default)(r.default,h,m)}e.exports=n.default}),yu=pa(Nc),Uo=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.promise=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return yu(this.tasks)},e.prototype.tapPromise=function(n,r){var i=this;this.tasks.push(function(a){return Bo(i,void 0,void 0,function(){return No(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,n),[2]}})})})},e}(),zc=na(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=h(lu),i=h(cs),a=h(bs),s=h(Na);function h(y){return y&&y.__esModule?y:{default:y}}function m(y,E){if(E=(0,r.default)(E),!Array.isArray(y))return E(new Error("First argument to waterfall must be an array of functions"));if(!y.length)return E();var w=0;function I(D){var W=(0,a.default)(y[w++]);W.apply(void 0,D.concat([(0,i.default)(k)]))}function k(D){for(var W=[],J=arguments.length-1;J-- >0;)W[J]=arguments[J+1];if(D!==!1){if(D||w===y.length)return E.apply(void 0,[D].concat(W));I(W)}}I([])}n.default=(0,s.default)(m),e.exports=n.default}),jf=pa(zc),gh=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return jf(this.tasks)},e.prototype.tap=function(n,r){this.tasks.length===0?this.tasks.push(function(i){var a=r();i(a?null:!1,a)}):this.tasks.push(function(i,a){var s=r();a(s?null:!1,n)})},e}(),Uc=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Zl(this.tasks)},e.prototype.tap=function(n,r){this.tasks.push(function(i){var a=r();i(a,n)})},e}(),_u=V(26729),ip=V.n(_u),dc=V(69848),Zc=V.n(dc);function Gf(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function ap(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Gf(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gf(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function _l(e,n){var r=n.radius,i=r===void 0?40:r,a=n.maxZoom,s=a===void 0?18:a,h=n.minZoom,m=h===void 0?0:h,y=n.zoom,E=y===void 0?2:y;if(e.pointIndex){var w=e.pointIndex.getClusters(e.extent,Math.floor(E));return e.dataArray=mf(w),e}var I=new(Zc())({radius:i,minZoom:m,maxZoom:s}),k={type:"FeatureCollection",features:[]};return k.features=e.dataArray.map(function(D){return{type:"Feature",geometry:{type:"Point",coordinates:D.coordinates},properties:ap({},D)}}),I.load(k.features),I}function mf(e){return e.map(function(n,r){return ap({coordinates:n.geometry.coordinates,_id:r+1},n.properties)})}function Vp(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n}function xd(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n}function Vc(e){if(e.length===0)return 0;for(var n=e[0],r=0,i,a=1;a<e.length;a++)i=n+e[a]*1,Math.abs(n)>=Math.abs(e[a])?r+=n-i+e[a]:r+=e[a]-i+n,n=i;return n+r*1}function op(e){if(e.length===0)throw new Error("mean requires at least one data point");return Vc(e)/e.length}var bd={min:xd,max:Vp,mean:op,sum:Vc};function Ed(e,n){return e.map(function(r){return r[n]*1})}function sp(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function yh(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?sp(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sp(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Sd(e){var n=gf();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function gf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Cd(e,n){if(Array.isArray(n))return n}var Po=function(e){(0,bn.Z)(r,e);var n=Sd(r);function r(i,a){var s;return(0,Bt.Z)(this,r),s=n.call(this),(0,A.Z)((0,be.Z)(s),"data",void 0),(0,A.Z)((0,be.Z)(s),"extent",void 0),(0,A.Z)((0,be.Z)(s),"hooks",{init:new Mo}),(0,A.Z)((0,be.Z)(s),"parser",{type:"geojson"}),(0,A.Z)((0,be.Z)(s),"transforms",[]),(0,A.Z)((0,be.Z)(s),"cluster",!1),(0,A.Z)((0,be.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,A.Z)((0,be.Z)(s),"mapService",void 0),(0,A.Z)((0,be.Z)(s),"invalidExtent",!1),(0,A.Z)((0,be.Z)(s),"originData",void 0),(0,A.Z)((0,be.Z)(s),"rawData",void 0),(0,A.Z)((0,be.Z)(s),"cfg",{}),(0,A.Z)((0,be.Z)(s),"clusterIndex",void 0),s.originData=i,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Yt.Z)(r,[{key:"setData",value:function(a,s){this.rawData=a,this.originData=a,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,h=this.clusterOptions,m=h.method,y=m===void 0?"sum":m,E=h.field,w=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,w.forEach(function(I){I.id||(I.properties.point_count=1)}),(E||Un()(y))&&(w=w.map(function(I){var k=I.id;if(k){var D=s.clusterIndex.getLeaves(k,Infinity),W=D.map(function(Oe){return Oe.properties}),J;if(On()(y)&&E){var ie=Ed(W,E);J=bd[y](ie)}Un()(y)&&(J=y(W)),I.properties.stat=J}else I.properties.point_count=1;return I})),this.data=Re("geojson")({type:"FeatureCollection",features:w}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,h=s===void 0?"geojson":s;if(h==="geojson"&&!this.cluster){var m=a<this.originData.features.length?this.originData.features[a]:"null",y=eo()(m);if(this.transforms.length!==0){var E=this.data.dataArray.find(function(w){return w._id===a});y.properties=E}return y}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"getFeatureId",value:function(a,s){var h=this.data.dataArray.find(function(m){return m[a]===name});return h==null?void 0:h._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=Sn(us(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=fi()(this.cfg,a,Cd);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=yh(yh({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var h=Re(s);this.data=h(this.originData,a),this.extent=Uf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(h){var m=h.type,y=$e(m)(a.data,h);Object.assign(a.data,y)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=_l(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(_u.EventEmitter);function _h(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function up(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=xh(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function xh(e,n){if(!!e){if(typeof e=="string")return Hf(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hf(e,n)}}function Hf(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var jc=6378e3;function bh(e,n){var r=e.dataArray,i=n.size,a=i===void 0?10:i,s=a/(2*Math.PI*jc)*(256<<20)/2,h=Wf(r,a),m=h.gridHash,y=h.gridOffset,E=Eh(m,y,n);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:E}}function Wf(e,n){var r=Infinity,i=-Infinity,a,s=up(e),h;try{for(s.s();!(h=s.n()).done;){var m=h.value;a=m.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,i=a>i?a:i)}}catch(rt){s.e(rt)}finally{s.f()}var y=(r+i)/2,E=vc(n,y);if(E.xOffset<=0||E.yOffset<=0)return{gridHash:{},gridOffset:E};var w={},I=up(e),k;try{for(I.s();!(k=I.n()).done;){var D=k.value,W=D.coordinates[1],J=D.coordinates[0];if(Number.isFinite(W)&&Number.isFinite(J)){var ie=Math.floor((W+90)/E.yOffset),Oe=Math.floor((J+180)/E.xOffset),qe="".concat(ie,"-").concat(Oe);w[qe]=w[qe]||{count:0,points:[]},w[qe].count+=1,w[qe].points.push(D)}}}catch(rt){I.e(rt)}finally{I.f()}return{gridHash:w,gridOffset:E}}function vc(e,n){var r=yf(e),i=Xf(n,e);return{yOffset:r,xOffset:i}}function yf(e){return e/jc*(180/Math.PI)}function Xf(e,n){return n/jc*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Eh(e,n,r){return Object.keys(e).reduce(function(i,a,s){var h=a.split("-"),m=parseInt(h[0],10),y=parseInt(h[1],10),E={};if(r.field&&r.method){var w=Ln(e[a].points,r.field);E[r.method]=tn[r.method](w)}return Object.assign(E,{_id:s,coordinates:fo([-180+n.xOffset*(y+.5),-90+n.yOffset*(m+.5)]),rawData:e[a].points,count:e[a].count}),i.push(E),i},[])}var xu=Math.PI/3,Sh=[0,xu,2*xu,3*xu,4*xu,5*xu];function Yf(e){return e[0]}function Ch(e){return e[1]}function _f(){var e=0,n=0,r=1,i=1,a=Yf,s=Ch,h,m,y;function E(I){var k={},D=[],W,J=I.length;for(W=0;W<J;++W)if(!(isNaN(Oe=+a.call(null,ie=I[W],W,I))||isNaN(qe=+s.call(null,ie,W,I)))){var ie,Oe,qe,rt=Math.round(qe=qe/y),pt=Math.round(Oe=Oe/m-(rt&1)/2),kt=qe-rt;if(Math.abs(kt)*3>1){var zt=Oe-pt,nr=pt+(Oe<pt?-1:1)/2,dr=rt+(qe<rt?-1:1),Zr=Oe-nr,un=qe-dr;zt*zt+kt*kt>Zr*Zr+un*un&&(pt=nr+(rt&1?1:-1)/2,rt=dr)}var wr=pt+"-"+rt,Pn=k[wr];Pn?Pn.push(ie):(D.push(Pn=k[wr]=[ie]),Pn.x=(pt+(rt&1)/2)*m,Pn.y=rt*y)}return D}function w(I){var k=0,D=0;return Sh.map(function(W){var J=Math.sin(W)*I,ie=-Math.cos(W)*I,Oe=J-k,qe=ie-D;return k=J,D=ie,[Oe,qe]})}return E.hexagon=function(I){return"m"+w(I==null?h:+I).join("l")+"z"},E.centers=function(){for(var I=[],k=Math.round(n/y),D=Math.round(e/m),W=k*y;W<i+h;W+=y,++k)for(var J=D*m+(k&1)*m/2;J<r+m/2;J+=m)I.push([J,W]);return I},E.mesh=function(){var I=w(h).slice(0,4).join("l");return E.centers().map(function(k){return"M"+k+"m"+I}).join("")},E.x=function(I){return arguments.length?(a=I,E):a},E.y=function(I){return arguments.length?(s=I,E):s},E.radius=function(I){return arguments.length?(h=+I,m=h*2*Math.sin(xu),y=h*1.5,E):h},E.size=function(I){return arguments.length?(e=n=0,r=+I[0],i=+I[1],E):[r-e,i-n]},E.extent=function(I){return arguments.length?(e=+I[0][0],n=+I[0][1],r=+I[1][0],i=+I[1][1],E):[[e,n],[r,i]]},E.radius(1)}function Gc(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function zs(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Gc(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gc(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var qf=6378e3;function Kf(e,n){var r=e.dataArray,i=n.size,a=i===void 0?10:i,s=n.method,h=s===void 0?"sum":s,m=a/(2*Math.PI*qf)*(256<<20)/2,y=r.map(function(k){var D=fo(k.coordinates),W=(0,Vn.Z)(D,2),J=W[0],ie=W[1];return zs(zs({},k),{},{coordinates:[J,ie]})}),E=_f().radius(m).x(function(k){return k.coordinates[0]}).y(function(k){return k.coordinates[1]}),w=E(y),I={dataArray:w.map(function(k,D){var W;if(n.field&&h){var J=Ln(k,n.field);k[h]=tn[h](J)}return W={},(0,A.Z)(W,n.method,k[h]),(0,A.Z)(W,"count",k.length),(0,A.Z)(W,"rawData",k),(0,A.Z)(W,"coordinates",[k.x,k.y]),(0,A.Z)(W,"_id",D),W}),radius:m,xOffset:m,yOffset:m,type:"hexagon"};return I}function xf(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function bf(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?xf(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xf(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function wh(e,n){var r=n.sourceField,i=n.targetField,a=n.data,s={};return a.forEach(function(h){s[h[r]]=h}),e.dataArray=e.dataArray.map(function(h){var m=h[i];return bf(bf({},h),s[m])}),e}function xl(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}he("geojson",di),he("image",zn),he("csv",ea),he("json",Sr),he("raster",sn),tt("cluster",_l),tt("filter",_h),tt("join",wh),tt("map",xl),tt("grid",bh),tt("hexagon",Kf);var Hc=Qn,jp=gn,Ah=Po,wd=V(28660),$r=V(86700),Ad=V(84879),Nt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Gp=V(31745),Th=V.n(Gp);function Wc(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Bu(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Wc(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wc(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function lp(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Td(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function Td(e,n){if(!!e){if(typeof e=="string")return Ku(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ku(e,n)}}function Ku(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var bl=30;function Xc(e){var n=e.characterSet,r=e.getFontWidth,i=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,h=e.mapping,m=h===void 0?{}:h,y=e.xOffset,E=y===void 0?0:y,w=e.yOffset,I=w===void 0?0:w,k=0,D=E;Array.from(n).forEach(function(J,ie){if(!m[J]){var Oe=r(J,ie);D+bl>s&&(D=0,k++),m[J]={x:D,y:I+k*bl,width:bl,height:bl,advance:Oe},D+=bl}});var W=i+a*2;return{mapping:m,xOffset:D,yOffset:I+k*W,canvasHeight:Mh(I+(k+1)*W)}}function mc(e,n,r){var i=0,a=0,s=0,h=[],m={},y=lp(e),E;try{for(y.s();!(E=y.n()).done;){var w=E.value;if(!m[w.id]){var I=w.size;i+I+n>r&&(cp(m,h,a),i=0,a=s+a+n,s=0,h=[]),h.push({icon:w,xOffset:i}),i=i+I+n,s=Math.max(s,I)}}}catch(D){y.e(D)}finally{y.f()}h.length>0&&cp(m,h,a);var k=Mh(s+a+n);return{mapping:m,canvasHeight:k}}function cp(e,n,r){var i=lp(n),a;try{for(i.s();!(a=i.n()).done;){var s=a.value,h=s.icon,m=s.xOffset;e[h.id]=Bu(Bu({},h),{},{x:m,y:r,image:h.image,width:h.width,height:h.height})}}catch(y){i.e(y)}finally{i.f()}}function Mh(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var $f,Ph;function oa(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=gc(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function gc(e,n){if(!!e){if(typeof e=="string")return xo(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xo(e,n)}}function xo(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function Us(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Ih(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Us(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Us(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Hp=pp(),Md="sans-serif",Pd="normal",Id=24,fp=3,Od=.25,Rd=8,Ef=1024,Wp=1,hp=1,Qf=3,Ia=null;function pp(){for(var e=[],n=32;n<128;n++)e.push(String.fromCharCode(n));return e}function El(e,n,r,i){e.font="".concat(i," ").concat(r,"px ").concat(n),e.fillStyle="black",e.textBaseline="middle"}function Yc(e,n){for(var r=0;r<e.length;r++)n.data[4*r+3]=e[r]}var dp=($f=(0,$r.b2)(),$f(Ph=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"fontAtlas",void 0),(0,A.Z)(this,"iconFontMap",void 0),(0,A.Z)(this,"iconFontGlyphs",{}),(0,A.Z)(this,"fontOptions",void 0),(0,A.Z)(this,"key",void 0),(0,A.Z)(this,"cache",new Pa(Qf))}return(0,Yt.Z)(e,[{key:"scale",get:function(){return hp}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Md,fontWeight:Pd,characterSet:Hp,fontSize:Id,buffer:fp,sdf:!0,cutoff:Od,radius:Rd,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var i=this;r.forEach(function(a){i.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,i){this.iconFontMap.set(r,i)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Ih(Ih({},this.fontOptions),r),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&i.length===0)){var s=this.generateFontAtlas(this.key,i,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,i,a){var s=this.fontOptions,h=s.fontFamily,m=s.fontWeight,y=s.fontSize,E=s.buffer,w=s.sdf,I=s.radius,k=s.cutoff,D=s.iconfont,W=a&&a.data;W||(W=Xi.document.createElement("canvas"),W.width=Ef);var J=W.getContext("2d");El(J,h,y,m);var ie=Xc(Ih({getFontWidth:function(tl){return J.measureText(tl).width},fontHeight:y*hp,buffer:E,characterSet:i,maxCanvasWidth:Ef},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Oe=ie.mapping,qe=ie.canvasHeight,rt=ie.xOffset,pt=ie.yOffset,kt=J.getImageData(0,0,W.width,W.height);if(W.height=qe,J.putImageData(kt,0,0),El(J,h,y,m),w){var zt=new(Th())(y,E,I,k,h,m),nr=J.getImageData(0,0,zt.size,zt.size),dr=oa(i),Zr;try{for(dr.s();!(Zr=dr.n()).done;){var un=Zr.value;if(D){var wr=String.fromCharCode(parseInt(un.replace("&#x","").replace(";",""),16)),Pn=zt.draw(wr);Yc(Pn,nr)}else Yc(zt.draw(un),nr);J.putImageData(nr,Oe[un].x,Oe[un].y)}}catch(As){dr.e(As)}finally{dr.f()}}else{var Nn=oa(i),pi;try{for(Nn.s();!(pi=Nn.n()).done;){var co=pi.value;J.fillText(co,Oe[co].x,Oe[co].y+y*Wp)}}catch(As){Nn.e(As)}finally{Nn.f()}}return{xOffset:rt,yOffset:pt,mapping:Oe,data:W,width:W.width,height:W.height}}},{key:"getKey",value:function(){return"key";var r,i,a,s,h,m,y,E}},{key:"getNewChars",value:function(r,i){var a=this.cache.get(r);if(!a)return i;var s=[],h=a.mapping,m=new Set(Object.keys(h)),y=new Set(i);return y.forEach(function(E){m.has(E)||s.push(E)}),s}}]),e}())||Ph),Xp,B;function ve(e){var n=Be();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Be(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ot=3,sr=1024,Tt=64,er=(Xp=(0,$r.b2)(),Xp(B=function(e){(0,bn.Z)(r,e);var n=ve(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"canvasHeight",128),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"canvas",void 0),(0,A.Z)((0,be.Z)(i),"iconData",void 0),(0,A.Z)((0,be.Z)(i),"iconMap",void 0),(0,A.Z)((0,be.Z)(i),"ctx",void 0),(0,A.Z)((0,be.Z)(i),"loadingImageCount",0),i}return(0,Yt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Xi.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var h=this,m=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Tt}),this.updateIconMap(),this.loadImage(s).then(function(y){m=y;var E=h.iconData.find(function(w){return w.id===a});E&&(E.image=m,E.width=m.width,E.height=m.height),h.update()})}},{key:"addImageMini",value:function(a,s,h){var m=this,y=h.getSceneConfig().canvas,E=y.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Tt}),this.updateIconMap(),this.loadImageMini(s,y).then(function(w){E=w;var I=m.iconData.find(function(k){return k.id===a});I&&(I.image=E,I.width=E.width,I.height=E.height),m.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=sr,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var h=a.iconMap[s],m=h.x,y=h.y,E=h.image,w=h.width,I=w===void 0?64:w,k=h.height,D=k===void 0?64:k,W=Math.max(I,D),J=W/Tt,ie=D/J,Oe=I/J;E&&a.ctx.drawImage(E,m+(Tt-Oe)/2,y+(Tt-ie)/2,Oe,ie)})}},{key:"updateIconMap",value:function(){var a=mc(this.iconData,Ot,sr),s=a.mapping,h=a.canvasHeight;this.iconMap=s,this.canvasHeight=h}},{key:"loadImage",value:function(a){return new Promise(function(s,h){if(a instanceof HTMLImageElement){s(a);return}var m=new Image;m.crossOrigin="anonymous",m.onload=function(){s(m)},m.onerror=function(){h(new Error("Could not load image at "+a))},m.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"loadImageMini",value:function(a,s){return new Promise(function(h,m){var y=s.createImage();y.crossOrigin="anonymous",y.onload=function(){h(y)},y.onerror=function(){m(new Error("Could not load image at "+a))},y.src=a})}}]),r}(_u.EventEmitter))||B),$t=1e-6,or=typeof Float32Array!="undefined"?Float32Array:Array,yr=Math.random;function Tr(e){or=e}var Mr=Math.PI/180;function jr(e){return e*Mr}function br(e,n){return Math.abs(e-n)<=$t*Math.max(1,Math.abs(e),Math.abs(n))}Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)});function gr(){var e=new or(16);return or!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function it(e){var n=new or(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Gt(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function _r(e,n,r,i,a,s,h,m,y,E,w,I,k,D,W,J){var ie=new or(16);return ie[0]=e,ie[1]=n,ie[2]=r,ie[3]=i,ie[4]=a,ie[5]=s,ie[6]=h,ie[7]=m,ie[8]=y,ie[9]=E,ie[10]=w,ie[11]=I,ie[12]=k,ie[13]=D,ie[14]=W,ie[15]=J,ie}function Br(e,n,r,i,a,s,h,m,y,E,w,I,k,D,W,J,ie){return e[0]=n,e[1]=r,e[2]=i,e[3]=a,e[4]=s,e[5]=h,e[6]=m,e[7]=y,e[8]=E,e[9]=w,e[10]=I,e[11]=k,e[12]=D,e[13]=W,e[14]=J,e[15]=ie,e}function cr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ir(e,n){if(e===n){var r=n[1],i=n[2],a=n[3],s=n[6],h=n[7],m=n[11];e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=r,e[6]=n[9],e[7]=n[13],e[8]=i,e[9]=s,e[11]=n[14],e[12]=a,e[13]=h,e[14]=m}else e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=n[1],e[5]=n[5],e[6]=n[9],e[7]=n[13],e[8]=n[2],e[9]=n[6],e[10]=n[10],e[11]=n[14],e[12]=n[3],e[13]=n[7],e[14]=n[11],e[15]=n[15];return e}function Gr(e,n){var r=n[0],i=n[1],a=n[2],s=n[3],h=n[4],m=n[5],y=n[6],E=n[7],w=n[8],I=n[9],k=n[10],D=n[11],W=n[12],J=n[13],ie=n[14],Oe=n[15],qe=r*m-i*h,rt=r*y-a*h,pt=r*E-s*h,kt=i*y-a*m,zt=i*E-s*m,nr=a*E-s*y,dr=w*J-I*W,Zr=w*ie-k*W,un=w*Oe-D*W,wr=I*ie-k*J,Pn=I*Oe-D*J,Nn=k*Oe-D*ie,pi=qe*Nn-rt*Pn+pt*wr+kt*un-zt*Zr+nr*dr;return pi?(pi=1/pi,e[0]=(m*Nn-y*Pn+E*wr)*pi,e[1]=(a*Pn-i*Nn-s*wr)*pi,e[2]=(J*nr-ie*zt+Oe*kt)*pi,e[3]=(k*zt-I*nr-D*kt)*pi,e[4]=(y*un-h*Nn-E*Zr)*pi,e[5]=(r*Nn-a*un+s*Zr)*pi,e[6]=(ie*pt-W*nr-Oe*rt)*pi,e[7]=(w*nr-k*pt+D*rt)*pi,e[8]=(h*Pn-m*un+E*dr)*pi,e[9]=(i*un-r*Pn-s*dr)*pi,e[10]=(W*zt-J*pt+Oe*qe)*pi,e[11]=(I*pt-w*zt-D*qe)*pi,e[12]=(m*Zr-h*wr-y*dr)*pi,e[13]=(r*wr-i*Zr+a*dr)*pi,e[14]=(J*rt-W*kt-ie*qe)*pi,e[15]=(w*kt-I*rt+k*qe)*pi,e):null}function Bn(e,n){var r=n[0],i=n[1],a=n[2],s=n[3],h=n[4],m=n[5],y=n[6],E=n[7],w=n[8],I=n[9],k=n[10],D=n[11],W=n[12],J=n[13],ie=n[14],Oe=n[15];return e[0]=m*(k*Oe-D*ie)-I*(y*Oe-E*ie)+J*(y*D-E*k),e[1]=-(i*(k*Oe-D*ie)-I*(a*Oe-s*ie)+J*(a*D-s*k)),e[2]=i*(y*Oe-E*ie)-m*(a*Oe-s*ie)+J*(a*E-s*y),e[3]=-(i*(y*D-E*k)-m*(a*D-s*k)+I*(a*E-s*y)),e[4]=-(h*(k*Oe-D*ie)-w*(y*Oe-E*ie)+W*(y*D-E*k)),e[5]=r*(k*Oe-D*ie)-w*(a*Oe-s*ie)+W*(a*D-s*k),e[6]=-(r*(y*Oe-E*ie)-h*(a*Oe-s*ie)+W*(a*E-s*y)),e[7]=r*(y*D-E*k)-h*(a*D-s*k)+w*(a*E-s*y),e[8]=h*(I*Oe-D*J)-w*(m*Oe-E*J)+W*(m*D-E*I),e[9]=-(r*(I*Oe-D*J)-w*(i*Oe-s*J)+W*(i*D-s*I)),e[10]=r*(m*Oe-E*J)-h*(i*Oe-s*J)+W*(i*E-s*m),e[11]=-(r*(m*D-E*I)-h*(i*D-s*I)+w*(i*E-s*m)),e[12]=-(h*(I*ie-k*J)-w*(m*ie-y*J)+W*(m*k-y*I)),e[13]=r*(I*ie-k*J)-w*(i*ie-a*J)+W*(i*k-a*I),e[14]=-(r*(m*ie-y*J)-h*(i*ie-a*J)+W*(i*y-a*m)),e[15]=r*(m*k-y*I)-h*(i*k-a*I)+w*(i*y-a*m),e}function tr(e){var n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],h=e[5],m=e[6],y=e[7],E=e[8],w=e[9],I=e[10],k=e[11],D=e[12],W=e[13],J=e[14],ie=e[15],Oe=n*h-r*s,qe=n*m-i*s,rt=n*y-a*s,pt=r*m-i*h,kt=r*y-a*h,zt=i*y-a*m,nr=E*W-w*D,dr=E*J-I*D,Zr=E*ie-k*D,un=w*J-I*W,wr=w*ie-k*W,Pn=I*ie-k*J;return Oe*Pn-qe*wr+rt*un+pt*Zr-kt*dr+zt*nr}function rr(e,n,r){var i=n[0],a=n[1],s=n[2],h=n[3],m=n[4],y=n[5],E=n[6],w=n[7],I=n[8],k=n[9],D=n[10],W=n[11],J=n[12],ie=n[13],Oe=n[14],qe=n[15],rt=r[0],pt=r[1],kt=r[2],zt=r[3];return e[0]=rt*i+pt*m+kt*I+zt*J,e[1]=rt*a+pt*y+kt*k+zt*ie,e[2]=rt*s+pt*E+kt*D+zt*Oe,e[3]=rt*h+pt*w+kt*W+zt*qe,rt=r[4],pt=r[5],kt=r[6],zt=r[7],e[4]=rt*i+pt*m+kt*I+zt*J,e[5]=rt*a+pt*y+kt*k+zt*ie,e[6]=rt*s+pt*E+kt*D+zt*Oe,e[7]=rt*h+pt*w+kt*W+zt*qe,rt=r[8],pt=r[9],kt=r[10],zt=r[11],e[8]=rt*i+pt*m+kt*I+zt*J,e[9]=rt*a+pt*y+kt*k+zt*ie,e[10]=rt*s+pt*E+kt*D+zt*Oe,e[11]=rt*h+pt*w+kt*W+zt*qe,rt=r[12],pt=r[13],kt=r[14],zt=r[15],e[12]=rt*i+pt*m+kt*I+zt*J,e[13]=rt*a+pt*y+kt*k+zt*ie,e[14]=rt*s+pt*E+kt*D+zt*Oe,e[15]=rt*h+pt*w+kt*W+zt*qe,e}function fn(e,n,r){var i=r[0],a=r[1],s=r[2],h,m,y,E,w,I,k,D,W,J,ie,Oe;return n===e?(e[12]=n[0]*i+n[4]*a+n[8]*s+n[12],e[13]=n[1]*i+n[5]*a+n[9]*s+n[13],e[14]=n[2]*i+n[6]*a+n[10]*s+n[14],e[15]=n[3]*i+n[7]*a+n[11]*s+n[15]):(h=n[0],m=n[1],y=n[2],E=n[3],w=n[4],I=n[5],k=n[6],D=n[7],W=n[8],J=n[9],ie=n[10],Oe=n[11],e[0]=h,e[1]=m,e[2]=y,e[3]=E,e[4]=w,e[5]=I,e[6]=k,e[7]=D,e[8]=W,e[9]=J,e[10]=ie,e[11]=Oe,e[12]=h*i+w*a+W*s+n[12],e[13]=m*i+I*a+J*s+n[13],e[14]=y*i+k*a+ie*s+n[14],e[15]=E*i+D*a+Oe*s+n[15]),e}function Nr(e,n,r){var i=r[0],a=r[1],s=r[2];return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*a,e[5]=n[5]*a,e[6]=n[6]*a,e[7]=n[7]*a,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=n[11]*s,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function Er(e,n,r,i){var a=i[0],s=i[1],h=i[2],m=Math.hypot(a,s,h),y,E,w,I,k,D,W,J,ie,Oe,qe,rt,pt,kt,zt,nr,dr,Zr,un,wr,Pn,Nn,pi,co;return m<$t?null:(m=1/m,a*=m,s*=m,h*=m,y=Math.sin(r),E=Math.cos(r),w=1-E,I=n[0],k=n[1],D=n[2],W=n[3],J=n[4],ie=n[5],Oe=n[6],qe=n[7],rt=n[8],pt=n[9],kt=n[10],zt=n[11],nr=a*a*w+E,dr=s*a*w+h*y,Zr=h*a*w-s*y,un=a*s*w-h*y,wr=s*s*w+E,Pn=h*s*w+a*y,Nn=a*h*w+s*y,pi=s*h*w-a*y,co=h*h*w+E,e[0]=I*nr+J*dr+rt*Zr,e[1]=k*nr+ie*dr+pt*Zr,e[2]=D*nr+Oe*dr+kt*Zr,e[3]=W*nr+qe*dr+zt*Zr,e[4]=I*un+J*wr+rt*Pn,e[5]=k*un+ie*wr+pt*Pn,e[6]=D*un+Oe*wr+kt*Pn,e[7]=W*un+qe*wr+zt*Pn,e[8]=I*Nn+J*pi+rt*co,e[9]=k*Nn+ie*pi+pt*co,e[10]=D*Nn+Oe*pi+kt*co,e[11]=W*Nn+qe*pi+zt*co,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}function Ur(e,n,r){var i=Math.sin(r),a=Math.cos(r),s=n[4],h=n[5],m=n[6],y=n[7],E=n[8],w=n[9],I=n[10],k=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=s*a+E*i,e[5]=h*a+w*i,e[6]=m*a+I*i,e[7]=y*a+k*i,e[8]=E*a-s*i,e[9]=w*a-h*i,e[10]=I*a-m*i,e[11]=k*a-y*i,e}function Xr(e,n,r){var i=Math.sin(r),a=Math.cos(r),s=n[0],h=n[1],m=n[2],y=n[3],E=n[8],w=n[9],I=n[10],k=n[11];return n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=s*a-E*i,e[1]=h*a-w*i,e[2]=m*a-I*i,e[3]=y*a-k*i,e[8]=s*i+E*a,e[9]=h*i+w*a,e[10]=m*i+I*a,e[11]=y*i+k*a,e}function mi(e,n,r){var i=Math.sin(r),a=Math.cos(r),s=n[0],h=n[1],m=n[2],y=n[3],E=n[4],w=n[5],I=n[6],k=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=s*a+E*i,e[1]=h*a+w*i,e[2]=m*a+I*i,e[3]=y*a+k*i,e[4]=E*a-s*i,e[5]=w*a-h*i,e[6]=I*a-m*i,e[7]=k*a-y*i,e}function ri(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Yr(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function rn(e,n,r){var i=r[0],a=r[1],s=r[2],h=Math.hypot(i,a,s),m,y,E;return h<$t?null:(h=1/h,i*=h,a*=h,s*=h,m=Math.sin(n),y=Math.cos(n),E=1-y,e[0]=i*i*E+y,e[1]=a*i*E+s*m,e[2]=s*i*E-a*m,e[3]=0,e[4]=i*a*E-s*m,e[5]=a*a*E+y,e[6]=s*a*E+i*m,e[7]=0,e[8]=i*s*E+a*m,e[9]=a*s*E-i*m,e[10]=s*s*E+y,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Yn(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hi(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fi(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xa(e,n,r){var i=n[0],a=n[1],s=n[2],h=n[3],m=i+i,y=a+a,E=s+s,w=i*m,I=i*y,k=i*E,D=a*y,W=a*E,J=s*E,ie=h*m,Oe=h*y,qe=h*E;return e[0]=1-(D+J),e[1]=I+qe,e[2]=k-Oe,e[3]=0,e[4]=I-qe,e[5]=1-(w+J),e[6]=W+ie,e[7]=0,e[8]=k+Oe,e[9]=W-ie,e[10]=1-(w+D),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function uo(e,n){var r=new or(3),i=-n[0],a=-n[1],s=-n[2],h=n[3],m=n[4],y=n[5],E=n[6],w=n[7],I=i*i+a*a+s*s+h*h;return I>0?(r[0]=(m*h+w*i+y*s-E*a)*2/I,r[1]=(y*h+w*a+E*i-m*s)*2/I,r[2]=(E*h+w*s+m*a-y*i)*2/I):(r[0]=(m*h+w*i+y*s-E*a)*2,r[1]=(y*h+w*a+E*i-m*s)*2,r[2]=(E*h+w*s+m*a-y*i)*2),Xa(e,n,r),e}function ki(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function qo(e,n){var r=n[0],i=n[1],a=n[2],s=n[4],h=n[5],m=n[6],y=n[8],E=n[9],w=n[10];return e[0]=Math.hypot(r,i,a),e[1]=Math.hypot(s,h,m),e[2]=Math.hypot(y,E,w),e}function za(e,n){var r=new or(3);qo(r,n);var i=1/r[0],a=1/r[1],s=1/r[2],h=n[0]*i,m=n[1]*a,y=n[2]*s,E=n[4]*i,w=n[5]*a,I=n[6]*s,k=n[8]*i,D=n[9]*a,W=n[10]*s,J=h+w+W,ie=0;return J>0?(ie=Math.sqrt(J+1)*2,e[3]=.25*ie,e[0]=(I-D)/ie,e[1]=(k-y)/ie,e[2]=(m-E)/ie):h>w&&h>W?(ie=Math.sqrt(1+h-w-W)*2,e[3]=(I-D)/ie,e[0]=.25*ie,e[1]=(m+E)/ie,e[2]=(k+y)/ie):w>W?(ie=Math.sqrt(1+w-h-W)*2,e[3]=(k-y)/ie,e[0]=(m+E)/ie,e[1]=.25*ie,e[2]=(I+D)/ie):(ie=Math.sqrt(1+W-h-w)*2,e[3]=(m-E)/ie,e[0]=(k+y)/ie,e[1]=(I+D)/ie,e[2]=.25*ie),e}function Ko(e,n,r,i){var a=n[0],s=n[1],h=n[2],m=n[3],y=a+a,E=s+s,w=h+h,I=a*y,k=a*E,D=a*w,W=s*E,J=s*w,ie=h*w,Oe=m*y,qe=m*E,rt=m*w,pt=i[0],kt=i[1],zt=i[2];return e[0]=(1-(W+ie))*pt,e[1]=(k+rt)*pt,e[2]=(D-qe)*pt,e[3]=0,e[4]=(k-rt)*kt,e[5]=(1-(I+ie))*kt,e[6]=(J+Oe)*kt,e[7]=0,e[8]=(D+qe)*zt,e[9]=(J-Oe)*zt,e[10]=(1-(I+W))*zt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function bo(e,n,r,i,a){var s=n[0],h=n[1],m=n[2],y=n[3],E=s+s,w=h+h,I=m+m,k=s*E,D=s*w,W=s*I,J=h*w,ie=h*I,Oe=m*I,qe=y*E,rt=y*w,pt=y*I,kt=i[0],zt=i[1],nr=i[2],dr=a[0],Zr=a[1],un=a[2],wr=(1-(J+Oe))*kt,Pn=(D+pt)*kt,Nn=(W-rt)*kt,pi=(D-pt)*zt,co=(1-(k+Oe))*zt,As=(ie+qe)*zt,tl=(W+rt)*nr,Tc=(ie-qe)*nr,Tl=(1-(k+J))*nr;return e[0]=wr,e[1]=Pn,e[2]=Nn,e[3]=0,e[4]=pi,e[5]=co,e[6]=As,e[7]=0,e[8]=tl,e[9]=Tc,e[10]=Tl,e[11]=0,e[12]=r[0]+dr-(wr*dr+pi*Zr+tl*un),e[13]=r[1]+Zr-(Pn*dr+co*Zr+Tc*un),e[14]=r[2]+un-(Nn*dr+As*Zr+Tl*un),e[15]=1,e}function $o(e,n){var r=n[0],i=n[1],a=n[2],s=n[3],h=r+r,m=i+i,y=a+a,E=r*h,w=i*h,I=i*m,k=a*h,D=a*m,W=a*y,J=s*h,ie=s*m,Oe=s*y;return e[0]=1-I-W,e[1]=w+Oe,e[2]=k-ie,e[3]=0,e[4]=w-Oe,e[5]=1-E-W,e[6]=D+J,e[7]=0,e[8]=k+ie,e[9]=D-J,e[10]=1-E-I,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Zo(e,n,r,i,a,s,h){var m=1/(r-n),y=1/(a-i),E=1/(s-h);return e[0]=s*2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*y,e[6]=0,e[7]=0,e[8]=(r+n)*m,e[9]=(a+i)*y,e[10]=(h+s)*E,e[11]=-1,e[12]=0,e[13]=0,e[14]=h*s*2*E,e[15]=0,e}function rs(e,n,r,i,a){var s=1/Math.tan(n/2),h;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(h=1/(i-a),e[10]=(a+i)*h,e[14]=2*a*i*h):(e[10]=-1,e[14]=-2*i),e}var to=rs;function _i(e,n,r,i,a){var s=1/Math.tan(n/2),h;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(h=1/(i-a),e[10]=a*h,e[14]=a*i*h):(e[10]=-1,e[14]=-i),e}function Vo(e,n,r,i){var a=Math.tan(n.upDegrees*Math.PI/180),s=Math.tan(n.downDegrees*Math.PI/180),h=Math.tan(n.leftDegrees*Math.PI/180),m=Math.tan(n.rightDegrees*Math.PI/180),y=2/(h+m),E=2/(a+s);return e[0]=y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=-((h-m)*y*.5),e[9]=(a-s)*E*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function Yi(e,n,r,i,a,s,h){var m=1/(n-r),y=1/(i-a),E=1/(s-h);return e[0]=-2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(n+r)*m,e[13]=(a+i)*y,e[14]=(h+s)*E,e[15]=1,e}var ns=Yi;function ni(e,n,r,i,a,s,h){var m=1/(n-r),y=1/(i-a),E=1/(s-h);return e[0]=-2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=E,e[11]=0,e[12]=(n+r)*m,e[13]=(a+i)*y,e[14]=s*E,e[15]=1,e}function Li(e,n,r,i){var a,s,h,m,y,E,w,I,k,D,W=n[0],J=n[1],ie=n[2],Oe=i[0],qe=i[1],rt=i[2],pt=r[0],kt=r[1],zt=r[2];return Math.abs(W-pt)<$t&&Math.abs(J-kt)<$t&&Math.abs(ie-zt)<$t?cr(e):(w=W-pt,I=J-kt,k=ie-zt,D=1/Math.hypot(w,I,k),w*=D,I*=D,k*=D,a=qe*k-rt*I,s=rt*w-Oe*k,h=Oe*I-qe*w,D=Math.hypot(a,s,h),D?(D=1/D,a*=D,s*=D,h*=D):(a=0,s=0,h=0),m=I*h-k*s,y=k*a-w*h,E=w*s-I*a,D=Math.hypot(m,y,E),D?(D=1/D,m*=D,y*=D,E*=D):(m=0,y=0,E=0),e[0]=a,e[1]=m,e[2]=w,e[3]=0,e[4]=s,e[5]=y,e[6]=I,e[7]=0,e[8]=h,e[9]=E,e[10]=k,e[11]=0,e[12]=-(a*W+s*J+h*ie),e[13]=-(m*W+y*J+E*ie),e[14]=-(w*W+I*J+k*ie),e[15]=1,e)}function sa(e,n,r,i){var a=n[0],s=n[1],h=n[2],m=i[0],y=i[1],E=i[2],w=a-r[0],I=s-r[1],k=h-r[2],D=w*w+I*I+k*k;D>0&&(D=1/Math.sqrt(D),w*=D,I*=D,k*=D);var W=y*k-E*I,J=E*w-m*k,ie=m*I-y*w;return D=W*W+J*J+ie*ie,D>0&&(D=1/Math.sqrt(D),W*=D,J*=D,ie*=D),e[0]=W,e[1]=J,e[2]=ie,e[3]=0,e[4]=I*ie-k*J,e[5]=k*W-w*ie,e[6]=w*J-I*W,e[7]=0,e[8]=w,e[9]=I,e[10]=k,e[11]=0,e[12]=a,e[13]=s,e[14]=h,e[15]=1,e}function Eo(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Sl(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Te(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e[4]=n[4]+r[4],e[5]=n[5]+r[5],e[6]=n[6]+r[6],e[7]=n[7]+r[7],e[8]=n[8]+r[8],e[9]=n[9]+r[9],e[10]=n[10]+r[10],e[11]=n[11]+r[11],e[12]=n[12]+r[12],e[13]=n[13]+r[13],e[14]=n[14]+r[14],e[15]=n[15]+r[15],e}function Dt(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e[4]=n[4]-r[4],e[5]=n[5]-r[5],e[6]=n[6]-r[6],e[7]=n[7]-r[7],e[8]=n[8]-r[8],e[9]=n[9]-r[9],e[10]=n[10]-r[10],e[11]=n[11]-r[11],e[12]=n[12]-r[12],e[13]=n[13]-r[13],e[14]=n[14]-r[14],e[15]=n[15]-r[15],e}function xt(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=n[11]*r,e[12]=n[12]*r,e[13]=n[13]*r,e[14]=n[14]*r,e[15]=n[15]*r,e}function vn(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e[4]=n[4]+r[4]*i,e[5]=n[5]+r[5]*i,e[6]=n[6]+r[6]*i,e[7]=n[7]+r[7]*i,e[8]=n[8]+r[8]*i,e[9]=n[9]+r[9]*i,e[10]=n[10]+r[10]*i,e[11]=n[11]+r[11]*i,e[12]=n[12]+r[12]*i,e[13]=n[13]+r[13]*i,e[14]=n[14]+r[14]*i,e[15]=n[15]+r[15]*i,e}function Bi(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}function Se(e,n){var r=e[0],i=e[1],a=e[2],s=e[3],h=e[4],m=e[5],y=e[6],E=e[7],w=e[8],I=e[9],k=e[10],D=e[11],W=e[12],J=e[13],ie=e[14],Oe=e[15],qe=n[0],rt=n[1],pt=n[2],kt=n[3],zt=n[4],nr=n[5],dr=n[6],Zr=n[7],un=n[8],wr=n[9],Pn=n[10],Nn=n[11],pi=n[12],co=n[13],As=n[14],tl=n[15];return Math.abs(r-qe)<=$t*Math.max(1,Math.abs(r),Math.abs(qe))&&Math.abs(i-rt)<=$t*Math.max(1,Math.abs(i),Math.abs(rt))&&Math.abs(a-pt)<=$t*Math.max(1,Math.abs(a),Math.abs(pt))&&Math.abs(s-kt)<=$t*Math.max(1,Math.abs(s),Math.abs(kt))&&Math.abs(h-zt)<=$t*Math.max(1,Math.abs(h),Math.abs(zt))&&Math.abs(m-nr)<=$t*Math.max(1,Math.abs(m),Math.abs(nr))&&Math.abs(y-dr)<=$t*Math.max(1,Math.abs(y),Math.abs(dr))&&Math.abs(E-Zr)<=$t*Math.max(1,Math.abs(E),Math.abs(Zr))&&Math.abs(w-un)<=$t*Math.max(1,Math.abs(w),Math.abs(un))&&Math.abs(I-wr)<=$t*Math.max(1,Math.abs(I),Math.abs(wr))&&Math.abs(k-Pn)<=$t*Math.max(1,Math.abs(k),Math.abs(Pn))&&Math.abs(D-Nn)<=$t*Math.max(1,Math.abs(D),Math.abs(Nn))&&Math.abs(W-pi)<=$t*Math.max(1,Math.abs(W),Math.abs(pi))&&Math.abs(J-co)<=$t*Math.max(1,Math.abs(J),Math.abs(co))&&Math.abs(ie-As)<=$t*Math.max(1,Math.abs(ie),Math.abs(As))&&Math.abs(Oe-tl)<=$t*Math.max(1,Math.abs(Oe),Math.abs(tl))}var oe=rr,Ve=Dt,at,Mt,Ye=(at=(0,$r.b2)(),at(Mt=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"overridedViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredProjectionMatrix",void 0),(0,A.Z)(this,"viewMatrixInverse",void 0),(0,A.Z)(this,"cameraPosition",void 0)}return(0,Yt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=gr(),Gr(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),i=(0,Vn.Z)(r,2),a=i[0],s=i[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,i){var a=ri(gr(),[r,i,0]);this.jitteredProjectionMatrix=rr(gr(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=rr(gr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Mt),Fe,et;function xe(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ze(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function ze(e,n){if(!!e){if(typeof e=="string")return we(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return we(e,n)}}function we(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var ot=(Fe=(0,$r.b2)(),Fe(et=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"controlCorners",void 0),(0,A.Z)(this,"controlContainer",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"controls",[]),(0,A.Z)(this,"unAddControls",[])}return(0,Yt.Z)(e,[{key:"init",value:function(r,i){this.container=r.container,this.scene=i,this.mapsService=i.get(Nt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,i){var a=i.get(Nt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(i){return i.controlOption.name===r})}},{key:"removeControl",value:function(r){var i=this.controls.indexOf(r);return i>-1&&this.controls.splice(i,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(i){i.addTo(r.scene),r.controls.push(i)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=xe(this.controls),i;try{for(r.s();!(i=r.n()).done;){var a=i.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},i="l7-",a=this.controlContainer=ao("div",i+"control-container",this.container);function s(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],m=h.map(function(y){return i+y}).join(" ");r[h.join("")]=ao("div",m,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&rc(this.controlCorners[r]);this.controlContainer&&rc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||et),_t,hr,zr=(_t=(0,$r.b2)(),_t(hr=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"markers",[]),(0,A.Z)(this,"markerLayers",[]),(0,A.Z)(this,"unAddMarkers",[]),(0,A.Z)(this,"unAddMarkerLayers",[])}return(0,Yt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var i=this.markerLayers.indexOf(r);i>-1&&this.markerLayers.splice(i,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(i){i.addTo(r.scene),r.markers.push(i)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(i){r.markerLayers.push(i),i.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var i=this.markers.indexOf(r);i>-1&&this.markers.splice(i,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Nt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||hr),Lr,Qr,Rr=(Lr=(0,$r.b2)(),Lr(Qr=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"popup",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"unAddPopup",void 0)}return(0,Yt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Nt.IMapService)}}]),e}())||Qr),Cn=V(82492),an=V.n(Cn),xn={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},_n=xn,hn,Gn;function da(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function jo(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?da(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):da(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Oa={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},ua={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Cl=(hn=(0,$r.b2)(),hn(Gn=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"sceneConfigCache",{}),(0,A.Z)(this,"layerConfigCache",{})}return(0,Yt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return _n[r]}},{key:"setSceneConfig",value:function(r,i){this.sceneConfigCache[r]=jo(jo({},Oa),i)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,i,a){this.layerConfigCache[i]=jo({},an()({},this.sceneConfigCache[r],ua,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Gn);function qn(e,n,r,i){!r||Object.defineProperty(e,n,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function ci(e,n,r,i,a){var s={};return Object.keys(i).forEach(function(h){s[h]=i[h]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(h,m){return m(e,n,h)||h},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,n,s),s=null),s}function cu(){var e=new or(4);return or!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Yp(e){var n=new glMatrix.ARRAY_TYPE(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function bu(e,n,r,i){var a=new or(4);return a[0]=e,a[1]=n,a[2]=r,a[3]=i,a}function qc(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function Oh(e,n,r,i,a){return e[0]=n,e[1]=r,e[2]=i,e[3]=a,e}function C0(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e}function is(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e}function qp(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e[2]=n[2]*r[2],e[3]=n[3]*r[3],e}function Sf(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e[2]=n[2]/r[2],e[3]=n[3]/r[3],e}function kd(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e[3]=Math.ceil(n[3]),e}function Ld(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e[3]=Math.floor(n[3]),e}function Sv(e,n,r){return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e[2]=Math.min(n[2],r[2]),e[3]=Math.min(n[3],r[3]),e}function vp(e,n,r){return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e[2]=Math.max(n[2],r[2]),e[3]=Math.max(n[3],r[3]),e}function Cf(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e[3]=Math.round(n[3]),e}function Cv(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e}function w0(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e}function wm(e,n){var r=n[0]-e[0],i=n[1]-e[1],a=n[2]-e[2],s=n[3]-e[3];return Math.hypot(r,i,a,s)}function Es(e,n){var r=n[0]-e[0],i=n[1]-e[1],a=n[2]-e[2],s=n[3]-e[3];return r*r+i*i+a*a+s*s}function Jf(e){var n=e[0],r=e[1],i=e[2],a=e[3];return Math.hypot(n,r,i,a)}function A0(e){var n=e[0],r=e[1],i=e[2],a=e[3];return n*n+r*r+i*i+a*a}function t(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=-n[3],e}function o(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e[3]=1/n[3],e}function u(e,n){var r=n[0],i=n[1],a=n[2],s=n[3],h=r*r+i*i+a*a+s*s;return h>0&&(h=1/Math.sqrt(h)),e[0]=r*h,e[1]=i*h,e[2]=a*h,e[3]=s*h,e}function p(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3]}function g(e,n,r,i){var a=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],h=r[0]*i[3]-r[3]*i[0],m=r[1]*i[2]-r[2]*i[1],y=r[1]*i[3]-r[3]*i[1],E=r[2]*i[3]-r[3]*i[2],w=n[0],I=n[1],k=n[2],D=n[3];return e[0]=I*E-k*y+D*m,e[1]=-(w*E)+k*h-D*s,e[2]=w*y-I*h+D*a,e[3]=-(w*m)+I*s-k*a,e}function x(e,n,r,i){var a=n[0],s=n[1],h=n[2],m=n[3];return e[0]=a+i*(r[0]-a),e[1]=s+i*(r[1]-s),e[2]=h+i*(r[2]-h),e[3]=m+i*(r[3]-m),e}function S(e,n){n=n||1;var r,i,a,s,h,m;do r=glMatrix.RANDOM()*2-1,i=glMatrix.RANDOM()*2-1,h=r*r+i*i;while(h>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,m=a*a+s*s;while(m>=1);var y=Math.sqrt((1-h)/m);return e[0]=n*r,e[1]=n*i,e[2]=n*a*y,e[3]=n*s*y,e}function P(e,n,r){var i=n[0],a=n[1],s=n[2],h=n[3];return e[0]=r[0]*i+r[4]*a+r[8]*s+r[12]*h,e[1]=r[1]*i+r[5]*a+r[9]*s+r[13]*h,e[2]=r[2]*i+r[6]*a+r[10]*s+r[14]*h,e[3]=r[3]*i+r[7]*a+r[11]*s+r[15]*h,e}function L(e,n,r){var i=n[0],a=n[1],s=n[2],h=r[0],m=r[1],y=r[2],E=r[3],w=E*i+m*s-y*a,I=E*a+y*i-h*s,k=E*s+h*a-m*i,D=-h*i-m*a-y*s;return e[0]=w*E+D*-h+I*-y-k*-m,e[1]=I*E+D*-m+k*-h-w*-y,e[2]=k*E+D*-y+w*-m-I*-h,e[3]=n[3],e}function N(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Z(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function G(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]}function Q(e,n){var r=e[0],i=e[1],a=e[2],s=e[3],h=n[0],m=n[1],y=n[2],E=n[3];return Math.abs(r-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(a-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(s-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))}var ae=null,Ie=null,Le=null,We=null,Ne=null,nt=null,bt=null,jt=function(){var e=cu();return function(n,r,i,a,s,h){var m,y;for(r||(r=4),i||(i=0),a?y=Math.min(a*r+i,n.length):y=n.length,m=i;m<y;m+=r)e[0]=n[m],e[1]=n[m+1],e[2]=n[m+2],e[3]=n[m+3],s(e,e,h),n[m]=e[0],n[m+1]=e[1],n[m+2]=e[2],n[m+3]=e[3];return n}}(),Ht=Math.PI/180,ur=512,Cr=4003e4;function Hr(e){var n=e.latitude,r=n===void 0?0:n,i=e.zoom,a=i===void 0?0:i,s=e.scale,h=e.highPrecision,m=h===void 0?!1:h,y=e.flipY,E=y===void 0?!1:y;s=s!==void 0?s:Math.pow(2,a);var w={},I=ur*s,k=Math.cos(r*Ht),D=I/360,W=D/k,J=I/Cr/k;if(w.pixelsPerMeter=[J,-J,J],w.metersPerPixel=[1/J,-1/J,1/J],w.pixelsPerDegree=[D,-W,J],w.degreesPerPixel=[1/D,-1/W,1/J],m){var ie=Ht*Math.tan(r*Ht)/k,Oe=D*ie/2,qe=I/Cr*ie,rt=qe/W*J;w.pixelsPerDegree2=[0,-Oe,qe],w.pixelsPerMeter2=[rt,0,rt],E&&(w.pixelsPerDegree2[1]=-w.pixelsPerDegree2[1],w.pixelsPerMeter2[1]=-w.pixelsPerMeter2[1])}return E&&(w.pixelsPerMeter[1]=-w.pixelsPerMeter[1],w.metersPerPixel[1]=-w.metersPerPixel[1],w.pixelsPerDegree[1]=-w.pixelsPerDegree[1],w.degreesPerPixel[1]=-w.degreesPerPixel[1]),w}var Tn;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Tn||(Tn={}));var Jr={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Zn,pn,Pi,Kn,Mn,Ni=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],wi=(Zn=(0,$r.b2)(),pn=(0,$r.f3)(Nt.ICameraService),Zn(Pi=(Kn=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"needRefresh",!0),qn(this,"cameraService",Mn,this),(0,A.Z)(this,"coordinateSystem",void 0),(0,A.Z)(this,"viewportCenter",void 0),(0,A.Z)(this,"viewportCenterProjection",void 0),(0,A.Z)(this,"pixelsPerDegree",void 0),(0,A.Z)(this,"pixelsPerDegree2",void 0),(0,A.Z)(this,"pixelsPerMeter",void 0)}return(0,Yt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Hr({latitude:a[1],zoom:r}),h=s.pixelsPerMeter,m=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=h,this.pixelsPerDegree=m,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Tn.LNGLAT||this.coordinateSystem===Tn.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Tn.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Tn.P20_OFFSET&&this.calculateLnglatOffset(a,r,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,i,a,s){var h=Hr({latitude:r[1],zoom:i,scale:a,flipY:s,highPrecision:!0}),m=h.pixelsPerMeter,y=h.pixelsPerDegree,E=h.pixelsPerDegree2,w=this.cameraService.getViewMatrix(),I=this.cameraService.getProjectionMatrix(),k=rr([],I,w),D=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,i));this.viewportCenterProjection=P([],[D[0],D[1],0,1],k),w=this.cameraService.getViewMatrixUncentered()||w,k=rr([],I,w),k=rr([],k,Ni),this.cameraService.setViewProjectionMatrix(k),this.pixelsPerMeter=m,this.pixelsPerDegree=y,this.pixelsPerDegree2=E}}]),e}(),Mn=ci(Kn.prototype,"cameraService",[pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kn))||Pi),Ji=V(20396),Dn=V.n(Ji),xi;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(xi||(xi={}));var Ya,ho,lo,Ua,po;function as(e){var n=os();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zs={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},fs=(Ya=(0,$r.b2)(),ho=(0,$r.f3)(Nt.IMapService),Ya(lo=(Ua=function(e){(0,bn.Z)(r,e);var n=as(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),qn((0,be.Z)(i),"mapService",po,(0,be.Z)(i)),(0,A.Z)((0,be.Z)(i),"hammertime",void 0),(0,A.Z)((0,be.Z)(i),"lastClickTime",0),(0,A.Z)((0,be.Z)(i),"lastClickXY",[-1,-1]),(0,A.Z)((0,be.Z)(i),"clickTimer",void 0),(0,A.Z)((0,be.Z)(i),"$containter",void 0),(0,A.Z)((0,be.Z)(i),"onDrag",function(m){var y=i.interactionEvent(m);y.type=Zs[y.type],i.emit(xi.Drag,y)}),(0,A.Z)((0,be.Z)(i),"onHammer",function(m){m.srcEvent.stopPropagation();var y=i.interactionEvent(m);i.emit(xi.Hover,y)}),(0,A.Z)((0,be.Z)(i),"onTouch",function(m){var y=m.touches[0];i.onHover({x:y.pageX,y:y.pageY,type:"touch"})}),(0,A.Z)((0,be.Z)(i),"onHover",function(m){var y=m.clientX,E=m.clientY,w=y,I=E,k=m.type,D=i.mapService.getMapContainer();if(D)if(es)w=w-D.left-0,I=I-D.top-0;else{var W=D.getBoundingClientRect(),J=W.top,ie=W.left;w=w-ie-D.clientLeft,I=I-J-D.clientTop}var Oe=i.mapService.containerToLngLat([w,I]);if(k==="click"){if(!es&&"ontouchstart"in document.documentElement)return;i.isDoubleTap(w,I,Oe);return}if(k==="touch"){i.isDoubleTap(w,I,Oe);return}k!=="click"&&k!=="dblclick"&&i.emit(xi.Hover,{x:w,y:I,lngLat:Oe,type:k,target:m})}),i}return(0,Yt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(xi.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,h=a.y;this.emit(xi.Hover,{x:s,y:h})}},{key:"triggerSelect",value:function(a){this.emit(xi.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(xi.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(es)Xi.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Dn()).Manager(a);s.add(new(Dn()).Tap({event:"dblclick",taps:2})),s.add(new(Dn()).Tap({event:"click"})),s.add(new(Dn()).Pan({threshold:0,pointers:0})),s.add(new(Dn()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(es)Xi.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,h=a.pointerType,m,y;h==="touch"?(y=Math.floor(a.pointers[0].clientY),m=Math.floor(a.pointers[0].clientX)):(y=Math.floor(a.srcEvent.y),m=Math.floor(a.srcEvent.x));var E=this.mapService.getMapContainer();if(E){var w=E.getBoundingClientRect(),I=w.top,k=w.left;m-=k,y-=I}var D=this.mapService.containerToLngLat([m,y]);return{x:m,y,lngLat:D,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,h){var m=this,y=new Date().getTime(),E="click";y-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),E="dblclick",this.emit(xi.Hover,{x:a,y:s,lngLat:h,type:E})):(this.lastClickTime=y,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){E="click",m.emit(xi.Hover,{x:a,y:s,lngLat:h,type:E})},400))}}]),r}(ip()),po=ci(Ua.prototype,"mapService",[ho],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua))||lo),ro=V(92137),Io=V(87757),Hi=V.n(Io),Gi=0;function Ra(e){if(es)return null;var n=e;if(typeof e=="string"&&(n=document.getElementById(e)),n){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Gi++),r.classList.add("l7-scene"),n.appendChild(r),r}return null}function Ea(e){var n,r,i=!0;return e==null||(n=e.target)===null||n===void 0||(r=n.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(h){(h==="l7-marker"||h==="l7-popup")&&(i=!1)})}}),i}var q;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(q||(q={}));var Vs,Ss,Za,Oo,Cs,ia,Eu,Su,Vl,So,jl;function $u(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Kc(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?$u(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$u(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var eh=(Vs=(0,$r.b2)(),Ss=(0,$r.f3)(Nt.IRendererService),Za=(0,$r.f3)(Nt.IGlobalConfigService),Oo=(0,$r.f3)(Nt.IInteractionService),Cs=(0,$r.f3)(Nt.ILayerService),Vs(ia=(Eu=function(){function e(){var n=this;(0,Bt.Z)(this,e),qn(this,"rendererService",Su,this),qn(this,"configService",Vl,this),qn(this,"interactionService",So,this),qn(this,"layerService",jl,this),(0,A.Z)(this,"pickingFBO",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0),(0,A.Z)(this,"alreadyInPicking",!1),(0,A.Z)(this,"pickBufferScale",1),(0,A.Z)(this,"lastPickTime",new Date().getTime()),(0,A.Z)(this,"pickFromPickingFBO",function(r,i){var a,s=i.x,h=i.y,m=i.lngLat,y=i.type,E=i.target,w=!1,I=n.rendererService,k=I.getViewportSize,D=I.readPixels,W=I.getContainer,J=n.getContainerSize(W()),ie=J.width,Oe=J.height;ie*=fa,Oe*=fa;var qe=r.getLayerConfig(),rt=qe.enableHighlight,pt=qe.enableSelect,kt=s*fa,zt=h*fa;if(kt>ie-1*fa||kt<0||zt>Oe-1*fa||zt<0)return!1;var nr;if(nr=D({x:Math.floor(kt/n.pickBufferScale),y:Math.floor((Oe-(h+1)*fa)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),nr[0]!==0||nr[1]!==0||nr[2]!==0){var dr=Pe(nr),Zr=r.getSource().getFeatureById(dr);dr!==r.getCurrentPickId()&&y==="mousemove"&&(y="mouseenter");var un={x:s,y:h,type:y,lngLat:m,featureId:dr,feature:Zr,target:E};Zr&&(w=!0,r.setCurrentPickId(dr),n.triggerHoverOnLayer(r,un))}else{var wr={x:s,y:h,lngLat:m,type:r.getCurrentPickId()!==null&&y==="mousemove"?"mouseout":"un"+y,featureId:null,target:E,feature:null};n.triggerHoverOnLayer(r,Kc(Kc({},wr),{},{type:"unpick"})),n.triggerHoverOnLayer(r,wr),r.setCurrentPickId(null)}if(rt&&n.highlightPickedFeature(r,nr),pt&&y==="click"&&((a=nr)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var Pn=Pe(nr);r.getCurrentSelectedId()===null||Pn!==r.getCurrentSelectedId()?(n.selectFeature(r,nr),r.setCurrentSelectedId(Pn)):(n.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return w})}return(0,Yt.Z)(e,[{key:"init",value:function(r){var i=this.rendererService,a=i.createTexture2D,s=i.createFramebuffer,h=i.getViewportSize,m=i.getContainer,y=this.getContainerSize(m()),E=y.width,w=y.height;E*=fa,w*=fa,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(E/this.pickBufferScale),height:Math.round(w/this.pickBufferScale),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(xi.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var n=(0,ro.Z)(Hi().mark(function i(a,s,h){var m=this,y,E,w,I;return Hi().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:y=this.rendererService,E=y.useFramebuffer,w=y.clear,I=y.getContainer,this.resizePickingFBO(),E(this.pickingFBO,function(){w({framebuffer:m.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var W=m.pickBox(a,s);h(W)});case 3:case"end":return D.stop()}},i,this)}));function r(i,a,s){return n.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,i){var a=this,s=i.map(function(wr){var Pn=wr<0?0:wr;return Math.floor(Pn*fa/a.pickBufferScale)}),h=(0,Vn.Z)(s,4),m=h[0],y=h[1],E=h[2],w=h[3],I=this.rendererService,k=I.getViewportSize,D=I.readPixels,W=I.getContainer,J=this.getContainerSize(W()),ie=J.width,Oe=J.height;if(ie*=fa,Oe*=fa,m>(ie-1)*fa/this.pickBufferScale||E<0||y>(Oe-1)*fa/this.pickBufferScale||w<0)return[];var qe,rt=Math.min(ie/this.pickBufferScale,E)-m,pt=Math.min(Oe/this.pickBufferScale,w)-y;qe=D({x:m,y:Math.floor(Oe/this.pickBufferScale-(w+1)),width:rt,height:pt,data:new Uint8Array(rt*pt*4),framebuffer:this.pickingFBO});for(var kt=[],zt={},nr=0;nr<qe.length/4;nr=nr+1){var dr=qe.slice(nr*4,nr*4+4),Zr=Pe(dr);if(Zr!==-1&&!zt[Zr]){var un=r.getSource().getFeatureById(Zr);kt.push(Kc(Kc({},un),{},{pickedFeatureIdx:Zr})),zt[Zr]=!0}}return kt}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/fa,height:r.height/fa}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var n=(0,ro.Z)(Hi().mark(function i(a){var s;return Hi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){m.next=2;break}return m.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu")){m.next=7;break}return m.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return m.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,i=this.getContainerSize(r()),a=i.width,s=i.height;a*=fa,s*=fa,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var n=(0,ro.Z)(Hi().mark(function i(a){var s=this,h,m,y,E,w;return Hi().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:h=this.rendererService,m=h.getViewportSize,y=h.useFramebuffer,E=h.clear,w=h.getContainer,this.resizePickingFBO(),y(this.pickingFBO,function(){var D=s.layerService.getRenderList();D.filter(function(W){return W.needPick(a.type)}).reverse().some(function(W){E({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),W.hooks.beforePickingEncode.call(),W.renderModels(!0),W.hooks.afterPickingEncode.call();var J=s.pickFromPickingFBO(W,a);return J&&!W.getLayerConfig().enablePropagation})});case 3:case"end":return k.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,i){Ea(i)&&r.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(r,i){var a=(0,Vn.Z)(i,3),s=a[0],h=a[1],m=a[2];r.hooks.beforeHighlight.call([s,h,m])}},{key:"selectFeature",value:function(r,i){var a=(0,Vn.Z)(i,3),s=a[0],h=a[1],m=a[2];r.hooks.beforeSelect.call([s,h,m])}}]),e}(),Su=ci(Eu.prototype,"rendererService",[Ss],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vl=ci(Eu.prototype,"configService",[Za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),So=ci(Eu.prototype,"interactionService",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jl=ci(Eu.prototype,"layerService",[Cs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eu))||ia),Rh=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Bt.Z)(this,e),(0,A.Z)(this,"autoStart",void 0),(0,A.Z)(this,"startTime",0),(0,A.Z)(this,"oldTime",0),(0,A.Z)(this,"running",!1),(0,A.Z)(this,"elapsedTime",0),this.autoStart=n}return(0,Yt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var i=(typeof performance=="undefined"?Date:performance).now();r=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=r}return r}}]),e}(),yc,th,mp,rh,kh,wf,gp,_c,Lh,Dh=(yc=(0,$r.b2)(),th=(0,$r.f3)(Nt.IRendererService),mp=(0,$r.f3)(Nt.IMapService),rh=(0,$r.f3)(Nt.IGlobalConfigService),yc(kh=(wf=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"clock",new Rh),(0,A.Z)(this,"alreadyInRendering",!1),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"layerList",[]),(0,A.Z)(this,"layerRenderID",void 0),(0,A.Z)(this,"sceneInited",!1),(0,A.Z)(this,"animateInstanceCount",0),(0,A.Z)(this,"shaderPicking",!0),(0,A.Z)(this,"enableRender",!0),qn(this,"renderService",gp,this),qn(this,"mapService",_c,this),qn(this,"configService",Lh,this)}return(0,Yt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(i){return i.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(i){return i.name===r})}},{key:"cleanRemove",value:function(r,i){if(i){var a=i.layerChildren.indexOf(r);a>-1&&i.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,i){if(i){var a=i.layerChildren.indexOf(r);a>-1&&i.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){this.alreadyInRendering||!this.enableRender||(this.alreadyInRendering=!0,this.clear(),this.layerList.forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).forEach(function(i){r.layerList.push(i),i.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).forEach(function(a){r.layerList.push(a)})}),this.layerList.sort(function(i,a){return i.zIndex-a.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(i){return i.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Xi.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=Ce(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){Xi.cancelAnimationFrame(this.layerRenderID)}}]),e}(),gp=ci(wf.prototype,"renderService",[th],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_c=ci(wf.prototype,"mapService",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lh=ci(wf.prototype,"configService",[rh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wf))||kh),wl=V(81253),Fh=V(14293),$c=V.n(Fh),Kp=function(){function e(n){var r=this;(0,Bt.Z)(this,e),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"scale",void 0),(0,A.Z)(this,"descriptor",void 0),(0,A.Z)(this,"featureBufferLayout",[]),(0,A.Z)(this,"needRescale",!1),(0,A.Z)(this,"needRemapping",!1),(0,A.Z)(this,"needRegenerateVertices",!1),(0,A.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,A.Z)(this,"vertexAttribute",void 0),(0,A.Z)(this,"defaultCallback",function(i){if(i.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return i.map(function(s,h){var m,y=(m=r.scale)===null||m===void 0?void 0:m.scalers[h].func,E=y(s);return E})}),this.setProps(n)}return(0,Yt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var i;if((i=this.scale)!==null&&i!==void 0&&i.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,_e.Z)(r));if(!$c()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),yp=["buffer","update","name"],Qc,_p,Bh,Nh,nh,xp;function ih(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function zh(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ih(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ih(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function bp(e){return new Promise(function(n){return setTimeout(n,e)})}var Ep=(Qc={},(0,A.Z)(Qc,q.FLOAT,4),(0,A.Z)(Qc,q.UNSIGNED_BYTE,1),(0,A.Z)(Qc,q.UNSIGNED_SHORT,2),Qc),ah=(_p=(0,$r.b2)(),Bh=(0,$r.f3)(Nt.IRendererService),_p(Nh=(nh=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"attributesAndIndices",void 0),qn(this,"rendererService",xp,this),(0,A.Z)(this,"attributes",[]),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Yt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var i=this.getLayerStyleAttribute(r.name||"");return i?i.setProps(r):(i=new Kp(r),this.attributes.push(i)),i}},{key:"updateStyleAttribute",value:function(r,i,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(zh(zh({},i),{},{name:r})));var h=i.scale;h&&s&&(s.scale=h,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(i){return i.name===r})}},{key:"getLayerAttributeScale",value:function(r){var i,a=this.getLayerStyleAttribute(r),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,i){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,h=this.attributes.find(function(pt){return pt.name===r});if(h&&h.descriptor){var m=h.descriptor,y=m.update,E=m.buffer,w=m.size,I=w===void 0?0:w,k=Ep[E.type||q.FLOAT];if(y){var D=this.featureLayout,W=D.elements,J=D.sizePerElement,ie=W.slice(a,s);if(!ie.length)return;var Oe=ie[0].offset,qe=Oe*I*k,rt=ie.map(function(pt,kt){for(var zt=pt.featureIdx,nr=pt.vertices,dr=pt.normals,Zr=nr.length/J,un=[],wr=0;wr<Zr;wr++){var Pn=dr?dr.slice(wr*3,wr*3+3):[];un.push.apply(un,(0,_e.Z)(y(i[zt],zt,nr.slice(wr*J,wr*J+J),kt,Pn)))}return un}).reduce(function(pt,kt){return pt.push.apply(pt,(0,_e.Z)(kt)),pt},[]);h.vertexAttribute.updateBuffer({data:rt,offset:qe})}}}},{key:"createAttributesAndIndices",value:function(r,i,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var h=this.attributes.map(function(qe){return qe.resetDescriptor(),qe.descriptor}),m=0,y=[],E=[],w=[],I=3;r.forEach(function(qe,rt){var pt=s.triangulation(qe,a),kt=pt.indices,zt=pt.vertices,nr=pt.normals,dr=pt.size;kt.forEach(function(Pn){E.push(Pn+m)}),I=dr;var Zr=zt.length/dr;s.featureLayout.sizePerElement=I,s.featureLayout.elements.push({featureIdx:rt,vertices:zt,normals:nr,offset:m}),m+=Zr;for(var un=function(Nn){var pi=(nr==null?void 0:nr.slice(Nn*3,Nn*3+3))||[],co=zt.slice(Nn*dr,Nn*dr+dr);h.forEach(function(As,tl){if(As&&As.update){var Tc;(Tc=As.buffer.data).push.apply(Tc,(0,_e.Z)(As.update(qe,rt,co,Nn,pi)))}})},wr=0;wr<Zr;wr++)un(wr)});var k=this.rendererService,D=k.createAttribute,W=k.createBuffer,J=k.createElements,ie={};h.forEach(function(qe,rt){if(qe){var pt=qe.buffer,kt=qe.update,zt=qe.name,nr=(0,wl.Z)(qe,yp),dr=D(zh({buffer:W(pt)},nr));ie[qe.name||""]=dr,s.attributes[rt].vertexAttribute=dr}});var Oe=J({data:E,type:q.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:ie,elements:Oe},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(i){i.vertexAttribute&&i.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),xp=ci(nh.prototype,"rendererService",[Bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nh))||Nh),Uh=V(67709),Zh=V.n(Uh),$p,Dd,Qp,Fd,Jp,wv,Vh,Co,Al,Av,Jc,ed,Bd,Sp,Gl,Cp,jh,ws,wp,td,Nd,Gh,zd,Ud,Zd,Vd,jd,Cu,Ap,Gd,Hl,Tv,Hd;function oh(e){var n=Hh();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Hh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wh=($p=(0,$r.b2)(),Dd=(0,$r.f3)(Nt.SceneID),Qp=(0,$r.f3)(Nt.IIconService),Fd=(0,$r.f3)(Nt.IFontService),Jp=(0,$r.f3)(Nt.IControlService),wv=(0,$r.f3)(Nt.IGlobalConfigService),Vh=(0,$r.f3)(Nt.IMapService),Co=(0,$r.f3)(Nt.ICoordinateSystemService),Al=(0,$r.f3)(Nt.IRendererService),Av=(0,$r.f3)(Nt.ILayerService),Jc=(0,$r.f3)(Nt.ICameraService),ed=(0,$r.f3)(Nt.IInteractionService),Bd=(0,$r.f3)(Nt.IPickingService),Sp=(0,$r.f3)(Nt.IShaderModuleService),Gl=(0,$r.f3)(Nt.IMarkerService),Cp=(0,$r.f3)(Nt.IPopupService),$p(jh=(ws=function(e){(0,bn.Z)(r,e);var n=oh(r);function r(){var i;return(0,Bt.Z)(this,r),i=n.call(this),(0,A.Z)((0,be.Z)(i),"destroyed",!1),(0,A.Z)((0,be.Z)(i),"loaded",!1),(0,A.Z)((0,be.Z)(i),"loadFont",!1),(0,A.Z)((0,be.Z)(i),"fontFamily",""),qn((0,be.Z)(i),"id",wp,(0,be.Z)(i)),qn((0,be.Z)(i),"iconService",td,(0,be.Z)(i)),qn((0,be.Z)(i),"fontService",Nd,(0,be.Z)(i)),qn((0,be.Z)(i),"controlService",Gh,(0,be.Z)(i)),qn((0,be.Z)(i),"configService",zd,(0,be.Z)(i)),qn((0,be.Z)(i),"map",Ud,(0,be.Z)(i)),qn((0,be.Z)(i),"coordinateSystemService",Zd,(0,be.Z)(i)),qn((0,be.Z)(i),"rendererService",Vd,(0,be.Z)(i)),qn((0,be.Z)(i),"layerService",jd,(0,be.Z)(i)),qn((0,be.Z)(i),"cameraService",Cu,(0,be.Z)(i)),qn((0,be.Z)(i),"interactionService",Ap,(0,be.Z)(i)),qn((0,be.Z)(i),"pickingService",Gd,(0,be.Z)(i)),qn((0,be.Z)(i),"shaderModuleService",Hl,(0,be.Z)(i)),qn((0,be.Z)(i),"markerService",Tv,(0,be.Z)(i)),qn((0,be.Z)(i),"popupService",Hd,(0,be.Z)(i)),(0,A.Z)((0,be.Z)(i),"inited",!1),(0,A.Z)((0,be.Z)(i),"initPromise",void 0),(0,A.Z)((0,be.Z)(i),"rendering",!1),(0,A.Z)((0,be.Z)(i),"$container",void 0),(0,A.Z)((0,be.Z)(i),"canvas",void 0),(0,A.Z)((0,be.Z)(i),"markerContainer",void 0),(0,A.Z)((0,be.Z)(i),"hooks",void 0),(0,A.Z)((0,be.Z)(i),"handleWindowResized",function(){i.emit("resize"),i.$container&&(i.initContainer(),Ja(),i.coordinateSystemService.needRefresh=!0,i.render())}),(0,A.Z)((0,be.Z)(i),"handleMapCameraChanged",function(a){i.cameraService.update(a),i.render()}),i.hooks={init:new Uo},i}return(0,Yt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ro.Z)(Hi().mark(function h(){return Hi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,new Promise(function(E){s.map.onCameraChanged(function(w){s.cameraService.init(),s.cameraService.update(w),s.map.version!=="GAODE2.x"&&E()}),s.map.version!=="GAODE2.x"?s.map.init():E()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){y.next=6;break}return y.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(xi.Drag,s.addSceneEvent.bind(s));case 13:case"end":return y.stop()}},h)}))),this.hooks.init.tapPromise("initRenderer",(0,ro.Z)(Hi().mark(function h(){var m,y;return Hi().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(m=Ra(s.configService.getSceneConfig(s.id).id||""),s.$container=m,!m){w.next=11;break}return s.canvas=ao("canvas","",m),s.setCanvas(),w.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Zh()(s.$container,s.handleWindowResized),Xi.matchMedia&&((y=Xi.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||y===void 0||y.addListener(s.handleWindowResized)),w.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return w.stop()}},h)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ro.Z)(Hi().mark(function h(){return Hi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,new Promise(function(E){s.map.onCameraChanged(function(w){s.cameraService.init(),s.cameraService.update(w),s.map.version!=="GAODE2.x"&&E()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(xi.Drag,s.addSceneEvent.bind(s));case 5:case"end":return y.stop()}},h)}))),this.hooks.init.tapPromise("initRenderer",(0,ro.Z)(Hi().mark(function h(){var m;return Hi().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(m=a.canvas,s.$container=m||null,!s.$container){E.next=7;break}return E.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:E.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return E.stop()}},h)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"render",value:function(){var i=(0,ro.Z)(Hi().mark(function s(){return Hi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.rendering||this.destroyed)){m.next=2;break}return m.abrupt("return");case 2:if(this.rendering=!0,this.inited){m.next=15;break}return m.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){m.next=10;break}return m.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return m.stop()}},s,this)}));function a(){return i.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var h=document.createElement("style");h.type="text/css",h.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(h),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,h=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var m=a==="jpg"?h==null?void 0:h.toDataURL("image/jpeg"):h==null?void 0:h.toDataURL("image/png");return m}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=ao("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,h;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),setTimeout(function(){a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(s=this.$container)===null||s===void 0||(h=s.parentNode)===null||h===void 0||h.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Uh.unbind)(this.$container,this.handleWindowResized),Xi.matchMedia){var m;(m=Xi.matchMedia("screen and (min-resolution: 2dppx)"))===null||m===void 0||m.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,h=fa,m=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,y=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,E=this.canvas;E&&(E.width=m*h,E.height=y*h),this.rendererService.viewport({x:0,y:0,width:h*m,height:h*y})}},{key:"setCanvas",value:function(){var a,s,h=fa,m=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,y=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,E=this.canvas;E.width=m*h,E.height=y*h,E.style.width="100%",E.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(_u.EventEmitter),wp=ci(ws.prototype,"id",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),td=ci(ws.prototype,"iconService",[Qp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd=ci(ws.prototype,"fontService",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gh=ci(ws.prototype,"controlService",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zd=ci(ws.prototype,"configService",[wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud=ci(ws.prototype,"map",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd=ci(ws.prototype,"coordinateSystemService",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=ci(ws.prototype,"rendererService",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=ci(ws.prototype,"layerService",[Av],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cu=ci(ws.prototype,"cameraService",[Jc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ap=ci(ws.prototype,"interactionService",[ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=ci(ws.prototype,"pickingService",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hl=ci(ws.prototype,"shaderModuleService",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=ci(ws.prototype,"markerService",[Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=ci(ws.prototype,"popupService",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ws))||jh),Xh=V(44908),sh=V.n(Xh);function Mv(e){var n=0;switch(e){case"vec2":case"ivec2":n=2;break;case"vec3":case"ivec3":n=3;break;case"vec4":case"ivec4":case"mat2":n=4;break;case"mat3":n=9;break;case"mat4":n=16;break;default:}return n}var Pv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Wd(e){var n={};return e=e.replace(Pv,function(r,i,a){var s=a.split(":"),h=s[0].trim(),m="";switch(s.length>1&&(m=s[1].trim()),i){case"bool":m=m==="true";break;case"float":case"int":m=Number(m);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":m?m=m.replace("[","").replace("]","").split(",").reduce(function(y,E){return y.push(Number(E.trim())),y},[]):m=new Array(Mv(i)).fill(0);break;default:}return n[h]=m,"uniform ".concat(i," ").concat(h,`;
`)}),{content:e,uniforms:n}}var Xd,rd;function nd(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Qu(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?nd(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nd(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Yd="#define PI 3.14159265359",qd=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Kd=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Iv=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,$d=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float selected = v_PickingResult.a;

  if (selected == SELECT) {
    // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
    vec4 selectColor = u_SelectColor * COLOR_SCALE;
    return selectColor;
  } else if (selected == HIGHLIGHT) {
    // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,Ov=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage
  if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
    // \u9009\u4E2D\u6001
    v_PickingResult.a = SELECT;
  } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
    // \u9AD8\u4EAE\u6001
    v_PickingResult.a = HIGHLIGHT;
  } else {
    v_PickingResult.a = NORMAL;
  }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Rv=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Qd=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,kv=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Tp=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Lv=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,id=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,T0=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Dv=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,M0=/precision\s+(high|low|medium)p\s+float/,P0=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,I0=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,O0=(Xd=(0,$r.b2)(),Xd(rd=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"moduleCache",{}),(0,A.Z)(this,"rawContentCache",{})}return(0,Yt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Yd,fs:Yd}),this.registerModule("decode",{vs:qd,fs:""}),this.registerModule("projection",{vs:Qd,fs:""}),this.registerModule("project",{vs:Rv,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:kv}),this.registerModule("lighting",{vs:Iv,fs:""}),this.registerModule("light",{vs:Kd,fs:""}),this.registerModule("picking",{vs:Ov,fs:$d}),this.registerModule("styleMapping",{vs:Tp,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:Dv,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Lv,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:id,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:T0,fs:""})}},{key:"registerModule",value:function(r,i){if(!this.rawContentCache[r]){var a=i.vs,s=i.fs,h=i.uniforms,m=Wd(a),y=m.content,E=m.uniforms,w=Wd(s),I=w.content,k=w.uniforms;this.rawContentCache[r]={fs:I,uniforms:Qu(Qu(Qu({},E),k),h),vs:y}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var i=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,h=this.processModule(a,[],"vs"),m=h.content,y=h.includeList,E=this.processModule(s,[],"fs"),w=E.content,I=E.includeList,k=w,D=sh()(y.concat(I).concat(r)).reduce(function(W,J){return Qu(Qu({},W),i.rawContentCache[J].uniforms)},{});return M0.test(w)||(k=P0+w),this.moduleCache[r]={fs:k.trim(),uniforms:D,vs:m.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,i,a){var s=this,h=r.replace(I0,function(m,y){var E=y.split(" "),w=E[0].replace(/"/g,"");if(i.indexOf(w)>-1)return"";var I=s.rawContentCache[w][a];i.push(w);var k=s.processModule(I,i,a),D=k.content;return D});return{content:h,includeList:i}}}]),e}())||rd);function R0(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&(e=(0,At.Z)(e),e!==null););return e}function uh(){return typeof Reflect!="undefined"&&Reflect.get?uh=Reflect.get:uh=function(n,r,i){var a=R0(n,r);if(!!a){var s=Object.getOwnPropertyDescriptor(a,r);return s.get?s.get.call(arguments.length<3?n:i):s.value}},uh.apply(this,arguments)}var Af;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Af||(Af={}));var Fv,Wl,lh=(Fv=(0,$r.b2)(),Fv(Wl=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"config",void 0)}return(0,Yt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Af.Normal}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(Nt.IRendererService),this.cameraService=r.getContainer().get(Nt.ICameraService),this.mapService=r.getContainer().get(Nt.IMapService),this.interactionService=r.getContainer().get(Nt.IInteractionService),this.layerService=r.getContainer().get(Nt.ILayerService),this.shaderModuleService=r.getContainer().get(Nt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Wl),Jd,Yh;function Bv(e){var n=sb();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function sb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ub=(Jd=(0,$r.b2)(),Jd(Yh=function(e){(0,bn.Z)(r,e);var n=Bv(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){uh((0,At.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(lh))||Yh),Am,Tm,Mm,k0,Pm;function lb(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=cb(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function cb(e,n){if(!!e){if(typeof e=="string")return Im(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Im(e,n)}}function Im(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var fb=(Am=(0,$r.b2)(),Tm=(0,$r.f3)(Nt.IPostProcessor),Am(Mm=(k0=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"passes",[]),qn(this,"postProcessor",Pm,this),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"renderFlag",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0)}return(0,Yt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var n=(0,ro.Z)(Hi().mark(function i(){var a,s,h;return Hi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:a=lb(this.passes),y.prev=1,a.s();case 3:if((s=a.n()).done){y.next=9;break}return h=s.value,y.next=7,h.render(this.layer);case 7:y.next=3;break;case 9:y.next=14;break;case 11:y.prev=11,y.t0=y.catch(1),a.e(y.t0);case 14:return y.prev=14,a.f(),y.finish(14);case 17:this.layer.renderModels();case 18:case"end":return y.stop()}},i,this,[[1,11,14,17]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){(this.width!==r||this.height!==i)&&(this.width=r,this.height=i)}},{key:"add",value:function(r,i){r.getType()===Af.PostProcessing?this.postProcessor.add(r,this.layer,i):(r.init(this.layer,i),this.passes.push(r))}},{key:"insert",value:function(r,i,a){r.init(this.layer,i),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Pm=ci(k0.prototype,"postProcessor",[Tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0))||Mm),Om,Rm;function km(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Lm(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?km(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):km(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function hb(e){var n=pb();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=(Om=(0,$r.b2)(),Om(Rm=function(e){(0,bn.Z)(r,e);var n=hb(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"pickingFBO",void 0),(0,A.Z)((0,be.Z)(i),"layer",void 0),(0,A.Z)((0,be.Z)(i),"width",0),(0,A.Z)((0,be.Z)(i),"height",0),(0,A.Z)((0,be.Z)(i),"alreadyInRendering",!1),(0,A.Z)((0,be.Z)(i),"pickFromPickingFBO",function(m){var y=m.x,E=m.y,w=m.lngLat,I=m.type;if(!(!i.layer.isVisible()||!i.layer.needPick(I))){var k=i.rendererService,D=k.getViewportSize,W=k.readPixels,J=k.useFramebuffer,ie=D(),Oe=ie.width,qe=ie.height,rt=i.layer.getLayerConfig(),pt=rt.enableHighlight,kt=rt.enableSelect,zt=y*fa,nr=E*fa;if(!(zt>Oe||zt<0||nr>qe||nr<0)){var dr;J(i.pickingFBO,function(){var Zr;if(dr=W({x:Math.round(zt),y:Math.round(qe-(E+1)*fa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),dr[0]!==0||dr[1]!==0||dr[2]!==0){var un=Pe(dr),wr=i.layer.getSource().getFeatureById(un),Pn={x:y,y:E,type:I,lngLat:w,featureId:un,feature:wr};wr&&(i.layer.setCurrentPickId(un),i.triggerHoverOnLayer(Pn))}else{var Nn={x:y,y:E,lngLat:w,type:i.layer.getCurrentPickId()===null?"un"+I:"mouseout",featureId:null,feature:null};i.triggerHoverOnLayer(Lm(Lm({},Nn),{},{type:"unpick"})),i.triggerHoverOnLayer(Nn),i.layer.setCurrentPickId(null)}pt&&i.highlightPickedFeature(dr),kt&&I==="click"&&((Zr=dr)===null||Zr===void 0?void 0:Zr.toString())!==[0,0,0,0].toString()&&i.selectFeature(dr)})}}}),i}return(0,Yt.Z)(r,[{key:"getType",value:function(){return Af.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){uh((0,At.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var h=this.rendererService,m=h.createTexture2D,y=h.createFramebuffer,E=h.getViewportSize,w=E(),I=w.width,k=w.height;this.pickingFBO=y({color:m({width:I,height:k,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(xi.Hover,this.pickFromPickingFBO),this.interactionService.on(xi.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(xi.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var h=this.rendererService,m=h.getViewportSize,y=h.useFramebuffer,E=h.clear,w=m(),I=w.width,k=w.height;this.alreadyInRendering=!0,(this.width!==I||this.height!==k)&&(this.pickingFBO.resize({width:I,height:k}),this.width=I,this.height=k),y(this.pickingFBO,function(){E({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var D=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(D),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,Vn.Z)(a,3),h=s[0],m=s[1],y=s[2];this.layer.hooks.beforeHighlight.call([h,m,y]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,Vn.Z)(a,3),h=s[0],m=s[1],y=s[2];this.layer.hooks.beforeSelect.call([h,m,y]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,h=Ue(s);this.selectFeature(new Uint8Array(h))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,h=Ue(s);this.highlightPickedFeature(new Uint8Array(h))}}]),r}(lh))||Rm),vb=V(11700),mb=V.n(vb),gb=V(68929),yb=V.n(gb),Dm,Fm;function Bm(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function ev(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Bm(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bm(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var _b=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qh=(Dm=(0,$r.b2)(),Dm(Fm=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",_b),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,Yt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Af.PostProcessing}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(Nt.IRendererService),this.shaderModuleService=r.getContainer().get(Nt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,h=a.createBuffer,m=a.createModel,y=this.setupShaders(),E=y.vs,w=y.fs,I=y.uniforms;this.model=m({vs:E,fs:w,attributes:{a_Position:s({buffer:h({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:ev(ev({u_Texture:null},I),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var i=this,a=r.multiPassRenderer.getPostProcessor(),s=this.rendererService,h=s.useFramebuffer,m=s.getViewportSize,y=s.clear,E=m(),w=E.width,I=E.height;h(this.renderToScreen?null:a.getWriteFBO(),function(){y({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),i.model.draw({uniforms:ev({u_Texture:a.getReadFBO(),u_ViewportSize:[w,I]},i.convertOptionsToUniforms(i.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=ev(ev({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var i={};return Object.keys(r).forEach(function(a){$c()(r[a])||(i["u_".concat(mb()(yb()(a)))]=r[a])}),i}}]),e}())||Fm),Nm,zm;function Um(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Zm(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Um(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Um(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xb(e){var n=bb();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Sb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Cb=(Nm=(0,$r.b2)(),Nm(zm=function(e){(0,bn.Z)(r,e);var n=xb(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Sb,fs:Eb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,w=y.height;return{vs:s,fs:h,uniforms:Zm(Zm({},m),{},{u_ViewportSize:[E,w]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return $c()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(qh))||zm),Vm,jm;function Gm(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Hm(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Gm(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gm(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function wb(e){var n=Ab();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Mb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Pb=(Vm=(0,$r.b2)(),Vm(jm=function(e){(0,bn.Z)(r,e);var n=wb(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Mb,fs:Tb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,w=y.height;return{vs:s,fs:h,uniforms:Hm(Hm({},m),{},{u_ViewportSize:[E,w]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return $c()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(qh))||jm),Wm,Xm;function Ym(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function qm(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ym(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ym(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ib(e){var n=Ob();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Ob(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,kb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lb=(Wm=(0,$r.b2)(),Wm(Xm=function(e){(0,bn.Z)(r,e);var n=Ib(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:kb,fs:Rb});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,w=y.height;return{vs:s,fs:h,uniforms:qm(qm({},m),{},{u_ViewportSize:[E,w]})}}}]),r}(qh))||Xm),Km,$m;function Db(e){var n=Fb();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Fb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Nb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,zb=(Km=(0,$r.b2)(),Km($m=function(e){(0,bn.Z)(r,e);var n=Db(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Nb,fs:Bb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(qh))||$m),Qm,Jm;function eg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function tg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?eg(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ub(e){var n=Zb();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Zb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,jb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Gb=(Qm=(0,$r.b2)(),Qm(Jm=function(e){(0,bn.Z)(r,e);var n=Ub(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:jb,fs:Vb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,w=y.height;return{vs:s,fs:h,uniforms:tg(tg({},m),{},{u_ViewportSize:[E,w]})}}}]),r}(qh))||Jm),rg,ng;function ig(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function ag(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ig(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ig(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Hb(e){var n=Wb();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Yb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qb=(rg=(0,$r.b2)(),rg(ng=function(e){(0,bn.Z)(r,e);var n=Hb(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Yb,fs:Xb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,w=y.height;return{vs:s,fs:h,uniforms:ag(ag({},m),{},{u_ViewportSize:[E,w]})}}}]),r}(qh))||ng),og,sg;function Kb(e){var n=$b();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function $b(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Jb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,e2=(og=(0,$r.b2)(),og(sg=function(e){(0,bn.Z)(r,e);var n=Kb(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Jb,fs:Qb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(qh))||sg),ug,lg;function t2(e){var n=r2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function r2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,i2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,a2=(ug=(0,$r.b2)(),ug(lg=function(e){(0,bn.Z)(r,e);var n=t2(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:n2,fs:i2}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(qh))||lg),cg,fg,hg,pg,ad,dg,o2=(cg=(0,$r.b2)(),fg=(0,$r.f3)(Nt.IRendererService),hg=(0,$r.zY)(),cg(pg=(ad=function(){function e(){(0,Bt.Z)(this,e),qn(this,"rendererService",dg,this),(0,A.Z)(this,"passes",[]),(0,A.Z)(this,"readFBO",void 0),(0,A.Z)(this,"writeFBO",void 0)}return(0,Yt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var n=(0,ro.Z)(Hi().mark(function i(a){var s,h;return Hi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:s=0;case 1:if(!(s<this.passes.length)){y.next=10;break}return h=this.passes[s],h.setRenderToScreen(this.isLastEnabledPass(s)),y.next=6,h.render(a);case 6:s!==this.passes.length-1&&this.swap();case 7:s++,y.next=1;break;case 10:case"end":return y.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){this.readFBO.resize({width:r,height:i}),this.writeFBO.resize({width:r,height:i})}},{key:"add",value:function(r,i,a){r.init(i,a),this.passes.push(r)}},{key:"insert",value:function(r,i,a,s){r.init(a,s),this.passes.splice(i,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(i){return i.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var i=r+1;i<this.passes.length;i++)if(this.passes[i].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),dg=ci(ad.prototype,"rendererService",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ci(ad.prototype,"init",[hg],Object.getOwnPropertyDescriptor(ad.prototype,"init"),ad.prototype),ad))||pg),vg,mg;function s2(e){var n=u2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function u2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l2=(vg=(0,$r.b2)(),vg(mg=function(e){(0,bn.Z)(r,e);var n=s2(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getType",value:function(){return Af.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){uh((0,At.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,h=s.useFramebuffer,m=s.clear;h(null,function(){m({color:[0,0,0,0],depth:1,stencil:0}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(lh))||mg),gg,yg,_g,L0,xg;function bg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Eg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?bg(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function c2(e){var n=f2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function f2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h2=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Sg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,p2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Cg(e,n){for(var r=0,i=1/n,a=e;a>0;)r=r+i*(a%n),a=Math.floor(a/n),i=i/n;return r}var d2=1,v2=(gg=(0,$r.b2)(),yg=(0,$r.f3)(Nt.IShaderModuleService),gg(_g=(L0=function(e){(0,bn.Z)(r,e);var n=c2(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),qn((0,be.Z)(i),"shaderModuleService",xg,(0,be.Z)(i)),(0,A.Z)((0,be.Z)(i),"haltonSequence",[]),(0,A.Z)((0,be.Z)(i),"accumulatingId",0),(0,A.Z)((0,be.Z)(i),"frame",0),(0,A.Z)((0,be.Z)(i),"timer",void 0),(0,A.Z)((0,be.Z)(i),"sampleRenderTarget",void 0),(0,A.Z)((0,be.Z)(i),"prevRenderTarget",void 0),(0,A.Z)((0,be.Z)(i),"outputRenderTarget",void 0),(0,A.Z)((0,be.Z)(i),"copyRenderTarget",void 0),(0,A.Z)((0,be.Z)(i),"blendModel",void 0),(0,A.Z)((0,be.Z)(i),"outputModel",void 0),(0,A.Z)((0,be.Z)(i),"copyModel",void 0),i}return(0,Yt.Z)(r,[{key:"getType",value:function(){return Af.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){uh((0,At.Z)(r.prototype),"init",this).call(this,a,s);var h=this.rendererService,m=h.createFramebuffer,y=h.createTexture2D;this.sampleRenderTarget=m({color:y({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.prevRenderTarget=m({color:y({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.outputRenderTarget=m({color:y({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.copyRenderTarget=m({color:y({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})});for(var E=0;E<30;E++)this.haltonSequence.push([Cg(E,2),Cg(E,3)]);this.blendModel=this.createTriangleModel("blend-pass",h2),this.outputModel=this.createTriangleModel("copy-pass",Sg,{blend:{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:q.ONE,dstAlpha:q.ONE_MINUS_SRC_ALPHA},equation:{rgb:q.FUNC_ADD,alpha:q.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Sg)}},{key:"render",value:function(a){var s=this,h=this.rendererService,m=h.clear,y=h.getViewportSize,E=h.useFramebuffer,w=y(),I=w.width,k=w.height;this.sampleRenderTarget.resize({width:I,height:k}),this.prevRenderTarget.resize({width:I,height:k}),this.outputRenderTarget.resize({width:I,height:k}),this.copyRenderTarget.resize({width:I,height:k}),this.resetFrame(),this.stopAccumulating();var D=a.multiPassRenderer.getPostProcessor().getReadFBO();E(D,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:D}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var W=function J(ie){!s.accumulatingId||ie!==s.accumulatingId||s.isFinished()||(s.doRender(a),Xi.requestAnimationFrame(function(){J(ie)}))};this.accumulatingId=d2++,this.timer=Xi.setTimeout(function(){W(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,h=this.rendererService,m=h.clear,y=h.getViewportSize,E=h.useFramebuffer,w=y(),I=w.width,k=w.height,D=a.getLayerConfig(),W=D.jitterScale,J=W===void 0?1:W,ie=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ie[0]*2-1)/I*J,(ie[1]*2-1)/k*J),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),E(this.sampleRenderTarget,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Oe=a.getLayerConfig();E(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Oe.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(E(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),E(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var qe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=qe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Xi.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,h){this.shaderModuleService.registerModule(a,{vs:p2,fs:s});var m=this.shaderModuleService.getModule(a),y=m.vs,E=m.fs,w=m.uniforms,I=this.rendererService,k=I.createAttribute,D=I.createBuffer,W=I.createModel;return W(Eg({vs:y,fs:E,attributes:{a_Position:k({buffer:D({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:Eg({},w),depth:{enable:!1},count:3},h))}}]),r}(lh),xg=ci(L0.prototype,"shaderModuleService",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L0))||_g),tv=new $r.W2;tv.bind(Nt.IGlobalConfigService).to(Cl).inSingletonScope(),(0,$r.GW)((0,$r.b2)(),_u.EventEmitter),tv.bind(Nt.IEventEmitter).to(_u.EventEmitter);var wg=(0,Ad.Z)(tv,!1),D0=function(n){var r=wg.lazyInject(n);return function(i,a,s){r.call(this,i,a),s&&(s.initializer=function(){return i[a]})}},h5=function(n){var r=wg.lazyMultiInject(n);return function(i,a,s){r.call(this,i,a),s&&(s.initializer=function(){return i[a]})}},Xl=tv,m2=0;function g2(){var e=new $r.W2;return e.parent=tv,e.bind(Nt.SceneID).toConstantValue("".concat(m2++)),e.bind(Nt.IShaderModuleService).to(O0).inSingletonScope(),e.bind(Nt.ILayerService).to(Dh).inSingletonScope(),e.bind(Nt.ISceneService).to(Wh).inSingletonScope(),e.bind(Nt.ICameraService).to(Ye).inSingletonScope(),e.bind(Nt.ICoordinateSystemService).to(wi).inSingletonScope(),e.bind(Nt.IInteractionService).to(fs).inSingletonScope(),e.bind(Nt.IPickingService).to(eh).inSingletonScope(),e.bind(Nt.IControlService).to(ot).inSingletonScope(),e.bind(Nt.IMarkerService).to(zr).inSingletonScope(),e.bind(Nt.IIconService).to(er).inSingletonScope(),e.bind(Nt.IFontService).to(dp).inSingletonScope(),e.bind(Nt.IPopupService).to(Rr).inSingletonScope(),e.bind(Nt.INormalPass).to(ub).whenTargetNamed("clear"),e.bind(Nt.INormalPass).to(db).whenTargetNamed("pixelPicking"),e.bind(Nt.INormalPass).to(l2).whenTargetNamed("render"),e.bind(Nt.INormalPass).to(v2).whenTargetNamed("taa"),e.bind(Nt.IFactoryNormalPass).toFactory(function(n){return function(r){return n.container.getNamed(Nt.INormalPass,r)}}),e.bind(Nt.IPostProcessingPass).to(zb).whenTargetNamed("copy"),e.bind(Nt.IPostProcessingPass).to(Cb).whenTargetNamed("blurH"),e.bind(Nt.IPostProcessingPass).to(Pb).whenTargetNamed("blurV"),e.bind(Nt.IPostProcessingPass).to(e2).whenTargetNamed("noise"),e.bind(Nt.IPostProcessingPass).to(a2).whenTargetNamed("sepia"),e.bind(Nt.IPostProcessingPass).to(Lb).whenTargetNamed("colorHalftone"),e.bind(Nt.IPostProcessingPass).to(Gb).whenTargetNamed("hexagonalPixelate"),e.bind(Nt.IPostProcessingPass).to(qb).whenTargetNamed("ink"),e.bind(Nt.IFactoryPostProcessingPass).toFactory(function(n){return function(r){var i=n.container.getNamed(Nt.IPostProcessingPass,r);return i.setName(r),i}}),e}function y2(e){var n=new $r.W2;return n.parent=e,n.bind(Nt.IStyleAttributeService).to(ah).inSingletonScope(),n.bind(Nt.IMultiPassRenderer).to(fb).inSingletonScope(),n.bind(Nt.IPostProcessor).to(o2).inSingletonScope(),n}var p5=V(74691),_2=null;function d5(e){return _2.indexOf(e)}var x2=2,v5=4,b2=64,m5=128,E2=256,S2=512,g5=8192,y5=16384,_5=32768,C2=null,Ag=131072,x5=262144,w2=524288,b5=1048576,A2=2097152,E5=4194304,T2=8388608,M2=16777216,P2=null;function Nv(e,n){return e=_clamp(Math.floor(e),0,255),n=_clamp(Math.floor(n),0,255),256*e+n}function S5(e){var n=e.color,r=e.radius,i=e.tileX,a=e.tileY,s=e.shape,h=e.opacity,m=e.stroke,y=e.strokeWidth,E=e.strokeOpacity,w=[],I=[],k=[],D=[Nv(n[0],n[1]),Nv(n[2],n[3])],W=[Nv(m[0],m[1]),Nv(m[2],m[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(J){var ie=_slicedToArray(J,2),Oe=ie[0],qe=ie[1];w.push([].concat(D,[(Oe+1)*T2+(qe+1)*A2+getShapeIndex(s)*Ag+r,(i+512)*w2+(a+512)*b2])),I.push([].concat(W,[y,E])),k.push([h,0,0,0])}),{packedBuffer:w,packedBuffer2:I,packedBuffer3:k}}function C5(e,n){if(e===0&&!n)return 0;if(e===1&&n)return 4294967295;var r=n?1:0,i=Math.floor(e*127);return i*P2+r*M2+i*Ag+r*C2+i*S2+r*E2+i*x2+r}var xc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(xc||(xc={}));var tu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(tu||(tu={}));var Kh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Kh||(Kh={}));var $n;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})($n||($n={}));var I2=["mapload","mapchange"],Mp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},F0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],$h;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})($h||($h={}));function Tg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Mg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Tg(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function O2(e){var n=R2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function R2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k2=0,zv=function(e){(0,bn.Z)(r,e);var n=O2(r);function r(i){var a;return(0,Bt.Z)(this,r),a=n.call(this),(0,A.Z)((0,be.Z)(a),"controlOption",void 0),(0,A.Z)((0,be.Z)(a),"container",void 0),(0,A.Z)((0,be.Z)(a),"sceneContainer",void 0),(0,A.Z)((0,be.Z)(a),"mapsService",void 0),(0,A.Z)((0,be.Z)(a),"renderService",void 0),(0,A.Z)((0,be.Z)(a),"layerService",void 0),(0,A.Z)((0,be.Z)(a),"controlService",void 0),(0,A.Z)((0,be.Z)(a),"isShow",void 0),a.controlOption=Mg(Mg({},a.getDefault()),i||{}),a}return(0,Yt.Z)(r,[{key:"getDefault",value:function(){return{position:$h.TOPRIGHT,name:"".concat(k2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$h.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Nt.IMapService),this.renderService=a.get(Nt.IRendererService),this.layerService=a.get(Nt.ILayerService),this.controlService=a.get(Nt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,h=this.controlOption.position,m=this.controlService.controlCorners[h];return du(s,"l7-control"),h.indexOf("bottom")!==-1?m.insertBefore(s,m.firstChild):m.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;du(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;ju(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;rc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(_u.EventEmitter);function L2(e){var n=D2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function D2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w5=function(e){(0,bn.Z)(r,e);var n=L2(r);function r(i){var a;return(0,Bt.Z)(this,r),a=n.call(this,i),(0,A.Z)((0,be.Z)(a),"layerControlInputs",void 0),(0,A.Z)((0,be.Z)(a),"layers",void 0),(0,A.Z)((0,be.Z)(a),"lastZIndex",void 0),(0,A.Z)((0,be.Z)(a),"handlingClick",void 0),(0,A.Z)((0,be.Z)(a),"layersLink",void 0),(0,A.Z)((0,be.Z)(a),"baseLayersList",void 0),(0,A.Z)((0,be.Z)(a),"separator",void 0),(0,A.Z)((0,be.Z)(a),"overlaysList",void 0),(0,A.Z)((0,be.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),vl(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,be.Z)(a)),a}return(0,Yt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:$h.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;du(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var h=s-(this.container.offsetTop+50);return h<this.form.clientHeight?(du(this.form,"l7-control-layers-scrollbar"),this.form.style.height=h+"px"):ju(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return ju(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=ao("div",a),h=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var m=this.form=ao("form",a+"-list");h&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=ao("a",a+"-toggle",s);var y=this.layersLink;y.title="Layers",h||this.expand(),this.baseLayersList=ao("div",a+"-base",m),this.separator=ao("div",a+"-separator",m),this.overlaysList=ao("div",a+"-overlays",m),s.appendChild(m)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,h=s.baseLayers,m=h===void 0?{}:h,y=s.overlayers,E=y===void 0?{}:y;Object.keys(m).forEach(function(w,I){a.addLayer(m[w],w,!1)}),Object.keys(E).forEach(function(w,I){a.addLayer(E[w],w,!0)})}},{key:"update",value:function(){if(!this.container)return this;Dl(this.baseLayersList),Dl(this.overlaysList),this.layerControlInputs=[];var a,s,h,m,y=0;for(h=0;h<this.layers.length;h++)m=this.layers[h],this.addItem(m),s=s||m.overlay,a=a||!m.overlay,y+=m.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&y>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,h,m=this.mapsService.getZoom(),y=a.length-1;y>=0;y--)if(s=a[y],h=this.layerService.getLayer(s.layerId),h&&h.inited){var E=h.getMinZoom(),w=h.getMaxZoom();s.disabled=m<E||m>w}}},{key:"addLayer",value:function(a,s,h){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:h});var m=this.controlOption,y=m.sortLayers,E=m.sortFunction,w=m.autoZIndex;y&&this.layers.sort(function(I,k){return E(I.layer,k.layer,I.name,k.name)}),w&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),h=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;h&&this.emit(h,s)}},{key:"createRadioElement",value:function(a,s){var h='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",m=document.createElement("div");return m.innerHTML=h,m.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),h=this.layerService.getLayer(a.layer.id),m=h&&h.inited&&a.layer.isVisible(),y;a.overlay?(y=document.createElement("input"),y.type="checkbox",y.className="l7-control-layers-selector",y.defaultChecked=m):y=this.createRadioElement("l7-base-layers",m),this.layerControlInputs.push(y),y.layerId=a.layer.id,y.addEventListener("click",this.onInputClick);var E=document.createElement("span");E.innerHTML=" "+a.name;var w=document.createElement("div");s.appendChild(w),w.appendChild(y),w.appendChild(E);var I=a.overlay?this.overlaysList:this.baseLayersList;return I.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,h,m=[],y=[];this.handlingClick=!0;for(var E=a.length-1;E>=0;E--)s=a[E],h=this.layerService.getLayer(s.layerId),s.checked?m.push(h):s.checked||y.push(h);y.forEach(function(w){w.hide()}),m.forEach(function(w){w.show()}),this.handlingClick=!1}}]),r}(zv);function F2(e){var n=B2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function B2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N2=function(e){(0,bn.Z)(r,e);var n=F2(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getDefault",value:function(){return{position:$h.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=ao("div",a),h=ao("a","l7-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://antv.alipay.com/l7",h.setAttribute("aria-label","AntV logo"),h.setAttribute("rel","noopener nofollow"),s.appendChild(h),s}},{key:"onRemove",value:function(){return null}}]),r}(zv);function z2(e){var n=U2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function U2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A5=function(e){(0,bn.Z)(r,e);var n=z2(r);function r(i){var a;return(0,Bt.Z)(this,r),a=n.call(this,i),(0,A.Z)((0,be.Z)(a),"mScale",void 0),(0,A.Z)((0,be.Z)(a),"iScale",void 0),vl(["update"],(0,be.Z)(a)),a}return(0,Yt.Z)(r,[{key:"getDefault",value:function(){return{position:$h.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=ao("div",a);this.addScales(a+"-line",s);var h=this.controlOption.updateWhenIdle;return this.mapsService.on(h?"moveend":"mapmove",this.update),this.mapsService.on(h?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,h=a.getSize()[1]/2,m=a.containerToLngLat([0,h]),y=a.containerToLngLat([s,h]),E=nu([m.lng,m.lat],[y.lng,y.lat]);this.updateScales(E)}},{key:"updateScales",value:function(a){var s=this.controlOption,h=s.metric,m=s.imperial;h&&a&&this.updateMetric(a),m&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),h=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,h,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,h,m,y;s>5280?(h=s/5280,m=this.getRoundNum(h),this.updateScale(this.iScale,m+" mi",m/h)):(y=this.getRoundNum(s),this.updateScale(this.iScale,y+" ft",y/s))}},{key:"updateScale",value:function(a,s,h){var m=this.controlOption.maxWidth;a.style.width=Math.round(m*h)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),h=a/s;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:1,s*h}},{key:"addScales",value:function(a,s){var h=this.controlOption,m=h.metric,y=h.imperial;m&&(this.mScale=ao("div",a,s)),y&&(this.iScale=ao("div",a,s))}}]),r}(zv);function Z2(e){var n=V2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function V2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T5=function(e){(0,bn.Z)(r,e);var n=Z2(r);function r(i){var a;return(0,Bt.Z)(this,r),a=n.call(this,i),(0,A.Z)((0,be.Z)(a),"disabled",void 0),(0,A.Z)((0,be.Z)(a),"zoomInButton",void 0),(0,A.Z)((0,be.Z)(a),"zoomOutButton",void 0),vl(["updateDisabled","zoomIn","zoomOut"],(0,be.Z)(a)),a}return(0,Yt.Z)(r,[{key:"getDefault",value:function(){return{position:$h.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=ao("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,h,m,y){var E=ao("a",h,m);return E.innerHTML=a,E.title=s,E.href="javascript:void(0)",E.addEventListener("click",y),E}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";ju(this.zoomInButton,s),ju(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&du(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&du(this.zoomInButton,s)}}]),r}(zv);function Pg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Ig(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Pg(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function j2(e){var n=G2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function G2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Og=function(e){(0,bn.Z)(r,e);var n=j2(r);function r(i){var a;return(0,Bt.Z)(this,r),a=n.call(this),(0,A.Z)((0,be.Z)(a),"markerOption",void 0),(0,A.Z)((0,be.Z)(a),"defaultMarker",void 0),(0,A.Z)((0,be.Z)(a),"popup",void 0),(0,A.Z)((0,be.Z)(a),"mapsService",void 0),(0,A.Z)((0,be.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,be.Z)(a),"lngLat",void 0),(0,A.Z)((0,be.Z)(a),"scene",void 0),(0,A.Z)((0,be.Z)(a),"added",!1),(0,A.Z)((0,be.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=Ig(Ig({},a.getDefault()),i),vl(["update","onMove","onUp","addDragHandler","onMapClick"],(0,be.Z)(a)),a.init(),a}return(0,Yt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Ze.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Nt.IMapService),this.sceneSerive=a.get(Nt.ISceneService);var s=this.markerOption,h=s.element,m=s.draggable;return this.mapsService.getMarkerContainer().appendChild(h),this.registerMarkerEvent(h),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&rc(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var h=this.markerOption.element;return h&&rc(h),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,h=a.anchor;this.updatePosition(),dn(s,"".concat(Ke[h]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,h=a.offsets,m=this.lngLat,y=m.lng,E=m.lat,w=this.mapsService.getBounds(),I=this.mapsService.lngLatToContainer([y,E]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var k=this.mapsService.getContainer(),D=0,W=0;if(k&&(D=k.scrollWidth,W=k.scrollHeight),Math.abs(w[0][0])>180||Math.abs(w[1][0])>180){if(I.x>D){var J=this.mapsService.lngLatToContainer([y-360,E]);I.x=J.x}if(I.x<0){var ie=this.mapsService.lngLatToContainer([y+360,E]);I.x=ie.x}}(I.x>D||I.x<0||I.y>W||I.y<0)&&(s.style.display="none"),s.style.left=I.x+h[0]+"px",s.style.top=I.y-h[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,h=this.markerOption,m=h.color,y=h.anchor;if(!s){this.defaultMarker=!0,s=ao("div"),this.markerOption.element=s;var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","48px"),E.setAttributeNS(null,"width","48px"),E.setAttributeNS(null,"viewBox","0 0 1024 1024");var w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),w.setAttributeNS(null,"fill",m),E.appendChild(w),s.appendChild(E)}du(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(I){var k,D,W=((k=a.markerOption)===null||k===void 0?void 0:k.style)&&((D=a.markerOption)===null||D===void 0?void 0:D.style[I]);s&&(s.style[I]=W)}),s.addEventListener("click",function(I){a.onMapClick(I)}),s.addEventListener("click",this.eventHandle),mt(s,y,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(_u.EventEmitter);function Rg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function kg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Rg(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function H2(e){var n=W2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function W2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M5=function(e){(0,bn.Z)(r,e);var n=H2(r);function r(i){var a,s;return(0,Bt.Z)(this,r),s=n.call(this),(0,A.Z)((0,be.Z)(s),"markers",[]),(0,A.Z)((0,be.Z)(s),"markerLayerOption",void 0),(0,A.Z)((0,be.Z)(s),"clusterIndex",void 0),(0,A.Z)((0,be.Z)(s),"points",[]),(0,A.Z)((0,be.Z)(s),"clusterMarkers",[]),(0,A.Z)((0,be.Z)(s),"mapsService",void 0),(0,A.Z)((0,be.Z)(s),"scene",void 0),(0,A.Z)((0,be.Z)(s),"zoom",void 0),(0,A.Z)((0,be.Z)(s),"bbox",void 0),s.markerLayerOption=an()(s.getDefault(),i),vl(["update"],(0,be.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Yt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Nt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;s&&this.addPoint(a,this.markers.length),this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var h=a.getLnglat(),m=h.lng,y=h.lat,E={geometry:{type:"Point",coordinates:[m,y]},properties:kg(kg({},a.getExtData()),{},{marker_id:s})};this.points.push(E)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,h=a.minZoom,m=h===void 0?0:h,y=a.maxZoom;this.clusterIndex=new(Zc())({radius:s,minZoom:m,maxZoom:y}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var h=this,m=a[0].concat(a[1]),y=this.clusterIndex.getClusters(m,s);this.clusterMarkers.forEach(function(E){E.remove()}),this.clusterMarkers=[],y.forEach(function(E){var w,I=h.markerLayerOption.clusterOption,k=I.field,D=I.method;if(E.properties&&(w=E.properties)!==null&&w!==void 0&&w.cluster_id){var W,J=h.getLeaves((W=E.properties)===null||W===void 0?void 0:W.cluster_id);if(E.properties.clusterData=J,k&&D){var ie=J==null?void 0:J.map(function(kt){var zt=(0,A.Z)({},k,kt.properties[k]);return zt}),Oe=Ln(ie,k),qe=Fn(D,Oe),rt="point_"+D;E.properties[rt]=qe.toFixed(2)}}var pt=h.clusterMarker(E);h.clusterMarkers.push(pt),pt.addTo(h.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,h):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,h=s,m=h.element,y=m===void 0?this.generateElement.bind(this):m,E=new Og({element:y(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return E}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!sc(this.bbox,s))&&(this.bbox=Sn(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(a){var s=ao("div","l7-marker-cluster"),h=ao("div","",s),m=ao("span","",h),y=this.markerLayerOption.clusterOption,E=y.field,w=y.method;a.properties.point_count=a.properties.point_count||1;var I=E&&w?a.properties["point_"+w]||a.properties[E]:a.properties.point_count;return m.textContent=I,s}}]),r}(_u.EventEmitter);function Lg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Dg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Lg(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function X2(e){var n=Y2();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fg=function(e){(0,bn.Z)(r,e);var n=X2(r);function r(i){var a;return(0,Bt.Z)(this,r),a=n.call(this),(0,A.Z)((0,be.Z)(a),"popupOption",void 0),(0,A.Z)((0,be.Z)(a),"mapsService",void 0),(0,A.Z)((0,be.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,be.Z)(a),"lngLat",void 0),(0,A.Z)((0,be.Z)(a),"content",void 0),(0,A.Z)((0,be.Z)(a),"closeButton",void 0),(0,A.Z)((0,be.Z)(a),"timeoutInstance",void 0),(0,A.Z)((0,be.Z)(a),"container",void 0),(0,A.Z)((0,be.Z)(a),"tip",void 0),(0,A.Z)((0,be.Z)(a),"scene",void 0),a.popupOption=Dg(Dg({},a.getdefault()),i),vl(["update","onClickClose","remove"],(0,be.Z)(a)),a}return(0,Yt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Nt.IMapService),this.sceneSerive=a.get(Nt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),h=window.document.createElement("body"),m;for(h.innerHTML=a;m=h.firstChild,!!m;)s.appendChild(m);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&rc(this.content),this.content=ao("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=ao("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,h){var m=window.document.createElement(a);return s!==void 0&&(m.className=s),h&&h.appendChild(m),m}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Ze.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,h=this.popupOption,m=h.className,y=h.maxWidth,E=h.anchor;if(!(!this.mapsService||!s||!this.content)){var w=this.mapsService.getMarkerContainer();if(!this.container&&w){this.container=this.creatDom("div","l7-popup",w),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),m&&m.split(" ").forEach(function(k){return a.container.classList.add(k)});var I=this.popupOption.stopPropagation;I&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(k){a.container.addEventListener(k,function(D){D.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}y&&this.container.style.maxWidth!==y&&(this.container.style.maxWidth=y),this.updatePosition(),dn(this.container,"".concat(Ke[E])),mt(this.container,E,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,h=a.lat,m=this.popupOption.offsets,y=this.mapsService.lngLatToContainer([s,h]);this.container.style.left=y.x+m[0]+"px",this.container.style.top=y.y-m[1]+"px"}}}]),r}(_u.EventEmitter);function q2(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var a=n.head||n.getElementsByTagName("head")[0];if(!a){a=n.createElement("head");var s=n.body||n.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):n.documentElement.appendChild(a)}var h=n.createElement("style");return h.type="text/css",h.styleSheet?h.styleSheet.cssText=e:h.appendChild(n.createTextNode(e)),a.appendChild(h),h}}q2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var K2=V(88307),$2=V.n(K2),Q2=function(){function e(n,r){(0,Bt.Z)(this,e),(0,A.Z)(this,"attribute",void 0),(0,A.Z)(this,"buffer",void 0);var i=r.buffer,a=r.offset,s=r.stride,h=r.normalized,m=r.size,y=r.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:a||0,stride:s||0,normalized:h||!1,divisor:y||0},m&&(this.attribute.size=m)}return(0,Yt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),ch,rv,fh,bc,nv,Qh,iv,Uv,Tf,Pp,wu,Mf,Pf,Zv,J2=(ch={},(0,A.Z)(ch,q.POINTS,"points"),(0,A.Z)(ch,q.LINES,"lines"),(0,A.Z)(ch,q.LINE_LOOP,"line loop"),(0,A.Z)(ch,q.LINE_STRIP,"line strip"),(0,A.Z)(ch,q.TRIANGLES,"triangles"),(0,A.Z)(ch,q.TRIANGLE_FAN,"triangle fan"),(0,A.Z)(ch,q.TRIANGLE_STRIP,"triangle strip"),ch),Bg=(rv={},(0,A.Z)(rv,q.STATIC_DRAW,"static"),(0,A.Z)(rv,q.DYNAMIC_DRAW,"dynamic"),(0,A.Z)(rv,q.STREAM_DRAW,"stream"),rv),B0=(fh={},(0,A.Z)(fh,q.BYTE,"int8"),(0,A.Z)(fh,q.UNSIGNED_INT,"int16"),(0,A.Z)(fh,q.INT,"int32"),(0,A.Z)(fh,q.UNSIGNED_BYTE,"uint8"),(0,A.Z)(fh,q.UNSIGNED_SHORT,"uint16"),(0,A.Z)(fh,q.UNSIGNED_INT,"uint32"),(0,A.Z)(fh,q.FLOAT,"float"),fh),eE=(bc={},(0,A.Z)(bc,q.ALPHA,"alpha"),(0,A.Z)(bc,q.LUMINANCE,"luminance"),(0,A.Z)(bc,q.LUMINANCE_ALPHA,"luminance alpha"),(0,A.Z)(bc,q.RGB,"rgb"),(0,A.Z)(bc,q.RGBA,"rgba"),(0,A.Z)(bc,q.RGBA4,"rgba4"),(0,A.Z)(bc,q.RGB5_A1,"rgb5 a1"),(0,A.Z)(bc,q.RGB565,"rgb565"),(0,A.Z)(bc,q.DEPTH_COMPONENT,"depth"),(0,A.Z)(bc,q.DEPTH_STENCIL,"depth stencil"),bc),tE=(nv={},(0,A.Z)(nv,q.DONT_CARE,"dont care"),(0,A.Z)(nv,q.NICEST,"nice"),(0,A.Z)(nv,q.FASTEST,"fast"),nv),Ng=(Qh={},(0,A.Z)(Qh,q.NEAREST,"nearest"),(0,A.Z)(Qh,q.LINEAR,"linear"),(0,A.Z)(Qh,q.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,A.Z)(Qh,q.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,A.Z)(Qh,q.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,A.Z)(Qh,q.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Qh),zg=(iv={},(0,A.Z)(iv,q.REPEAT,"repeat"),(0,A.Z)(iv,q.CLAMP_TO_EDGE,"clamp"),(0,A.Z)(iv,q.MIRRORED_REPEAT,"mirror"),iv),rE=(Uv={},(0,A.Z)(Uv,q.NONE,"none"),(0,A.Z)(Uv,q.BROWSER_DEFAULT_WEBGL,"browser"),Uv),nE=(Tf={},(0,A.Z)(Tf,q.NEVER,"never"),(0,A.Z)(Tf,q.ALWAYS,"always"),(0,A.Z)(Tf,q.LESS,"less"),(0,A.Z)(Tf,q.LEQUAL,"lequal"),(0,A.Z)(Tf,q.GREATER,"greater"),(0,A.Z)(Tf,q.GEQUAL,"gequal"),(0,A.Z)(Tf,q.EQUAL,"equal"),(0,A.Z)(Tf,q.NOTEQUAL,"notequal"),Tf),Ug=(Pp={},(0,A.Z)(Pp,q.FUNC_ADD,"add"),(0,A.Z)(Pp,q.MIN_EXT,"min"),(0,A.Z)(Pp,q.MAX_EXT,"max"),(0,A.Z)(Pp,q.FUNC_SUBTRACT,"subtract"),(0,A.Z)(Pp,q.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Pp),Vv=(wu={},(0,A.Z)(wu,q.ZERO,"zero"),(0,A.Z)(wu,q.ONE,"one"),(0,A.Z)(wu,q.SRC_COLOR,"src color"),(0,A.Z)(wu,q.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,A.Z)(wu,q.SRC_ALPHA,"src alpha"),(0,A.Z)(wu,q.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,A.Z)(wu,q.DST_COLOR,"dst color"),(0,A.Z)(wu,q.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,A.Z)(wu,q.DST_ALPHA,"dst alpha"),(0,A.Z)(wu,q.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,A.Z)(wu,q.CONSTANT_COLOR,"constant color"),(0,A.Z)(wu,q.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,A.Z)(wu,q.CONSTANT_ALPHA,"constant alpha"),(0,A.Z)(wu,q.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,A.Z)(wu,q.SRC_ALPHA_SATURATE,"src alpha saturate"),wu),iE=(Mf={},(0,A.Z)(Mf,q.NEVER,"never"),(0,A.Z)(Mf,q.ALWAYS,"always"),(0,A.Z)(Mf,q.LESS,"less"),(0,A.Z)(Mf,q.LEQUAL,"lequal"),(0,A.Z)(Mf,q.GREATER,"greater"),(0,A.Z)(Mf,q.GEQUAL,"gequal"),(0,A.Z)(Mf,q.EQUAL,"equal"),(0,A.Z)(Mf,q.NOTEQUAL,"notequal"),Mf),od=(Pf={},(0,A.Z)(Pf,q.ZERO,"zero"),(0,A.Z)(Pf,q.KEEP,"keep"),(0,A.Z)(Pf,q.REPLACE,"replace"),(0,A.Z)(Pf,q.INVERT,"invert"),(0,A.Z)(Pf,q.INCR,"increment"),(0,A.Z)(Pf,q.DECR,"decrement"),(0,A.Z)(Pf,q.INCR_WRAP,"increment wrap"),(0,A.Z)(Pf,q.DECR_WRAP,"decrement wrap"),Pf),aE=(Zv={},(0,A.Z)(Zv,q.FRONT,"front"),(0,A.Z)(Zv,q.BACK,"back"),Zv),oE=function(){function e(n,r){(0,Bt.Z)(this,e),(0,A.Z)(this,"buffer",void 0);var i=r.data,a=r.usage,s=r.type;this.buffer=n.buffer({data:i,usage:Bg[a||q.STATIC_DRAW],type:B0[s||q.UNSIGNED_BYTE]})}return(0,Yt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var i=r.data,a=r.offset;this.buffer.subdata(i,a)}}]),e}(),sE=function(){function e(n,r){(0,Bt.Z)(this,e),(0,A.Z)(this,"elements",void 0);var i=r.data,a=r.usage,s=r.type,h=r.count;this.elements=n.elements({data:i,usage:Bg[a||q.STATIC_DRAW],type:B0[s||q.UNSIGNED_BYTE],count:h})}return(0,Yt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var i=r.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),e}(),uE=function(){function e(n,r){(0,Bt.Z)(this,e),(0,A.Z)(this,"framebuffer",void 0);var i=r.width,a=r.height,s=r.color,h=r.colors,m=r.depth,y=r.stencil,E={width:i,height:a};Array.isArray(h)&&(E.colors=h.map(function(w){return w.get()})),s&&typeof s!="boolean"&&(E.color=s.get()),this.framebuffer=n.framebuffer(E)}return(0,Yt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var i=r.width,a=r.height;this.framebuffer.resize(i,a)}}]),e}(),lE=V(36719),cE=V.n(lE),fE=V(68630),hE=V.n(fE);function Zg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function If(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zg(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var pE=function(){function e(n,r){(0,Bt.Z)(this,e),(0,A.Z)(this,"reGl",void 0),(0,A.Z)(this,"destroyed",!1),(0,A.Z)(this,"drawCommand",void 0),(0,A.Z)(this,"drawPickCommand",void 0),(0,A.Z)(this,"drawParams",void 0),(0,A.Z)(this,"options",void 0),(0,A.Z)(this,"uniforms",{}),this.reGl=n;var i=r.vs,a=r.fs,s=r.attributes,h=r.uniforms,m=r.primitive,y=r.count,E=r.elements,w=r.depth,I=r.blend,k=r.stencil,D=r.cull,W=r.instances,J={};this.options=r,h&&(this.uniforms=this.extractUniforms(h),Object.keys(h).forEach(function(rt){J[rt]=n.prop(rt)}));var ie={};Object.keys(s).forEach(function(rt){ie[rt]=s[rt].get()});var Oe={attributes:ie,frag:a,uniforms:J,vert:i,blend:{},primitive:J2[m===void 0?q.TRIANGLES:m]};W&&(Oe.instances=W),y&&(Oe.count=y),E&&(Oe.elements=E.get()),this.initDepthDrawParams({depth:w},Oe),this.initBlendDrawParams({blend:I},Oe),this.initStencilDrawParams({stencil:k},Oe),this.initCullDrawParams({cull:D},Oe),this.drawCommand=n(Oe);var qe=eo()(Oe);qe.blend=If(If({},qe.blend),{},{enable:!1}),qe.stencil=If(If({},qe.stencil),{},{enable:!1}),this.drawPickCommand=n(qe),this.drawParams=Oe}return(0,Yt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=If(If({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,i){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=If(If({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(h){var m=(0,ut.Z)(a[h]);m==="boolean"||m==="number"||Array.isArray(a[h])||a[h].BYTES_PER_ELEMENT?s[h]=a[h]:s[h]=a[h].get()}),i?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,i){var a=r.depth;a&&(i.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:nE[a.func||q.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,i){var a=r.blend;if(a){var s=a.enable,h=a.func,m=a.equation,y=a.color,E=y===void 0?[0,0,0,0]:y;i.blend={enable:!!s,func:{srcRGB:Vv[h&&h.srcRGB||q.SRC_ALPHA],srcAlpha:Vv[h&&h.srcAlpha||q.SRC_ALPHA],dstRGB:Vv[h&&h.dstRGB||q.ONE_MINUS_SRC_ALPHA],dstAlpha:Vv[h&&h.dstAlpha||q.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Ug[m&&m.rgb||q.FUNC_ADD],alpha:Ug[m&&m.alpha||q.FUNC_ADD]},color:E}}}},{key:"initStencilDrawParams",value:function(r,i){var a=r.stencil;if(a){var s=a.enable,h=a.mask,m=h===void 0?-1:h,y=a.func,E=y===void 0?{cmp:q.ALWAYS,ref:0,mask:-1}:y,w=a.opFront,I=w===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:w,k=a.opBack,D=k===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:k;i.stencil={enable:!!s,mask:m,func:If(If({},E),{},{cmp:iE[E.cmp]}),opFront:{fail:od[I.fail],zfail:od[I.zfail],zpass:od[I.zpass]},opBack:{fail:od[D.fail],zfail:od[D.zfail],zpass:od[D.zpass]}}}}},{key:"initCullDrawParams",value:function(r,i){var a=r.cull;if(a){var s=a.enable,h=a.face,m=h===void 0?q.BACK:h;i.cull={enable:!!s,face:aE[m]}}}},{key:"extractUniforms",value:function(r){var i=this,a={};return Object.keys(r).forEach(function(s){i.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,i,a,s){var h=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||cE()(i)||i===""||"resize"in i){a["".concat(s&&s+".").concat(r)]=i;return}hE()(i)&&Object.keys(i).forEach(function(m){h.extractUniformsRecursively(m,i[m],a,"".concat(s&&s+".").concat(r))}),Array.isArray(i)&&i.forEach(function(m,y){Object.keys(m).forEach(function(E){h.extractUniformsRecursively(E,m[E],a,"".concat(s&&s+".").concat(r,"[").concat(y,"]"))})})}}]),e}(),dE=function(){function e(n,r){(0,Bt.Z)(this,e),(0,A.Z)(this,"texture",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDistroy",!1);var i=r.data,a=r.type,s=a===void 0?q.UNSIGNED_BYTE:a,h=r.width,m=r.height,y=r.flipY,E=y===void 0?!1:y,w=r.format,I=w===void 0?q.RGBA:w,k=r.mipmap,D=k===void 0?!1:k,W=r.wrapS,J=W===void 0?q.CLAMP_TO_EDGE:W,ie=r.wrapT,Oe=ie===void 0?q.CLAMP_TO_EDGE:ie,qe=r.aniso,rt=qe===void 0?0:qe,pt=r.alignment,kt=pt===void 0?1:pt,zt=r.premultiplyAlpha,nr=zt===void 0?!1:zt,dr=r.mag,Zr=dr===void 0?q.NEAREST:dr,un=r.min,wr=un===void 0?q.NEAREST:un,Pn=r.colorSpace,Nn=Pn===void 0?q.BROWSER_DEFAULT_WEBGL:Pn;this.width=h,this.height=m;var pi={width:h,height:m,type:B0[s],format:eE[I],wrapS:zg[J],wrapT:zg[Oe],mag:Ng[Zr],min:Ng[wr],alignment:kt,flipY:E,colorSpace:rE[Nn],premultiplyAlpha:nr,aniso:rt};i&&(pi.data=i),typeof D=="number"?pi.mipmap=tE[D]:typeof D=="boolean"&&(pi.mipmap=D),this.texture=n.texture(pi)}return(0,Yt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var i=r.width,a=r.height;this.texture.resize(i,a),this.width=i,this.height=a}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),e}(),Vg,jg,vE=(Vg=(0,$r.b2)(),Vg(jg=function(){function e(){var n=this;(0,Bt.Z)(this,e),(0,A.Z)(this,"extensionObject",void 0),(0,A.Z)(this,"gl",void 0),(0,A.Z)(this,"$container",void 0),(0,A.Z)(this,"canvas",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDirty",void 0),(0,A.Z)(this,"createModel",function(r){return new pE(n.gl,r)}),(0,A.Z)(this,"createAttribute",function(r){return new Q2(n.gl,r)}),(0,A.Z)(this,"createBuffer",function(r){return new oE(n.gl,r)}),(0,A.Z)(this,"createElements",function(r){return new sE(n.gl,r)}),(0,A.Z)(this,"createTexture2D",function(r){return new dE(n.gl,r)}),(0,A.Z)(this,"createFramebuffer",function(r){return new uE(n.gl,r)}),(0,A.Z)(this,"useFramebuffer",function(r,i){n.gl({framebuffer:r?r.get():null})(i)}),(0,A.Z)(this,"clear",function(r){var i=r.color,a=r.depth,s=r.stencil,h=r.framebuffer,m=h===void 0?null:h,y={color:i,depth:a,stencil:s};y.framebuffer=m===null?m:m.get(),n.gl.clear(y)}),(0,A.Z)(this,"viewport",function(r){var i=r.x,a=r.y,s=r.width,h=r.height;n.gl._gl.viewport(i,a,s,h),n.width=s,n.height=h,n.gl._refresh()}),(0,A.Z)(this,"readPixels",function(r){var i=r.framebuffer,a=r.x,s=r.y,h=r.width,m=r.height,y={x:a,y:s,width:h,height:m};return i&&(y.framebuffer=i.get()),n.gl.read(y)}),(0,A.Z)(this,"getViewportSize",function(){return{width:n.gl._gl.drawingBufferWidth,height:n.gl._gl.drawingBufferHeight}}),(0,A.Z)(this,"getContainer",function(){if(es)return n.canvas;var r;return(r=n.canvas)===null||r===void 0?void 0:r.parentElement}),(0,A.Z)(this,"getCanvas",function(){return n.canvas}),(0,A.Z)(this,"getGLContext",function(){return n.gl._gl}),(0,A.Z)(this,"destroy",function(){n.gl.destroy()})}return(0,Yt.Z)(e,[{key:"init",value:function(){var n=(0,ro.Z)(Hi().mark(function i(a,s){var h=this;return Hi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return this.canvas=a,y.next=3,new Promise(function(E,w){$2()({canvas:h.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(k,D){(k||!D)&&w(k),E(D)}})});case 3:this.gl=y.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return y.stop()}},i,this)}));function r(i,a){return n.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||jg);function Gg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Hg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Gg(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var mE=function(){function e(n){(0,Bt.Z)(this,e),(0,A.Z)(this,"sceneService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"controlService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"markerService",void 0),(0,A.Z)(this,"popupService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"container",void 0);var r=n.id,i=n.map,a=n.canvas,s=n.hasBaseMap,h=g2();this.container=h,i.setContainer(h,r,a,s),h.bind(Nt.IRendererService).to(vE).inSingletonScope(),this.sceneService=h.get(Nt.ISceneService),this.mapService=h.get(Nt.IMapService),this.iconService=h.get(Nt.IIconService),this.fontService=h.get(Nt.IFontService),this.controlService=h.get(Nt.IControlService),this.layerService=h.get(Nt.ILayerService),this.markerService=h.get(Nt.IMarkerService),this.interactionService=h.get(Nt.IInteractionService),this.popupService=h.get(Nt.IPopupService),es?this.sceneService.initMiniScene(n):(this.initComponent(r),this.sceneService.init(n),this.initControl())}return(0,Yt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var i=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(i);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var i=y2(this.container);r.setContainer(i,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,i){this.layerService.remove(r,i)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,i){this.fontService.addIconFont(r,i)}},{key:"addIconFonts",value:function(r){var i=this;r.forEach(function(a){var s=(0,Vn.Z)(a,2),h=s[0],m=s[1];i.fontService.addIconFont(h,m)})}},{key:"addFontFace",value:function(r,i){this.sceneService.addFontFace(r,i)}},{key:"addImage",value:function(r,i){es?this.iconService.addImageMini(r,i,this.sceneService):this.iconService.addImage(r,i)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,i){F0.indexOf(r)===-1?this.mapService.on(r,i):this.sceneService.on(r,i)}},{key:"once",value:function(r,i){F0.indexOf(r)===-1?this.mapService.once(r,i):this.sceneService.once(r,i)}},{key:"off",value:function(r,i){F0.indexOf(r)===-1?this.mapService.off(r,i):this.sceneService.off(r,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,i){return this.mapService.setCenter(r,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,i){this.mapService.panBy(r,i)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,i){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,h=a.animate;this.mapService.fitBounds(r,i||Hg(Hg({},s),{},{animate:h}))}},{key:"setZoomAndCenter",value:function(r,i){this.mapService.setZoomAndCenter(r,i)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,i){this.container.bind(Nt.IPostProcessingPass).to(r).whenTargetNamed(i)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Is(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),i=r.logoVisible,a=r.logoPosition;i&&this.addControl(new N2({position:a}))}}]),e}(),gE=V(13218),Nu=V.n(gE),Wg,Xg,Yg,N0,qg;function yE(e){return e.map(function(n){return typeof n=="string"&&(n=[n,{}]),n})}var _E=(Wg=(0,$r.b2)(),Xg=(0,$r.f3)(Nt.IGlobalConfigService),Wg(Yg=(N0=function(){function e(){(0,Bt.Z)(this,e),qn(this,"configService",qg,this),(0,A.Z)(this,"enabled",void 0)}return(0,Yt.Z)(e,[{key:"apply",value:function(r,i){var a=this,s=i.rendererService,h=i.postProcessingPassFactory,m=i.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var y=r.getLayerConfig(),E=y.enableMultiPassRenderer,w=y.passes,I=w===void 0?[]:w;a.enabled=!!E&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=a.createMultiPassRenderer(r,I,h,m),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,i,a,s){var h=r.multiPassRenderer,m=r.getLayerConfig(),y=m.enablePicking,E=m.enableTAA;return y&&h.add(s("pixelPicking")),h}}]),e}(),qg=ci(N0.prototype,"configService",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0))||Yg),Jh,Kg=(Jh={},(0,A.Z)(Jh,xc.additive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(Jh,xc.none,{enable:!1}),(0,A.Z)(Jh,xc.normal,{enable:!0,func:{srcRGB:q.SRC_ALPHA,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(Jh,xc.subtractive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:q.ZERO,dstAlpha:q.ONE_MINUS_SRC_COLOR},equation:{rgb:q.FUNC_SUBTRACT,alpha:q.FUNC_SUBTRACT}}),(0,A.Z)(Jh,xc.max,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MAX_EXT}}),(0,A.Z)(Jh,xc.min,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MIN_EXT}}),Jh),xE=V(81763),Ca=V.n(xE),bE=V(1469),Ip=V.n(bE),P5=1024;function Ju(e,n,r,i,a){n.updateStyleAttribute(e,r,i,a)}function EE(e,n){e.opacity&&jv("opacity",n,e.opacity),e.strokeWidth&&jv("strokeWidth",n,e.strokeWidth),e.strokeOpacity&&jv("strokeOpacity",n,e.strokeOpacity),e.stroke&&SE("stroke",n,e.stroke),e.offsets&&$g("offsets",n,e.offsets),e.textOffset&&$g("textOffset",n,e.textOffset),e.thetaOffset&&jv("thetaOffset",n,e.thetaOffset)}function jv(e,n,r){On()(r)?Ju(e,n,r,function(i){return i}):Ca()(r)?Ju(e,n,[r],void 0):Ip()(r)&&r.length===2?On()(r[0])&&Un()(r[1])||On()(r[0])&&Ip()(r[1])&&Ca()(r[1][0])&&Ca()(r[1][1])?Ju(e,n,r[0],r[1]):Ju(e,n,[1],void 0):Ju(e,n,[1],void 0)}function $g(e,n,r){On()(r)?Ju(e,n,r,function(i){return i}):Ip()(r)&&r.length===2&&On()(r[0])&&Un()(r[1])?Ju(e,n,r[0],r[1]):Ip()(r)&&r.length===2&&Ca()(r[0])&&Ca()(r[1])?Ju(e,n,r,void 0):Ju(e,n,[0,0],void 0)}function SE(e,n,r){On()(r)?Ju(e,n,r,void 0):Ip()(r)&&r.length===2&&(On()(r[0])&&Un()(r[1])||On()(r[0])&&Ip()(r[1])&&r[1].length>0)?Ju(e,n,r[0],r[1]):Ju(e,n,"#fff",void 0)}var CE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function wE(e,n,r){typeof n=="string"&&typeof r=="string"&&n!==r&&CE.map(function(i){i.includes(n)&&i.includes(r)&&(e.dataState.dataSourceNeedUpdate=!0)})}var AE=["passes"],TE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Qg,z0,Jg;function ME(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=PE(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function PE(e,n){if(!!e){if(typeof e=="string")return ey(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ey(e,n)}}function ey(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function ty(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function zu(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ty(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ty(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function IE(e){var n=OE();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function OE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ry=0,Op=(Qg=D0(Nt.IGlobalConfigService),z0=function(e){(0,bn.Z)(r,e);var n=IE(r);function r(){var i,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Bt.Z)(this,r),i=n.call(this),(0,A.Z)((0,be.Z)(i),"id","".concat(ry++)),(0,A.Z)((0,be.Z)(i),"name","".concat(ry)),(0,A.Z)((0,be.Z)(i),"type",void 0),(0,A.Z)((0,be.Z)(i),"visible",!0),(0,A.Z)((0,be.Z)(i),"zIndex",0),(0,A.Z)((0,be.Z)(i),"minZoom",void 0),(0,A.Z)((0,be.Z)(i),"maxZoom",void 0),(0,A.Z)((0,be.Z)(i),"inited",!1),(0,A.Z)((0,be.Z)(i),"layerModelNeedUpdate",!1),(0,A.Z)((0,be.Z)(i),"pickedFeatureID",null),(0,A.Z)((0,be.Z)(i),"selectedFeatureID",null),(0,A.Z)((0,be.Z)(i),"styleNeedUpdate",!1),(0,A.Z)((0,be.Z)(i),"rendering",void 0),(0,A.Z)((0,be.Z)(i),"clusterZoom",0),(0,A.Z)((0,be.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,A.Z)((0,be.Z)(i),"hooks",{init:new Uc,afterInit:new Uc,beforeRender:new Uc,beforeRenderData:new gh,afterRender:new Mo,beforePickingEncode:new Mo,afterPickingEncode:new Mo,beforeHighlight:new Mo(["pickedColor"]),afterHighlight:new Mo,beforeSelect:new Mo(["pickedColor"]),afterSelect:new Mo,beforeDestroy:new Mo,afterDestroy:new Mo}),(0,A.Z)((0,be.Z)(i),"models",[]),(0,A.Z)((0,be.Z)(i),"multiPassRenderer",void 0),(0,A.Z)((0,be.Z)(i),"plugins",void 0),(0,A.Z)((0,be.Z)(i),"sourceOption",void 0),(0,A.Z)((0,be.Z)(i),"layerModel",void 0),(0,A.Z)((0,be.Z)(i),"sceneContainer",void 0),(0,A.Z)((0,be.Z)(i),"layerChildren",[]),qn((0,be.Z)(i),"configService",Jg,(0,be.Z)(i)),(0,A.Z)((0,be.Z)(i),"shaderModuleService",void 0),(0,A.Z)((0,be.Z)(i),"cameraService",void 0),(0,A.Z)((0,be.Z)(i),"coordinateService",void 0),(0,A.Z)((0,be.Z)(i),"iconService",void 0),(0,A.Z)((0,be.Z)(i),"fontService",void 0),(0,A.Z)((0,be.Z)(i),"pickingService",void 0),(0,A.Z)((0,be.Z)(i),"rendererService",void 0),(0,A.Z)((0,be.Z)(i),"layerService",void 0),(0,A.Z)((0,be.Z)(i),"interactionService",void 0),(0,A.Z)((0,be.Z)(i),"mapService",void 0),(0,A.Z)((0,be.Z)(i),"styleAttributeService",void 0),(0,A.Z)((0,be.Z)(i),"layerSource",void 0),(0,A.Z)((0,be.Z)(i),"postProcessingPassFactory",void 0),(0,A.Z)((0,be.Z)(i),"normalPassFactory",void 0),(0,A.Z)((0,be.Z)(i),"animateOptions",{enable:!1}),(0,A.Z)((0,be.Z)(i),"container",void 0),(0,A.Z)((0,be.Z)(i),"encodedData",void 0),(0,A.Z)((0,be.Z)(i),"configSchema",void 0),(0,A.Z)((0,be.Z)(i),"currentPickId",null),(0,A.Z)((0,be.Z)(i),"rawConfig",void 0),(0,A.Z)((0,be.Z)(i),"needUpdateConfig",void 0),(0,A.Z)((0,be.Z)(i),"pendingStyleAttributes",[]),(0,A.Z)((0,be.Z)(i),"scaleOptions",{}),(0,A.Z)((0,be.Z)(i),"animateStartTime",void 0),(0,A.Z)((0,be.Z)(i),"aniamateStatus",!1),(0,A.Z)((0,be.Z)(i),"bottomColor","rgba(0, 0, 0, 0)"),(0,A.Z)((0,be.Z)(i),"isDestroied",!1),(0,A.Z)((0,be.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var s=i.getLayerConfig(),h=s.autoFit,m=s.fitBoundsOptions;h&&i.fitBounds(m),i.emit("dataUpdate"),i.reRender()}),i.name=a.name||i.id,i.zIndex=a.zIndex||0,i.rawConfig=a,i}return(0,Yt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=zu(zu({},this.needUpdateConfig),a);else{var s=this.container.get(Nt.SceneID);EE(a,this),this.configService.setLayerConfig(s,this.id,zu(zu(zu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Nt.SceneID),h=this.rawConfig.enableMultiPassRenderer,m=h===void 0?!1:h;this.configService.setLayerConfig(s,this.id,{enableMultiPassRenderer:m}),this.iconService=this.container.get(Nt.IIconService),this.fontService=this.container.get(Nt.IFontService),this.rendererService=this.container.get(Nt.IRendererService),this.layerService=this.container.get(Nt.ILayerService),this.interactionService=this.container.get(Nt.IInteractionService),this.pickingService=this.container.get(Nt.IPickingService),this.mapService=this.container.get(Nt.IMapService),this.cameraService=this.container.get(Nt.ICameraService),this.coordinateService=this.container.get(Nt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Nt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Nt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Nt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Nt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Nt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(I){var k=I.attributeName,D=I.attributeField,W=I.attributeValues,J=I.updateOptions;a.styleAttributeService.updateStyleAttribute(k,{scale:zu({field:D},a.splitValuesAndCallbackInAttribute(W,a.getLayerConfig()[k]))},J)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Nt.ILayerPlugin);var y=ME(this.plugins),E;try{for(y.s();!(E=y.n()).done;){var w=E.value;w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(I){y.e(I)}finally{y.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(zu(zu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,h){return this.updateStyleAttribute("color",a,s,h),this}},{key:"texture",value:function(a,s,h){return this.updateStyleAttribute("texture",a,s,h),this}},{key:"rotate",value:function(a,s,h){return this.updateStyleAttribute("rotate",a,s,h),this}},{key:"size",value:function(a,s,h){return this.updateStyleAttribute("size",a,s,h),this}},{key:"filter",value:function(a,s,h){return this.updateStyleAttribute("filter",a,s,h),this}},{key:"shape",value:function(a,s,h){var m,y,E,w=(m=this.styleAttributeService)===null||m===void 0||(y=m.getLayerStyleAttribute("shape"))===null||y===void 0||(E=y.scale)===null||E===void 0?void 0:E.field,I=a;return this.updateStyleAttribute("shape",a,s,h),wE(this,w,I),this}},{key:"label",value:function(a,s,h){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:h}),this}},{key:"animate",value:function(a){var s={};return Nu()(a)?(s.enable=!0,s=zu(zu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var h=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){h.layerSource.setData(a,s)}),this}},{key:"style",value:function(a){var s=this,h=a.passes,m=(0,wl.Z)(a,AE);return h&&yE(h).forEach(function(y){var E=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(y[0]);E&&E.updateOptions(y[1])}),this.rawConfig=zu(zu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(a,s){return Nu()(a)?this.scaleOptions=zu(zu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(a){var s={};return s.enableHighlight=Nu()(a)?!0:a,Nu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var h=this;if(Nu()(a)){var m=a.x,y=m===void 0?0:m,E=a.y,w=E===void 0?0:E;this.updateLayerConfig({highlightColor:Nu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Nu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:y,y:w})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Nu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Nu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ue(a)).then(function(){setTimeout(function(){h.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Nu()(a)?!0:a,Nu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var h=this;if(Nu()(a)){var m=a.x,y=m===void 0?0:m,E=a.y,w=E===void 0?0:E;this.updateLayerConfig({selectColor:Nu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Nu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:y,y:w})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Nu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Nu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ue(a)).then(function(){setTimeout(function(){h.reRender()},1)})}},{key:"setBlend",value:function(a){this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),h=s.visible,m=s.minZoom,y=m===void 0?-Infinity:m,E=s.maxZoom,w=E===void 0?Infinity:E;return!!h&&a>=y&&a<=w}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),h=s.extent,m=h.some(function(y){return Math.abs(y)===Infinity});return m?this:(this.mapService.fitBounds([[h[0],h[1]],[h[2],h[3]]],a),this)}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(s){if(s.ticks){var h=s.ticks().map(function(y){return(0,A.Z)({value:y},a,s(y))});return h}else if(s.invertExtent){var m=s.range().map(function(y){return(0,A.Z)({value:s.invertExtent(y)},a,y)});return m}}else return[]}},{key:"pick",value:function(a){var s=a.x,h=a.y;this.interactionService.triggerHover({x:s,y:h})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,h=a.vertexShader,m=a.fragmentShader,y=a.triangulation,E=a.segmentNumber,w=(0,wl.Z)(a,TE);this.shaderModuleService.registerModule(s,{vs:h,fs:m});var I=this.shaderModuleService.getModule(s),k=I.vs,D=I.fs,W=I.uniforms,J=this.rendererService.createModel,ie=this.styleAttributeService.createAttributesAndIndices(this.encodedData,y,E),Oe=ie.attributes,qe=ie.elements;return J(zu({attributes:Oe,uniforms:W,fs:D,vs:k,elements:qe,blend:Kg[xc.normal]},w))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),h=s.enableHighlight,m=h===void 0?!0:h,y=s.enableSelect,E=y===void 0?!0:y,w=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&E&&(w=!0),a==="mousemove"&&(m||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(w=!0),this.isVisible()&&w}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(h){h.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,h,m){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:zu({field:s},this.splitValuesAndCallbackInAttribute(h,this.getLayerConfig()[s]))},m):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:h,updateOptions:m})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:Un()(a)?void 0:a||s,callback:Un()(a)?a:void 0}}}]),r}(_u.EventEmitter),Jg=ci(z0.prototype,"configService",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z0),RE=V(18446),sd=V.n(RE),ny,U0,iy;function kE(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=LE(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function LE(e,n){if(!!e){if(typeof e=="string")return ay(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ay(e,n)}}function ay(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var hs=(ny=D0(Nt.IGlobalConfigService),U0=function(){function e(n){(0,Bt.Z)(this,e),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"createTexture2D",void 0),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"dataTexture",void 0),(0,A.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,A.Z)(this,"rowCount",void 0),(0,A.Z)(this,"cacheStyleProperties",void 0),(0,A.Z)(this,"cellLength",void 0),(0,A.Z)(this,"cellProperties",void 0),(0,A.Z)(this,"cellTypeLayout",void 0),(0,A.Z)(this,"stylePropertyesExist",void 0),(0,A.Z)(this,"dataTextureTest",void 0),qn(this,"configService",iy,this),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"styleAttributeService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"layerService",void 0),this.layer=n,this.rendererService=n.getContainer().get(Nt.IRendererService),this.shaderModuleService=n.getContainer().get(Nt.IShaderModuleService),this.styleAttributeService=n.getContainer().get(Nt.IStyleAttributeService),this.mapService=n.getContainer().get(Nt.IMapService),this.iconService=n.getContainer().get(Nt.IIconService),this.fontService=n.getContainer().get(Nt.IFontService),this.cameraService=n.getContainer().get(Nt.ICameraService),this.layerService=n.getContainer().get(Nt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:q.NEAREST,min:q.NEAREST,width:1,height:1}))}return(0,Yt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var i=!1;return sd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(i=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),sd()(r.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=r.opacity),sd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),sd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),sd()(r.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=r.stroke),sd()(r.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Ca()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Ca()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Ca()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Ca()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return On()(r)?!!ku(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var i=Ce(r);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Ip()(r)&&r.length===2&&Ca()(r[0])&&Ca()(r[1]))}},{key:"patchMod",value:function(r,i){for(var a=0;a<i;a++)r.push(-1)}},{key:"patchData",value:function(r,i,a){var s=kE(a),h;try{for(s.s();!(h=s.n()).done;){var m=h.value,y=m.attr,E=m.count,w=i[y];w!==void 0?y==="stroke"?r.push.apply(r,(0,_e.Z)(Ce(w))):y==="offsets"?this.isOffsetStatic(w)?r.push(-w[0],w[1]):r.push(0,0):r.push(Ca()(w)?w:1):this.patchMod(r,E)}}catch(I){s.e(I)}finally{s.f()}}},{key:"calDataFrame",value:function(r,i,a){for(var s=i.length,h=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),m=h*this.DATA_TEXTURE_WIDTH,y=[],E=0;E<s;E++){var w=i[E];this.patchData(y,w,a)}for(var I=y.length;I<m;I++)y.push(-1);return{data:y,width:this.DATA_TEXTURE_WIDTH,height:h}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),i=r.blend,a=i===void 0?"normal":i;return Kg[xc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),i=r.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),e}(),iy=ci(U0.prototype,"configService",[ny],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U0),DE=V(9187),Of=V.n(DE),oy=100,I5=36,O5=40;function sy(e){return e/180*Math.acos(-1)}function uy(e){var n=sy(e[0])+Math.PI/2,r=sy(e[1]),i=oy+Math.random()*.4,a=i*Math.cos(r)*Math.cos(n),s=i*Math.cos(r)*Math.sin(n),h=i*Math.sin(r);return[s,h,a]}function R5(e,n){var r=mat4.create(),i=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);n=n||{},e=typeof e!="undefined"?e:1;for(var h=typeof n.segments!="undefined"?n.segments:32,m=2+h,y=2*m,E=[],w=[],I=[],k=[],D=[],W=[],J=0;J<=m;J++){for(var ie=J/m,Oe=ie*Math.PI,qe=0;qe<=y;qe++){var rt=qe/y,pt=rt*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-Oe),mat4.identity(r),mat4.rotateY(r,r,pt),vec3.transformMat4(s,a,i),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),I.push(s.slice()),k.push.apply(k,_toConsumableArray(s.slice())),vec3.normalize(s,s),D.push.apply(D,_toConsumableArray(s.slice())),W.push([rt,1-ie]),k.push(rt,1-ie)}if(J>0)for(var kt=I.length,zt=kt-2*(y+1);zt+y+2<kt;zt++)E.push([zt,zt+1,zt+y+1]),w.push(zt,zt+1,zt+y+1),E.push([zt+y+1,zt+1,zt+y+2]),w.push(zt+y+1,zt+1,zt+y+2)}return{cells:E,positions:I,uvs:W,positionsArr:k,indicesArr:w,normalArr:D}}function js(){var e=new or(2);return or!=Float32Array&&(e[0]=0,e[1]=0),e}function k5(e){var n=new glMatrix.ARRAY_TYPE(2);return n[0]=e[0],n[1]=e[1],n}function Z0(e,n){var r=new or(2);return r[0]=e,r[1]=n,r}function av(e,n){return e[0]=n[0],e[1]=n[1],e}function FE(e,n,r){return e[0]=n,e[1]=r,e}function Ec(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e}function Gv(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e}function L5(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e}function D5(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e}function F5(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e}function B5(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e}function N5(e,n,r){return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e}function z5(e,n,r){return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e}function U5(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e}function Z5(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e}function V5(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e}function j5(e,n){var r=n[0]-e[0],i=n[1]-e[1];return Math.hypot(r,i)}function G5(e,n){var r=n[0]-e[0],i=n[1]-e[1];return r*r+i*i}function H5(e){var n=e[0],r=e[1];return Math.hypot(n,r)}function W5(e){var n=e[0],r=e[1];return n*n+r*r}function BE(e,n){return e[0]=-n[0],e[1]=-n[1],e}function X5(e,n){return e[0]=1/n[0],e[1]=1/n[1],e}function ov(e,n){var r=n[0],i=n[1],a=r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=n[0]*a,e[1]=n[1]*a,e}function Hv(e,n){return e[0]*n[0]+e[1]*n[1]}function Y5(e,n,r){var i=n[0]*r[1]-n[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function NE(e,n,r,i){var a=n[0],s=n[1];return e[0]=a+i*(r[0]-a),e[1]=s+i*(r[1]-s),e}function q5(e,n){n=n||1;var r=glMatrix.RANDOM()*2*Math.PI;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e}function K5(e,n,r){var i=n[0],a=n[1];return e[0]=r[0]*i+r[2]*a,e[1]=r[1]*i+r[3]*a,e}function $5(e,n,r){var i=n[0],a=n[1];return e[0]=r[0]*i+r[2]*a+r[4],e[1]=r[1]*i+r[3]*a+r[5],e}function Q5(e,n,r){var i=n[0],a=n[1];return e[0]=r[0]*i+r[3]*a+r[6],e[1]=r[1]*i+r[4]*a+r[7],e}function J5(e,n,r){var i=n[0],a=n[1];return e[0]=r[0]*i+r[4]*a+r[12],e[1]=r[1]*i+r[5]*a+r[13],e}function eI(e,n,r,i){var a=n[0]-r[0],s=n[1]-r[1],h=Math.sin(i),m=Math.cos(i);return e[0]=a*m-s*h+r[0],e[1]=a*h+s*m+r[1],e}function tI(e,n){var r=e[0],i=e[1],a=n[0],s=n[1],h=Math.sqrt(r*r+i*i)*Math.sqrt(a*a+s*s),m=h&&(r*a+i*s)/h;return Math.acos(Math.min(Math.max(m,-1),1))}function rI(e){return e[0]=0,e[1]=0,e}function nI(e){return"vec2("+e[0]+", "+e[1]+")"}function iI(e,n){return e[0]===n[0]&&e[1]===n[1]}function aI(e,n){var r=e[0],i=e[1],a=n[0],s=n[1];return Math.abs(r-a)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))}var oI=null,V0=Gv,sI=null,uI=null,lI=null,cI=null,fI=null,hI=function(){var e=js();return function(n,r,i,a,s,h){var m,y;for(r||(r=2),i||(i=0),a?y=Math.min(a*r+i,n.length):y=n.length,m=i;m<y;m+=r)e[0]=n[m],e[1]=n[m+1],s(e,e,h),n[m]=e[0],n[m+1]=e[1];return n}}(),Wv=js(),pI=js(),Gs=js(),ep=js(),ud=js();function j0(e,n,r,i,a){Ec(e,r,i),ov(e,e),n=Z0(-e[1],e[0]);var s=Z0(-r[1],r[0]);return[a/Hv(n,s),n]}function tp(e,n){return FE(e,-n[1],n[0])}function ld(e,n,r){return V0(e,n,r),ov(e,e),e}function G0(e,n){return e[0]===n[0]&&e[1]===n[1]}function dI(e){for(var n=new Map,r=0;r<e.length;r++){var i=e[0].toString()+"-"+e[1].toString();n.get(i)?(e.splice(r,1),r++):n.set(i,i)}return e}var ly=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Bt.Z)(this,e),(0,A.Z)(this,"complex",void 0),(0,A.Z)(this,"join",void 0),(0,A.Z)(this,"cap",void 0),(0,A.Z)(this,"miterLimit",void 0),(0,A.Z)(this,"thickness",void 0),(0,A.Z)(this,"normal",void 0),(0,A.Z)(this,"lastFlip",-1),(0,A.Z)(this,"miter",Z0(0,0)),(0,A.Z)(this,"started",!1),(0,A.Z)(this,"dash",!1),(0,A.Z)(this,"totalDistance",0),this.join=n.join||"miter",this.cap=n.cap||"butt",this.miterLimit=n.miterLimit||10,this.thickness=n.thickness||1,this.dash=n.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Yt.Z)(e,[{key:"extrude_gaode2",value:function(r,i){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,h=a.startIndex,m=1;m<s;m++){var y,E,w,I=r[m-1];I.push((y=i[m-1][2])!==null&&y!==void 0?y:0);var k=i[m-1],D=r[m];D.push((E=i[m][2])!==null&&E!==void 0?E:0);var W=i[m],J=m<r.length-1?[].concat((0,_e.Z)(r[m+1]),[(w=i[m+1][2])!==null&&w!==void 0?w:0]):null,ie=m<i.length-1?i[m+1]:null,Oe=this.segment_gaode2(a,h,I,D,J,k,W,ie);h+=Oe}if(this.dash)for(var qe=0;qe<a.positions.length/6;qe++)a.positions[qe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,i){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,h=a.startIndex,m=1;m<s;m++){var y,E,w,I=r[m-1];I.push((y=i[m-1][2])!==null&&y!==void 0?y:0);var k=i[m-1],D=r[m];D.push((E=i[m][2])!==null&&E!==void 0?E:0);var W=i[m],J=m<r.length-1?[].concat((0,_e.Z)(r[m+1]),[(w=i[m+1][2])!==null&&w!==void 0?w:0]):null,ie=m<i.length-1?i[m+1]:null,Oe=this.simpleSegment(a,h,I,D,J,k,W,ie);h+=Oe}if(this.dash)for(var qe=0;qe<a.positions.length/6;qe++)a.positions[qe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,h=1;h<a;h++){var m=r[h-1],y=r[h],E=h<r.length-1?r[h+1]:null,w=this.segment(i,s,m,y,E);s+=w}if(this.dash)for(var I=0;I<i.positions.length/6;I++)i.positions[I*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude",value:function(r){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,h=1;h<a;h++){var m=r[h-1],y=r[h],E=h<r.length-1?r[h+1]:null,w=this.simpleSegment(i,s,m,y,E);s+=w}if(this.dash)for(var I=0;I<i.positions.length/6;I++)i.positions[I*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(r,i,a,s,h,m,y,E){var w=0,I=r.indices,k=r.positions,D=r.normals,W=this.cap==="square",J=this.join==="bevel",ie=fo([y[0],y[1]]),Oe=fo([m[0],m[1]]);ld(Gs,s,a);var qe=0;if(this.dash&&(qe=this.lineSegmentDistance(ie,Oe),this.totalDistance+=qe),this.normal||(this.normal=js(),tp(this.normal,Gs)),!this.started)if(this.started=!0,W){var rt=js(),pt=js();Ec(rt,this.normal,Gs),Ec(pt,this.normal,Gs),D.push(pt[0],pt[1],0),D.push(rt[0],rt[1],0),k.push(a[0],a[1],a[2]|0,this.totalDistance-qe,-this.thickness,a[2]|0),k.push(a[0],a[1],a[2]|0,this.totalDistance-qe,this.thickness,a[2]|0)}else this.extrusions(k,D,a,this.normal,this.thickness,this.totalDistance-qe);if(I.push(i+0,i+1,i+2),h){G0(s,h)&&Ec(h,s,ov(h,Gv(h,s,a))),ld(ep,h,s);var nr=j0(ud,js(),Gs,ep,this.thickness),dr=(0,Vn.Z)(nr,2),Zr=dr[0],un=dr[1],wr=Hv(ud,this.normal)<0?-1:1,Pn=J;if(!Pn&&this.join==="miter"){var Nn=Zr;Nn>this.miterLimit&&(Pn=!0)}Pn?(D.push(this.normal[0],this.normal[1],0),D.push(un[0],un[1],0),k.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*wr,s[2]|0),k.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*wr,s[2]|0),I.push.apply(I,(0,_e.Z)(this.lastFlip!==-wr?[i,i+2,i+3]:[i+2,i+1,i+3])),I.push(i+2,i+3,i+4),tp(Wv,ep),av(this.normal,Wv),D.push(this.normal[0],this.normal[1],0),k.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*wr,s[2]|0),w+=3):(this.extrusions(k,D,s,un,Zr,this.totalDistance),I.push.apply(I,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),wr=-1,av(this.normal,un),w+=2),this.lastFlip=wr}else{if(tp(this.normal,Gs),W){var kt=js(),zt=js();V0(zt,Gs,this.normal),Ec(kt,Gs,this.normal),D.push(zt[0],zt[1],0),D.push(kt[0],kt[1],0),k.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),k.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(k,D,s,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),w+=2}return w}},{key:"simpleSegment",value:function(r,i,a,s,h){var m=0,y=r.indices,E=r.positions,w=r.normals,I=fo([s[0],s[1]]),k=fo([a[0],a[1]]);ld(Gs,I,k);var D=0;if(this.dash&&(D=this.lineSegmentDistance(I,k),this.totalDistance+=D),this.normal||(this.normal=js(),tp(this.normal,Gs)),this.started||(this.started=!0,this.extrusions(E,w,a,this.normal,this.thickness,this.totalDistance-D)),y.push(i+0,i+1,i+2),!h)tp(this.normal,Gs),this.extrusions(E,w,s,this.normal,this.thickness,this.totalDistance),y.push.apply(y,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),m+=2;else{var W=fo([h[0],h[1]]);G0(I,W)&&Ec(W,I,ov(W,Gv(W,I,k))),ld(ep,W,I);var J=j0(ud,js(),Gs,ep,this.thickness),ie=(0,Vn.Z)(J,2),Oe=ie[0],qe=ie[1],rt=Hv(ud,this.normal)<0?-1:1;this.extrusions(E,w,s,qe,Oe,this.totalDistance),y.push.apply(y,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),rt=-1,av(this.normal,qe),m+=2,this.lastFlip=rt}return m}},{key:"segment",value:function(r,i,a,s,h){var m=0,y=r.indices,E=r.positions,w=r.normals,I=this.cap==="square",k=this.join==="bevel",D=fo([s[0],s[1]]),W=fo([a[0],a[1]]);ld(Gs,D,W);var J=0;if(this.dash&&(J=this.lineSegmentDistance(D,W),this.totalDistance+=J),this.normal||(this.normal=js(),tp(this.normal,Gs)),!this.started)if(this.started=!0,I){var ie=js(),Oe=js();Ec(ie,this.normal,Gs),Ec(Oe,this.normal,Gs),w.push(Oe[0],Oe[1],0),w.push(ie[0],ie[1],0),E.push(a[0],a[1],a[2]|0,this.totalDistance-J,-this.thickness,a[2]|0),E.push(a[0],a[1],a[2]|0,this.totalDistance-J,this.thickness,a[2]|0)}else this.extrusions(E,w,a,this.normal,this.thickness,this.totalDistance-J);if(y.push(i+0,i+1,i+2),h){var pt=fo([h[0],h[1]]);G0(D,pt)&&Ec(pt,D,ov(pt,Gv(pt,D,W))),ld(ep,pt,D);var kt=j0(ud,js(),Gs,ep,this.thickness),zt=(0,Vn.Z)(kt,2),nr=zt[0],dr=zt[1],Zr=Hv(ud,this.normal)<0?-1:1,un=k;if(!un&&this.join==="miter"){var wr=nr;wr>this.miterLimit&&(un=!0)}un?(w.push(this.normal[0],this.normal[1],0),w.push(dr[0],dr[1],0),E.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Zr,s[2]|0),E.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Zr,s[2]|0),y.push.apply(y,(0,_e.Z)(this.lastFlip!==-Zr?[i,i+2,i+3]:[i+2,i+1,i+3])),y.push(i+2,i+3,i+4),tp(Wv,ep),av(this.normal,Wv),w.push(this.normal[0],this.normal[1],0),E.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Zr,s[2]|0),m+=3):(this.extrusions(E,w,s,dr,nr,this.totalDistance),y.push.apply(y,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Zr=-1,av(this.normal,dr),m+=2),this.lastFlip=Zr}else{if(tp(this.normal,Gs),I){var qe=js(),rt=js();V0(rt,Gs,this.normal),Ec(qe,Gs,this.normal),w.push(rt[0],rt[1],0),w.push(qe[0],qe[1],0),E.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),E.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(E,w,s,this.normal,this.thickness,this.totalDistance);y.push.apply(y,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),m+=2}return m}},{key:"extrusions",value:function(r,i,a,s,h,m){i.push(s[0],s[1],0),i.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,m,-h,a[2]|0),r.push(a[0],a[1],a[2]|0,m,h,a[2]|0)}},{key:"lineSegmentDistance",value:function(r,i){var a=i[0]-r[0],s=i[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Rp(e){if(Ca()(e[0]))return e;if(Ca()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Ca()(e[0][0][0])){var n=e,r=0,i=0,a=0;return n.forEach(function(s){s.forEach(function(h){r+=h[0],i+=h[1],a++})}),[r/a,i/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function zE(e){for(var n=e[0],r=e[1],i=e[0],a=e[1],s=0,h=0,m=0,y=0;y<e.length;y+=2){var E=e[y],w=e[y+1];E&&w&&(n=Math.max(E,n),r=Math.max(w,r),i=Math.min(E,i),a=Math.min(w,a),s+=E,h+=w,m++)}return{center:[s/m,h/m],radius:Math.sqrt(Math.pow(n-i,2)+Math.pow(r-a,2))/2}}function cd(){var e=new or(3);return or!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function UE(e){var n=new or(3);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function cy(e){var n=e[0],r=e[1],i=e[2];return Math.hypot(n,r,i)}function Sc(e,n,r){var i=new or(3);return i[0]=e,i[1]=n,i[2]=r,i}function ZE(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function VE(e,n,r,i){return e[0]=n,e[1]=r,e[2]=i,e}function jE(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function fy(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e}function hy(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e[2]=n[2]*r[2],e}function py(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e[2]=n[2]/r[2],e}function GE(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e}function HE(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e}function WE(e,n,r){return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e[2]=Math.min(n[2],r[2]),e}function XE(e,n,r){return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e[2]=Math.max(n[2],r[2]),e}function YE(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e}function qE(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e}function KE(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e}function dy(e,n){var r=n[0]-e[0],i=n[1]-e[1],a=n[2]-e[2];return Math.hypot(r,i,a)}function vy(e,n){var r=n[0]-e[0],i=n[1]-e[1],a=n[2]-e[2];return r*r+i*i+a*a}function gy(e){var n=e[0],r=e[1],i=e[2];return n*n+r*r+i*i}function yy(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e}function $E(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e}function fd(e,n){var r=n[0],i=n[1],a=n[2],s=r*r+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=n[0]*s,e[1]=n[1]*s,e[2]=n[2]*s,e}function _y(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function xy(e,n,r){var i=n[0],a=n[1],s=n[2],h=r[0],m=r[1],y=r[2];return e[0]=a*y-s*m,e[1]=s*h-i*y,e[2]=i*m-a*h,e}function QE(e,n,r,i){var a=n[0],s=n[1],h=n[2];return e[0]=a+i*(r[0]-a),e[1]=s+i*(r[1]-s),e[2]=h+i*(r[2]-h),e}function JE(e,n,r,i,a,s){var h=s*s,m=h*(2*s-3)+1,y=h*(s-2)+s,E=h*(s-1),w=h*(3-2*s);return e[0]=n[0]*m+r[0]*y+i[0]*E+a[0]*w,e[1]=n[1]*m+r[1]*y+i[1]*E+a[1]*w,e[2]=n[2]*m+r[2]*y+i[2]*E+a[2]*w,e}function eS(e,n,r,i,a,s){var h=1-s,m=h*h,y=s*s,E=m*h,w=3*s*m,I=3*y*h,k=y*s;return e[0]=n[0]*E+r[0]*w+i[0]*I+a[0]*k,e[1]=n[1]*E+r[1]*w+i[1]*I+a[1]*k,e[2]=n[2]*E+r[2]*w+i[2]*I+a[2]*k,e}function tS(e,n){n=n||1;var r=yr()*2*Math.PI,i=yr()*2-1,a=Math.sqrt(1-i*i)*n;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=i*n,e}function sv(e,n,r){var i=n[0],a=n[1],s=n[2],h=r[3]*i+r[7]*a+r[11]*s+r[15];return h=h||1,e[0]=(r[0]*i+r[4]*a+r[8]*s+r[12])/h,e[1]=(r[1]*i+r[5]*a+r[9]*s+r[13])/h,e[2]=(r[2]*i+r[6]*a+r[10]*s+r[14])/h,e}function rS(e,n,r){var i=n[0],a=n[1],s=n[2];return e[0]=i*r[0]+a*r[3]+s*r[6],e[1]=i*r[1]+a*r[4]+s*r[7],e[2]=i*r[2]+a*r[5]+s*r[8],e}function nS(e,n,r){var i=r[0],a=r[1],s=r[2],h=r[3],m=n[0],y=n[1],E=n[2],w=a*E-s*y,I=s*m-i*E,k=i*y-a*m,D=a*k-s*I,W=s*w-i*k,J=i*I-a*w,ie=h*2;return w*=ie,I*=ie,k*=ie,D*=2,W*=2,J*=2,e[0]=m+w+D,e[1]=y+I+W,e[2]=E+k+J,e}function iS(e,n,r,i){var a=[],s=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],s[0]=a[0],s[1]=a[1]*Math.cos(i)-a[2]*Math.sin(i),s[2]=a[1]*Math.sin(i)+a[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function aS(e,n,r,i){var a=[],s=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],s[0]=a[2]*Math.sin(i)+a[0]*Math.cos(i),s[1]=a[1],s[2]=a[2]*Math.cos(i)-a[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function oS(e,n,r,i){var a=[],s=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],s[0]=a[0]*Math.cos(i)-a[1]*Math.sin(i),s[1]=a[0]*Math.sin(i)+a[1]*Math.cos(i),s[2]=a[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function H0(e,n){var r=e[0],i=e[1],a=e[2],s=n[0],h=n[1],m=n[2],y=Math.sqrt(r*r+i*i+a*a),E=Math.sqrt(s*s+h*h+m*m),w=y*E,I=w&&_y(e,n)/w;return Math.acos(Math.min(Math.max(I,-1),1))}function sS(e){return e[0]=0,e[1]=0,e[2]=0,e}function uS(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function lS(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function cS(e,n){var r=e[0],i=e[1],a=e[2],s=n[0],h=n[1],m=n[2];return Math.abs(r-s)<=$t*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-h)<=$t*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-m)<=$t*Math.max(1,Math.abs(a),Math.abs(m))}var W0=fy,fS=hy,hS=py,pS=dy,dS=vy,vS=cy,mS=gy,gS=function(){var e=cd();return function(n,r,i,a,s,h){var m,y;for(r||(r=3),i||(i=0),a?y=Math.min(a*r+i,n.length):y=n.length,m=i;m<y;m+=r)e[0]=n[m],e[1]=n[m+1],e[2]=n[m+2],s(e,e,h),n[m]=e[0],n[m+1]=e[1],n[m+2]=e[2];return n}}();function yS(e){var n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Of().flatten(e),s=a.vertices,h=a.dimensions,m=[],y=[],E=0;E<s.length/h;E++)h===2?m.push(s[E*2],s[E*2+1],1):m.push(s[E*3],s[E*3+1],1);var w=Of()(a.vertices,a.holes,a.dimensions);y.push.apply(y,(0,_e.Z)(w));for(var I=function(W){var J=a.vertices.slice(W*h,(W+1)*h),ie=a.vertices.slice((W+1)*h,(W+2)*h);ie.length===0&&(ie=a.vertices.slice(0,h));var Oe=m.length/3;m.push(J[0],J[1],1,ie[0],ie[1],1,J[0],J[1],0,ie[0],ie[1],0),y.push.apply(y,(0,_e.Z)([0,2,1,2,3,1].map(function(qe){return qe+Oe})))},k=0;k<i;k++)I(k);return{positions:m,index:y}}function _S(e){var n=Of().flatten(e),r=Of()(n.vertices,n.holes,n.dimensions);return{positions:n.vertices,index:r}}function by(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],i=e[0][e[0].length-1];r[0]===i[0]&&r[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Of().flatten(e),h=s.vertices,m=s.dimensions,y=[],E=[],w=[],I=0;I<h.length/m;I++)m===2?y.push(h[I*2],h[I*2+1],1,-1,-1):y.push(h[I*3],h[I*3+1],1,-1,-1),w.push(0,0,1);var k=Of()(s.vertices,s.holes,s.dimensions);E.push.apply(E,(0,_e.Z)(k));for(var D=function(ie){var Oe=s.vertices.slice(ie*m,(ie+1)*m),qe=s.vertices.slice((ie+1)*m,(ie+2)*m);qe.length===0&&(qe=s.vertices.slice(0,m));var rt=y.length/5;y.push(Oe[0],Oe[1],1,0,0,qe[0],qe[1],1,.1,0,Oe[0],Oe[1],0,0,.8,qe[0],qe[1],0,.1,.8);var pt=xS([qe[0],qe[1],1],[Oe[0],Oe[1],0],[Oe[0],Oe[1],1],n);w.push.apply(w,(0,_e.Z)(pt).concat((0,_e.Z)(pt),(0,_e.Z)(pt),(0,_e.Z)(pt))),E.push.apply(E,(0,_e.Z)([1,2,0,3,2,1].map(function(kt){return kt+rt})))},W=0;W<a;W++)D(W);return{positions:y,index:E,normals:w}}function xS(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=cd(),s=cd(),h=cd();i&&(e=Ks(e),n=Ks(n),r=Ks(r));var m=Sc.apply(pe,(0,_e.Z)(e)),y=Sc.apply(pe,(0,_e.Z)(n)),E=Sc.apply(pe,(0,_e.Z)(r));W0(a,E,y),W0(s,m,y),xy(h,a,s);var w=cd();return fd(w,h),w}var Cc,kp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(kp||(kp={}));var Lp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Lp||(Lp={}));function uv(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,i=[],a=0;a<e;a++)i.push(r*a+n*Math.PI/12);var s=i.map(function(h){var m=Math.sin(h+Math.PI/4),y=Math.cos(h+Math.PI/4);return[m,y,0]});return s}function Ey(){return uv(30)}function Sy(){return uv(4)}function Cy(){return uv(3)}function wy(){return uv(6,1)}function Ay(){return uv(5)}var hd=(Cc={},(0,A.Z)(Cc,Lp.CIRCLE,Ey),(0,A.Z)(Cc,Lp.HEXAGON,wy),(0,A.Z)(Cc,Lp.TRIANGLE,Cy),(0,A.Z)(Cc,Lp.SQUARE,Sy),(0,A.Z)(Cc,Lp.PENTAGON,Ay),(0,A.Z)(Cc,kp.CYLINDER,Ey),(0,A.Z)(Cc,kp.HEXAGONCOLUMN,wy),(0,A.Z)(Cc,kp.TRIANGLECOLUMN,Cy),(0,A.Z)(Cc,kp.SQUARECOLUMN,Sy),(0,A.Z)(Cc,kp.PENTAGONCOLUMN,Ay),Cc),Xv={};function Ty(e){var n=Rp(e.coordinates);return{vertices:[].concat((0,_e.Z)(n),(0,_e.Z)(n),(0,_e.Z)(n),(0,_e.Z)(n)),indices:[0,1,2,2,3,0],size:n.length}}function bS(e){var n=Rp(e.coordinates),r=uy(n);return{vertices:[].concat((0,_e.Z)(r),(0,_e.Z)(r),(0,_e.Z)(r),(0,_e.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function My(e){var n=e.shape,r=TS(n,!1),i=r.positions,a=r.index,s=r.normals;return{vertices:i,indices:a,normals:s,size:5}}function Py(e){var n=Rp(e.coordinates);return{vertices:(0,_e.Z)(n),indices:[0],size:n.length}}function Iy(e){var n=e.coordinates,r=e.originCoordinates,i=e.version,a=new ly({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var s=n;Array.isArray(s[0][0])||(s=[n]);var h=r;Array.isArray(h[0][0])||(h=[r]);for(var m=0;m<s.length;m++){var y=s[m],E=h[m];a.extrude_gaode2(y,E)}}else{var w=n;Array.isArray(w[0][0])||(w=[n]),w.forEach(function(k){a.extrude(k)})}var I=a.complex;return{vertices:I.positions,indices:I.indices,normals:I.normals,size:6}}function ES(e){var n=e.coordinates,r=e.originCoordinates,i=e.version,a=new ly({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var s=n;Array.isArray(s[0][0])||(s=[n]);var h=r;Array.isArray(h[0][0])||(h=[r]);for(var m=0;m<s.length;m++){var y=s[m],E=h[m];a.simpleExtrude_gaode2(y,E)}}else{var w=n;Array.isArray(w[0][0])||(w=[n]),w.forEach(function(k){a.simpleExtrude(k)})}var I=a.complex;return{vertices:I.positions,indices:I.indices,normals:I.normals,size:6}}function SS(e){var n=e.coordinates,r=Of().flatten(n),i=r.vertices,a=r.dimensions,s=r.holes;return{indices:Of()(i,s,a),vertices:i,size:a}}function CS(e){var n=e.coordinates,r=Of().flatten(n),i=r.vertices,a=r.dimensions,s=r.holes;return{indices:Of()(i,s,a),vertices:wS(i),size:a+4}}function wS(e){for(var n=[],r=zE(e),i=r.center,a=r.radius,s=0;s<e.length;s+=2){var h=e[s],m=e[s+1];n.push.apply(n,[h,m,0].concat((0,_e.Z)(i),[a]))}return n}function Oy(e){var n=e.coordinates,r=by(n,!0),i=r.positions,a=r.index,s=r.normals;return{vertices:i,indices:a,normals:s,size:5}}function Ry(e){var n=e.shape,r=PS(n),i=r.positions,a=r.index;return{vertices:i,indices:a,size:3}}function ky(e){var n=e.coordinates,r=[].concat((0,_e.Z)(n[0]),[0,0,1,n[1][0],n[0][1],0,1,1],(0,_e.Z)(n[1]),[0,1,0],(0,_e.Z)(n[0]),[0,0,1],(0,_e.Z)(n[1]),[0,1,0,n[0][0],n[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:r,indices:i,size:5}}function Yv(e,n){for(var r=n||30,i=e.coordinates,a=[],s=[],h=function(E){a.push(E,1,E,i[0][0],i[0][1],i[1][0],i[1][1],E,-1,E,i[0][0],i[0][1],i[1][0],i[1][1]),E!==r-1&&s.push.apply(s,(0,_e.Z)([0,1,2,1,3,2].map(function(w){return E*2+w})))},m=0;m<r;m++)h(m);return{vertices:a,indices:s,size:7}}function AS(e){var n=e.coordinates;n.length===2&&n.push(0);var r=e.size,i=qv(-1,1),a=qv(1,1),s=qv(-1,-1),h=qv(1,-1),m=[].concat((0,_e.Z)(n),(0,_e.Z)(i),(0,_e.Z)(n),(0,_e.Z)(s),(0,_e.Z)(n),(0,_e.Z)(h),(0,_e.Z)(n),(0,_e.Z)(a)),y=[0,1,2,3,0,2];return{vertices:m,indices:y,size:5}}function TS(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Xv&&Xv[e])return Xv[e];var r=hd[e]?hd[e]():hd.cylinder(),i=by([r],n);return Xv[e]=i,i}function vI(e,n){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,h,m,y=vec3.create(),E=vec3.create(),w=vec3.create(),I=0,k=n.length;I<k;I+=3){s=n[I+0]*3,h=n[I+1]*3,m=n[I+2]*3;var D=[e[s],e[s+1]],W=[e[h],e[h+1]],J=[e[m],e[m+1]];i&&(D=lngLatToMeters(D),W=lngLatToMeters(W),J=lngLatToMeters(J));var ie=D,Oe=_slicedToArray(ie,2),qe=Oe[0],rt=Oe[1],pt=vec3.fromValues(qe,rt,e[s+2]),kt=W,zt=_slicedToArray(kt,2),nr=zt[0],dr=zt[1],Zr=vec3.fromValues(nr,dr,e[h+2]),un=J,wr=_slicedToArray(un,2),Pn=wr[0],Nn=wr[1],pi=vec3.fromValues(Pn,Nn,e[m+2]);vec3.sub(y,pi,Zr),vec3.sub(E,pt,Zr),vec3.cross(w,y,E),a[s]+=y[0],a[s+1]+=y[1],a[s+2]+=y[2],a[h]+=y[0],a[h+1]+=y[1],a[h+2]+=y[2],a[m]+=y[0],a[m+1]+=y[1],a[m+2]+=y[2]}return MS(a),a}function MS(e){for(var n=0,r=e.length;n<r;n+=3){var i=vec3.fromValues(e[n],e[n+1],e[n+2]),a=vec3.create();vec3.normalize(a,i),e.set(a,n)}}function mI(e){var n=e[0][0],r=e[0][e[0].length-1];return n[0]===r[0]&&n[1]===r[1]}function PS(e){var n=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=hd[e]?hd[e]():hd.circle(),i=n.indexOf(e)===-1?_S([r]):yS([r]);return i}function qv(e,n){var r=(e+1)/2,i=(n+1)/2;return[r,i]}function gI(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),n=e.positionsArr,r=e.indicesArr,i=e.normalArr;return{vertices:n,indices:r,size:5,normals:i}}function yI(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),n=e.positionsArr,r=e.indicesArr,i=e.normalArr;return{vertices:n,indices:r,size:5,normals:i}}function IS(e){var n=OS();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function OS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RS=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,kS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,LS=function(e){(0,bn.Z)(r,e);var n=IS(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"cityCenter",void 0),(0,A.Z)((0,be.Z)(i),"cityMinSize",void 0),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.baseColor,y=m===void 0?"rgb(16,16,16)":m,E=a.brightColor,w=E===void 0?"rgb(255,176,38)":E,I=a.windowColor,k=I===void 0?"rgb(30,60,89)":I,D=a.time,W=D===void 0?0:D,J=a.sweep,ie=J===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:J;return{u_cityCenter:ie.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*ie.sweepRadius,u_circleSweep:ie.enable?1:0,u_circleSweepColor:Ce(ie.sweepColor).slice(0,3),u_circleSweepSpeed:ie.sweepSpeed,u_opacity:h,u_baseColor:Ce(y),u_brightColor:Ce(w),u_windowColor:Ce(k),u_time:this.layer.getLayerAnimateTime()||W}}},{key:"calCityGeo",value:function(){var a=(0,Vn.Z)(this.layer.getSource().extent,4),s=a[0],h=a[1],m=a[2],y=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(m+s)/2,(y+h)/2]);var E=this.mapService.lngLatToCoord([m,y]),w=this.mapService.lngLatToCoord([s,h]);this.cityMinSize=Math.sqrt(Math.pow(E[0]-w[0],2)+Math.pow(E[1]-w[1],2))/4}else{var I=m-s,k=y-h;this.cityCenter=[(m+s)/2,(y+h)/2],this.cityMinSize=Math.sqrt(Math.pow(I,2)+Math.pow(k,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:kS,fragmentShader:RS,triangulation:Oy})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:$n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(s,h,m,y,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){var E=s.size,w=E===void 0?10:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(s,h,m,y){var E=s.size;return[m[3],m[4]]}}})}}]),r}(hs);function DS(e){var n=FS();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=function(e){(0,bn.Z)(r,e);var n=DS(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"type","PolygonLayer"),i}return(0,Yt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new LS(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Op);function NS(e){var n=zS();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function zS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var US=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,ZS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,VS=function(e){(0,bn.Z)(r,e);var n=NS(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:h||.9,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:US,fragmentShader:ZS,triangulation:Ry,depth:{enable:!1},primitive:q.TRIANGLES,blend:this.getBlend(),stencil:St(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:$n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(s,h){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(hs);function jS(e){var n=GS();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function GS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,WS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,XS=function(e){(0,bn.Z)(r,e);var n=jS(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:h||1,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:HS,fragmentShader:WS,triangulation:My,depth:{enable:!0},blend:this.getBlend(),stencil:St(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){var E=s.size;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:$n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(s,h,m,y,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:$n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(s,h){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(hs);function YS(e,n){for(var r=[],i=[],a=[],s=e+1,h=n+1,m=e/2,y=n/2,E=0;E<h;E++)for(var w=E-y,I=0;I<s;I++){var k=I-m;i.push(k/m,-w/y,0),a.push(I/e),a.push(1-E/n)}for(var D=0;D<n;D++)for(var W=0;W<e;W++){var J=W+s*D,ie=W+s*(D+1),Oe=W+1+s*(D+1),qe=W+1+s*D;r.push(J,ie,qe),r.push(ie,Oe,qe)}return{vertices:i,indices:r,uvs:a}}var Ly,Dy;function Fy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function By(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Fy(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function qS(e){var n=KS();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function KS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $S=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,QS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,JS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,eC=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,tC=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,rC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Ny=(Ly=(0,$r.b2)(),Ly(Dy=function(e){(0,bn.Z)(r,e);var n=qS(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"colorTexture",void 0),(0,A.Z)((0,be.Z)(i),"heatmapFramerBuffer",void 0),(0,A.Z)((0,be.Z)(i),"intensityModel",void 0),(0,A.Z)((0,be.Z)(i),"colorModel",void 0),(0,A.Z)((0,be.Z)(i),"shapeType",void 0),i}return(0,Yt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,h=s.clear,m=s.useFramebuffer;m(this.heatmapFramerBuffer,function(){h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,h=s.createFramebuffer,m=s.clear,y=s.getViewportSize,E=s.createTexture2D,w=s.useFramebuffer,I=this.styleAttributeService.getLayerStyleAttribute("shape"),k=(I==null||(a=I.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=k,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=k==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var D=y(),W=D.width,J=D.height;return this.heatmapFramerBuffer=h({color:E({width:Math.floor(W/4),height:Math.floor(J/4),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.LINEAR,mag:q.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:$n.Attribute,descriptor:{name:"a_Dir",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(s,h,m,y){return[m[3],m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){var E=s.size,w=E===void 0?1:E;return[w]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:tC,fragmentShader:eC,triangulation:AS,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:q.ONE,srcAlpha:1,dstRGB:q.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;this.shaderModuleService.registerModule("heatmapColor",{vs:rC,fs:JS});var E=this.shaderModuleService.getModule("heatmapColor"),w=E.vs,I=E.fs,k=E.uniforms,D=this.rendererService,W=D.createAttribute,J=D.createElements,ie=D.createBuffer,Oe=D.createModel;return Oe({vs:w,fs:I,attributes:{a_Position:W({buffer:ie({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:q.FLOAT}),size:3}),a_Uv:W({buffer:ie({data:[0,1,1,1,0,0,1,0],type:q.FLOAT}),size:2})},uniforms:By({},k),depth:{enable:!1},blend:this.getBlend(),count:6,elements:J({data:[0,2,1,2,3,1],type:q.UNSIGNED_INT,count:6}),stencil:St(h,y)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.intensity,m=h===void 0?10:h,y=a.radius,E=y===void 0?5:y;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:E,u_intensity:m}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=gr();Gr(h,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,_e.Z)(h)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,E=this.rendererService.getViewportSize,w=E(),I=w.width,k=w.height,D=YS(I/4,k/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:QS,fs:$S});var W=this.shaderModuleService.getModule("heatmap3dColor"),J=W.vs,ie=W.fs,Oe=W.uniforms,qe=this.rendererService,rt=qe.createAttribute,pt=qe.createElements,kt=qe.createBuffer,zt=qe.createModel;return zt({vs:J,fs:ie,attributes:{a_Position:rt({buffer:kt({data:D.vertices,type:q.FLOAT}),size:3}),a_Uv:rt({buffer:kt({data:D.uvs,type:q.FLOAT}),size:2})},primitive:q.TRIANGLES,uniforms:By({},Oe),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:q.SRC_ALPHA,srcAlpha:1,dstRGB:q.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:pt({data:D.indices,type:q.UNSIGNED_INT,count:D.indices.length}),stencil:St(h,y)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),h=s.rampColors,m=Ae(h);this.colorTexture=a({data:new Uint8Array(m.data),width:m.width,height:m.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.NEAREST,mag:q.NEAREST,flipY:!1})}}]),r}(hs))||Dy);function nC(e){var n=iC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function iC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,oC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,sC=function(e){(0,bn.Z)(r,e);var n=nC(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:h||.9,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:oC,fragmentShader:aC,triangulation:Ry,depth:{enable:!1},primitive:q.TRIANGLES,blend:this.getBlend(),stencil:St(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:$n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(s,h){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(hs),uC={heatmap:Ny,heatmap3d:Ny,grid:VS,grid3d:XS,hexagon:sC},lC=uC;function cC(e){var n=fC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function fC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hC=function(e){(0,bn.Z)(r,e);var n=cC(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"type","HeatMapLayer"),i}return(0,Yt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new lC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(h){return h.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),h=this.getLayerConfig(),m=h.shape3d,y=this.getSource(),E=y.data.type,w=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return w==="heatmap"||w==="heatmap3d"?"heatmap":E==="hexagon"?(m==null?void 0:m.indexOf(w))===-1?"hexagon":"grid3d":E==="grid"?(m==null?void 0:m.indexOf(w))===-1?"grid":"grid3d":"heatmap"}}]),r}(Op);function pC(e){var n=dC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function dC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vC=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,mC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,gC=function(e){(0,bn.Z)(r,e);var n=pC(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),h=s.mask,m=h===void 0?!1:h,y=s.maskInside,E=y===void 0?!0:y,w=this.layer.getSource(),I=this.rendererService.createTexture2D;if(this.texture=I({height:0,width:0}),es){var k=this.layerService.sceneService.getSceneConfig().canvas,D=k.createImage();D.crossOrigin="anonymous",D.src=w.data.originData,D.onload=function(){a.texture=I({data:D,width:D.width,height:D.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else w.data.images.then(function(W){a.texture=I({data:W[0],width:W[0].width,height:W[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:mC,fragmentShader:vC,triangulation:ky,primitive:q.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:St(m,E)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(s,h,m,y){return[m[3],m[4]]}}})}}]),r}(hs),yC={image:gC},_C=yC;function xC(e){var n=bC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EC=function(e){(0,bn.Z)(r,e);var n=xC(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"type","ImageLayer"),i}return(0,Yt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new _C[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(Op);function SC(e){var n=CC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function CC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,AC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,TC={solid:0,dash:1},MC=function(e){(0,bn.Z)(r,e);var n=SC(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"updateTexture",function(){var m=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=m({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,w=a.lineType,I=w===void 0?"solid":w,k=a.dashArray,D=k===void 0?[10,5]:k,W=a.forward,J=W===void 0?!0:W,ie=a.lineTexture,Oe=ie===void 0?!1:ie,qe=a.iconStep,rt=qe===void 0?100:qe,pt=a.segmentNumber,kt=pt===void 0?30:pt,zt=a.thetaOffset,nr=zt===void 0?.314:zt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:nr})){this.judgeStyleAttributes({opacity:s,thetaOffset:nr});var dr=this.layer.getEncodedData(),Zr=this.calDataFrame(this.cellLength,dr,this.cellProperties),un=Zr.data,wr=Zr.width,Pn=Zr.height;this.rowCount=Pn,this.dataTexture=this.cellLength>0&&un.length>0?this.createTexture2D({flipY:!0,data:un,format:q.LUMINANCE,type:q.FLOAT,width:wr,height:Pn}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}D.length===2&&D.push(0,0);var Nn=0,pi=[0,0,0,0],co=[0,0,0,0];return h&&m&&(pi=Ce(h),co=Ce(m),Nn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Ca()(nr)?nr:0,u_opacity:Ca()(s)?s:1,u_textureBlend:E==="normal"?0:1,segmentNumber:kt,u_line_type:TC[I||"solid"],u_dash_array:D,u_blur:.9,u_lineDir:J?1:-1,u_texture:this.texture,u_line_texture:Oe?1:0,u_icon_step:rt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Nn,u_sourceColor:pi,u_targetColor:co}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,h=s===void 0?30:s,m=a.mask,y=m===void 0?!1:m,E=a.maskInside,w=E===void 0?!0:E;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:AC,fragmentShader:wC,triangulation:Yv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:h,stencil:St(y,w)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(h,m,y,E){var w=h.size,I=w===void 0?1:w;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:$n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(h,m,y,E){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(h,m,y,E){var w=a.iconService.getIconMap(),I=h.texture,k=w[I]||{x:0,y:0},D=k.x,W=k.y;return[D,W]}}})}}]),r}(hs);function PC(e){var n=IC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function IC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,RC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,kC={solid:0,dash:1},LC=function(e){(0,bn.Z)(r,e);var n=PC(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"updateTexture",function(){var m=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=m({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,w=a.lineType,I=w===void 0?"solid":w,k=a.dashArray,D=k===void 0?[10,5]:k,W=a.lineTexture,J=W===void 0?!1:W,ie=a.iconStep,Oe=ie===void 0?100:ie,qe=a.segmentNumber,rt=qe===void 0?30:qe,pt=a.globalArcHeight,kt=pt===void 0?10:pt;D.length===2&&D.push(0,0);var zt=0,nr=[0,0,0,0],dr=[0,0,0,0];if(h&&m&&(nr=Ce(h),dr=Ce(m),zt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Zr=this.layer.getEncodedData(),un=this.calDataFrame(this.cellLength,Zr,this.cellProperties),wr=un.data,Pn=un.width,Nn=un.height;this.rowCount=Nn,this.dataTexture=this.cellLength>0&&wr.length>0?this.createTexture2D({flipY:!0,data:wr,format:q.LUMINANCE,type:q.FLOAT,width:Pn,height:Nn}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:oy,u_global_height:kt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(s)?s:1,u_textureBlend:E==="normal"?0:1,segmentNumber:rt,u_line_type:kC[I]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:zt,u_sourceColor:nr,u_targetColor:dr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,h=s===void 0?30:s,m=a.mask,y=m===void 0?!1:m,E=a.maskInside,w=E===void 0?!0:E;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:RC,fragmentShader:OC,triangulation:Yv,blend:this.getBlend(),segmentNumber:h,stencil:St(y,w)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(h,m,y,E){var w=h.size,I=w===void 0?1:w;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:$n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(h,m,y,E){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(h,m,y,E){var w=a.iconService.getIconMap(),I=h.texture,k=w[I]||{x:0,y:0},D=k.x,W=k.y;return[D,W]}}})}}]),r}(hs);function DC(e){var n=FC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function FC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BC=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,NC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,zC=function(e){(0,bn.Z)(r,e);var n=DC(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.forward,E=y===void 0?!0:y,w=a.segmentNumber,I=w===void 0?30:w,k=a.thetaOffset,D=k===void 0?.314:k,W=0,J=[0,0,0,0],ie=[0,0,0,0];return h&&m&&(J=Ce(h),ie=Ce(m),W=1),{u_thetaOffset:D,u_opacity:Ca()(s)?s:1,segmentNumber:I,u_blur:.9,u_lineDir:E?1:-1,u_linearColor:W,u_sourceColor:J,u_targetColor:ie}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,h=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:NC,fragmentShader:BC,triangulation:Yv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:h})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){var E=s.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:$n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(s,h,m,y){return[m[3],m[4],m[5],m[6]]}}})}}]),r}(hs);function UC(e){var n=ZC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,jC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,GC={solid:0,dash:1},HC=function(e){(0,bn.Z)(r,e);var n=UC(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"updateTexture",function(){var m=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=m({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,w=a.lineType,I=w===void 0?"solid":w,k=a.dashArray,D=k===void 0?[10,5]:k,W=a.lineTexture,J=W===void 0?!1:W,ie=a.iconStep,Oe=ie===void 0?100:ie,qe=a.segmentNumber,rt=qe===void 0?30:qe;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var pt=0,kt=[0,0,0,0],zt=[0,0,0,0];if(h&&m&&(kt=Ce(h),zt=Ce(m),pt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var nr=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,nr,this.cellProperties),Zr=dr.data,un=dr.width,wr=dr.height;this.rowCount=wr,this.dataTexture=this.cellLength>0&&Zr.length>0?this.createTexture2D({flipY:!0,data:Zr,format:q.LUMINANCE,type:q.FLOAT,width:un,height:wr}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(s)?s:1,u_textureBlend:E==="normal"?0:1,segmentNumber:rt,u_line_type:GC[I]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:pt,u_sourceColor:kt,u_targetColor:zt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:jC,fragmentShader:VC,triangulation:Yv,depth:{enable:!1},blend:this.getBlend(),stencil:St(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(h,m,y,E){var w=h.size,I=w===void 0?1:w;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:$n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(h,m,y,E){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(h,m,y,E){var w=a.iconService.getIconMap(),I=h.texture,k=w[I]||{x:0,y:0},D=k.x,W=k.y;return[D,W]}}})}}]),r}(hs);function WC(e){var n=XC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function XC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

    float v = styleMappingMat[3].a;
    float borderWidth = min(0.5, u_borderWidth);
    // \u7ED8\u5236 border
    if(borderWidth > 0.01) {
      float borderOuterWidth = borderWidth/2.0;

      if(v >= 1.0 - borderWidth || v <= borderWidth) {
        if(v > borderWidth) {
          float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
          gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
        } else if(v <= borderWidth) {
          float linear = smoothstep(0.0, 1.0, v/borderWidth);
          gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
        }
      }

      if(v < borderOuterWidth) {
        gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
      } else if(v > 1.0 - borderOuterWidth) {
        gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
      }
    }

    gl_FragColor = filterColor(gl_FragColor);
}
`,qC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,KC={solid:0,dash:1},zy=function(e){(0,bn.Z)(r,e);var n=WC(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"updateTexture",function(){var m=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=m({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,w=a.lineType,I=w===void 0?"solid":w,k=a.dashArray,D=k===void 0?[10,5,0,0]:k,W=a.lineTexture,J=W===void 0?!1:W,ie=a.iconStep,Oe=ie===void 0?100:ie,qe=a.vertexHeightScale,rt=qe===void 0?20:qe,pt=a.borderWidth,kt=pt===void 0?0:pt,zt=a.borderColor,nr=zt===void 0?"#ccc":zt;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var dr=0,Zr=[0,0,0,0],un=[0,0,0,0];if(h&&m&&(Zr=Ce(h),un=Ce(m),dr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var wr=this.layer.getEncodedData(),Pn=this.calDataFrame(this.cellLength,wr,this.cellProperties),Nn=Pn.data,pi=Pn.width,co=Pn.height;this.rowCount=co,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:q.LUMINANCE,type:q.FLOAT,width:pi,height:co}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(s)?s:1,u_textureBlend:E==="normal"?0:1,u_line_type:KC[I],u_dash_array:D,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:kt,u_borderColor:Ce(nr),u_linearColor:dr,u_sourceColor:Zr,u_targetColor:un,u_vertexScale:rt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"line",vertexShader:qC,fragmentShader:YC,triangulation:Iy,primitive:q.TRIANGLES,blend:this.getBlend(),depth:{enable:!1},stencil:St(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:$n.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(h,m,y,E){return[y[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:$n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(h,m,y,E){return[y[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(h,m,y,E){var w=h.size,I=w===void 0?1:w;return Array.isArray(I)?[I[0],I[1]]:[I,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:$n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(h,m,y,E,w){return w}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:$n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(h,m,y,E){return[y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(h,m,y,E){var w=a.iconService.getIconMap(),I=h.texture,k=w[I]||{x:0,y:0},D=k.x,W=k.y;return[D,W]}}})}}]),r}(hs);function $C(e){var n=QC();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function QC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JC=`
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,ew=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,tw=function(e){(0,bn.Z)(r,e);var n=$C(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.vertexHeightScale,E=y===void 0?20:y,w=0,I=[0,0,0,0],k=[0,0,0,0];if(h&&m&&(I=Ce(h),k=Ce(m),w=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var D=this.layer.getEncodedData(),W=this.calDataFrame(this.cellLength,D,this.cellProperties),J=W.data,ie=W.width,Oe=W.height;this.rowCount=Oe,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:q.LUMINANCE,type:q.FLOAT,width:ie,height:Oe}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(s)?s:1,u_linearColor:w,u_sourceColor:I,u_targetColor:k,u_vertexScale:E}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"simpleline",vertexShader:ew,fragmentShader:JC,triangulation:ES,primitive:q.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:St(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:$n.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){return[m[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:$n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(s,h,m,y){var E=s.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:$n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(s,h,m,y,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:$n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){return[m[4]]}}})}}]),r}(hs);function rw(e){var n=nw();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iw=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,aw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,ow=function(e){(0,bn.Z)(r,e);var n=rw(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"updateTexture",function(){var m=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=m({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,w=a.heightfixed,I=w===void 0?!1:w,k=a.lineTexture,D=k===void 0?!1:k,W=a.iconStep,J=W===void 0?100:W,ie=a.iconStepCount,Oe=ie===void 0?1:ie;this.rendererService.getDirty()&&this.texture.bind();var qe=0,rt=[0,0,0,0],pt=[0,0,0,0];if(h&&m&&(rt=Ce(h),pt=Ce(m),qe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var kt=this.layer.getEncodedData(),zt=this.calDataFrame(this.cellLength,kt,this.cellProperties),nr=zt.data,dr=zt.width,Zr=zt.height;this.rowCount=Zr,this.dataTexture=this.cellLength>0&&nr.length>0?this.createTexture2D({flipY:!0,data:nr,format:q.LUMINANCE,type:q.FLOAT,width:dr,height:Zr}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_heightfixed:Number(I),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(s)?s:1,u_textureBlend:E==="normal"?0:1,u_texture:this.texture,u_line_texture:D?1:0,u_iconStepCount:Oe,u_icon_step:J,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:qe,u_sourceColor:rt,u_targetColor:pt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:aw,fragmentShader:iw,triangulation:Iy,primitive:q.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.layer.getLayerConfig(),h=s.lineType,m=h===void 0?"solid":h;this.styleAttributeService.registerStyleAttribute({name:"distance",type:$n.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(E,w,I,k){return[I[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:$n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(E,w,I,k){return[I[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(E,w,I,k){var D=E.size,W=D===void 0?1:D;return Array.isArray(W)?[W[0],W[1]]:[W,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:$n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(E,w,I,k,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:$n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(E,w,I,k){return[I[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(E,w,I,k){var D=a.iconService.getIconMap(),W=E.texture,J=D[W]||{x:0,y:0},ie=J.x,Oe=J.y;return[ie,Oe]}}})}}]),r}(hs),sw={arc:MC,arcmini:zC,arc3d:LC,greatcircle:HC,wall:ow,line:zy,simple:tw},uw=sw;function lw(e){var n=cw();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fw=function(e){(0,bn.Z)(r,e);var n=lw(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"type","LineLayer"),i}return(0,Yt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new uw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),h=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return h||"line"}}]),r}(Op);function hw(e){var n=pw();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dw=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  gl_FragColor = filterColor(gl_FragColor);
}
`,vw=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  v_lightWeight = lightWeight;
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Uy=function(e){(0,bn.Z)(r,e);var n=hw(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"raiseCount",0),(0,A.Z)((0,be.Z)(i),"raiserepeat",0),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,h=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,m=a.opacity,y=m===void 0?1:m,E=a.sourceColor,w=a.targetColor,I=a.opacityLinear,k=I===void 0?{enable:!1,dir:"up"}:I,D=a.lightEnable,W=D===void 0?!0:D;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var J=this.layer.getEncodedData(),ie=this.calDataFrame(this.cellLength,J,this.cellProperties),Oe=ie.data,qe=ie.width,rt=ie.height;this.rowCount=rt,this.dataTexture=this.cellLength>0&&Oe.length>0?this.createTexture2D({flipY:!0,data:Oe,format:q.LUMINANCE,type:q.FLOAT,width:qe,height:rt}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}var pt=0,kt=[0,0,0,0],zt=[0,0,0,0];if(E&&w&&(kt=Ce(E),zt=Ce(w),pt=1),this.raiseCount<1&&this.raiserepeat>0&&h.enable){var nr=h.speed,dr=nr===void 0?.01:nr,Zr=h.repeat,un=Zr===void 0?!1:Zr;this.raiseCount+=dr,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_r:h.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(y)?y:1,u_linearColor:pt,u_sourceColor:kt,u_targetColor:zt,u_opacitylinear:Number(k.enable),u_opacitylinear_dir:k.dir==="up"?1:0,u_lightEnable:Number(W)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,h=s===void 0?!0:s,m=a.animateOption.repeat,y=m===void 0?1:m;return this.raiserepeat=y,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:vw,fragmentShader:dw,triangulation:My,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?q.FRONT:q.BACK},depth:{enable:h}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(h,m,y,E){var w=h.size;if(w){var I=[];return Array.isArray(w)&&(I=w.length===2?[w[0],w[0],w[1]]:w),Array.isArray(w)||(I=[w,w,w]),I}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:$n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(h,m,y,E,w){return w}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:$n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(h,m){var y=Rp(h.coordinates);return a?uy([y[0],y[1]]):[y[0],y[1],0]}}})}}]),r}(hs),Dp;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(Dp||(Dp={}));function mw(e){var n=gw();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yw=`#define Animate 0.0

uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    
    // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
    if(u_additive > 0.0) {
      gl_FragColor *= intensity;
    } else {
      gl_FragColor = vec4(gl_FragColor.xyz, intensity);
    }
  
    // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6\uFF08a == 0 \u65F6\u65E0\u6CD5\u62FE\u53D6\uFF09
    if(d < 0.7) {
      gl_FragColor.a = max(gl_FragColor.a, 0.001);
    }

    if(u_additive > 0.0) {
      gl_FragColor = filterColorAnimate(gl_FragColor);
    } else {
      gl_FragColor = filterColor(gl_FragColor);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
    
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }
}
`,_w=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
  }
  
  

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Zy=function(e){(0,bn.Z)(r,e);var n=mw(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"meter2coord",1),(0,A.Z)((0,be.Z)(i),"isMeter",!1),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.strokeOpacity,y=m===void 0?1:m,E=a.strokeWidth,w=E===void 0?0:E,I=a.stroke,k=I===void 0?"rgba(0,0,0,0)":I,D=a.offsets,W=D===void 0?[0,0]:D,J=a.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h,strokeOpacity:y,strokeWidth:w,stroke:k,offsets:W})){this.judgeStyleAttributes({opacity:h,strokeOpacity:y,strokeWidth:w,stroke:k,offsets:W});var ie=this.layer.getEncodedData(),Oe=this.calDataFrame(this.cellLength,ie,this.cellProperties),qe=Oe.data,rt=Oe.width,pt=Oe.height;this.rowCount=pt,this.dataTexture=this.cellLength>0&&qe.length>0?this.createTexture2D({flipY:!0,data:qe,format:q.LUMINANCE,type:q.FLOAT,width:rt,height:pt}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:J==="additive"?1:0,u_globel:this.mapService.version===Dp.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(h)?h:1,u_stroke_opacity:Ca()(y)?y:1,u_stroke_width:Ca()(w)?w:0,u_stroke_color:this.getStrokeColor(k),u_offsets:this.isOffsetStatic(W)?W:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ty)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,h=s===void 0?"l7size":s,m=this.mapService.version;return h==="meter"&&m!==Dp.L7MAP&&m!==Dp.GLOBEL&&m!==Dp.MAPBOX&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Vn.Z)(this.layer.getSource().extent,4),s=a[0],h=a[1],m=a[2],y=a[3],E=[(s+m)/2,(h+y)/2],w=this.mapService.meterToCoord(E,[s,h]),I=this.mapService.meterToCoord(E,[m===s?m+.1:m,y===h?h+.1:y]);this.meter2coord=(w+I)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,E=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:_w,fragmentShader:yw,triangulation:E?bS:Ty,depth:{enable:E},blend:this.getBlend(),stencil:St(h,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:$n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(m,y,E,w){var I;if(s){var k=(0,Vn.Z)(E,3),D=k[0],W=k[1],J=k[2],ie=Sc(0,0,1),Oe=Sc(D,0,J),qe=D>=0?H0(ie,Oe):Math.PI*2-H0(ie,Oe),rt=Math.PI*2-Math.asin(W/100),pt=gr();Xr(pt,pt,qe),Ur(pt,pt,rt);var kt=Sc(1,1,0);sv(kt,kt,pt),fd(kt,kt);var zt=Sc(-1,1,0);sv(zt,zt,pt),fd(zt,zt);var nr=Sc(-1,-1,0);sv(nr,nr,pt),fd(nr,nr);var dr=Sc(1,-1,0);sv(dr,dr,pt),fd(dr,dr),I=[].concat((0,_e.Z)(kt),(0,_e.Z)(zt),(0,_e.Z)(nr),(0,_e.Z)(dr))}else I=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Zr=w%4*3;return[I[Zr],I[Zr+1],I[Zr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(m,y,E,w){var I=m.size,k=I===void 0?5:I;return Array.isArray(k)?[k[0]*a.meter2coord]:[k*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:$n.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(m,y,E,w){var I=m.shape,k=I===void 0?2:I,D=a.layer.getLayerConfig().shape2d,W=D.indexOf(k);return[W]}}})}}]),r}(hs);function xw(e){var n=bw();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function bw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ew=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Sw=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Cw=function(e){(0,bn.Z)(r,e);var n=xw(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:Sw,fragmentShader:Ew,triangulation:Py,primitive:q.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(h,m,y,E){var w=h.size;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(h,m,y,E){var w=a.fontService.mapping,I=h.shape,k=a.fontService.getGlyph(I),D=w[k],W=D.x,J=D.y;return[W,J]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:q.LINEAR,min:q.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),h=s.fontWeight,m=h===void 0?"normal":h,y=s.fontFamily,E=y===void 0?"sans-serif":y,w=this.layer.getEncodedData(),I=[];w.forEach(function(k){var D=k.shape,W=D===void 0?"":D;W=W.toString();var J=a.fontService.getGlyph(W);I.indexOf(J)===-1&&I.push(J)}),this.fontService.setFontOptions({characterSet:I,fontWeight:m,fontFamily:E,fontSize:48})}}]),r}(hs);function ww(e){var n=Aw();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tw=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Mw=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Vy=function(e){(0,bn.Z)(r,e);var n=ww(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"updateTexture",function(){var m=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),i.layer.renderLayers();return}i.texture=m({data:i.iconService.getCanvas(),mag:q.LINEAR,min:q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128,mipmap:!0})}),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.offsets,m=h===void 0?[0,0]:h;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:m})){this.judgeStyleAttributes({opacity:s,offsets:m});var y=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,y,this.cellProperties),w=E.data,I=E.width,k=E.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:q.LUMINANCE,type:q.FLOAT,width:I,height:k}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Ca()(s)?s:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Mw,fragmentShader:Tw,triangulation:Py,primitive:q.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:St(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(h,m,y,E){var w=h.size,I=w===void 0?5:w;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(h,m,y,E){var w=a.iconService.getIconMap(),I=h.shape,k=w[I]||{x:0,y:0},D=k.x,W=k.y;return[D,W]}}})}}]),r}(hs);function Pw(e){var n=Iw();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ow=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Rw=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function kw(e){var n=e.coordinates;return{vertices:(0,_e.Z)(n),indices:[0],size:n.length}}var jy=function(e){(0,bn.Z)(r,e);var n=Pw(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.offsets,y=m===void 0?[0,0]:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h,offsets:y})){this.judgeStyleAttributes({opacity:h,offsets:y});var E=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,E,this.cellProperties),I=w.data,k=w.width,D=w.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:q.LUMINANCE,type:q.FLOAT,width:k,height:D}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(h)?h:1,u_offsets:this.isOffsetStatic(y)?y:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:Rw,fragmentShader:Ow,triangulation:kw,depth:{enable:!1},primitive:q.POINTS,blend:this.getBlend(),stencil:St(h,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){var E=s.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0]]:[w]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:xc.additive}}}]),r}(hs);function Lw(e){var n=Dw();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Dw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fw=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,Bw=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Nw(e){var n=e.coordinates;return{vertices:(0,_e.Z)(n),indices:[0],size:n.length}}var zw=function(e){(0,bn.Z)(r,e);var n=Lw(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.offsets,y=m===void 0?[0,0]:m,E=a.blend,w=a.strokeOpacity,I=w===void 0?1:w,k=a.strokeWidth,D=k===void 0?0:k,W=a.stroke,J=W===void 0?"#fff":W;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h,offsets:y})){this.judgeStyleAttributes({opacity:h,offsets:y});var ie=this.layer.getEncodedData(),Oe=this.calDataFrame(this.cellLength,ie,this.cellProperties),qe=Oe.data,rt=Oe.width,pt=Oe.height;this.rowCount=pt,this.dataTexture=this.cellLength>0&&qe.length>0?this.createTexture2D({flipY:!0,data:qe,format:q.LUMINANCE,type:q.FLOAT,width:rt,height:pt}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_additive:E==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(h)?h:1,u_offsets:this.isOffsetStatic(y)?y:[0,0],u_stroke_opacity:Ca()(I)?I:1,u_stroke_width:Ca()(D)?D:0,u_stroke_color:this.getStrokeColor(J)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:Bw,fragmentShader:Fw,triangulation:Nw,depth:{enable:!1},primitive:q.POINTS,blend:this.getBlend(),stencil:St(h,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){var E=s.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0]]:[w]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:xc.additive}}}]),r}(hs);function Uw(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Zw(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function Zw(e,n){if(!!e){if(typeof e=="string")return Gy(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gy(e,n)}}function Gy(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Vw=function(){function e(n,r,i){(0,Bt.Z)(this,e),(0,A.Z)(this,"boxCells",[]),(0,A.Z)(this,"xCellCount",void 0),(0,A.Z)(this,"yCellCount",void 0),(0,A.Z)(this,"boxKeys",void 0),(0,A.Z)(this,"bboxes",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"xScale",void 0),(0,A.Z)(this,"yScale",void 0),(0,A.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(n/i),this.yCellCount=Math.ceil(r/i);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=n,this.height=r,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Yt.Z)(e,[{key:"insert",value:function(r,i,a,s,h){this.forEachCell(i,a,s,h,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(h)}},{key:"query",value:function(r,i,a,s,h){return this.queryHitTest(r,i,a,s,!1,h)}},{key:"hitTest",value:function(r,i,a,s,h){return this.queryHitTest(r,i,a,s,!0,h)}},{key:"insertBoxCell",value:function(r,i,a,s,h,m){this.boxCells[h].push(m)}},{key:"queryHitTest",value:function(r,i,a,s,h,m){if(a<0||r>this.width||s<0||i>this.height)return h?!1:[];var y=[];if(r<=0&&i<=0&&this.width<=a&&this.height<=s){if(h)return!0;for(var E=0;E<this.boxKeys.length;E++)y.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return m?y.filter(m):y}var w={hitTest:h,seenUids:{box:{},circle:{}}};return this.forEachCell(r,i,a,s,this.queryCell,y,w,m),h?y.length>0:y}},{key:"queryCell",value:function(r,i,a,s,h,m,y,E){var w=y.seenUids,I=this.boxCells[h];if(I!==null){var k=this.bboxes,D=Uw(I),W;try{for(D.s();!(W=D.n()).done;){var J=W.value;if(!w.box[J]){w.box[J]=!0;var ie=J*4;if(r<=k[ie+2]&&i<=k[ie+3]&&a>=k[ie+0]&&s>=k[ie+1]&&(!E||E(this.boxKeys[J]))){if(y.hitTest)return m.push(!0),!0;m.push({key:this.boxKeys[J],x1:k[ie],y1:k[ie+1],x2:k[ie+2],y2:k[ie+3]})}}}}catch(Oe){D.e(Oe)}finally{D.f()}}return!1}},{key:"forEachCell",value:function(r,i,a,s,h,m,y,E){for(var w=this.convertToXCellCoord(r),I=this.convertToYCellCoord(i),k=this.convertToXCellCoord(a),D=this.convertToYCellCoord(s),W=w;W<=k;W++)for(var J=I;J<=D;J++){var ie=this.xCellCount*J+W;if(h.call(this,r,i,a,s,ie,m,y,E))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),jw=Vw,Gw=function(){function e(n,r){(0,Bt.Z)(this,e),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"grid",void 0),(0,A.Z)(this,"viewportPadding",100),(0,A.Z)(this,"screenRightBoundary",void 0),(0,A.Z)(this,"screenBottomBoundary",void 0),(0,A.Z)(this,"gridRightBoundary",void 0),(0,A.Z)(this,"gridBottomBoundary",void 0),this.width=n,this.height=r,this.viewportPadding=Math.max(n,r),this.grid=new jw(n+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=n+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=n+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Yt.Z)(e,[{key:"placeCollisionBox",value:function(r){var i=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,h=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,a,s,h)||this.grid.hitTest(i,a,s,h)?{box:[]}:{box:[i,a,s,h]}}},{key:"insertCollisionBox",value:function(r,i){var a={featureIndex:i};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,i,a){var s=bu(i,a,0,1),h=cu(),m=_r.apply(ce,(0,_e.Z)(r));return P(h,s,m),{x:(h[0]/h[3]+1)/2*this.width+this.viewportPadding,y:(-h[1]/h[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,i,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&i<this.gridBottomBoundary}}]),e}();function Hy(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Hw(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function Hw(e,n){if(!!e){if(typeof e=="string")return Wy(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wy(e,n)}}function Wy(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function Xy(e){var n=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0;break;default:n=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:n,verticalAlign:r}}function Yy(e,n,r,i,a){if(!!a){var s=e[i],h=s.glyph;if(h)for(var m=n[h].advance*s.scale,y=(e[i].x+m)*a,E=r;E<=i;E++)e[E].x-=y}}function qy(e,n,r,i,a,s,h){var m=(n-r)*a,y=(-i*h+.5)*s,E=Hy(e),w;try{for(E.s();!(w=E.n()).done;){var I=w.value;I.x+=m,I.y+=y}}catch(k){E.e(k)}finally{E.f()}}function Ww(e,n,r,i,a,s,h){var m=-8,y=0,E=m,w=0,I=e.positionedGlyphs,k=s==="right"?1:s==="left"?0:.5,D=I.length;r.forEach(function(qe){if(qe.split("").forEach(function(pt){var kt=n[pt],zt=0;kt&&(I.push({glyph:pt,x:y,y:E+zt,vertical:!1,scale:1,metrics:kt}),y+=kt.advance+h)}),I.length!==D){var rt=y-h;w=Math.max(rt,w),Yy(I,n,D,I.length-1,k)}y=0,E-=i+5});var W=Xy(a),J=W.horizontalAlign,ie=W.verticalAlign;qy(I,k,J,ie,w,i,r.length);var Oe=E-m;e.top+=-ie*Oe,e.bottom=e.top-Oe,e.left+=-J*w,e.right=e.left+w}function Xw(e,n,r,i,a,s,h){var m=-8,y=0,E=m,w=0,I=e.positionedGlyphs,k=s==="right"?1:s==="left"?0:.5,D=I.length;r.forEach(function(qe){var rt=n[qe],pt=0;if(rt&&(I.push({glyph:qe,x:y,y:E+pt,vertical:!1,scale:1,metrics:rt}),y+=rt.advance+h),I.length!==D){var kt=y-h;w=Math.max(kt,w),Yy(I,n,D,I.length-1,k)}y=0,E-=i+5});var W=Xy(a),J=W.horizontalAlign,ie=W.verticalAlign;qy(I,k,J,ie,w,i,r.length);var Oe=E-m;e.top+=-ie*Oe,e.bottom=e.top-Oe,e.left+=-J*w,e.right=e.left+w}function Yw(e,n,r,i,a,s){var h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],m=arguments.length>7?arguments[7]:void 0,y=e.split(`
`),E=[],w={positionedGlyphs:E,top:h[1],bottom:h[1],left:h[0],right:h[0],lineCount:y.length,text:e};return m?Xw(w,n,y,r,i,a,s):Ww(w,n,y,r,i,a,s),E.length?w:!1}function qw(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,a=i===void 0?[]:i,s=[],h=Hy(a),m;try{for(h.s();!(m=h.n()).done;){var y=m.value,E=y.metrics,w=4,I=E.advance*y.scale/2,k=r?[y.x+I,y.y]:[0,0],D=r?[0,0]:[y.x+I+n[0],y.y+n[1]],W=(0-w)*y.scale-I+D[0],J=(0-w)*y.scale+D[1],ie=W+E.width*y.scale,Oe=J+E.height*y.scale,qe={x:W,y:J},rt={x:ie,y:J},pt={x:W,y:Oe},kt={x:ie,y:Oe};s.push({tl:qe,tr:rt,bl:pt,br:kt,tex:E,glyphOffset:k})}}catch(zt){h.e(zt)}finally{h.f()}return s}function Kw(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=$w(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){h=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function $w(e,n){if(!!e){if(typeof e=="string")return Ky(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ky(e,n)}}function Ky(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function Qw(e){var n=Jw();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function Jw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $y=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Qy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Jy(e){var n=this,r=e.id,i=[],a=[];if(!n.glyphInfoMap||!n.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=n.glyphInfoMap[r].centroid,h=s.length===2?[s[0],s[1],0]:s;return n.glyphInfoMap[r].glyphQuads.forEach(function(m,y){i.push.apply(i,(0,_e.Z)(h).concat([m.tex.x,m.tex.y+m.tex.height,m.tl.x,m.tl.y],(0,_e.Z)(h),[m.tex.x+m.tex.width,m.tex.y+m.tex.height,m.tr.x,m.tr.y],(0,_e.Z)(h),[m.tex.x+m.tex.width,m.tex.y,m.br.x,m.br.y],(0,_e.Z)(h),[m.tex.x,m.tex.y,m.bl.x,m.bl.y])),a.push(0+y*4,1+y*4,2+y*4,2+y*4,3+y*4,0+y*4)}),{vertices:i,indices:a,size:7}}var e_=function(e){(0,bn.Z)(r,e);var n=Qw(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"glyphInfo",void 0),(0,A.Z)((0,be.Z)(i),"glyphInfoMap",{}),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"currentZoom",-1),(0,A.Z)((0,be.Z)(i),"extent",void 0),(0,A.Z)((0,be.Z)(i),"textureHeight",0),(0,A.Z)((0,be.Z)(i),"textCount",0),(0,A.Z)((0,be.Z)(i),"preTextStyle",{}),(0,A.Z)((0,be.Z)(i),"buildModels",function(){var m=i.layer.getLayerConfig(),y=m.mask,E=y===void 0?!1:y,w=m.maskInside,I=w===void 0?!0:w;return i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel(),[i.layer.buildLayerModel({moduleName:"pointText",vertexShader:Qy,fragmentShader:$y,triangulation:Jy.bind((0,be.Z)(i)),depth:{enable:!1},blend:i.getBlend(),stencil:St(E,I)})]}),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.stroke,y=m===void 0?"#fff":m,E=a.strokeWidth,w=E===void 0?0:E,I=a.textAnchor,k=I===void 0?"center":I,D=a.textAllowOverlap,W=D===void 0?!1:D,J=a.halo,ie=J===void 0?.5:J,Oe=a.gamma,qe=Oe===void 0?2:Oe,rt=this.fontService,pt=rt.canvas,kt=rt.mapping;if(Object.keys(kt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(kt).length),this.preTextStyle={textAnchor:k,textAllowOverlap:W},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h,strokeWidth:w,stroke:y})){this.judgeStyleAttributes({opacity:h,strokeWidth:w,stroke:y});var zt=this.layer.getEncodedData(),nr=this.calDataFrame(this.cellLength,zt,this.cellProperties),dr=nr.data,Zr=nr.width,un=nr.height;this.rowCount=un,this.dataTexture=this.cellLength>0&&dr.length>0?this.createTexture2D({flipY:!0,data:dr,format:q.LUMINANCE,type:q.FLOAT,width:Zr,height:un}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(h)?h:1,u_stroke_width:Ca()(w)?w:0,u_stroke_color:this.getStrokeColor(y),u_sdf_map:this.texture,u_halo_blur:ie,u_gamma_scale:qe,u_sdf_map_size:[pt.width,pt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,h=s===void 0?"center":s,m=a.textAllowOverlap,y=m===void 0?!0:m;return this.preTextStyle={textAnchor:h,textAllowOverlap:y},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,h=s===void 0?!1:s,m=this.mapService.getZoom(),y=this.mapService.getBounds(),E=sc(this.extent,y);return!h&&(Math.abs(this.currentZoom-m)>1||!E)||h!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:$n.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){var E=s.rotate,w=E===void 0?0:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:$n.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(s,h,m,y){return[m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){var E=s.size,w=E===void 0?12:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:$n.Attribute,descriptor:{name:"a_tex",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(s,h,m,y){return[m[3],m[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return Sn(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,h=s===void 0?"400":s,m=a.fontFamily,y=m===void 0?"sans-serif":m,E=this.layer.getEncodedData(),w=[];E.forEach(function(I){var k=I.shape,D=k===void 0?"":k;D=D.toString();var W=Kw(D),J;try{for(W.s();!(J=W.n()).done;){var ie=J.value;w.indexOf(ie)===-1&&w.push(ie)}}catch(Oe){W.e(Oe)}finally{W.f()}}),this.fontService.setFontOptions({characterSet:w,fontWeight:h,fontFamily:y,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,h=s===void 0?"400":s,m=a.fontFamily,y=m===void 0?"sans-serif":m,E=this.layer.getEncodedData(),w=[];E.forEach(function(I){var k=I.shape,D=k===void 0?"":k;D="".concat(D),w.indexOf(D)===-1&&w.push(D)}),this.fontService.setFontOptions({characterSet:w,fontWeight:h,fontFamily:y,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,h=this.fontService.mapping,m=this.layer.getLayerConfig(),y=m.spacing,E=y===void 0?2:y,w=m.textAnchor,I=w===void 0?"center":w,k=this.layer.getEncodedData();this.glyphInfo=k.map(function(D){var W=D.shape,J=W===void 0?"":W,ie=D.id,Oe=D.size,qe=Oe===void 0?1:Oe,rt=D.textOffset,pt=rt===void 0?[0,0]:rt,kt=Yw(J.toString(),h,qe,I,"left",E,pt,a),zt=qw(kt,pt,!1);return D.shaping=kt,D.glyphQuads=zt,D.centroid=Rp(D.coordinates),D.originCentroid=D.version==="GAODE2.x"?Rp(D.originCoordinates):D.originCentroid=D.centroid,s.glyphInfoMap[ie]={shaping:kt,glyphQuads:zt,centroid:Rp(D.coordinates)},D})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),h=s.padding,m=h===void 0?[4,4]:h,y=s.textAllowOverlap,E=y===void 0?!1:y;if(!E){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var w=this.rendererService.getViewportSize(),I=w.width,k=w.height,D=new Gw(I,k),W=this.glyphInfo.filter(function(J){var ie=J.shaping,Oe=J.id,qe=Oe===void 0?0:Oe,rt=J.version==="GAODE2.x"?J.originCentroid:J.centroid,pt=J.size,kt=pt/24,zt=a.mapService.lngLatToContainer(rt),nr=D.placeCollisionBox({x1:ie.left*kt-m[0],x2:ie.right*kt+m[0],y1:ie.top*kt-m[1],y2:ie.bottom*kt+m[1],anchorPointX:zt.x,anchorPointY:zt.y}),dr=nr.box;return dr&&dr.length?(D.insertCollisionBox(dr,qe),!0):!1});W.forEach(function(J){a.glyphInfoMap[J.id]=J})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,h=s===void 0?!1:s;h?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(h)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:q.LINEAR,min:q.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Qy,fragmentShader:$y,triangulation:Jy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:St(h,y)})]}}]),r}(hs),eA={fill:Zy,image:Vy,normal:jy,simplePoint:zw,extrude:Uy,text:e_,icon:Cw},tA=eA;function rA(e){var n=nA();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function nA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iA=function(e){(0,bn.Z)(r,e);var n=rA(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"type","PointLayer"),i}return(0,Yt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new tA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={normal:{blend:"additive"},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),h=s.shape2d,m=s.shape3d,y=this.iconService.getIconMap(),E=a.find(function(I){return I.hasOwnProperty("shape")});if(E){var w=E.shape;return w==="dot"?"normal":w==="simple"?"simplePoint":(h==null?void 0:h.indexOf(w))!==-1?"fill":(m==null?void 0:m.indexOf(w))!==-1?"extrude":y.hasOwnProperty(w)?"image":this.fontService.getGlyph(w)!==""?"icon":"text"}else return"normal"}}]),r}(Op);function aA(e){var n=oA();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function oA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,uA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,lA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,cA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,fA=function(e){(0,bn.Z)(r,e);var n=aA(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h})){this.judgeStyleAttributes({opacity:h});var m=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,m,this.cellProperties),E=y.data,w=y.width,I=y.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:q.LUMINANCE,type:q.FLOAT,width:w,height:I}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(h)?h:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,h=s===void 0?!1:s,m=a.mask,y=m===void 0?!1:m,E=a.maskInside,w=E===void 0?!0:E;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:h?lA:cA,fragmentShader:h?uA:sA,triangulation:Oy,stencil:St(y,w)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:$n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(s,h,m,y,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:$n.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(s,h,m,y){var E=s.size,w=E===void 0?10:E;return Array.isArray(w)?[w[0]]:[w]}}})}}]),r}(hs);function hA(e){var n=pA();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function pA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,vA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,mA=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,gA=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,yA=function(e){(0,bn.Z)(r,e);var n=hA(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.opacityLinear,y=m===void 0?{enable:!1,dir:"in"}:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h})){this.judgeStyleAttributes({opacity:h});var E=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,E,this.cellProperties),I=w.data,k=w.width,D=w.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:q.LUMINANCE,type:q.FLOAT,width:k,height:D}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ca()(h)?h:1,u_opacitylinear:Number(y.enable),u_dir:y.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,h=s===void 0?{enable:!1,dir:"in"}:s,m=a.mask,y=m===void 0?!1:m,E=a.maskInside,w=E===void 0?!0:E;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:h.enable?mA:gA,fragmentShader:h.enable?vA:dA,triangulation:h.enable?CS:SS,blend:this.getBlend(),depth:{enable:!1},stencil:St(y,w)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,h=s===void 0?{enable:!1,dir:"in"}:s;h.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:$n.Attribute,descriptor:{name:"a_linear",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(y,E,w,I,k){return[w[3],w[4],w[5]]}}})}}]),r}(hs),_A={fill:yA,line:zy,extrude:fA,text:e_,point_fill:Zy,point_image:Vy,point_normal:jy,point_extrude:Uy},xA=_A;function bA(e){var n=EA();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function EA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t_=function(e){(0,bn.Z)(r,e);var n=bA(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"type","PolygonLayer"),i}return(0,Yt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new xA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),h=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return h==="fill"?"fill":h==="extrude"?"extrude":h==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),h=s.shape2d,m=s.shape3d,y=this.iconService.getIconMap(),E=a.find(function(I){return I.hasOwnProperty("shape")});if(E){var w=E.shape;return w==="dot"?"point_normal":(h==null?void 0:h.indexOf(w))!==-1?"point_fill":(m==null?void 0:m.indexOf(w))!==-1?"point_extrude":y.hasOwnProperty(w)?"point_image":"text"}else return"fill"}}]),r}(Op);function SA(e){var n=CA();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function CA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,AA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,r_=function(e){(0,bn.Z)(r,e);var n=SA(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"texture",void 0),(0,A.Z)((0,be.Z)(i),"colorTexture",void 0),i}return(0,Yt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.clampLow,y=m===void 0?!0:m,E=a.clampHigh,w=E===void 0?!0:E,I=a.noDataValue,k=I===void 0?-9999999:I,D=a.domain,W=D===void 0?[0,1]:D;return this.updateColorTexure(),{u_opacity:h||1,u_texture:this.texture,u_domain:W,u_clampLow:y,u_clampHigh:typeof w!="undefined"?w:y,u_noDataValue:k,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,E=this.layer.getSource(),w=this.rendererService.createTexture2D,I=E.data.dataArray[0];this.texture=w({data:I.data,width:I.width,height:I.height,format:q.LUMINANCE,type:q.FLOAT});var k=this.layer.getLayerConfig(),D=k.rampColors,W=Ae(D);return this.colorTexture=w({data:W.data,width:W.width,height:W.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:AA,fragmentShader:wA,triangulation:ky,primitive:q.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:St(h,y)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:$n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(s,h,m,y){return[m[3],m[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),h=s.rampColors,m=Ae(h);this.colorTexture=a({data:m.data,width:m.width,height:m.height,flipY:!1})}}]),r}(hs),TA={raster:r_,raster3d:r_},MA=TA;function PA(e){var n=IA();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function IA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OA=function(e){(0,bn.Z)(r,e);var n=PA(r);function r(){var i;(0,Bt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return i=n.call.apply(n,[this].concat(s)),(0,A.Z)((0,be.Z)(i),"type","RasterLayer"),i}return(0,Yt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new MA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Op),n_,i_,a_,o_,s_,lv,u_,l_,c_;function f_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function RA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?f_(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var kA=(n_=(0,$r.b2)(),i_=(0,$r.f3)(Nt.IGlobalConfigService),a_=(0,$r.f3)(Nt.IMapService),o_=(0,$r.f3)(Nt.IFontService),n_(s_=(lv=function(){function e(){(0,Bt.Z)(this,e),qn(this,"configService",u_,this),qn(this,"mapService",l_,this),qn(this,"fontService",c_,this)}return(0,Yt.Z)(e,[{key:"apply",value:function(r,i){var a=this,s=i.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var h=r.getBottomColor(),m=s.getLayerStyleAttributes()||[],y=s.getLayerStyleAttribute("filter"),E=r.getSource().data.dataArray,w=m.filter(function(k){return k.needRemapping}),I=E;y!=null&&y.needRemapping&&y!==null&&y!==void 0&&y.scale&&(I=E.filter(function(k){return a.applyAttributeMapping(y,k,h)[0]})),w.length&&(y!=null&&y.needRemapping?(r.setEncodedData(a.mapping(m,I,void 0,h)),y.needRemapping=!1):r.setEncodedData(a.mapping(w,I,r.getEncodedData(),h)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,i){var a=this,s=i.styleAttributeService,h=r.getBottomColor(),m=s.getLayerStyleAttributes()||[],y=s.getLayerStyleAttribute("filter"),E=r.getSource().data.dataArray,w=E;y!=null&&y.scale&&(w=E.filter(function(I){return a.applyAttributeMapping(y,I,h)[0]})),r.setEncodedData(this.mapping(m,w,void 0,h))}},{key:"mapping",value:function(r,i,a,s){var h=this,m=i.map(function(y,E){var w=a?a[E]:{},I=RA({id:y._id,coordinates:y.coordinates},w);return r.filter(function(k){return k.scale!==void 0}).forEach(function(k){var D=h.applyAttributeMapping(k,y,s);k.needRemapping=!1,k.name==="color"&&(D=D.map(function(W){return Ce(W)})),I[k.name]=Array.isArray(D)&&D.length===1?D[0]:D,k.name==="shape"&&(I.shape=h.fontService.getIconFontKey(I[k.name]))}),I});return m.length>0&&this.mapService.version==="GAODE2.x"&&(typeof m[0].coordinates[0]=="number"?m.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=eo()(y.coordinates),y.coordinates=h.mapService.lngLatToCoord(y.coordinates)}):m.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=eo()(y.coordinates),y.coordinates=h.mapService.lngLatToCoords(y.coordinates)})),m}},{key:"applyAttributeMapping",value:function(r,i,a){var s;if(!r.scale)return[];var h=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],m=[];h.forEach(function(E){var w,I=E.field;(i.hasOwnProperty(I)||((w=r.scale)===null||w===void 0?void 0:w.type)==="variable")&&m.push(i[I])});var y=r.mapping?r.mapping(m):[];return r.name==="color"&&!fe(y[0])?[a]:y}}]),e}(),u_=ci(lv.prototype,"configService",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l_=ci(lv.prototype,"mapService",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c_=ci(lv.prototype,"fontService",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lv))||s_),h_,p_,LA=(h_=(0,$r.b2)(),h_(p_=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"mapService",void 0)}return(0,Yt.Z)(e,[{key:"apply",value:function(r){var i=this;this.mapService=r.getContainer().get(Nt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Hc,options:jp},h=s.data,m=s.options;r.setSource(new Ah(h,m))}i.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=i.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var i=r.getSource(),a=i.cluster,s=i.clusterOptions,h=s.zoom,m=h===void 0?0:h,y=s.maxZoom,E=y===void 0?16:y,w=this.mapService.getZoom()-1,I=r.dataState.dataSourceNeedUpdate;return a&&(I||Math.abs(r.clusterZoom-w)>=1)?(m!==Math.floor(w)&&i.updateClusterData(Math.floor(w)),r.clusterZoom=w,!0):!1}}]),e}())||p_);function X0(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function d_(e){return e.length===1&&(e=DA(e)),{left:function(n,r,i,a){for(i==null&&(i=0),a==null&&(a=n.length);i<a;){var s=i+a>>>1;e(n[s],r)<0?i=s+1:a=s}return i},right:function(n,r,i,a){for(i==null&&(i=0),a==null&&(a=n.length);i<a;){var s=i+a>>>1;e(n[s],r)>0?a=s:i=s+1}return i}}}function DA(e){return function(n,r){return X0(e(n),r)}}var v_=d_(X0),FA=v_.right,_I=v_.left,Kv=FA;function BA(e,n){var r=e.length,i=-1,a,s,h;if(n==null){for(;++i<r;)if((a=e[i])!=null&&a>=a)for(s=h=a;++i<r;)(a=e[i])!=null&&(s>a&&(s=a),h<a&&(h=a))}else for(;++i<r;)if((a=n(e[i],i,e))!=null&&a>=a)for(s=h=a;++i<r;)(a=n(e[i],i,e))!=null&&(s>a&&(s=a),h<a&&(h=a));return[s,h]}var m_=Array.prototype,xI=m_.slice,bI=m_.map,Y0=Math.sqrt(50),q0=Math.sqrt(10),K0=Math.sqrt(2);function g_(e,n,r){var i,a=-1,s,h,m;if(n=+n,e=+e,r=+r,e===n&&r>0)return[e];if((i=n<e)&&(s=e,e=n,n=s),(m=$v(e,n,r))===0||!isFinite(m))return[];if(m>0)for(e=Math.ceil(e/m),n=Math.floor(n/m),h=new Array(s=Math.ceil(n-e+1));++a<s;)h[a]=(e+a)*m;else for(e=Math.floor(e*m),n=Math.ceil(n*m),h=new Array(s=Math.ceil(e-n+1));++a<s;)h[a]=(e-a)/m;return i&&h.reverse(),h}function $v(e,n,r){var i=(n-e)/Math.max(0,r),a=Math.floor(Math.log(i)/Math.LN10),s=i/Math.pow(10,a);return a>=0?(s>=Y0?10:s>=q0?5:s>=K0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=Y0?10:s>=q0?5:s>=K0?2:1)}function $0(e,n,r){var i=Math.abs(n-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=i/a;return s>=Y0?a*=10:s>=q0?a*=5:s>=K0&&(a*=2),n<e?-a:a}function EI(){var e=identity,n=extent,r=sturges;function i(a){var s,h=a.length,m,y=new Array(h);for(s=0;s<h;++s)y[s]=e(a[s],s,a);var E=n(y),w=E[0],I=E[1],k=r(y,w,I);Array.isArray(k)||(k=tickStep(w,I,k),k=range(Math.ceil(w/k)*k,I,k));for(var D=k.length;k[0]<=w;)k.shift(),--D;for(;k[D-1]>I;)k.pop(),--D;var W=new Array(D+1),J;for(s=0;s<=D;++s)J=W[s]=[],J.x0=s>0?k[s-1]:w,J.x1=s<D?k[s]:I;for(s=0;s<h;++s)m=y[s],w<=m&&m<=I&&W[bisect(k,m,0,D)].push(a[s]);return W}return i.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),i):e},i.domain=function(a){return arguments.length?(n=typeof a=="function"?a:constant([a[0],a[1]]),i):n},i.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),i):r},i}function SI(e,n,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-n)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function NA(e){return e===null?NaN:+e}function zA(e,n,r){if(r==null&&(r=NA),!!(i=e.length)){if((n=+n)<=0||i<2)return+r(e[0],0,e);if(n>=1)return+r(e[i-1],i-1,e);var i,a=(i-1)*n,s=Math.floor(a),h=+r(e[s],s,e),m=+r(e[s+1],s+1,e);return h+(m-h)*(a-s)}}var wc="$";function Qv(){}Qv.prototype=y_.prototype={constructor:Qv,has:function(e){return wc+e in this},get:function(e){return this[wc+e]},set:function(e,n){return this[wc+e]=n,this},remove:function(e){var n=wc+e;return n in this&&delete this[n]},clear:function(){for(var e in this)e[0]===wc&&delete this[e]},keys:function(){var e=[];for(var n in this)n[0]===wc&&e.push(n.slice(1));return e},values:function(){var e=[];for(var n in this)n[0]===wc&&e.push(this[n]);return e},entries:function(){var e=[];for(var n in this)n[0]===wc&&e.push({key:n.slice(1),value:this[n]});return e},size:function(){var e=0;for(var n in this)n[0]===wc&&++e;return e},empty:function(){for(var e in this)if(e[0]===wc)return!1;return!0},each:function(e){for(var n in this)n[0]===wc&&e(this[n],n.slice(1),this)}};function y_(e,n){var r=new Qv;if(e instanceof Qv)e.each(function(m,y){r.set(y,m)});else if(Array.isArray(e)){var i=-1,a=e.length,s;if(n==null)for(;++i<a;)r.set(i,e[i]);else for(;++i<a;)r.set(n(s=e[i],i,e),s)}else if(e)for(var h in e)r.set(h,e[h]);return r}var Q0=y_;function CI(){var e=[],n=[],r,i,a;function s(m,y,E,w){if(y>=e.length)return r!=null&&m.sort(r),i!=null?i(m):m;for(var I=-1,k=m.length,D=e[y++],W,J,ie=map(),Oe,qe=E();++I<k;)(Oe=ie.get(W=D(J=m[I])+""))?Oe.push(J):ie.set(W,[J]);return ie.each(function(rt,pt){w(qe,pt,s(rt,y,E,w))}),qe}function h(m,y){if(++y>e.length)return m;var E,w=n[y-1];return i!=null&&y>=e.length?E=m.entries():(E=[],m.each(function(I,k){E.push({key:k,values:h(I,y)})})),w!=null?E.sort(function(I,k){return w(I.key,k.key)}):E}return a={object:function(m){return s(m,0,UA,ZA)},map:function(m){return s(m,0,__,x_)},entries:function(m){return h(s(m,0,__,x_),0)},key:function(m){return e.push(m),a},sortKeys:function(m){return n[e.length-1]=m,a},sortValues:function(m){return r=m,a},rollup:function(m){return i=m,a}}}function UA(){return{}}function ZA(e,n,r){e[n]=r}function __(){return map()}function x_(e,n,r){e.set(n,r)}function Jv(){}var Fp=Q0.prototype;Jv.prototype=VA.prototype={constructor:Jv,has:Fp.has,add:function(e){return e+="",this[wc+e]=e,this},remove:Fp.remove,clear:Fp.clear,values:Fp.keys,size:Fp.size,empty:Fp.empty,each:Fp.each};function VA(e,n){var r=new Jv;if(e instanceof Jv)e.each(function(s){r.add(s)});else if(e){var i=-1,a=e.length;if(n==null)for(;++i<a;)r.add(e[i]);else for(;++i<a;)r.add(n(e[i],i,e))}return r}var wI=null,b_=Array.prototype,e0=b_.map,Bp=b_.slice;function rp(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function AI(e,n){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(n).domain(e);break}return this}var E_={name:"implicit"};function t0(){var e=Q0(),n=[],r=[],i=E_;function a(s){var h=s+"",m=e.get(h);if(!m){if(i!==E_)return i;e.set(h,m=n.push(s))}return r[(m-1)%r.length]}return a.domain=function(s){if(!arguments.length)return n.slice();n=[],e=Q0();for(var h=-1,m=s.length,y,E;++h<m;)e.has(E=(y=s[h])+"")||e.set(E,n.push(y));return a},a.range=function(s){return arguments.length?(r=Bp.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(i=s,a):i},a.copy=function(){return t0(n,r).unknown(i)},rp.apply(a,arguments),a}function S_(){var e=ordinal().unknown(void 0),n=e.domain,r=e.range,i=[0,1],a,s,h=!1,m=0,y=0,E=.5;delete e.unknown;function w(){var I=n().length,k=i[1]<i[0],D=i[k-0],W=i[1-k];a=(W-D)/Math.max(1,I-m+y*2),h&&(a=Math.floor(a)),D+=(W-D-a*(I-m))*E,s=a*(1-m),h&&(D=Math.round(D),s=Math.round(s));var J=sequence(I).map(function(ie){return D+a*ie});return r(k?J.reverse():J)}return e.domain=function(I){return arguments.length?(n(I),w()):n()},e.range=function(I){return arguments.length?(i=[+I[0],+I[1]],w()):i.slice()},e.rangeRound=function(I){return i=[+I[0],+I[1]],h=!0,w()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(I){return arguments.length?(h=!!I,w()):h},e.padding=function(I){return arguments.length?(m=Math.min(1,y=+I),w()):m},e.paddingInner=function(I){return arguments.length?(m=Math.min(1,I),w()):m},e.paddingOuter=function(I){return arguments.length?(y=+I,w()):y},e.align=function(I){return arguments.length?(E=Math.max(0,Math.min(1,I)),w()):E},e.copy=function(){return S_(n(),i).round(h).paddingInner(m).paddingOuter(y).align(E)},initRange.apply(w(),arguments)}function C_(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return C_(n())},e}function TI(){return C_(S_.apply(null,arguments).paddingInner(1))}function w_(e,n,r,i,a){var s=e*e,h=s*e;return((1-3*e+3*s-h)*n+(4-6*s+3*h)*r+(1+3*e+3*s-3*h)*i+h*a)/6}function jA(e){var n=e.length-1;return function(r){var i=r<=0?r=0:r>=1?(r=1,n-1):Math.floor(r*n),a=e[i],s=e[i+1],h=i>0?e[i-1]:2*a-s,m=i<n-1?e[i+2]:2*s-a;return w_((r-i/n)*n,h,a,s,m)}}function GA(e){var n=e.length;return function(r){var i=Math.floor(((r%=1)<0?++r:r)*n),a=e[(i+n-1)%n],s=e[i%n],h=e[(i+1)%n],m=e[(i+2)%n];return w_((r-i/n)*n,a,s,h,m)}}function J0(e){return function(){return e}}function A_(e,n){return function(r){return e+r*n}}function HA(e,n,r){return e=Math.pow(e,r),n=Math.pow(n,r)-e,r=1/r,function(i){return Math.pow(e+i*n,r)}}function MI(e,n){var r=n-e;return r?A_(e,r>180||r<-180?r-360*Math.round(r/360):r):constant(isNaN(e)?n:e)}function WA(e){return(e=+e)==1?T_:function(n,r){return r-n?HA(n,r,e):J0(isNaN(n)?r:n)}}function T_(e,n){var r=n-e;return r?A_(e,r):J0(isNaN(e)?n:e)}var M_=function e(n){var r=WA(n);function i(a,s){var h=r((a=c(a)).r,(s=c(s)).r),m=r(a.g,s.g),y=r(a.b,s.b),E=T_(a.opacity,s.opacity);return function(w){return a.r=h(w),a.g=m(w),a.b=y(w),a.opacity=E(w),a+""}}return i.gamma=e,i}(1);function P_(e){return function(n){var r=n.length,i=new Array(r),a=new Array(r),s=new Array(r),h,m;for(h=0;h<r;++h)m=c(n[h]),i[h]=m.r||0,a[h]=m.g||0,s[h]=m.b||0;return i=e(i),a=e(a),s=e(s),m.opacity=1,function(y){return m.r=i(y),m.g=a(y),m.b=s(y),m+""}}}var PI=P_(jA),II=P_(GA);function OI(e,n){return(isNumberArray(n)?numberArray:I_)(e,n)}function I_(e,n){var r=n?n.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),s=new Array(r),h;for(h=0;h<i;++h)a[h]=rm(e[h],n[h]);for(;h<r;++h)s[h]=n[h];return function(m){for(h=0;h<i;++h)s[h]=a[h](m);return s}}function XA(e,n){var r=new Date;return e=+e,n=+n,function(i){return r.setTime(e*(1-i)+n*i),r}}function r0(e,n){return e=+e,n=+n,function(r){return e*(1-r)+n*r}}function YA(e,n){var r={},i={},a;(e===null||typeof e!="object")&&(e={}),(n===null||typeof n!="object")&&(n={});for(a in n)a in e?r[a]=rm(e[a],n[a]):i[a]=n[a];return function(s){for(a in r)i[a]=r[a](s);return i}}var em=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,tm=new RegExp(em.source,"g");function qA(e){return function(){return e}}function KA(e){return function(n){return e(n)+""}}function $A(e,n){var r=em.lastIndex=tm.lastIndex=0,i,a,s,h=-1,m=[],y=[];for(e=e+"",n=n+"";(i=em.exec(e))&&(a=tm.exec(n));)(s=a.index)>r&&(s=n.slice(r,s),m[h]?m[h]+=s:m[++h]=s),(i=i[0])===(a=a[0])?m[h]?m[h]+=a:m[++h]=a:(m[++h]=null,y.push({i:h,x:r0(i,a)})),r=tm.lastIndex;return r<n.length&&(s=n.slice(r),m[h]?m[h]+=s:m[++h]=s),m.length<2?y[0]?KA(y[0].x):qA(n):(n=y.length,function(E){for(var w=0,I;w<n;++w)m[(I=y[w]).i]=I.x(E);return m.join("")})}function QA(e,n){n||(n=[]);var r=e?Math.min(n.length,e.length):0,i=n.slice(),a;return function(s){for(a=0;a<r;++a)i[a]=e[a]*(1-s)+n[a]*s;return i}}function JA(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function rm(e,n){var r=typeof n,i;return n==null||r==="boolean"?J0(n):(r==="number"?r0:r==="string"?(i=ku(n))?(n=i,M_):$A:n instanceof ku?M_:n instanceof Date?XA:JA(n)?QA:Array.isArray(n)?I_:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?YA:r0)(e,n)}function eT(e,n){return e=+e,n=+n,function(r){return Math.round(e*(1-r)+n*r)}}function tT(e){return function(){return e}}function nm(e){return+e}var O_=[0,1];function Ac(e){return e}function im(e,n){return(n-=e=+e)?function(r){return(r-e)/n}:tT(isNaN(n)?NaN:.5)}function R_(e){var n=e[0],r=e[e.length-1],i;return n>r&&(i=n,n=r,r=i),function(a){return Math.max(n,Math.min(r,a))}}function rT(e,n,r){var i=e[0],a=e[1],s=n[0],h=n[1];return a<i?(i=im(a,i),s=r(h,s)):(i=im(i,a),s=r(s,h)),function(m){return s(i(m))}}function nT(e,n,r){var i=Math.min(e.length,n.length)-1,a=new Array(i),s=new Array(i),h=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++h<i;)a[h]=im(e[h],e[h+1]),s[h]=r(n[h],n[h+1]);return function(m){var y=Kv(e,m,1,i)-1;return s[y](a[y](m))}}function n0(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function am(){var e=O_,n=O_,r=rm,i,a,s,h=Ac,m,y,E;function w(){return m=Math.min(e.length,n.length)>2?nT:rT,y=E=null,I}function I(k){return isNaN(k=+k)?s:(y||(y=m(e.map(i),n,r)))(i(h(k)))}return I.invert=function(k){return h(a((E||(E=m(n,e.map(i),r0)))(k)))},I.domain=function(k){return arguments.length?(e=e0.call(k,nm),h===Ac||(h=R_(e)),w()):e.slice()},I.range=function(k){return arguments.length?(n=Bp.call(k),w()):n.slice()},I.rangeRound=function(k){return n=Bp.call(k),r=eT,w()},I.clamp=function(k){return arguments.length?(h=k?R_(e):Ac,I):h!==Ac},I.interpolate=function(k){return arguments.length?(r=k,w()):r},I.unknown=function(k){return arguments.length?(s=k,I):s},function(k,D){return i=k,a=D,w()}}function k_(e,n){return am()(e,n)}var iT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function i0(e){if(!(n=iT.exec(e)))throw new Error("invalid format: "+e);var n;return new om({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}i0.prototype=om.prototype;function om(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}om.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function aT(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function a0(e,n){if((r=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function pd(e){return e=a0(Math.abs(e)),e?e[1]:NaN}function oT(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(pd(n)/3)))*3-pd(Math.abs(e)))}function sT(e,n){return function(r,i){for(var a=r.length,s=[],h=0,m=e[0],y=0;a>0&&m>0&&(y+m+1>i&&(m=Math.max(1,i-y)),s.push(r.substring(a-=m,a+m)),!((y+=m+1)>i));)m=e[h=(h+1)%e.length];return s.reverse().join(n)}}function uT(e){return function(n){return n.replace(/[0-9]/g,function(r){return e[+r]})}}function lT(e){e:for(var n=e.length,r=1,i=-1,a;r<n;++r)switch(e[r]){case".":i=a=r;break;case"0":i===0&&(i=r),a=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(a+1):e}var L_;function cT(e,n){var r=a0(e,n);if(!r)return e+"";var i=r[0],a=r[1],s=a-(L_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,h=i.length;return s===h?i:s>h?i+new Array(s-h+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+a0(e,Math.max(0,n+s-1))[0]}function D_(e,n){var r=a0(e,n);if(!r)return e+"";var i=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+i:i.length>a+1?i.slice(0,a+1)+"."+i.slice(a+1):i+new Array(a-i.length+2).join("0")}var F_={"%":function(e,n){return(e*100).toFixed(n)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:aT,e:function(e,n){return e.toExponential(n)},f:function(e,n){return e.toFixed(n)},g:function(e,n){return e.toPrecision(n)},o:function(e){return Math.round(e).toString(8)},p:function(e,n){return D_(e*100,n)},r:D_,s:cT,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function B_(e){return e}var N_=Array.prototype.map,z_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function fT(e){var n=e.grouping===void 0||e.thousands===void 0?B_:sT(N_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?B_:uT(N_.call(e.numerals,String)),h=e.percent===void 0?"%":e.percent+"",m=e.minus===void 0?"-":e.minus+"",y=e.nan===void 0?"NaN":e.nan+"";function E(I){I=i0(I);var k=I.fill,D=I.align,W=I.sign,J=I.symbol,ie=I.zero,Oe=I.width,qe=I.comma,rt=I.precision,pt=I.trim,kt=I.type;kt==="n"?(qe=!0,kt="g"):F_[kt]||(rt===void 0&&(rt=12),pt=!0,kt="g"),(ie||k==="0"&&D==="=")&&(ie=!0,k="0",D="=");var zt=J==="$"?r:J==="#"&&/[boxX]/.test(kt)?"0"+kt.toLowerCase():"",nr=J==="$"?i:/[%p]/.test(kt)?h:"",dr=F_[kt],Zr=/[defgprs%]/.test(kt);rt=rt===void 0?6:/[gprs]/.test(kt)?Math.max(1,Math.min(21,rt)):Math.max(0,Math.min(20,rt));function un(wr){var Pn=zt,Nn=nr,pi,co,As;if(kt==="c")Nn=dr(wr)+Nn,wr="";else{wr=+wr;var tl=wr<0||1/wr<0;if(wr=isNaN(wr)?y:dr(Math.abs(wr),rt),pt&&(wr=lT(wr)),tl&&+wr==0&&W!=="+"&&(tl=!1),Pn=(tl?W==="("?W:m:W==="-"||W==="("?"":W)+Pn,Nn=(kt==="s"?z_[8+L_/3]:"")+Nn+(tl&&W==="("?")":""),Zr){for(pi=-1,co=wr.length;++pi<co;)if(As=wr.charCodeAt(pi),48>As||As>57){Nn=(As===46?a+wr.slice(pi+1):wr.slice(pi))+Nn,wr=wr.slice(0,pi);break}}}qe&&!ie&&(wr=n(wr,Infinity));var Tc=Pn.length+wr.length+Nn.length,Tl=Tc<Oe?new Array(Oe-Tc+1).join(k):"";switch(qe&&ie&&(wr=n(Tl+wr,Tl.length?Oe-Nn.length:Infinity),Tl=""),D){case"<":wr=Pn+wr+Nn+Tl;break;case"=":wr=Pn+Tl+wr+Nn;break;case"^":wr=Tl.slice(0,Tc=Tl.length>>1)+Pn+wr+Nn+Tl.slice(Tc);break;default:wr=Tl+Pn+wr+Nn;break}return s(wr)}return un.toString=function(){return I+""},un}function w(I,k){var D=E((I=i0(I),I.type="f",I)),W=Math.max(-8,Math.min(8,Math.floor(pd(k)/3)))*3,J=Math.pow(10,-W),ie=z_[8+W/3];return function(Oe){return D(J*Oe)+ie}}return{format:E,formatPrefix:w}}var o0,sm,U_;hT({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function hT(e){return o0=fT(e),sm=o0.format,U_=o0.formatPrefix,o0}function pT(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,pd(n)-pd(e))+1}function dT(e){return Math.max(0,-pd(Math.abs(e)))}function vT(e,n,r,i){var a=$0(e,n,r),s;switch(i=i0(i==null?",f":i),i.type){case"s":{var h=Math.max(Math.abs(e),Math.abs(n));return i.precision==null&&!isNaN(s=oT(a,h))&&(i.precision=s),U_(i,h)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=pT(a,Math.max(Math.abs(e),Math.abs(n))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=dT(a))&&(i.precision=s-(i.type==="%")*2);break}}return sm(i)}function s0(e){var n=e.domain;return e.ticks=function(r){var i=n();return g_(i[0],i[i.length-1],r==null?10:r)},e.tickFormat=function(r,i){var a=n();return vT(a[0],a[a.length-1],r==null?10:r,i)},e.nice=function(r){r==null&&(r=10);var i=n(),a=0,s=i.length-1,h=i[a],m=i[s],y;return m<h&&(y=h,h=m,m=y,y=a,a=s,s=y),y=$v(h,m,r),y>0?(h=Math.floor(h/y)*y,m=Math.ceil(m/y)*y,y=$v(h,m,r)):y<0&&(h=Math.ceil(h*y)/y,m=Math.floor(m*y)/y,y=$v(h,m,r)),y>0?(i[a]=Math.floor(h/y)*y,i[s]=Math.ceil(m/y)*y,n(i)):y<0&&(i[a]=Math.ceil(h*y)/y,i[s]=Math.floor(m*y)/y,n(i)),e},e}function Z_(){var e=k_(Ac,Ac);return e.copy=function(){return n0(e,Z_())},rp.apply(e,arguments),s0(e)}function V_(e){var n;function r(i){return isNaN(i=+i)?n:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(e=e0.call(i,nm),r):e.slice()},r.unknown=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return V_(e).unknown(n)},e=arguments.length?e0.call(e,nm):[0,1],s0(r)}function j_(e,n){e=e.slice();var r=0,i=e.length-1,a=e[r],s=e[i],h;return s<a&&(h=r,r=i,i=h,h=a,a=s,s=h),e[r]=n.floor(a),e[i]=n.ceil(s),e}function G_(e){return Math.log(e)}function H_(e){return Math.exp(e)}function mT(e){return-Math.log(-e)}function gT(e){return-Math.exp(-e)}function yT(e){return isFinite(e)?+("1e"+e):e<0?0:e}function _T(e){return e===10?yT:e===Math.E?Math.exp:function(n){return Math.pow(e,n)}}function xT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(n){return Math.log(n)/e})}function W_(e){return function(n){return-e(-n)}}function bT(e){var n=e(G_,H_),r=n.domain,i=10,a,s;function h(){return a=xT(i),s=_T(i),r()[0]<0?(a=W_(a),s=W_(s),e(mT,gT)):e(G_,H_),n}return n.base=function(m){return arguments.length?(i=+m,h()):i},n.domain=function(m){return arguments.length?(r(m),h()):r()},n.ticks=function(m){var y=r(),E=y[0],w=y[y.length-1],I;(I=w<E)&&(k=E,E=w,w=k);var k=a(E),D=a(w),W,J,ie,Oe=m==null?10:+m,qe=[];if(!(i%1)&&D-k<Oe){if(k=Math.round(k)-1,D=Math.round(D)+1,E>0){for(;k<D;++k)for(J=1,W=s(k);J<i;++J)if(ie=W*J,!(ie<E)){if(ie>w)break;qe.push(ie)}}else for(;k<D;++k)for(J=i-1,W=s(k);J>=1;--J)if(ie=W*J,!(ie<E)){if(ie>w)break;qe.push(ie)}}else qe=g_(k,D,Math.min(D-k,Oe)).map(s);return I?qe.reverse():qe},n.tickFormat=function(m,y){if(y==null&&(y=i===10?".0e":","),typeof y!="function"&&(y=sm(y)),m===Infinity)return y;m==null&&(m=10);var E=Math.max(1,i*m/n.ticks().length);return function(w){var I=w/s(Math.round(a(w)));return I*i<i-.5&&(I*=i),I<=E?y(w):""}},n.nice=function(){return r(j_(r(),{floor:function(m){return s(Math.floor(a(m)))},ceil:function(m){return s(Math.ceil(a(m)))}}))},n}function X_(){var e=bT(am()).domain([1,10]);return e.copy=function(){return n0(e,X_()).base(e.base())},rp.apply(e,arguments),e}function Y_(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function q_(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function ET(e){var n=1,r=e(Y_(n),q_(n));return r.constant=function(i){return arguments.length?e(Y_(n=+i),q_(n)):n},linearish(r)}function ST(){var e=ET(transformer());return e.copy=function(){return copy(e,ST()).constant(e.constant())},initRange.apply(e,arguments)}function K_(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function CT(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function wT(e){return e<0?-e*e:e*e}function AT(e){var n=e(Ac,Ac),r=1;function i(){return r===1?e(Ac,Ac):r===.5?e(CT,wT):e(K_(r),K_(1/r))}return n.exponent=function(a){return arguments.length?(r=+a,i()):r},s0(n)}function um(){var e=AT(am());return e.copy=function(){return n0(e,um()).exponent(e.exponent())},rp.apply(e,arguments),e}function RI(){return um.apply(null,arguments).exponent(.5)}function $_(){var e=[],n=[],r=[],i;function a(){var h=0,m=Math.max(1,n.length);for(r=new Array(m-1);++h<m;)r[h-1]=zA(e,h/m);return s}function s(h){return isNaN(h=+h)?i:n[Kv(r,h)]}return s.invertExtent=function(h){var m=n.indexOf(h);return m<0?[NaN,NaN]:[m>0?r[m-1]:e[0],m<r.length?r[m]:e[e.length-1]]},s.domain=function(h){if(!arguments.length)return e.slice();e=[];for(var m=0,y=h.length,E;m<y;++m)E=h[m],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(X0),a()},s.range=function(h){return arguments.length?(n=Bp.call(h),a()):n.slice()},s.unknown=function(h){return arguments.length?(i=h,s):i},s.quantiles=function(){return r.slice()},s.copy=function(){return $_().domain(e).range(n).unknown(i)},rp.apply(s,arguments)}function Q_(){var e=0,n=1,r=1,i=[.5],a=[0,1],s;function h(y){return y<=y?a[Kv(i,y,0,r)]:s}function m(){var y=-1;for(i=new Array(r);++y<r;)i[y]=((y+1)*n-(y-r)*e)/(r+1);return h}return h.domain=function(y){return arguments.length?(e=+y[0],n=+y[1],m()):[e,n]},h.range=function(y){return arguments.length?(r=(a=Bp.call(y)).length-1,m()):a.slice()},h.invertExtent=function(y){var E=a.indexOf(y);return E<0?[NaN,NaN]:E<1?[e,i[0]]:E>=r?[i[r-1],n]:[i[E-1],i[E]]},h.unknown=function(y){return arguments.length&&(s=y),h},h.thresholds=function(){return i.slice()},h.copy=function(){return Q_().domain([e,n]).range(a).unknown(s)},rp.apply(s0(h),arguments)}function J_(){var e=[.5],n=[0,1],r,i=1;function a(s){return s<=s?n[Kv(e,s,0,i)]:r}return a.domain=function(s){return arguments.length?(e=Bp.call(s),i=Math.min(e.length,n.length-1),a):e.slice()},a.range=function(s){return arguments.length?(n=Bp.call(s),i=Math.min(e.length,n.length-1),a):n.slice()},a.invertExtent=function(s){var h=n.indexOf(s);return[e[h-1],e[h]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return J_().domain(e).range(n).unknown(r)},rp.apply(a,arguments)}var lm=new Date,cm=new Date;function el(e,n,r,i){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),n(s,1),e(s),s},a.round=function(s){var h=a(s),m=a.ceil(s);return s-h<m-s?h:m},a.offset=function(s,h){return n(s=new Date(+s),h==null?1:Math.floor(h)),s},a.range=function(s,h,m){var y=[],E;if(s=a.ceil(s),m=m==null?1:Math.floor(m),!(s<h)||!(m>0))return y;do y.push(E=new Date(+s)),n(s,m),e(s);while(E<s&&s<h);return y},a.filter=function(s){return el(function(h){if(h>=h)for(;e(h),!s(h);)h.setTime(h-1)},function(h,m){if(h>=h)if(m<0)for(;++m<=0;)for(;n(h,-1),!s(h););else for(;--m>=0;)for(;n(h,1),!s(h););})},r&&(a.count=function(s,h){return lm.setTime(+s),cm.setTime(+h),e(lm),e(cm),Math.floor(r(lm,cm))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(i?function(h){return i(h)%s==0}:function(h){return a.count(0,h)%s==0}):a}),a}var fm=el(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n)},function(e,n){return n.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});fm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:el(function(n){n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,r){n.setFullYear(n.getFullYear()+r*e)})};var dd=fm,kI=fm.range,e1=el(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,n){e.setMonth(e.getMonth()+n)},function(e,n){return n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),TT=e1,LI=e1.range,u0=1e3,cv=6e4,t1=36e5,r1=864e5,n1=6048e5;function Np(e){return el(function(n){n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},function(n,r){n.setDate(n.getDate()+r*7)},function(n,r){return(r-n-(r.getTimezoneOffset()-n.getTimezoneOffset())*cv)/n1})}var hm=Np(0),l0=Np(1),MT=Np(2),PT=Np(3),vd=Np(4),IT=Np(5),OT=Np(6),DI=hm.range,FI=l0.range,BI=MT.range,NI=PT.range,zI=vd.range,UI=IT.range,ZI=OT.range,i1=el(function(e){e.setHours(0,0,0,0)},function(e,n){e.setDate(e.getDate()+n)},function(e,n){return(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*cv)/r1},function(e){return e.getDate()-1}),pm=i1,VI=i1.range,a1=el(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*u0-e.getMinutes()*cv)},function(e,n){e.setTime(+e+n*t1)},function(e,n){return(n-e)/t1},function(e){return e.getHours()}),RT=a1,jI=a1.range,o1=el(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*u0)},function(e,n){e.setTime(+e+n*cv)},function(e,n){return(n-e)/cv},function(e){return e.getMinutes()}),kT=o1,GI=o1.range,s1=el(function(e){e.setTime(e-e.getMilliseconds())},function(e,n){e.setTime(+e+n*u0)},function(e,n){return(n-e)/u0},function(e){return e.getUTCSeconds()}),LT=s1,HI=s1.range,c0=el(function(){},function(e,n){e.setTime(+e+n)},function(e,n){return n-e});c0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?el(function(n){n.setTime(Math.floor(n/e)*e)},function(n,r){n.setTime(+n+r*e)},function(n,r){return(r-n)/e}):c0};var DT=c0,WI=c0.range;function zp(e){return el(function(n){n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCDate(n.getUTCDate()+r*7)},function(n,r){return(r-n)/n1})}var u1=zp(0),f0=zp(1),FT=zp(2),BT=zp(3),md=zp(4),NT=zp(5),zT=zp(6),XI=u1.range,YI=f0.range,qI=FT.range,KI=BT.range,$I=md.range,QI=NT.range,JI=zT.range,l1=el(function(e){e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCDate(e.getUTCDate()+n)},function(e,n){return(n-e)/r1},function(e){return e.getUTCDate()-1}),c1=l1,eO=l1.range,dm=el(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n)},function(e,n){return n.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});dm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:el(function(n){n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCFullYear(n.getUTCFullYear()+r*e)})};var fv=dm,tO=dm.range;function vm(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function mm(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function hv(e,n,r){return{y:e,m:n,d:r,H:0,M:0,S:0,L:0}}function UT(e){var n=e.dateTime,r=e.date,i=e.time,a=e.periods,s=e.days,h=e.shortDays,m=e.months,y=e.shortMonths,E=pv(a),w=dv(a),I=pv(s),k=dv(s),D=pv(h),W=dv(h),J=pv(m),ie=dv(m),Oe=pv(y),qe=dv(y),rt={a:tl,A:Tc,b:Tl,B:n5,c:null,d:m1,e:m1,f:lM,g:_M,G:bM,H:oM,I:sM,j:uM,L:g1,m:cM,M:fM,p:i5,q:a5,Q:S1,s:C1,S:hM,u:pM,U:dM,V:vM,w:mM,W:gM,x:null,X:null,y:yM,Y:xM,Z:EM,"%":E1},pt={a:o5,A:s5,b:u5,B:l5,c:null,d:_1,e:_1,f:AM,g:FM,G:NM,H:SM,I:CM,j:wM,L:x1,m:TM,M:MM,p:c5,q:f5,Q:S1,s:C1,S:PM,u:IM,U:OM,V:RM,w:kM,W:LM,x:null,X:null,y:DM,Y:BM,Z:zM,"%":E1},kt={a:un,A:wr,b:Pn,B:Nn,c:pi,d:d1,e:d1,f:rM,g:p1,G:h1,H:v1,I:v1,j:QT,L:tM,m:$T,M:JT,p:Zr,q:KT,Q:iM,s:aM,S:eM,u:HT,U:WT,V:XT,w:GT,W:YT,x:co,X:As,y:p1,Y:h1,Z:qT,"%":nM};rt.x=zt(r,rt),rt.X=zt(i,rt),rt.c=zt(n,rt),pt.x=zt(r,pt),pt.X=zt(i,pt),pt.c=zt(n,pt);function zt(oi,wa){return function(Ka){var mn=[],Ml=-1,Go=0,Yl=oi.length,ql,Zp,ob;for(Ka instanceof Date||(Ka=new Date(+Ka));++Ml<Yl;)oi.charCodeAt(Ml)===37&&(mn.push(oi.slice(Go,Ml)),(Zp=f1[ql=oi.charAt(++Ml)])!=null?ql=oi.charAt(++Ml):Zp=ql==="e"?" ":"0",(ob=wa[ql])&&(ql=ob(Ka,Zp)),mn.push(ql),Go=Ml+1);return mn.push(oi.slice(Go,Ml)),mn.join("")}}function nr(oi,wa){return function(Ka){var mn=hv(1900,void 0,1),Ml=dr(mn,oi,Ka+="",0),Go,Yl;if(Ml!=Ka.length)return null;if("Q"in mn)return new Date(mn.Q);if("s"in mn)return new Date(mn.s*1e3+("L"in mn?mn.L:0));if(wa&&!("Z"in mn)&&(mn.Z=0),"p"in mn&&(mn.H=mn.H%12+mn.p*12),mn.m===void 0&&(mn.m="q"in mn?mn.q:0),"V"in mn){if(mn.V<1||mn.V>53)return null;"w"in mn||(mn.w=1),"Z"in mn?(Go=mm(hv(mn.y,0,1)),Yl=Go.getUTCDay(),Go=Yl>4||Yl===0?f0.ceil(Go):f0(Go),Go=c1.offset(Go,(mn.V-1)*7),mn.y=Go.getUTCFullYear(),mn.m=Go.getUTCMonth(),mn.d=Go.getUTCDate()+(mn.w+6)%7):(Go=vm(hv(mn.y,0,1)),Yl=Go.getDay(),Go=Yl>4||Yl===0?l0.ceil(Go):l0(Go),Go=pm.offset(Go,(mn.V-1)*7),mn.y=Go.getFullYear(),mn.m=Go.getMonth(),mn.d=Go.getDate()+(mn.w+6)%7)}else("W"in mn||"U"in mn)&&("w"in mn||(mn.w="u"in mn?mn.u%7:"W"in mn?1:0),Yl="Z"in mn?mm(hv(mn.y,0,1)).getUTCDay():vm(hv(mn.y,0,1)).getDay(),mn.m=0,mn.d="W"in mn?(mn.w+6)%7+mn.W*7-(Yl+5)%7:mn.w+mn.U*7-(Yl+6)%7);return"Z"in mn?(mn.H+=mn.Z/100|0,mn.M+=mn.Z%100,mm(mn)):vm(mn)}}function dr(oi,wa,Ka,mn){for(var Ml=0,Go=wa.length,Yl=Ka.length,ql,Zp;Ml<Go;){if(mn>=Yl)return-1;if(ql=wa.charCodeAt(Ml++),ql===37){if(ql=wa.charAt(Ml++),Zp=kt[ql in f1?wa.charAt(Ml++):ql],!Zp||(mn=Zp(oi,Ka,mn))<0)return-1}else if(ql!=Ka.charCodeAt(mn++))return-1}return mn}function Zr(oi,wa,Ka){var mn=E.exec(wa.slice(Ka));return mn?(oi.p=w[mn[0].toLowerCase()],Ka+mn[0].length):-1}function un(oi,wa,Ka){var mn=D.exec(wa.slice(Ka));return mn?(oi.w=W[mn[0].toLowerCase()],Ka+mn[0].length):-1}function wr(oi,wa,Ka){var mn=I.exec(wa.slice(Ka));return mn?(oi.w=k[mn[0].toLowerCase()],Ka+mn[0].length):-1}function Pn(oi,wa,Ka){var mn=Oe.exec(wa.slice(Ka));return mn?(oi.m=qe[mn[0].toLowerCase()],Ka+mn[0].length):-1}function Nn(oi,wa,Ka){var mn=J.exec(wa.slice(Ka));return mn?(oi.m=ie[mn[0].toLowerCase()],Ka+mn[0].length):-1}function pi(oi,wa,Ka){return dr(oi,n,wa,Ka)}function co(oi,wa,Ka){return dr(oi,r,wa,Ka)}function As(oi,wa,Ka){return dr(oi,i,wa,Ka)}function tl(oi){return h[oi.getDay()]}function Tc(oi){return s[oi.getDay()]}function Tl(oi){return y[oi.getMonth()]}function n5(oi){return m[oi.getMonth()]}function i5(oi){return a[+(oi.getHours()>=12)]}function a5(oi){return 1+~~(oi.getMonth()/3)}function o5(oi){return h[oi.getUTCDay()]}function s5(oi){return s[oi.getUTCDay()]}function u5(oi){return y[oi.getUTCMonth()]}function l5(oi){return m[oi.getUTCMonth()]}function c5(oi){return a[+(oi.getUTCHours()>=12)]}function f5(oi){return 1+~~(oi.getUTCMonth()/3)}return{format:function(oi){var wa=zt(oi+="",rt);return wa.toString=function(){return oi},wa},parse:function(oi){var wa=nr(oi+="",!1);return wa.toString=function(){return oi},wa},utcFormat:function(oi){var wa=zt(oi+="",pt);return wa.toString=function(){return oi},wa},utcParse:function(oi){var wa=nr(oi+="",!0);return wa.toString=function(){return oi},wa}}}var f1={"-":"",_:" ","0":"0"},fu=/^\s*\d+/,ZT=/^%/,VT=/[\\^$*+?|[\]().{}]/g;function qa(e,n,r){var i=e<0?"-":"",a=(i?-e:e)+"",s=a.length;return i+(s<r?new Array(r-s+1).join(n)+a:a)}function jT(e){return e.replace(VT,"\\$&")}function pv(e){return new RegExp("^(?:"+e.map(jT).join("|")+")","i")}function dv(e){for(var n={},r=-1,i=e.length;++r<i;)n[e[r].toLowerCase()]=r;return n}function GT(e,n,r){var i=fu.exec(n.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function HT(e,n,r){var i=fu.exec(n.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function WT(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function XT(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function YT(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function h1(e,n,r){var i=fu.exec(n.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function p1(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function qT(e,n,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function KT(e,n,r){var i=fu.exec(n.slice(r,r+1));return i?(e.q=i[0]*3-3,r+i[0].length):-1}function $T(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function d1(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function QT(e,n,r){var i=fu.exec(n.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function v1(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function JT(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function eM(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function tM(e,n,r){var i=fu.exec(n.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function rM(e,n,r){var i=fu.exec(n.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function nM(e,n,r){var i=ZT.exec(n.slice(r,r+1));return i?r+i[0].length:-1}function iM(e,n,r){var i=fu.exec(n.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function aM(e,n,r){var i=fu.exec(n.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function m1(e,n){return qa(e.getDate(),n,2)}function oM(e,n){return qa(e.getHours(),n,2)}function sM(e,n){return qa(e.getHours()%12||12,n,2)}function uM(e,n){return qa(1+pm.count(dd(e),e),n,3)}function g1(e,n){return qa(e.getMilliseconds(),n,3)}function lM(e,n){return g1(e,n)+"000"}function cM(e,n){return qa(e.getMonth()+1,n,2)}function fM(e,n){return qa(e.getMinutes(),n,2)}function hM(e,n){return qa(e.getSeconds(),n,2)}function pM(e){var n=e.getDay();return n===0?7:n}function dM(e,n){return qa(hm.count(dd(e)-1,e),n,2)}function y1(e){var n=e.getDay();return n>=4||n===0?vd(e):vd.ceil(e)}function vM(e,n){return e=y1(e),qa(vd.count(dd(e),e)+(dd(e).getDay()===4),n,2)}function mM(e){return e.getDay()}function gM(e,n){return qa(l0.count(dd(e)-1,e),n,2)}function yM(e,n){return qa(e.getFullYear()%100,n,2)}function _M(e,n){return e=y1(e),qa(e.getFullYear()%100,n,2)}function xM(e,n){return qa(e.getFullYear()%1e4,n,4)}function bM(e,n){var r=e.getDay();return e=r>=4||r===0?vd(e):vd.ceil(e),qa(e.getFullYear()%1e4,n,4)}function EM(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+qa(n/60|0,"0",2)+qa(n%60,"0",2)}function _1(e,n){return qa(e.getUTCDate(),n,2)}function SM(e,n){return qa(e.getUTCHours(),n,2)}function CM(e,n){return qa(e.getUTCHours()%12||12,n,2)}function wM(e,n){return qa(1+c1.count(fv(e),e),n,3)}function x1(e,n){return qa(e.getUTCMilliseconds(),n,3)}function AM(e,n){return x1(e,n)+"000"}function TM(e,n){return qa(e.getUTCMonth()+1,n,2)}function MM(e,n){return qa(e.getUTCMinutes(),n,2)}function PM(e,n){return qa(e.getUTCSeconds(),n,2)}function IM(e){var n=e.getUTCDay();return n===0?7:n}function OM(e,n){return qa(u1.count(fv(e)-1,e),n,2)}function b1(e){var n=e.getUTCDay();return n>=4||n===0?md(e):md.ceil(e)}function RM(e,n){return e=b1(e),qa(md.count(fv(e),e)+(fv(e).getUTCDay()===4),n,2)}function kM(e){return e.getUTCDay()}function LM(e,n){return qa(f0.count(fv(e)-1,e),n,2)}function DM(e,n){return qa(e.getUTCFullYear()%100,n,2)}function FM(e,n){return e=b1(e),qa(e.getUTCFullYear()%100,n,2)}function BM(e,n){return qa(e.getUTCFullYear()%1e4,n,4)}function NM(e,n){var r=e.getUTCDay();return e=r>=4||r===0?md(e):md.ceil(e),qa(e.getUTCFullYear()%1e4,n,4)}function zM(){return"+0000"}function E1(){return"%"}function S1(e){return+e}function C1(e){return Math.floor(+e/1e3)}var gd,w1,UM,ZM,VM;jM({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function jM(e){return gd=UT(e),w1=gd.format,UM=gd.parse,ZM=gd.utcFormat,VM=gd.utcParse,gd}var vv=1e3,mv=vv*60,gv=mv*60,yv=gv*24,GM=yv*7,A1=yv*30,gm=yv*365;function HM(e){return new Date(e)}function WM(e){return e instanceof Date?+e:+new Date(+e)}function T1(e,n,r,i,a,s,h,m,y){var E=k_(Ac,Ac),w=E.invert,I=E.domain,k=y(".%L"),D=y(":%S"),W=y("%I:%M"),J=y("%I %p"),ie=y("%a %d"),Oe=y("%b %d"),qe=y("%B"),rt=y("%Y"),pt=[[h,1,vv],[h,5,5*vv],[h,15,15*vv],[h,30,30*vv],[s,1,mv],[s,5,5*mv],[s,15,15*mv],[s,30,30*mv],[a,1,gv],[a,3,3*gv],[a,6,6*gv],[a,12,12*gv],[i,1,yv],[i,2,2*yv],[r,1,GM],[n,1,A1],[n,3,3*A1],[e,1,gm]];function kt(nr){return(h(nr)<nr?k:s(nr)<nr?D:a(nr)<nr?W:i(nr)<nr?J:n(nr)<nr?r(nr)<nr?ie:Oe:e(nr)<nr?qe:rt)(nr)}function zt(nr,dr,Zr,un){if(nr==null&&(nr=10),typeof nr=="number"){var wr=Math.abs(Zr-dr)/nr,Pn=d_(function(Nn){return Nn[2]}).right(pt,wr);Pn===pt.length?(un=$0(dr/gm,Zr/gm,nr),nr=e):Pn?(Pn=pt[wr/pt[Pn-1][2]<pt[Pn][2]/wr?Pn-1:Pn],un=Pn[1],nr=Pn[0]):(un=Math.max($0(dr,Zr,nr),1),nr=m)}return un==null?nr:nr.every(un)}return E.invert=function(nr){return new Date(w(nr))},E.domain=function(nr){return arguments.length?I(e0.call(nr,WM)):I().map(HM)},E.ticks=function(nr,dr){var Zr=I(),un=Zr[0],wr=Zr[Zr.length-1],Pn=wr<un,Nn;return Pn&&(Nn=un,un=wr,wr=Nn),Nn=zt(nr,un,wr,dr),Nn=Nn?Nn.range(un,wr+1):[],Pn?Nn.reverse():Nn},E.tickFormat=function(nr,dr){return dr==null?kt:y(dr)},E.nice=function(nr,dr){var Zr=I();return(nr=zt(nr,Zr[0],Zr[Zr.length-1],dr))?I(j_(Zr,nr)):E},E.copy=function(){return n0(E,T1(e,n,r,i,a,s,h,m,y))},E}function XM(){return rp.apply(T1(dd,TT,hm,pm,RT,kT,LT,DT,w1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function rO(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function h0(){var e=0,n=1,r,i,a,s,h=identity,m=!1,y;function E(w){return isNaN(w=+w)?y:h(a===0?.5:(w=(s(w)-r)*a,m?Math.max(0,Math.min(1,w)):w))}return E.domain=function(w){return arguments.length?(r=s(e=+w[0]),i=s(n=+w[1]),a=r===i?0:1/(i-r),E):[e,n]},E.clamp=function(w){return arguments.length?(m=!!w,E):m},E.interpolator=function(w){return arguments.length?(h=w,E):h},E.unknown=function(w){return arguments.length?(y=w,E):y},function(w){return s=w,r=w(e),i=w(n),a=r===i?0:1/(i-r),E}}function p0(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function YM(){var e=linearish(h0()(identity));return e.copy=function(){return p0(e,YM())},initInterpolator.apply(e,arguments)}function qM(){var e=loggish(h0()).domain([1,10]);return e.copy=function(){return p0(e,qM()).base(e.base())},initInterpolator.apply(e,arguments)}function KM(){var e=symlogish(h0());return e.copy=function(){return p0(e,KM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function M1(){var e=powish(h0());return e.copy=function(){return p0(e,M1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function nO(){return M1.apply(null,arguments).exponent(.5)}function $M(){var e=[],n=identity;function r(i){if(!isNaN(i=+i))return n((bisect(e,i)-1)/(e.length-1))}return r.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var a=0,s=i.length,h;a<s;++a)h=i[a],h!=null&&!isNaN(h=+h)&&e.push(h);return e.sort(ascending),r},r.interpolator=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return $M(n).domain(e)},initInterpolator.apply(r,arguments)}function d0(){var e=0,n=.5,r=1,i,a,s,h,m,y=identity,E,w=!1,I;function k(D){return isNaN(D=+D)?I:(D=.5+((D=+E(D))-a)*(D<a?h:m),y(w?Math.max(0,Math.min(1,D)):D))}return k.domain=function(D){return arguments.length?(i=E(e=+D[0]),a=E(n=+D[1]),s=E(r=+D[2]),h=i===a?0:.5/(a-i),m=a===s?0:.5/(s-a),k):[e,n,r]},k.clamp=function(D){return arguments.length?(w=!!D,k):w},k.interpolator=function(D){return arguments.length?(y=D,k):y},k.unknown=function(D){return arguments.length?(I=D,k):I},function(D){return E=D,i=D(e),a=D(n),s=D(r),h=i===a?0:.5/(a-i),m=a===s?0:.5/(s-a),k}}function QM(){var e=linearish(d0()(identity));return e.copy=function(){return copy(e,QM())},initInterpolator.apply(e,arguments)}function JM(){var e=loggish(d0()).domain([.1,1,10]);return e.copy=function(){return copy(e,JM()).base(e.base())},initInterpolator.apply(e,arguments)}function e3(){var e=symlogish(d0());return e.copy=function(){return copy(e,e3()).constant(e.constant())},initInterpolator.apply(e,arguments)}function P1(){var e=powish(d0());return e.copy=function(){return copy(e,P1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function iO(){return P1.apply(null,arguments).exponent(.5)}var ef,I1,O1,R1,ym,k1,t3=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,r3=(ef={},(0,A.Z)(ef,tu.LINEAR,Z_),(0,A.Z)(ef,tu.POWER,um),(0,A.Z)(ef,tu.LOG,X_),(0,A.Z)(ef,tu.IDENTITY,V_),(0,A.Z)(ef,tu.TIME,XM),(0,A.Z)(ef,tu.QUANTILE,$_),(0,A.Z)(ef,tu.QUANTIZE,Q_),(0,A.Z)(ef,tu.THRESHOLD,J_),(0,A.Z)(ef,tu.CAT,t0),ef),n3=(I1=(0,$r.b2)(),O1=(0,$r.f3)(Nt.IGlobalConfigService),I1(R1=(ym=function(){function e(){(0,Bt.Z)(this,e),qn(this,"configService",k1,this),(0,A.Z)(this,"scaleCache",{}),(0,A.Z)(this,"scaleOptions",{})}return(0,Yt.Z)(e,[{key:"apply",value:function(r,i){var a=this,s=i.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var h=s.getLayerStyleAttributes(),m=r.getSource().data.dataArray;m.length!==0&&a.caculateScalesForAttributes(h||[],m)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var h=s.getLayerStyleAttributes(),m=r.getSource().data.dataArray;return a.caculateScalesForAttributes(h||[],m),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var h=s.getLayerStyleAttributes();if(h){var m=r.getSource().data.dataArray;if(m.length===0)return;var y=h.filter(function(E){return E.needRescale});y.length&&a.caculateScalesForAttributes(y,m)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,i){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var h=s.scale,m=s.name;h.names=a.parseFields(s.scale.field||[]);var y=[];h.names.forEach(function(E){y.push(a.getOrCreateScale(E,s,i))}),y.some(function(E){return E.type===Kh.VARIABLE})?(h.type=Kh.VARIABLE,y.forEach(function(E){if(!h.callback){var w;if(h.values&&h.values!=="text"){var I;if(((I=E.option)===null||I===void 0?void 0:I.type)==="linear"&&h.values.length>2){var k=E.scale.ticks(h.values.length);m==="color"&&E.scale.domain(k)}E.scale.range(h.values)}else((w=E.option)===null||w===void 0?void 0:w.type)==="cat"&&E.scale.range(E.option.domain)}})):(h.type=Kh.CONSTANT,h.defaultValues=y.map(function(E,w){return E.scale(h.names[w])})),h.scalers=y.map(function(E){return{field:E.field,func:E.scale,option:E.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,i,a){var s,h=[r,i.name].join("_"),m=(s=i.scale)===null||s===void 0?void 0:s.values,y=this.createScale(r,i.name,m,a);return y}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:On()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,i,a,s){var h,m,y=this.scaleOptions[i]&&((h=this.scaleOptions[i])===null||h===void 0?void 0:h.field)===r?this.scaleOptions[i]:this.scaleOptions[r],E={field:r,scale:void 0,type:Kh.VARIABLE,option:y};if(!s||!s.length)return y&&y.type?E.scale=this.createDefaultScale(y):(E.scale=t0([r]),E.type=Kh.CONSTANT),E;var w=(m=s.find(function(D){return!$c()(D[r])}))===null||m===void 0?void 0:m[r];if(this.isNumber(r)||$c()(w)&&!y)E.scale=t0([r]),E.type=Kh.CONSTANT;else{var I=y&&y.type||this.getDefaultType(w);a==="text"&&(I=tu.CAT);var k=this.createDefaultScaleConfig(I,r,s);Object.assign(k,y),E.scale=this.createDefaultScale(k),E.option=k}return E}},{key:"getDefaultType",value:function(r){var i=tu.LINEAR;return typeof r=="string"&&(i=t3.test(r)?tu.TIME:tu.CAT),i}},{key:"createDefaultScaleConfig",value:function(r,i,a){var s={type:r},h=(a==null?void 0:a.map(function(m){return m[i]}))||[];return r!==tu.CAT&&r!==tu.QUANTILE?s.domain=BA(h):r===tu.CAT?s.domain=sh()(h):r===tu.QUANTILE&&(s.domain=h),s}},{key:"createDefaultScale",value:function(r){var i=r.type,a=r.domain,s=r3[i]();return a&&s.domain(a),s}}]),e}(),k1=ci(ym.prototype,"configService",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym))||R1),L1,D1,F1,B1,v0,N1,z1;function U1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function i3(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?U1(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var a3=(L1=(0,$r.b2)(),D1=(0,$r.f3)(Nt.ICameraService),F1=(0,$r.f3)(Nt.IRendererService),L1(B1=(v0=function(){function e(){(0,Bt.Z)(this,e),qn(this,"cameraService",N1,this),qn(this,"rendererService",z1,this)}return(0,Yt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(i){i.addUniforms(i3({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),N1=ci(v0.prototype,"cameraService",[D1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z1=ci(v0.prototype,"rendererService",[F1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v0))||B1),Z1,V1,o3=(Z1=(0,$r.b2)(),Z1(V1=function(){function e(){(0,Bt.Z)(this,e)}return(0,Yt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||V1),j1,G1,s3=(j1=(0,$r.b2)(),j1(G1=function(){function e(){(0,Bt.Z)(this,e)}return(0,Yt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var i=r.getLayerConfig(),a=i.autoFit,s=i.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||G1),H1,W1,u3=["type"];function X1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function _v(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?X1(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Y1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},l3={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},c3={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},f3={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},aO=null;function h3(e){var n={u_DirectionalLights:new Array(3).fill(_v({},c3)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(_v({},f3)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[l3]),e.forEach(function(r,i){var a=r.type,s=a===void 0?"directional":a,h=(0,wl.Z)(r,u3),m=Y1[s].lights,y=Y1[s].num,E=n[y];n[m][E]=_v(_v({},n[m][E]),h),n[y]++}),n}var p3=(H1=(0,$r.b2)(),H1(W1=function(){function e(){(0,Bt.Z)(this,e)}return(0,Yt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var i=r.getLayerConfig(),a=i.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(_v({},h3()))})})}}]),e}())||W1),q1,K1,m0={NONE:0,ENCODE:1,HIGHLIGHT:2},d3=(q1=(0,$r.b2)(),q1(K1=function(){function e(){(0,Bt.Z)(this,e)}return(0,Yt.Z)(e,[{key:"apply",value:function(r,i){var a=i.rendererService,s=i.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var h=r.getLayerConfig(),m=h.enablePicking;s.registerStyleAttribute({name:"pickingColor",type:$n.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:q.FLOAT},size:3,update:function(E,w){var I=E.id;return m?Ue(I):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var h=r.getLayerConfig(),m=h.enablePicking;m&&r.isVisible()&&r.models.forEach(function(y){return y.addUniforms({u_PickingStage:m0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var h=r.getLayerConfig(),m=h.enablePicking;m&&r.isVisible()&&r.models.forEach(function(y){return y.addUniforms({u_PickingStage:m0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(h){var m=r.getLayerConfig(),y=m.highlightColor,E=m.activeMix,w=E===void 0?0:E,I=m.enableSelect,k=typeof y=="string"?Ce(y):y||[1,0,0,1],D=r.getLayerConfig(),W=D.selectColor,J=typeof W=="string"?Ce(W):W||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Pe(new Uint8Array(h))});var ie=r.getCurrentSelectedId();r.models.forEach(function(Oe){return Oe.addUniforms({u_PickingStage:m0.HIGHLIGHT,u_PickingColor:h,u_HighlightColor:k.map(function(qe){return qe*255}),u_activeMix:w,u_CurrentSelectedId:ie?Ue(r.getCurrentSelectedId()):[0,0,0],u_SelectColor:J.map(function(qe){return qe*255}),u_EnableSelect:+(I||!1)})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(h){var m=r.getLayerConfig(),y=m.selectColor,E=m.selectMix,w=E===void 0?0:E,I=typeof y=="string"?Ce(y):y||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Pe(new Uint8Array(h))}),r.models.forEach(function(k){return k.addUniforms({u_PickingStage:m0.HIGHLIGHT,u_PickingColor:h,u_HighlightColor:I.map(function(D){return D*255}),u_activeMix:w,u_CurrentSelectedId:h,u_SelectColor:I.map(function(D){return D*255}),u_EnableSelect:1})})})}}]),e}())||K1),$1,Q1,v3=($1=(0,$r.b2)(),$1(Q1=function(){function e(){(0,Bt.Z)(this,e)}return(0,Yt.Z)(e,[{key:"apply",value:function(r,i){var a=this,s=i.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:$n.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:q.FLOAT},size:3,update:function(a,s,h){return h.length===2?[h[0],h[1],0]:[h[0],h[1],h[2]]}}}),r.registerStyleAttribute({name:"filter",type:$n.Attribute,descriptor:{name:"filter",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(a,s){var h=a.filter;return h?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:$n.Attribute,descriptor:{name:"a_Color",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(a,s){var h=a.color;return!h||!h.length?[1,1,1,1]:h}}}),r.registerStyleAttribute({name:"vertexId",type:$n.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(a,s,h,m){return[s]}}})}}]),e}())||Q1),J1,ex,tx,rx,nx,ix,yd,ax,ox,sx,ux,m3=(J1=(0,$r.b2)(),ex=(0,$r.f3)(Nt.ICameraService),tx=(0,$r.f3)(Nt.ICoordinateSystemService),rx=(0,$r.f3)(Nt.IRendererService),nx=(0,$r.f3)(Nt.IMapService),J1(ix=(yd=function(){function e(){(0,Bt.Z)(this,e),qn(this,"cameraService",ax,this),qn(this,"coordinateSystemService",ox,this),qn(this,"rendererService",sx,this),qn(this,"mapService",ux,this)}return(0,Yt.Z)(e,[{key:"apply",value:function(r){var i=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],h=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){i.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=i.mapService.map.customCoords.getMVPMatrix(),h=i.mapService.getCustomCoordCenter());var m=i.rendererService.getViewportSize(),y=m.width,E=m.height;r.models.forEach(function(w){var I;w.addUniforms((I={},(0,A.Z)(I,Mp.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,A.Z)(I,Mp.ViewMatrix,i.cameraService.getViewMatrix()),(0,A.Z)(I,Mp.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,A.Z)(I,Mp.Zoom,i.cameraService.getZoom()),(0,A.Z)(I,Mp.ZoomScale,i.cameraService.getZoomScale()),(0,A.Z)(I,Mp.FocalDistance,i.cameraService.getFocalDistance()),(0,A.Z)(I,Mp.CameraPosition,i.cameraService.getCameraPosition()),(0,A.Z)(I,Jr.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,A.Z)(I,Jr.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,A.Z)(I,Jr.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,A.Z)(I,Jr.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,A.Z)(I,Jr.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,A.Z)(I,Jr.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,A.Z)(I,Jr.Mvp,s),(0,A.Z)(I,"u_SceneCenterMKT",h),(0,A.Z)(I,"u_ViewportSize",[y,E]),(0,A.Z)(I,"u_ModelMatrix",i.cameraService.getModelMatrix()),(0,A.Z)(I,"u_DevicePixelRatio",Xi.devicePixelRatio),(0,A.Z)(I,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,A.Z)(I,"u_shaderPick",Number(r.getShaderPickStat())),I))})})}}]),e}(),ax=ci(yd.prototype,"cameraService",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=ci(yd.prototype,"coordinateSystemService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sx=ci(yd.prototype,"rendererService",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ux=ci(yd.prototype,"mapService",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd))||ix),lx,cx,g3=(lx=(0,$r.b2)(),lx(cx=function(){function e(){(0,Bt.Z)(this,e)}return(0,Yt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||cx),fx,hx,y3=(fx=(0,$r.b2)(),fx(hx=function(){function e(){(0,Bt.Z)(this,e)}return(0,Yt.Z)(e,[{key:"apply",value:function(r,i){var a=this,s=i.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,i){var a=i.styleAttributeService,s=a.getLayerStyleAttributes()||[],h=a.getLayerStyleAttribute("filter"),m=a.getLayerStyleAttribute("shape");if(h&&h.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(y){return y.needRegenerateVertices=!1});return}s.filter(function(y){return y.needRegenerateVertices}).forEach(function(y){a.updateAttributeByFeatureRange(y.name,r.getEncodedData(),y.featureRange.startIndex,y.featureRange.endIndex),y.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,i){var a=i.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(h){return h.needRegenerateVertices}).forEach(function(h){a.updateAttributeByFeatureRange(h.name,r.getEncodedData(),h.featureRange.startIndex,h.featureRange.endIndex),h.needRegenerateVertices=!1})}}]),e}())||hx);Xl.bind(Nt.ILayerPlugin).to(LA).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(v3).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(n3).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(kA).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(s3).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(y3).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(g3).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(_E).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(m3).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(a3).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(p3).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(d3).inRequestScope(),Xl.bind(Nt.ILayerPlugin).to(o3).inRequestScope();var oO="2.7.3";function px(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function sO(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?px(Object(r),!0).forEach(function(i){_3(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):px(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function _3(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function uO(e,n){return S3(e)||E3(e,n)||b3(e,n)||x3()}function x3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b3(e,n){if(!!e){if(typeof e=="string")return dx(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dx(e,n)}}function dx(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function E3(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(i.push(h.value),!(n&&i.length===n));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return i}}function S3(e){if(Array.isArray(e))return e}var lO=null,cO=null,vx,_m,mx;function gx(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function yx(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?gx(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gx(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var C3=(vx=D0(Nt.IGlobalConfigService),_m=function(){function e(n){(0,Bt.Z)(this,e),qn(this,"configService",mx,this),(0,A.Z)(this,"config",void 0),this.config=n}return(0,Yt.Z)(e,[{key:"setContainer",value:function(r,i,a,s){r.bind(Nt.MapConfig).toConstantValue(yx(yx({},this.config),{},{id:i,canvas:a,hasBaseMap:s})),r.bind(Nt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),mx=ci(_m.prototype,"configService",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_m),w3=V(6158),xv=V.n(w3);function bv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function g0(e,n){var r=P([],n,e);return Cv(r,r,1/r[3]),r}function fO(e,n){var r=e%n;return r<0?n+r:r}function hO(e,n,r){return r*n+(1-r)*e}function Up(e,n){if(!e)throw new Error(n||"viewport-mercator-project: assertion failed.")}var tf=Math.PI,_x=tf/4,hh=tf/180,xx=180/tf,xm=512,bm=4003e4,A3=1.5;function bx(e){return Math.pow(2,e)}function T3(e){return Math.log2(e)}function y0(e,n){var r=(0,Vn.Z)(e,2),i=r[0],a=r[1];Up(Number.isFinite(i)&&Number.isFinite(n)),Up(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),n*=xm;var s=i*hh,h=a*hh,m=n*(s+tf)/(2*tf),y=n*(tf-Math.log(Math.tan(_x+h*.5)))/(2*tf);return[m,y]}function Em(e,n){var r=(0,Vn.Z)(e,2),i=r[0],a=r[1];n*=xm;var s=i/n*(2*tf)-tf,h=2*(Math.atan(Math.exp(tf-a/n*(2*tf)))-_x);return[s*xx,h*xx]}function pO(e){var n=e.latitude;assert(Number.isFinite(n));var r=Math.cos(n*hh);return T3(bm*r)-9}function Ex(e){var n=e.latitude,r=e.longitude,i=e.zoom,a=e.scale,s=e.highPrecision,h=s===void 0?!1:s;a=a!==void 0?a:bx(i),Up(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(a));var m={},y=xm*a,E=Math.cos(n*hh),w=y/360,I=w/E,k=y/bm/E;if(m.pixelsPerMeter=[k,-k,k],m.metersPerPixel=[1/k,-1/k,1/k],m.pixelsPerDegree=[w,-I,k],m.degreesPerPixel=[1/w,-1/I,1/k],h){var D=hh*Math.tan(n*hh)/E,W=w*D/2,J=y/bm*D,ie=J/I*k;m.pixelsPerDegree2=[0,-W,J],m.pixelsPerMeter2=[ie,0,ie]}return m}function dO(e,n){var r=_slicedToArray(e,3),i=r[0],a=r[1],s=r[2],h=_slicedToArray(n,3),m=h[0],y=h[1],E=h[2],w=1,I=Ex({longitude:i,latitude:a,scale:w,highPrecision:!0}),k=I.pixelsPerMeter,D=I.pixelsPerMeter2,W=y0(e,w);W[0]+=m*(k[0]+D[0]*y),W[1]+=y*(k[1]+D[1]*y);var J=Em(W,w),ie=(s||0)+(E||0);return Number.isFinite(s)||Number.isFinite(E)?[J[0],J[1],ie]:J}function M3(e){var n=e.height,r=e.pitch,i=e.bearing,a=e.altitude,s=e.center,h=s===void 0?null:s,m=e.flipY,y=m===void 0?!1:m,E=bv();return fn(E,E,[0,0,-a]),Nr(E,E,[1,1,1/n]),Ur(E,E,-r*hh),mi(E,E,i*hh),y&&Nr(E,E,[1,-1,1]),h&&fn(E,E,yy([],h)),E}function P3(e){var n=e.width,r=e.height,i=e.altitude,a=i===void 0?A3:i,s=e.pitch,h=s===void 0?0:s,m=e.nearZMultiplier,y=m===void 0?1:m,E=e.farZMultiplier,w=E===void 0?1:E,I=h*hh,k=Math.atan(.5/a),D=Math.sin(k)*a/Math.sin(Math.PI/2-I-k),W=Math.cos(Math.PI/2-I)*D+a;return{fov:2*Math.atan(r/2/a),aspect:n/r,focalDistance:a,near:y,far:W*w}}function I3(e){var n=e.width,r=e.height,i=e.pitch,a=e.altitude,s=e.nearZMultiplier,h=e.farZMultiplier,m=P3({width:n,height:r,altitude:a,pitch:i,nearZMultiplier:s,farZMultiplier:h}),y=m.fov,E=m.aspect,w=m.near,I=m.far,k=to([],y,E,w,I);return k}function O3(e,n){var r=(0,Vn.Z)(e,3),i=r[0],a=r[1],s=r[2],h=s===void 0?0:s;return Up(Number.isFinite(i)&&Number.isFinite(a)&&Number.isFinite(h)),g0(n,[i,a,h,1])}function Sx(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,Vn.Z)(e,3),a=i[0],s=i[1],h=i[2];if(Up(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(h)){var m=g0(n,[a,s,h,1]);return m}var y=g0(n,[a,s,0,1]),E=g0(n,[a,s,1,1]),w=y[2],I=E[2],k=w===I?0:((r||0)-w)/(I-w);return NE([],y,E,k)}var Cx=bv(),R3=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,i=n.height,a=n.viewMatrix,s=a===void 0?Cx:a,h=n.projectionMatrix,m=h===void 0?Cx:h;(0,Bt.Z)(this,e),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=m;var y=bv();rr(y,y,this.projectionMatrix),rr(y,y,this.viewMatrix),this.viewProjectionMatrix=y;var E=bv();Nr(E,E,[this.width/2,-this.height/2,1]),fn(E,E,[1,-1,0]),rr(E,E,this.viewProjectionMatrix);var w=Gr(bv(),E);if(!w)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=w,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Yt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Se(r.projectionMatrix,this.projectionMatrix)&&Se(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.topLeft,s=a===void 0?!0:a,h=this.projectPosition(r),m=O3(h,this.pixelProjectionMatrix),y=(0,Vn.Z)(m,2),E=y[0],w=y[1],I=s?w:this.height-w;return r.length===2?[E,I]:[E,I,m[2]]}},{key:"unproject",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.topLeft,s=a===void 0?!0:a,h=i.targetZ,m=(0,Vn.Z)(r,3),y=m[0],E=m[1],w=m[2],I=s?E:this.height-E,k=h&&h*this.pixelsPerMeter,D=Sx([y,I,w],this.pixelUnprojectionMatrix,k),W=this.unprojectPosition(D),J=(0,Vn.Z)(W,3),ie=J[0],Oe=J[1],qe=J[2];return Number.isFinite(w)?[ie,Oe,qe]:Number.isFinite(h)?[ie,Oe,h]:[ie,Oe]}},{key:"projectPosition",value:function(r){var i=this.projectFlat(r),a=(0,Vn.Z)(i,2),s=a[0],h=a[1],m=(r[2]||0)*this.pixelsPerMeter;return[s,h,m]}},{key:"unprojectPosition",value:function(r){var i=this.unprojectFlat(r),a=(0,Vn.Z)(i,2),s=a[0],h=a[1],m=(r[2]||0)/this.pixelsPerMeter;return[s,h,m]}},{key:"projectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function k3(e){var n=e.width,r=e.height,i=e.bounds,a=e.minExtent,s=a===void 0?0:a,h=e.maxZoom,m=h===void 0?24:h,y=e.padding,E=y===void 0?0:y,w=e.offset,I=w===void 0?[0,0]:w,k=(0,Vn.Z)(i,2),D=(0,Vn.Z)(k[0],2),W=D[0],J=D[1],ie=(0,Vn.Z)(k[1],2),Oe=ie[0],qe=ie[1];if(Number.isFinite(E)){var rt=E;E={top:rt,bottom:rt,left:rt,right:rt}}else Up(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var pt=new Ax({width:n,height:r,longitude:0,latitude:0,zoom:0}),kt=pt.project([W,qe]),zt=pt.project([Oe,J]),nr=[Math.max(Math.abs(zt[0]-kt[0]),s),Math.max(Math.abs(zt[1]-kt[1]),s)],dr=[n-E.left-E.right-Math.abs(I[0])*2,r-E.top-E.bottom-Math.abs(I[1])*2];Up(dr[0]>0&&dr[1]>0);var Zr=dr[0]/nr[0],un=dr[1]/nr[1],wr=(E.right-E.left)/2/Zr,Pn=(E.bottom-E.top)/2/un,Nn=[(zt[0]+kt[0])/2+wr,(zt[1]+kt[1])/2+Pn],pi=pt.unproject(Nn),co=pt.zoom+Math.log2(Math.abs(Math.min(Zr,un)));return{longitude:pi[0],latitude:pi[1],zoom:Math.min(co,m)}}var Ax=function(e){(0,bn.Z)(n,e);function n(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=i.width,s=i.height,h=i.latitude,m=h===void 0?0:h,y=i.longitude,E=y===void 0?0:y,w=i.zoom,I=w===void 0?0:w,k=i.pitch,D=k===void 0?0:k,W=i.bearing,J=W===void 0?0:W,ie=i.altitude,Oe=ie===void 0?1.5:ie,qe=i.nearZMultiplier,rt=i.farZMultiplier;(0,Bt.Z)(this,n),a=a||1,s=s||1;var pt=bx(I);Oe=Math.max(.75,Oe);var kt=y0([E,m],pt);kt[2]=0;var zt=I3({width:a,height:s,pitch:D,bearing:J,altitude:Oe,nearZMultiplier:qe||1/s,farZMultiplier:rt||1.01}),nr=M3({height:s,center:kt,pitch:D,bearing:J,altitude:Oe,flipY:!0});return r=(0,Wr.Z)(this,(0,At.Z)(n).call(this,{width:a,height:s,viewMatrix:nr,projectionMatrix:zt})),r.latitude=m,r.longitude=E,r.zoom=I,r.pitch=D,r.bearing=J,r.altitude=Oe,r.scale=pt,r.center=kt,r.pixelsPerMeter=Ex((0,be.Z)((0,be.Z)(r))).pixelsPerMeter[2],Object.freeze((0,be.Z)((0,be.Z)(r))),r}return(0,Yt.Z)(n,[{key:"projectFlat",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return y0(i,a)}},{key:"unprojectFlat",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Em(i,a)}},{key:"getMapCenterByLngLatPosition",value:function(i){var a=i.lngLat,s=i.pos,h=Sx(s,this.pixelUnprojectionMatrix),m=y0(a,this.scale),y=Ec([],m,BE([],h)),E=Ec([],this.center,y);return Em(E,this.scale)}},{key:"getLocationAtPoint",value:function(i){var a=i.lngLat,s=i.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,h=this.height,m=k3(Object.assign({width:s,height:h,bounds:i},a)),y=m.longitude,E=m.latitude,w=m.zoom;return new n({width:s,height:h,longitude:y,latitude:E,zoom:w})}}]),n}(R3),L3=function(){function e(){(0,Bt.Z)(this,e),(0,A.Z)(this,"viewport",void 0)}return(0,Yt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var i=r.center,a=r.zoom,s=r.pitch,h=r.bearing,m=r.viewportHeight,y=r.viewportWidth;this.viewport=new Ax({width:y,height:m,longitude:i&&i[0],latitude:i&&i[1],zoom:a,pitch:s,bearing:h})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}}]),e}(),Tx={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},D3=["id","attributionControl","style","token","rotation","mapInstance"],Mx,Px,Ix,Ox,Rx,kx,_d,Lx,Dx,Fx,Bx;function Nx(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function F3(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Nx(Object(r),!0).forEach(function(i){(0,A.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nx(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function B3(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var a=n.head||n.getElementsByTagName("head")[0];if(!a){a=n.createElement("head");var s=n.body||n.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):n.documentElement.appendChild(a)}var h=n.createElement("style");return h.type="text/css",h.styleSheet?h.styleSheet.cssText=e:h.appendChild(n.createTextNode(e)),a.appendChild(h),h}}B3(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=xv();var zx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},N3=0,z3=12,Ux="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",U3=(Mx=(0,$r.b2)(),Px=(0,$r.f3)(Nt.MapConfig),Ix=(0,$r.f3)(Nt.IGlobalConfigService),Ox=(0,$r.f3)(Nt.ICoordinateSystemService),Rx=(0,$r.f3)(Nt.IEventEmitter),Mx(kx=(_d=function(){function e(){var n=this;(0,Bt.Z)(this,e),(0,A.Z)(this,"version",Dp.MAPBOX),(0,A.Z)(this,"map",void 0),(0,A.Z)(this,"dragging",!1),(0,A.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),qn(this,"config",Lx,this),qn(this,"configService",Dx,this),qn(this,"coordinateSystemService",Fx,this),qn(this,"eventEmitter",Bx,this),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"markerContainer",void 0),(0,A.Z)(this,"cameraChangedCallback",void 0),(0,A.Z)(this,"$mapContainer",void 0),(0,A.Z)(this,"handleCameraChanged",function(){var r=n.map.getCenter().wrap(),i=r.lat,a=r.lng;n.emit("mapchange"),n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[a,i],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0});var s=n.config.offsetZoom,h=s===void 0?z3:s;n.viewport.getZoom()>h?n.coordinateSystemService.setCoordinateSystem(Tn.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(Tn.LNGLAT),n.cameraChangedCallback(n.viewport)})}return(0,Yt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=ao("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,i){I2.indexOf(r)!==-1?this.eventEmitter.on(r,i):this.map.on(zx[r]||r,i)}},{key:"off",value:function(r,i){this.map.off(zx[r]||r,i)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,i){this.map.zoomIn(r,i)}},{key:"zoomOut",value:function(r,i){this.map.zoomOut(r,i)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,i){this.panTo([r,i])}},{key:"fitBounds",value:function(r,i){this.map.fitBounds(r,i)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,i){this.map.flyTo({zoom:r,center:i})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,h=a.y;return[s-i.x,h-i.y]}},{key:"lngLatToMercator",value:function(r,i){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),s=a.x,h=s===void 0?0:s,m=a.y,y=m===void 0?0:m,E=a.z,w=E===void 0?0:E;return{x:h,y,z:w}}},{key:"getModelMatrix",value:function(r,i,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},m=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),y=m.meterInMercatorCoordinateUnits(),E=gr();return fn(E,E,Sc(m.x-h.x,m.y-h.y,m.z||0-h.z)),Nr(E,E,Sc(y*s[0],-y*s[1],y*s[2])),Ur(E,E,a[0]),Xr(E,E,a[1]),mi(E,E,a[2]),E}},{key:"init",value:function(){var n=(0,ro.Z)(Hi().mark(function i(){var a=this,s,h,m,y,E,w,I,k,D,W,J,ie,Oe;return Hi().wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:s=this.config,h=s.id,m=h===void 0?"map":h,y=s.attributionControl,E=y===void 0?!1:y,w=s.style,I=w===void 0?"light":w,k=s.token,D=k===void 0?Ux:k,W=s.rotation,J=W===void 0?0:W,ie=s.mapInstance,Oe=(0,wl.Z)(s,D3),this.viewport=new L3,!ie&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),D===Ux&&I!=="blank"&&!window.mapboxgl.accessToken&&!ie&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ie&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=D),ie?(this.map=ie,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(m),this.map=new window.mapboxgl.Map(F3({container:this.$mapContainer,style:this.getMapStyle(I),attributionControl:E,bearing:J},Oe))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return a.dragging=!0,""}),this.map.on("dragend",function(){return a.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return rt.stop()}},i,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,i;(r=this.$mapContainer)===null||r===void 0||(i=r.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var i,a=arguments.length,s=new Array(a>1?a-1:0),h=1;h<a;h++)s[h-1]=arguments[h];(i=this.eventEmitter).emit.apply(i,[r].concat(s))}},{key:"once",value:function(r){for(var i,a=arguments.length,s=new Array(a>1?a-1:0),h=1;h<a;h++)s[h-1]=arguments[h];(i=this.eventEmitter).once.apply(i,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,i){var a=new(xv()).LngLat(r[0],r[1]),s=new(xv()).LngLat(i[0],i[1]),h=a.distanceTo(s),m=xv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),y=xv().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),E=m.x,w=m.y,I=y.x,k=y.y,D=Math.sqrt(Math.pow(E-I,2)+Math.pow(w-k,2))*4194304*2;return D/h}},{key:"exportMap",value:function(r){var i=this.map.getCanvas(),a=r==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var i=r;typeof r=="string"&&(i=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+N3++,i.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:Tx[r]?Tx[r]:r}}]),e}(),Lx=ci(_d.prototype,"config",[Px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dx=ci(_d.prototype,"configService",[Ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fx=ci(_d.prototype,"coordinateSystemService",[Ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bx=ci(_d.prototype,"eventEmitter",[Rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||kx);function Z3(e){var n=V3();return function(){var i=(0,At.Z)(e),a;if(n){var s=(0,At.Z)(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return(0,Wr.Z)(this,a)}}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function j3(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var a=n.head||n.getElementsByTagName("head")[0];if(!a){a=n.createElement("head");var s=n.body||n.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):n.documentElement.appendChild(a)}var h=n.createElement("style");return h.type="text/css",h.styleSheet?h.styleSheet.cssText=e:h.appendChild(n.createTextNode(e)),a.appendChild(h),h}}j3(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var G3=function(e){(0,bn.Z)(r,e);var n=Z3(r);function r(){return(0,Bt.Z)(this,r),n.apply(this,arguments)}return(0,Yt.Z)(r,[{key:"getServiceConstructor",value:function(){return U3}}]),r}(C3);function Zx(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Vx(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zx(Object(r),!0).forEach(function(i){H3(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zx(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function H3(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function W3(e,n){return K3(e)||q3(e,n)||Y3(e,n)||X3()}function X3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Y3(e,n){if(!!e){if(typeof e=="string")return jx(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jx(e,n)}}function jx(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function q3(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(i.push(h.value),!(n&&i.length===n));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return i}}function K3(e){if(Array.isArray(e))return e}var $3=v.memo(function(e){var n=e.style,r=e.className,i=e.map,a=e.option,s=e.onSceneLoaded,h=(0,v.createRef)(),m=(0,v.useState)(),y=W3(m,2),E=y[0],w=y[1];return(0,v.useEffect)(function(){var I=new mE(Vx(Vx({id:h.current},a),{},{map:new G3(i)}));return I.on("loaded",function(){w(I),s&&s(I)}),function(){I.destroy()}},[]),(0,v.useEffect)(function(){E&&i.style&&E.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,v.useEffect)(function(){E&&i.zoom&&E.setZoom(i.zoom)},[i.zoom]),(0,v.useEffect)(function(){E&&i.center&&E.setCenter(i.center)},[JSON.stringify(i.center)]),(0,v.useEffect)(function(){E&&i.pitch!==void 0&&E.setPitch(i.pitch||0)},[i.pitch]),(0,v.useEffect)(function(){E&&i.rotation&&E.setRotation(i.rotation)},[i.rotation]),v.createElement(de.Provider,{value:E},(0,v.createElement)("div",{ref:h,style:n,className:r},E&&e.children))}),Q3=$3;function Gx(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function vO(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Gx(Object(r),!0).forEach(function(i){J3(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gx(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function J3(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function mO(e,n){return nP(e)||rP(e,n)||tP(e,n)||eP()}function eP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tP(e,n){if(!!e){if(typeof e=="string")return Hx(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hx(e,n)}}function Hx(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function rP(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(i.push(h.value),!(n&&i.length===n));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return i}}function nP(e){if(Array.isArray(e))return e}var gO=null,yO=null;function Wx(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function _O(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Wx(Object(r),!0).forEach(function(i){iP(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wx(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function iP(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function xO(e,n){return uP(e)||sP(e,n)||oP(e,n)||aP()}function aP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oP(e,n){if(!!e){if(typeof e=="string")return Xx(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xx(e,n)}}function Xx(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function sP(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(i.push(h.value),!(n&&i.length===n));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return i}}function uP(e){if(Array.isArray(e))return e}var bO=null,EO=null;function SO(e,n){return hP(e)||fP(e,n)||cP(e,n)||lP()}function lP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cP(e,n){if(!!e){if(typeof e=="string")return Yx(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yx(e,n)}}function Yx(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function fP(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(i.push(h.value),!(n&&i.length===n));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return i}}function hP(e){if(Array.isArray(e))return e}var CO=null,wO=null;function qx(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function AO(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?qx(Object(r),!0).forEach(function(i){pP(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qx(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function pP(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function TO(e,n){if(e==null)return{};var r=dP(e,n),i,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)i=s[a],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function dP(e,n){if(e==null)return{};var r={},i=Object.keys(e),a,s;for(s=0;s<i.length;s++)a=i[s],!(n.indexOf(a)>=0)&&(r[a]=e[a]);return r}var MO=null,Kx=V(73935);function $x(e,n){return yP(e)||gP(e,n)||mP(e,n)||vP()}function vP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mP(e,n){if(!!e){if(typeof e=="string")return Qx(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qx(e,n)}}function Qx(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function gP(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(i.push(h.value),!(n&&i.length===n));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return i}}function yP(e){if(Array.isArray(e))return e}var Jx=v.useEffect,eb=v.useState,_P=/\B([A-Z])/g,xP=function(n){return n.replace(_P,"-$1").toLowerCase()};function PO(e){var n=e.className,r=e.style,i=e.children,a=e.position,s=eb(),h=$x(s,2),m=h[0],y=h[1],E=useSceneValue(),w=eb(function(){return document.createElement("div")}),I=$x(w,1),k=I[0];return Jx(function(){var D=new Control({position:a});return D.onAdd=function(){if(n&&(k.className=n),r){var W=Object.keys(r).map(function(J){return"".concat(xP(J),":").concat(r[J])}).join(";");k.style.cssText=W}return k},D.onRemove=function(){},y(D),E.addControl(D),function(){E.removeControl(D)}},[]),Jx(function(){m&&m.setPosition(a||"bottomleft")},[a]),createPortal(i,k)}var tb=(0,v.createContext)({});function IO(){return useContext(tb)}var Rf=V(96486),OO=v.useEffect,bP=v.memo(function(n){var r=n.layer,i=n.active;return r.active(i.option),null},Rf.isEqual),RO=v.useEffect,EP=v.memo(function(n){var r=n.layer,i=n.animate;return r.animate(i),null},Rf.isEqual),kO=v.useEffect,SP=v.memo(function(n){var r=n.layer,i=n.color;return i.field?r.color(i.field,i.values):r.color(i.values),null},Rf.isEqual),CP=v.memo(function(n){var r=n.layer,i=n.filter;return i.field&&r.filter(i.field,i.values),null},Rf.isEqual),wP=v.memo(function(n){var r=n.layer,i=n.scale;return r.scale(i.values),null},Rf.isEqual),LO=v.useEffect,AP=v.memo(function(n){var r=n.layer,i=n.select;return r.select(i.option),null},Rf.isEqual),TP=v.memo(function(n){var r=n.layer,i=n.shape;return i.field?r.shape(i.field,i.values):r.shape(i.values),null},Rf.isEqual),MP=v.memo(function(n){var r=n.layer,i=n.size;return i.field?r.size(i.field,i.values):r.size(i.values),null},Rf.isEqual),PP=["data"];function IP(e,n){if(e==null)return{};var r=OP(e,n),i,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)i=s[a],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function OP(e,n){if(e==null)return{};var r={},i=Object.keys(e),a,s;for(s=0;s<i.length;s++)a=i[s],!(n.indexOf(a)>=0)&&(r[a]=e[a]);return r}var RP=v.memo(function(n){var r=n.layer,i=n.source,a=i.data,s=IP(i,PP);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Rf.isEqual),DO=v.useEffect,kP=v.memo(function(n){var r=n.layer,i=n.style;return r.style(i),null},Rf.isEqual);function LP(e,n){return NP(e)||BP(e,n)||FP(e,n)||DP()}function DP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FP(e,n){if(!!e){if(typeof e=="string")return rb(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rb(e,n)}}function rb(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function BP(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(i.push(h.value),!(n&&i.length===n));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return i}}function NP(e){if(Array.isArray(e))return e}var Ev=v.useEffect,zP=v.useState;function UP(e,n){var r=n.source,i=n.color,a=n.shape,s=n.style,h=n.size,m=n.scale,y=n.active,E=n.select,w=n.filter,I=n.animate,k=n.options,D=n.onLayerLoaded,W=U(),J=zP(function(){var qe;switch(e){case"polygonLayer":qe=new t_(k);break;case"lineLayer":qe=new fw(k);break;case"pointLayer":qe=new iA(k);break;case"heatmapLayer":qe=new hC(k);break;case"rasterLayer":qe=new OA(k);break;case"imageLayer":qe=new EC(k);break;case"citybuildingLayer":qe=new BS(k);break;default:qe=new t_(k)}return qe.on("inited",function(){D&&D(qe,W)}),qe}),ie=LP(J,1),Oe=ie[0];return Ev(function(){return W.addLayer(Oe),function(){W.removeLayer(Oe)}},[]),Ev(function(){Oe.inited&&k&&Oe.updateLayerConfig(k)},[k==null?void 0:k.minZoom,k==null?void 0:k.maxZoom,k==null?void 0:k.visible]),Ev(function(){Oe.inited&&(k==null?void 0:k.zIndex)&&Oe.setIndex(k.zIndex)},[k==null?void 0:k.zIndex]),Ev(function(){Oe.inited&&(k==null?void 0:k.blend)&&Oe.setBlend(k.blend)},[k==null?void 0:k.blend]),Ev(function(){W.render()}),v.createElement(tb.Provider,{value:Oe},v.createElement(RP,{layer:Oe,source:r}),m&&v.createElement(wP,{layer:Oe,scale:m}),i&&v.createElement(SP,{layer:Oe,color:i}),h&&v.createElement(MP,{layer:Oe,size:h}),a&&v.createElement(TP,{layer:Oe,shape:a}),s&&v.createElement(kP,{layer:Oe,style:s}),y&&v.createElement(bP,{layer:Oe,active:y}),E&&v.createElement(AP,{layer:Oe,select:E}),w&&v.createElement(CP,{layer:Oe,filter:w}),I&&v.createElement(EP,{layer:Oe,animate:I}),n.children)}var FO=null,ZP=v.memo(function(n){return UP("lineLayer",n)}),BO=null,NO=null,zO=null,UO=null,ZO=null,VO=v.useEffect,jO=null,GO=null;function _0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_0=function(r){return typeof r}:_0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},_0(e)}function nb(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function x0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?nb(Object(r),!0).forEach(function(i){VP(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nb(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function VP(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function jP(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function ib(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function GP(e,n,r){return n&&ib(e.prototype,n),r&&ib(e,r),e}function HP(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&Sm(e,n)}function Sm(e,n){return Sm=Object.setPrototypeOf||function(i,a){return i.__proto__=a,i},Sm(e,n)}function WP(e){var n=qP();return function(){var i=b0(e),a;if(n){var s=b0(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return XP(this,a)}}function XP(e,n){if(n&&(_0(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return YP(e)}function YP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function b0(e){return b0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},b0(e)}var HO=function(e){HP(r,e);var n=WP(r);function r(i){var a;return jP(this,r),a=n.call(this,i),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return GP(r,[{key:"componentDidMount",value:function(){var a,s=this.props,h=s.lnglat,m=s.children,y=s.option,E=s.lngLat,w=new Fg(x0(x0({},y),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));h&&w.setLnglat(h),E&&w.setLnglat(E),m&&w.setDOMContent(this.el),this.popup=w,this.scene.addPopup(w)}},{key:"componentDidUpdate",value:function(a){var s,h,m,y,E,w,I=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(h=a.lnglat)===null||h===void 0?void 0:h.lat],k=Array.isArray(this.props.lnglat)?this.props.lnglat:[(m=this.props)===null||m===void 0||(y=m.lnglat)===null||y===void 0?void 0:y.lng,(E=this.props)===null||E===void 0||(w=E.lnglat)===null||w===void 0?void 0:w.lat],D=I.toString()!==k.toString();if(D){var W;this.popup.remove(),this.popup=new Fg(x0(x0({},this.props.option),{},{stopPropagation:(W=this.props.option)===null||W===void 0?void 0:W.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return v.createElement(de.Consumer,{},function(s){return s&&(a.scene=s),(0,Kx.createPortal)(a.props.children,a.el)})}}]),r}(v.PureComponent);function E0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?E0=function(r){return typeof r}:E0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},E0(e)}function KP(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function ab(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function $P(e,n,r){return n&&ab(e.prototype,n),r&&ab(e,r),e}function QP(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&Cm(e,n)}function Cm(e,n){return Cm=Object.setPrototypeOf||function(i,a){return i.__proto__=a,i},Cm(e,n)}function JP(e){var n=r5();return function(){var i=S0(e),a;if(n){var s=S0(this).constructor;a=Reflect.construct(i,arguments,s)}else a=i.apply(this,arguments);return e5(this,a)}}function e5(e,n){if(n&&(E0(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return t5(e)}function t5(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function S0(e){return S0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},S0(e)}var WO=function(e){QP(r,e);var n=JP(r);function r(i){var a;return KP(this,r),a=n.call(this,i),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return $P(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,h=a.children,m=a.option,y=a.onMarkerLoaded,E=new Og(m);s&&E.setLnglat(s),h&&E.setElement(this.el),this.marker=E,y&&y(E),this.scene.addMarker(E)}},{key:"componentDidUpdate",value:function(a){var s,h=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());h&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return v.createElement(de.Consumer,{},function(s){return s&&(a.scene=s),(0,Kx.createPortal)(a.props.children,a.el)})}}]),r}(v.PureComponent),XO=v.useEffect,YO=null,qO=null,KO=v.useEffect,$O=null},31795:function(It,$,V){var ce=V(75752);It.exports.geometry=pe,It.exports.ring=de;function pe(te){var se=0,Re;switch(te.type){case"Polygon":return v(te.coordinates);case"MultiPolygon":for(Re=0;Re<te.coordinates.length;Re++)se+=v(te.coordinates[Re]);return se;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Re=0;Re<te.geometries.length;Re++)se+=pe(te.geometries[Re]);return se}}function v(te){var se=0;if(te&&te.length>0){se+=Math.abs(de(te[0]));for(var Re=1;Re<te.length;Re++)se-=Math.abs(de(te[Re]))}return se}function de(te){var se,Re,he,$e,tt,gt,Jt,ir=0,yt=te.length;if(yt>2){for(Jt=0;Jt<yt;Jt++)Jt===yt-2?($e=yt-2,tt=yt-1,gt=0):Jt===yt-1?($e=yt-1,tt=0,gt=1):($e=Jt,tt=Jt+1,gt=Jt+2),se=te[$e],Re=te[tt],he=te[gt],ir+=(U(he[0])-U(se[0]))*Math.sin(U(Re[1]));ir=ir*ce.RADIUS*ce.RADIUS/2}return ir}function U(te){return te*Math.PI/180}},38163:function(It,$,V){var ce=V(31795);It.exports=pe;function pe(Re,he){switch(Re&&Re.type||null){case"FeatureCollection":return Re.features=Re.features.map(v(pe,he)),Re;case"GeometryCollection":return Re.geometries=Re.geometries.map(v(pe,he)),Re;case"Feature":return Re.geometry=pe(Re.geometry,he),Re;case"Polygon":case"MultiPolygon":return de(Re,he);default:return Re}}function v(Re,he){return function($e){return Re($e,he)}}function de(Re,he){return Re.type==="Polygon"?Re.coordinates=U(Re.coordinates,he):Re.type==="MultiPolygon"&&(Re.coordinates=Re.coordinates.map(v(U,he))),Re}function U(Re,he){he=!!he,Re[0]=te(Re[0],he);for(var $e=1;$e<Re.length;$e++)Re[$e]=te(Re[$e],!he);return Re}function te(Re,he){return se(Re)===he?Re:Re.reverse()}function se(Re){return ce.ring(Re)>=0}},53645:function(){},9187:function(It){"use strict";It.exports=$,It.exports.default=$;function $(Me,A,_e){_e=_e||2;var Et=A&&A.length,dt=Et?A[0]*_e:Me.length,Ft=V(Me,0,dt,_e,!0),qt=[];if(!Ft||Ft.next===Ft.prev)return qt;var Sr,Qn,gn,ea,wn,ii,Si;if(Et&&(Ft=se(Me,A,Ft,_e)),Me.length>80*_e){Sr=gn=Me[0],Qn=ea=Me[1];for(var si=_e;si<dt;si+=_e)wn=Me[si],ii=Me[si+1],wn<Sr&&(Sr=wn),ii<Qn&&(Qn=ii),wn>gn&&(gn=wn),ii>ea&&(ea=ii);Si=Math.max(gn-Sr,ea-Qn),Si=Si!==0?1/Si:0}return pe(Ft,qt,_e,Sr,Qn,Si),qt}function V(Me,A,_e,Et,dt){var Ft,qt;if(dt===Kr(Me,A,_e,Et)>0)for(Ft=A;Ft<_e;Ft+=Et)qt=Ut(Ft,Me[Ft],Me[Ft+1],qt);else for(Ft=_e-Et;Ft>=A;Ft-=Et)qt=Ut(Ft,Me[Ft],Me[Ft+1],qt);return qt&&ht(qt,qt.next)&&(xr(qt),qt=qt.next),qt}function ce(Me,A){if(!Me)return Me;A||(A=Me);var _e=Me,Et;do if(Et=!1,!_e.steiner&&(ht(_e,_e.next)||st(_e.prev,_e,_e.next)===0)){if(xr(_e),_e=A=_e.prev,_e===_e.next)break;Et=!0}else _e=_e.next;while(Et||_e!==A);return A}function pe(Me,A,_e,Et,dt,Ft,qt){if(!!Me){!qt&&Ft&&gt(Me,Et,dt,Ft);for(var Sr=Me,Qn,gn;Me.prev!==Me.next;){if(Qn=Me.prev,gn=Me.next,Ft?de(Me,Et,dt,Ft):v(Me)){A.push(Qn.i/_e),A.push(Me.i/_e),A.push(gn.i/_e),xr(Me),Me=gn.next,Sr=gn.next;continue}if(Me=gn,Me===Sr){qt?qt===1?(Me=U(ce(Me),A,_e),pe(Me,A,_e,Et,dt,Ft,2)):qt===2&&te(Me,A,_e,Et,dt,Ft):pe(ce(Me),A,_e,Et,dt,Ft,1);break}}}}function v(Me){var A=Me.prev,_e=Me,Et=Me.next;if(st(A,_e,Et)>=0)return!1;for(var dt=Me.next.next;dt!==Me.prev;){if(Qt(A.x,A.y,_e.x,_e.y,Et.x,Et.y,dt.x,dt.y)&&st(dt.prev,dt,dt.next)>=0)return!1;dt=dt.next}return!0}function de(Me,A,_e,Et){var dt=Me.prev,Ft=Me,qt=Me.next;if(st(dt,Ft,qt)>=0)return!1;for(var Sr=dt.x<Ft.x?dt.x<qt.x?dt.x:qt.x:Ft.x<qt.x?Ft.x:qt.x,Qn=dt.y<Ft.y?dt.y<qt.y?dt.y:qt.y:Ft.y<qt.y?Ft.y:qt.y,gn=dt.x>Ft.x?dt.x>qt.x?dt.x:qt.x:Ft.x>qt.x?Ft.x:qt.x,ea=dt.y>Ft.y?dt.y>qt.y?dt.y:qt.y:Ft.y>qt.y?Ft.y:qt.y,wn=ir(Sr,Qn,A,_e,Et),ii=ir(gn,ea,A,_e,Et),Si=Me.prevZ,si=Me.nextZ;Si&&Si.z>=wn&&si&&si.z<=ii;){if(Si!==Me.prev&&Si!==Me.next&&Qt(dt.x,dt.y,Ft.x,Ft.y,qt.x,qt.y,Si.x,Si.y)&&st(Si.prev,Si,Si.next)>=0||(Si=Si.prevZ,si!==Me.prev&&si!==Me.next&&Qt(dt.x,dt.y,Ft.x,Ft.y,qt.x,qt.y,si.x,si.y)&&st(si.prev,si,si.next)>=0))return!1;si=si.nextZ}for(;Si&&Si.z>=wn;){if(Si!==Me.prev&&Si!==Me.next&&Qt(dt.x,dt.y,Ft.x,Ft.y,qt.x,qt.y,Si.x,Si.y)&&st(Si.prev,Si,Si.next)>=0)return!1;Si=Si.prevZ}for(;si&&si.z<=ii;){if(si!==Me.prev&&si!==Me.next&&Qt(dt.x,dt.y,Ft.x,Ft.y,qt.x,qt.y,si.x,si.y)&&st(si.prev,si,si.next)>=0)return!1;si=si.nextZ}return!0}function U(Me,A,_e){var Et=Me;do{var dt=Et.prev,Ft=Et.next.next;!ht(dt,Ft)&&Wt(dt,Et,Et.next,Ft)&&He(dt,Ft)&&He(Ft,dt)&&(A.push(dt.i/_e),A.push(Et.i/_e),A.push(Ft.i/_e),xr(Et),xr(Et.next),Et=Me=Ft),Et=Et.next}while(Et!==Me);return ce(Et)}function te(Me,A,_e,Et,dt,Ft){var qt=Me;do{for(var Sr=qt.next.next;Sr!==qt.prev;){if(qt.i!==Sr.i&&Ct(qt,Sr)){var Qn=Qe(qt,Sr);qt=ce(qt,qt.next),Qn=ce(Qn,Qn.next),pe(qt,A,_e,Et,dt,Ft),pe(Qn,A,_e,Et,dt,Ft);return}Sr=Sr.next}qt=qt.next}while(qt!==Me)}function se(Me,A,_e,Et){var dt=[],Ft,qt,Sr,Qn,gn;for(Ft=0,qt=A.length;Ft<qt;Ft++)Sr=A[Ft]*Et,Qn=Ft<qt-1?A[Ft+1]*Et:Me.length,gn=V(Me,Sr,Qn,Et,!1),gn===gn.next&&(gn.steiner=!0),dt.push(yt(gn));for(dt.sort(Re),Ft=0;Ft<dt.length;Ft++)_e=he(dt[Ft],_e),_e=ce(_e,_e.next);return _e}function Re(Me,A){return Me.x-A.x}function he(Me,A){var _e=$e(Me,A);if(!_e)return A;var Et=Qe(_e,Me),dt=ce(_e,_e.next);return ce(Et,Et.next),A===_e?dt:A}function $e(Me,A){var _e=A,Et=Me.x,dt=Me.y,Ft=-Infinity,qt;do{if(dt<=_e.y&&dt>=_e.next.y&&_e.next.y!==_e.y){var Sr=_e.x+(dt-_e.y)*(_e.next.x-_e.x)/(_e.next.y-_e.y);if(Sr<=Et&&Sr>Ft){if(Ft=Sr,Sr===Et){if(dt===_e.y)return _e;if(dt===_e.next.y)return _e.next}qt=_e.x<_e.next.x?_e:_e.next}}_e=_e.next}while(_e!==A);if(!qt)return null;if(Et===Ft)return qt;var Qn=qt,gn=qt.x,ea=qt.y,wn=Infinity,ii;_e=qt;do Et>=_e.x&&_e.x>=gn&&Et!==_e.x&&Qt(dt<ea?Et:Ft,dt,gn,ea,dt<ea?Ft:Et,dt,_e.x,_e.y)&&(ii=Math.abs(dt-_e.y)/(Et-_e.x),He(_e,Me)&&(ii<wn||ii===wn&&(_e.x>qt.x||_e.x===qt.x&&tt(qt,_e)))&&(qt=_e,wn=ii)),_e=_e.next;while(_e!==Qn);return qt}function tt(Me,A){return st(Me.prev,Me,A.prev)<0&&st(A.next,Me,Me.next)<0}function gt(Me,A,_e,Et){var dt=Me;do dt.z===null&&(dt.z=ir(dt.x,dt.y,A,_e,Et)),dt.prevZ=dt.prev,dt.nextZ=dt.next,dt=dt.next;while(dt!==Me);dt.prevZ.nextZ=null,dt.prevZ=null,Jt(dt)}function Jt(Me){var A,_e,Et,dt,Ft,qt,Sr,Qn,gn=1;do{for(_e=Me,Me=null,Ft=null,qt=0;_e;){for(qt++,Et=_e,Sr=0,A=0;A<gn&&(Sr++,Et=Et.nextZ,!!Et);A++);for(Qn=gn;Sr>0||Qn>0&&Et;)Sr!==0&&(Qn===0||!Et||_e.z<=Et.z)?(dt=_e,_e=_e.nextZ,Sr--):(dt=Et,Et=Et.nextZ,Qn--),Ft?Ft.nextZ=dt:Me=dt,dt.prevZ=Ft,Ft=dt;_e=Et}Ft.nextZ=null,gn*=2}while(qt>1);return Me}function ir(Me,A,_e,Et,dt){return Me=32767*(Me-_e)*dt,A=32767*(A-Et)*dt,Me=(Me|Me<<8)&16711935,Me=(Me|Me<<4)&252645135,Me=(Me|Me<<2)&858993459,Me=(Me|Me<<1)&1431655765,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,Me|A<<1}function yt(Me){var A=Me,_e=Me;do(A.x<_e.x||A.x===_e.x&&A.y<_e.y)&&(_e=A),A=A.next;while(A!==Me);return _e}function Qt(Me,A,_e,Et,dt,Ft,qt,Sr){return(dt-qt)*(A-Sr)-(Me-qt)*(Ft-Sr)>=0&&(Me-qt)*(Et-Sr)-(_e-qt)*(A-Sr)>=0&&(_e-qt)*(Ft-Sr)-(dt-qt)*(Et-Sr)>=0}function Ct(Me,A){return Me.next.i!==A.i&&Me.prev.i!==A.i&&!ft(Me,A)&&(He(Me,A)&&He(A,Me)&&lt(Me,A)&&(st(Me.prev,Me,A.prev)||st(Me,A.prev,A))||ht(Me,A)&&st(Me.prev,Me,Me.next)>0&&st(A.prev,A,A.next)>0)}function st(Me,A,_e){return(A.y-Me.y)*(_e.x-A.x)-(A.x-Me.x)*(_e.y-A.y)}function ht(Me,A){return Me.x===A.x&&Me.y===A.y}function Wt(Me,A,_e,Et){var dt=Xt(st(Me,A,_e)),Ft=Xt(st(Me,A,Et)),qt=Xt(st(_e,Et,Me)),Sr=Xt(st(_e,Et,A));return!!(dt!==Ft&&qt!==Sr||dt===0&&X(Me,_e,A)||Ft===0&&X(Me,Et,A)||qt===0&&X(_e,Me,Et)||Sr===0&&X(_e,A,Et))}function X(Me,A,_e){return A.x<=Math.max(Me.x,_e.x)&&A.x>=Math.min(Me.x,_e.x)&&A.y<=Math.max(Me.y,_e.y)&&A.y>=Math.min(Me.y,_e.y)}function Xt(Me){return Me>0?1:Me<0?-1:0}function ft(Me,A){var _e=Me;do{if(_e.i!==Me.i&&_e.next.i!==Me.i&&_e.i!==A.i&&_e.next.i!==A.i&&Wt(_e,_e.next,Me,A))return!0;_e=_e.next}while(_e!==Me);return!1}function He(Me,A){return st(Me.prev,Me,Me.next)<0?st(Me,A,Me.next)>=0&&st(Me,Me.prev,A)>=0:st(Me,A,Me.prev)<0||st(Me,Me.next,A)<0}function lt(Me,A){var _e=Me,Et=!1,dt=(Me.x+A.x)/2,Ft=(Me.y+A.y)/2;do _e.y>Ft!=_e.next.y>Ft&&_e.next.y!==_e.y&&dt<(_e.next.x-_e.x)*(Ft-_e.y)/(_e.next.y-_e.y)+_e.x&&(Et=!Et),_e=_e.next;while(_e!==Me);return Et}function Qe(Me,A){var _e=new Dr(Me.i,Me.x,Me.y),Et=new Dr(A.i,A.x,A.y),dt=Me.next,Ft=A.prev;return Me.next=A,A.prev=Me,_e.next=dt,dt.prev=_e,Et.next=_e,_e.prev=Et,Ft.next=Et,Et.prev=Ft,Et}function Ut(Me,A,_e,Et){var dt=new Dr(Me,A,_e);return Et?(dt.next=Et.next,dt.prev=Et,Et.next.prev=dt,Et.next=dt):(dt.prev=dt,dt.next=dt),dt}function xr(Me){Me.next.prev=Me.prev,Me.prev.next=Me.next,Me.prevZ&&(Me.prevZ.nextZ=Me.nextZ),Me.nextZ&&(Me.nextZ.prevZ=Me.prevZ)}function Dr(Me,A,_e){this.i=Me,this.x=A,this.y=_e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}$.deviation=function(Me,A,_e,Et){var dt=A&&A.length,Ft=dt?A[0]*_e:Me.length,qt=Math.abs(Kr(Me,0,Ft,_e));if(dt)for(var Sr=0,Qn=A.length;Sr<Qn;Sr++){var gn=A[Sr]*_e,ea=Sr<Qn-1?A[Sr+1]*_e:Me.length;qt-=Math.abs(Kr(Me,gn,ea,_e))}var wn=0;for(Sr=0;Sr<Et.length;Sr+=3){var ii=Et[Sr]*_e,Si=Et[Sr+1]*_e,si=Et[Sr+2]*_e;wn+=Math.abs((Me[ii]-Me[si])*(Me[Si+1]-Me[ii+1])-(Me[ii]-Me[Si])*(Me[si+1]-Me[ii+1]))}return qt===0&&wn===0?0:Math.abs((wn-qt)/qt)};function Kr(Me,A,_e,Et){for(var dt=0,Ft=A,qt=_e-Et;Ft<_e;Ft+=Et)dt+=(Me[qt]-Me[Ft])*(Me[Ft+1]+Me[qt+1]),qt=Ft;return dt}$.flatten=function(Me){for(var A=Me[0][0].length,_e={vertices:[],holes:[],dimensions:A},Et=0,dt=0;dt<Me.length;dt++){for(var Ft=0;Ft<Me[dt].length;Ft++)for(var qt=0;qt<A;qt++)_e.vertices.push(Me[dt][Ft][qt]);dt>0&&(Et+=Me[dt-1].length,_e.holes.push(Et))}return _e}},67709:function(It){function $(ce){var pe=ce.target||ce.srcElement;pe.__resizeRAF__&&cancelAnimationFrame(pe.__resizeRAF__),pe.__resizeRAF__=requestAnimationFrame(function(){var v=pe.__resizeTrigger__,de=v&&v.__resizeListeners__;de&&de.forEach(function(U){U.call(v,ce)})})}var V=function(pe,v){var de=this,U=de.document,te,se=U.attachEvent;typeof navigator!="undefined"&&(te=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Re(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",$)}if(!pe.__resizeListeners__)if(pe.__resizeListeners__=[],se)pe.__resizeTrigger__=pe,pe.attachEvent("onresize",$);else{getComputedStyle(pe).position==="static"&&(pe.style.position="relative");var he=pe.__resizeTrigger__=U.createElement("object");he.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),he.setAttribute("class","resize-sensor"),he.setAttribute("tabindex","-1"),he.setAttribute("title",""),he.__resizeElement__=pe,he.onload=Re,he.type="text/html",te&&pe.appendChild(he),he.data="about:blank",te||pe.appendChild(he)}pe.__resizeListeners__.push(v)};It.exports=typeof window=="undefined"?V:V.bind(window),It.exports.unbind=function(ce,pe){var v=document.attachEvent,de=ce.__resizeListeners__||[];if(pe){var U=de.indexOf(pe);U!==-1&&de.splice(U,1)}else de=ce.__resizeListeners__=[];if(!de.length){if(v)ce.detachEvent("onresize",$);else if(ce.__resizeTrigger__){var te=ce.__resizeTrigger__.contentDocument,se=te&&te.defaultView;se&&(se.removeEventListener("resize",$),delete se.__resizeTrigger__),ce.__resizeTrigger__=!ce.removeChild(ce.__resizeTrigger__)}delete ce.__resizeListeners__}}},26729:function(It){"use strict";var $=Object.prototype.hasOwnProperty,V="~";function ce(){}Object.create&&(ce.prototype=Object.create(null),new ce().__proto__||(V=!1));function pe(te,se,Re){this.fn=te,this.context=se,this.once=Re||!1}function v(te,se,Re,he,$e){if(typeof Re!="function")throw new TypeError("The listener must be a function");var tt=new pe(Re,he||te,$e),gt=V?V+se:se;return te._events[gt]?te._events[gt].fn?te._events[gt]=[te._events[gt],tt]:te._events[gt].push(tt):(te._events[gt]=tt,te._eventsCount++),te}function de(te,se){--te._eventsCount==0?te._events=new ce:delete te._events[se]}function U(){this._events=new ce,this._eventsCount=0}U.prototype.eventNames=function(){var se=[],Re,he;if(this._eventsCount===0)return se;for(he in Re=this._events)$.call(Re,he)&&se.push(V?he.slice(1):he);return Object.getOwnPropertySymbols?se.concat(Object.getOwnPropertySymbols(Re)):se},U.prototype.listeners=function(se){var Re=V?V+se:se,he=this._events[Re];if(!he)return[];if(he.fn)return[he.fn];for(var $e=0,tt=he.length,gt=new Array(tt);$e<tt;$e++)gt[$e]=he[$e].fn;return gt},U.prototype.listenerCount=function(se){var Re=V?V+se:se,he=this._events[Re];return he?he.fn?1:he.length:0},U.prototype.emit=function(se,Re,he,$e,tt,gt){var Jt=V?V+se:se;if(!this._events[Jt])return!1;var ir=this._events[Jt],yt=arguments.length,Qt,Ct;if(ir.fn){switch(ir.once&&this.removeListener(se,ir.fn,void 0,!0),yt){case 1:return ir.fn.call(ir.context),!0;case 2:return ir.fn.call(ir.context,Re),!0;case 3:return ir.fn.call(ir.context,Re,he),!0;case 4:return ir.fn.call(ir.context,Re,he,$e),!0;case 5:return ir.fn.call(ir.context,Re,he,$e,tt),!0;case 6:return ir.fn.call(ir.context,Re,he,$e,tt,gt),!0}for(Ct=1,Qt=new Array(yt-1);Ct<yt;Ct++)Qt[Ct-1]=arguments[Ct];ir.fn.apply(ir.context,Qt)}else{var st=ir.length,ht;for(Ct=0;Ct<st;Ct++)switch(ir[Ct].once&&this.removeListener(se,ir[Ct].fn,void 0,!0),yt){case 1:ir[Ct].fn.call(ir[Ct].context);break;case 2:ir[Ct].fn.call(ir[Ct].context,Re);break;case 3:ir[Ct].fn.call(ir[Ct].context,Re,he);break;case 4:ir[Ct].fn.call(ir[Ct].context,Re,he,$e);break;default:if(!Qt)for(ht=1,Qt=new Array(yt-1);ht<yt;ht++)Qt[ht-1]=arguments[ht];ir[Ct].fn.apply(ir[Ct].context,Qt)}}return!0},U.prototype.on=function(se,Re,he){return v(this,se,Re,he,!1)},U.prototype.once=function(se,Re,he){return v(this,se,Re,he,!0)},U.prototype.removeListener=function(se,Re,he,$e){var tt=V?V+se:se;if(!this._events[tt])return this;if(!Re)return de(this,tt),this;var gt=this._events[tt];if(gt.fn)gt.fn===Re&&(!$e||gt.once)&&(!he||gt.context===he)&&de(this,tt);else{for(var Jt=0,ir=[],yt=gt.length;Jt<yt;Jt++)(gt[Jt].fn!==Re||$e&&!gt[Jt].once||he&&gt[Jt].context!==he)&&ir.push(gt[Jt]);ir.length?this._events[tt]=ir.length===1?ir[0]:ir:de(this,tt)}return this},U.prototype.removeAllListeners=function(se){var Re;return se?(Re=V?V+se:se,this._events[Re]&&de(this,Re)):(this._events=new ce,this._eventsCount=0),this},U.prototype.off=U.prototype.removeListener,U.prototype.addListener=U.prototype.on,U.prefixed=V,U.EventEmitter=U,It.exports=U},7375:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0});var V=Symbol.for("INJECTION");function ce(te,se,Re,he){function $e(){return he&&!Reflect.hasMetadata(V,this,se)&&Reflect.defineMetadata(V,Re(),this,se),Reflect.hasMetadata(V,this,se)?Reflect.getMetadata(V,this,se):Re()}function tt(gt){Reflect.defineMetadata(V,gt,this,se)}Object.defineProperty(te,se,{configurable:!0,enumerable:!0,get:$e,set:tt})}function pe(te,se){return function(Re){return function(he,$e){var tt=function(){return te.get(Re)};ce(he,$e,tt,se)}}}$.makePropertyInjectDecorator=pe;function v(te,se){return function(Re,he){return function($e,tt){var gt=function(){return te.getNamed(Re,he)};ce($e,tt,gt,se)}}}$.makePropertyInjectNamedDecorator=v;function de(te,se){return function(Re,he,$e){return function(tt,gt){var Jt=function(){return te.getTagged(Re,he,$e)};ce(tt,gt,Jt,se)}}}$.makePropertyInjectTaggedDecorator=de;function U(te,se){return function(Re){return function(he,$e){var tt=function(){return te.getAll(Re)};ce(he,$e,tt,se)}}}$.makePropertyMultiInjectDecorator=U},84879:function(It,$,V){"use strict";var ce;ce={value:!0};var pe=V(7375);function v(de,U){U===void 0&&(U=!0);var te=pe.makePropertyInjectDecorator(de,U),se=pe.makePropertyInjectNamedDecorator(de,U),Re=pe.makePropertyInjectTaggedDecorator(de,U),he=pe.makePropertyMultiInjectDecorator(de,U);return{lazyInject:te,lazyInjectNamed:se,lazyInjectTagged:Re,lazyMultiInject:he}}$.Z=v},99934:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.tagProperty=$.tagParameter=$.decorate=void 0;var ce=V(16674),pe=V(6867);function v(he,$e,tt,gt){var Jt=pe.TAGGED;U(Jt,he,$e,gt,tt)}$.tagParameter=v;function de(he,$e,tt){var gt=pe.TAGGED_PROP;U(gt,he.constructor,$e,tt)}$.tagProperty=de;function U(he,$e,tt,gt,Jt){var ir={},yt=typeof Jt=="number",Qt=Jt!==void 0&&yt?Jt.toString():tt;if(yt&&tt!==void 0)throw new Error(ce.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(he,$e)&&(ir=Reflect.getMetadata(he,$e));var Ct=ir[Qt];if(!Array.isArray(Ct))Ct=[];else for(var st=0,ht=Ct;st<ht.length;st++){var Wt=ht[st];if(Wt.key===gt.key)throw new Error(ce.DUPLICATED_METADATA+" "+Wt.key.toString())}Ct.push(gt),ir[Qt]=Ct,Reflect.defineMetadata(he,ir,$e)}function te(he,$e){Reflect.decorate(he,$e)}function se(he,$e){return function(tt,gt){$e(tt,gt,he)}}function Re(he,$e,tt){typeof tt=="number"?te([se(tt,he)],$e):typeof tt=="string"?Reflect.decorate([he],$e,tt):te([he],$e)}$.decorate=Re},5744:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.inject=$.LazyServiceIdentifer=void 0;var ce=V(16674),pe=V(6867),v=V(47738),de=V(99934),U=function(){function se(Re){this._cb=Re}return se.prototype.unwrap=function(){return this._cb()},se}();$.LazyServiceIdentifer=U;function te(se){return function(Re,he,$e){if(se===void 0)throw new Error(ce.UNDEFINED_INJECT_ANNOTATION(Re.name));var tt=new v.Metadata(pe.INJECT_TAG,se);typeof $e=="number"?de.tagParameter(Re,he,$e,tt):de.tagProperty(Re,he,tt)}}$.inject=te},64315:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.injectable=void 0;var ce=V(16674),pe=V(6867);function v(){return function(de){if(Reflect.hasOwnMetadata(pe.PARAM_TYPES,de))throw new Error(ce.DUPLICATED_INJECTABLE_DECORATOR);var U=Reflect.getMetadata(pe.DESIGN_PARAM_TYPES,de)||[];return Reflect.defineMetadata(pe.PARAM_TYPES,U,de),de}}$.injectable=v},71693:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.multiInject=void 0;var ce=V(6867),pe=V(47738),v=V(99934);function de(U){return function(te,se,Re){var he=new pe.Metadata(ce.MULTI_INJECT_TAG,U);typeof Re=="number"?v.tagParameter(te,se,Re,he):v.tagProperty(te,se,he)}}$.multiInject=de},38085:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.named=void 0;var ce=V(6867),pe=V(47738),v=V(99934);function de(U){return function(te,se,Re){var he=new pe.Metadata(ce.NAMED_TAG,U);typeof Re=="number"?v.tagParameter(te,se,Re,he):v.tagProperty(te,se,he)}}$.named=de},6515:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.optional=void 0;var ce=V(6867),pe=V(47738),v=V(99934);function de(){return function(U,te,se){var Re=new pe.Metadata(ce.OPTIONAL_TAG,!0);typeof se=="number"?v.tagParameter(U,te,se,Re):v.tagProperty(U,te,Re)}}$.optional=de},7014:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.postConstruct=void 0;var ce=V(16674),pe=V(6867),v=V(47738);function de(){return function(U,te,se){var Re=new v.Metadata(pe.POST_CONSTRUCT,te);if(Reflect.hasOwnMetadata(pe.POST_CONSTRUCT,U.constructor))throw new Error(ce.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(pe.POST_CONSTRUCT,Re,U.constructor)}}$.postConstruct=de},32052:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.tagged=void 0;var ce=V(47738),pe=V(99934);function v(de,U){return function(te,se,Re){var he=new ce.Metadata(de,U);typeof Re=="number"?pe.tagParameter(te,se,Re,he):pe.tagProperty(te,se,he)}}$.tagged=v},55638:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.targetName=void 0;var ce=V(6867),pe=V(47738),v=V(99934);function de(U){return function(te,se,Re){var he=new pe.Metadata(ce.NAME_TAG,U);v.tagParameter(te,se,Re,he)}}$.targetName=de},86757:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.unmanaged=void 0;var ce=V(6867),pe=V(47738),v=V(99934);function de(){return function(U,te,se){var Re=new pe.Metadata(ce.UNMANAGED_TAG,!0);v.tagParameter(U,te,se,Re)}}$.unmanaged=de},44290:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Binding=void 0;var ce=V(28421),pe=V(37791),v=function(){function de(U,te){this.id=pe.id(),this.activated=!1,this.serviceIdentifier=U,this.scope=te,this.type=ce.BindingTypeEnum.Invalid,this.constraint=function(se){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return de.prototype.clone=function(){var U=new de(this.serviceIdentifier,this.scope);return U.activated=U.scope===ce.BindingScopeEnum.Singleton?this.activated:!1,U.implementationType=this.implementationType,U.dynamicValue=this.dynamicValue,U.scope=this.scope,U.type=this.type,U.factory=this.factory,U.provider=this.provider,U.constraint=this.constraint,U.onActivation=this.onActivation,U.cache=this.cache,U},de}();$.Binding=v},23184:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingCount=void 0;var V={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};$.BindingCount=V},16674:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.STACK_OVERFLOW=$.CIRCULAR_DEPENDENCY_IN_FACTORY=$.POST_CONSTRUCT_ERROR=$.MULTIPLE_POST_CONSTRUCT_METHODS=$.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=$.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=$.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=$.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=$.ARGUMENTS_LENGTH_MISMATCH=$.INVALID_DECORATOR_OPERATION=$.INVALID_TO_SELF_VALUE=$.INVALID_FUNCTION_BINDING=$.INVALID_MIDDLEWARE_RETURN=$.NO_MORE_SNAPSHOTS_AVAILABLE=$.INVALID_BINDING_TYPE=$.NOT_IMPLEMENTED=$.CIRCULAR_DEPENDENCY=$.UNDEFINED_INJECT_ANNOTATION=$.MISSING_INJECT_ANNOTATION=$.MISSING_INJECTABLE_ANNOTATION=$.NOT_REGISTERED=$.CANNOT_UNBIND=$.AMBIGUOUS_MATCH=$.KEY_NOT_FOUND=$.NULL_ARGUMENT=$.DUPLICATED_METADATA=$.DUPLICATED_INJECTABLE_DECORATOR=void 0,$.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",$.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",$.NULL_ARGUMENT="NULL argument",$.KEY_NOT_FOUND="Key Not Found",$.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",$.CANNOT_UNBIND="Could not unbind serviceIdentifier:",$.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",$.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",$.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var V=function(de){return"@inject called with undefined this could mean that the class "+de+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};$.UNDEFINED_INJECT_ANNOTATION=V,$.CIRCULAR_DEPENDENCY="Circular dependency found:",$.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",$.INVALID_BINDING_TYPE="Invalid binding type:",$.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",$.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",$.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",$.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",$.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ce=function(){for(var de=[],U=0;U<arguments.length;U++)de[U]=arguments[U];return"The number of constructor arguments in the derived class "+(de[0]+" must be >= than the number of constructor arguments of its base class.")};$.ARGUMENTS_LENGTH_MISMATCH=ce,$.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",$.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",$.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",$.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",$.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var pe=function(){for(var de=[],U=0;U<arguments.length;U++)de[U]=arguments[U];return"@postConstruct error in class "+de[0]+": "+de[1]};$.POST_CONSTRUCT_ERROR=pe;var v=function(){for(var de=[],U=0;U<arguments.length;U++)de[U]=arguments[U];return"It looks like there is a circular dependency "+("in one of the '"+de[0]+"' bindings. Please investigate bindings with")+("service identifier '"+de[1]+"'.")};$.CIRCULAR_DEPENDENCY_IN_FACTORY=v,$.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.TargetTypeEnum=$.BindingTypeEnum=$.BindingScopeEnum=void 0;var V={Request:"Request",Singleton:"Singleton",Transient:"Transient"};$.BindingScopeEnum=V;var ce={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};$.BindingTypeEnum=ce;var pe={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};$.TargetTypeEnum=pe},6867:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.NON_CUSTOM_TAG_KEYS=$.POST_CONSTRUCT=$.DESIGN_PARAM_TYPES=$.PARAM_TYPES=$.TAGGED_PROP=$.TAGGED=$.MULTI_INJECT_TAG=$.INJECT_TAG=$.OPTIONAL_TAG=$.UNMANAGED_TAG=$.NAME_TAG=$.NAMED_TAG=void 0,$.NAMED_TAG="named",$.NAME_TAG="name",$.UNMANAGED_TAG="unmanaged",$.OPTIONAL_TAG="optional",$.INJECT_TAG="inject",$.MULTI_INJECT_TAG="multi_inject",$.TAGGED="inversify:tagged",$.TAGGED_PROP="inversify:tagged_props",$.PARAM_TYPES="inversify:paramtypes",$.DESIGN_PARAM_TYPES="design:paramtypes",$.POST_CONSTRUCT="post_construct";function V(){return[$.INJECT_TAG,$.MULTI_INJECT_TAG,$.NAME_TAG,$.UNMANAGED_TAG,$.NAMED_TAG,$.OPTIONAL_TAG]}$.NON_CUSTOM_TAG_KEYS=V()},51389:function(It,$,V){"use strict";var ce=this&&this.__awaiter||function(Ct,st,ht,Wt){function X(Xt){return Xt instanceof ht?Xt:new ht(function(ft){ft(Xt)})}return new(ht||(ht=Promise))(function(Xt,ft){function He(Ut){try{Qe(Wt.next(Ut))}catch(xr){ft(xr)}}function lt(Ut){try{Qe(Wt.throw(Ut))}catch(xr){ft(xr)}}function Qe(Ut){Ut.done?Xt(Ut.value):X(Ut.value).then(He,lt)}Qe((Wt=Wt.apply(Ct,st||[])).next())})},pe=this&&this.__generator||function(Ct,st){var ht={label:0,sent:function(){if(Xt[0]&1)throw Xt[1];return Xt[1]},trys:[],ops:[]},Wt,X,Xt,ft;return ft={next:He(0),throw:He(1),return:He(2)},typeof Symbol=="function"&&(ft[Symbol.iterator]=function(){return this}),ft;function He(Qe){return function(Ut){return lt([Qe,Ut])}}function lt(Qe){if(Wt)throw new TypeError("Generator is already executing.");for(;ht;)try{if(Wt=1,X&&(Xt=Qe[0]&2?X.return:Qe[0]?X.throw||((Xt=X.return)&&Xt.call(X),0):X.next)&&!(Xt=Xt.call(X,Qe[1])).done)return Xt;switch(X=0,Xt&&(Qe=[Qe[0]&2,Xt.value]),Qe[0]){case 0:case 1:Xt=Qe;break;case 4:return ht.label++,{value:Qe[1],done:!1};case 5:ht.label++,X=Qe[1],Qe=[0];continue;case 7:Qe=ht.ops.pop(),ht.trys.pop();continue;default:if(Xt=ht.trys,!(Xt=Xt.length>0&&Xt[Xt.length-1])&&(Qe[0]===6||Qe[0]===2)){ht=0;continue}if(Qe[0]===3&&(!Xt||Qe[1]>Xt[0]&&Qe[1]<Xt[3])){ht.label=Qe[1];break}if(Qe[0]===6&&ht.label<Xt[1]){ht.label=Xt[1],Xt=Qe;break}if(Xt&&ht.label<Xt[2]){ht.label=Xt[2],ht.ops.push(Qe);break}Xt[2]&&ht.ops.pop(),ht.trys.pop();continue}Qe=st.call(Ct,ht)}catch(Ut){Qe=[6,Ut],X=0}finally{Wt=Xt=0}if(Qe[0]&5)throw Qe[1];return{value:Qe[0]?Qe[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(Ct,st){for(var ht=0,Wt=st.length,X=Ct.length;ht<Wt;ht++,X++)Ct[X]=st[ht];return Ct};Object.defineProperty($,"__esModule",{value:!0}),$.Container=void 0;var de=V(44290),U=V(16674),te=V(28421),se=V(6867),Re=V(51377),he=V(86311),$e=V(31927),tt=V(51860),gt=V(37791),Jt=V(55800),ir=V(85700),yt=V(80175),Qt=function(){function Ct(st){this._appliedMiddleware=[];var ht=st||{};if(typeof ht!="object")throw new Error(""+U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(ht.defaultScope===void 0)ht.defaultScope=te.BindingScopeEnum.Transient;else if(ht.defaultScope!==te.BindingScopeEnum.Singleton&&ht.defaultScope!==te.BindingScopeEnum.Transient&&ht.defaultScope!==te.BindingScopeEnum.Request)throw new Error(""+U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(ht.autoBindInjectable===void 0)ht.autoBindInjectable=!1;else if(typeof ht.autoBindInjectable!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(ht.skipBaseClassChecks===void 0)ht.skipBaseClassChecks=!1;else if(typeof ht.skipBaseClassChecks!="boolean")throw new Error(""+U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:ht.autoBindInjectable,defaultScope:ht.defaultScope,skipBaseClassChecks:ht.skipBaseClassChecks},this.id=gt.id(),this._bindingDictionary=new yt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Re.MetadataReader}return Ct.merge=function(st,ht){for(var Wt=[],X=2;X<arguments.length;X++)Wt[X-2]=arguments[X];var Xt=new Ct,ft=v([st,ht],Wt).map(function(Qe){return he.getBindingDictionary(Qe)}),He=he.getBindingDictionary(Xt);function lt(Qe,Ut){Qe.traverse(function(xr,Dr){Dr.forEach(function(Kr){Ut.add(Kr.serviceIdentifier,Kr.clone())})})}return ft.forEach(function(Qe){lt(Qe,He)}),Xt},Ct.prototype.load=function(){for(var st=[],ht=0;ht<arguments.length;ht++)st[ht]=arguments[ht];for(var Wt=this._getContainerModuleHelpersFactory(),X=0,Xt=st;X<Xt.length;X++){var ft=Xt[X],He=Wt(ft.id);ft.registry(He.bindFunction,He.unbindFunction,He.isboundFunction,He.rebindFunction)}},Ct.prototype.loadAsync=function(){for(var st=[],ht=0;ht<arguments.length;ht++)st[ht]=arguments[ht];return ce(this,void 0,void 0,function(){var Wt,X,Xt,ft,He;return pe(this,function(lt){switch(lt.label){case 0:Wt=this._getContainerModuleHelpersFactory(),X=0,Xt=st,lt.label=1;case 1:return X<Xt.length?(ft=Xt[X],He=Wt(ft.id),[4,ft.registry(He.bindFunction,He.unbindFunction,He.isboundFunction,He.rebindFunction)]):[3,4];case 2:lt.sent(),lt.label=3;case 3:return X++,[3,1];case 4:return[2]}})})},Ct.prototype.unload=function(){for(var st=this,ht=[],Wt=0;Wt<arguments.length;Wt++)ht[Wt]=arguments[Wt];var X=function(Xt){return function(ft){return ft.moduleId===Xt}};ht.forEach(function(Xt){var ft=X(Xt.id);st._bindingDictionary.removeByCondition(ft)})},Ct.prototype.bind=function(st){var ht=this.options.defaultScope||te.BindingScopeEnum.Transient,Wt=new de.Binding(st,ht);return this._bindingDictionary.add(st,Wt),new tt.BindingToSyntax(Wt)},Ct.prototype.rebind=function(st){return this.unbind(st),this.bind(st)},Ct.prototype.unbind=function(st){try{this._bindingDictionary.remove(st)}catch(ht){throw new Error(U.CANNOT_UNBIND+" "+Jt.getServiceIdentifierAsString(st))}},Ct.prototype.unbindAll=function(){this._bindingDictionary=new yt.Lookup},Ct.prototype.isBound=function(st){var ht=this._bindingDictionary.hasKey(st);return!ht&&this.parent&&(ht=this.parent.isBound(st)),ht},Ct.prototype.isBoundNamed=function(st,ht){return this.isBoundTagged(st,se.NAMED_TAG,ht)},Ct.prototype.isBoundTagged=function(st,ht,Wt){var X=!1;if(this._bindingDictionary.hasKey(st)){var Xt=this._bindingDictionary.get(st),ft=he.createMockRequest(this,st,ht,Wt);X=Xt.some(function(He){return He.constraint(ft)})}return!X&&this.parent&&(X=this.parent.isBoundTagged(st,ht,Wt)),X},Ct.prototype.snapshot=function(){this._snapshots.push(ir.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ct.prototype.restore=function(){var st=this._snapshots.pop();if(st===void 0)throw new Error(U.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=st.bindings,this._middleware=st.middleware},Ct.prototype.createChild=function(st){var ht=new Ct(st||this.options);return ht.parent=this,ht},Ct.prototype.applyMiddleware=function(){for(var st=[],ht=0;ht<arguments.length;ht++)st[ht]=arguments[ht];this._appliedMiddleware=this._appliedMiddleware.concat(st);var Wt=this._middleware?this._middleware:this._planAndResolve();this._middleware=st.reduce(function(X,Xt){return Xt(X)},Wt)},Ct.prototype.applyCustomMetadataReader=function(st){this._metadataReader=st},Ct.prototype.get=function(st){return this._get(!1,!1,te.TargetTypeEnum.Variable,st)},Ct.prototype.getTagged=function(st,ht,Wt){return this._get(!1,!1,te.TargetTypeEnum.Variable,st,ht,Wt)},Ct.prototype.getNamed=function(st,ht){return this.getTagged(st,se.NAMED_TAG,ht)},Ct.prototype.getAll=function(st){return this._get(!0,!0,te.TargetTypeEnum.Variable,st)},Ct.prototype.getAllTagged=function(st,ht,Wt){return this._get(!1,!0,te.TargetTypeEnum.Variable,st,ht,Wt)},Ct.prototype.getAllNamed=function(st,ht){return this.getAllTagged(st,se.NAMED_TAG,ht)},Ct.prototype.resolve=function(st){var ht=this.createChild();return ht.bind(st).toSelf(),this._appliedMiddleware.forEach(function(Wt){ht.applyMiddleware(Wt)}),ht.get(st)},Ct.prototype._getContainerModuleHelpersFactory=function(){var st=this,ht=function(He,lt){He._binding.moduleId=lt},Wt=function(He){return function(lt){var Qe=st.bind.bind(st),Ut=Qe(lt);return ht(Ut,He),Ut}},X=function(He){return function(lt){var Qe=st.unbind.bind(st);Qe(lt)}},Xt=function(He){return function(lt){var Qe=st.isBound.bind(st);return Qe(lt)}},ft=function(He){return function(lt){var Qe=st.rebind.bind(st),Ut=Qe(lt);return ht(Ut,He),Ut}};return function(He){return{bindFunction:Wt(He),isboundFunction:Xt(He),rebindFunction:ft(He),unbindFunction:X(He)}}},Ct.prototype._get=function(st,ht,Wt,X,Xt,ft){var He=null,lt={avoidConstraints:st,contextInterceptor:function(Qe){return Qe},isMultiInject:ht,key:Xt,serviceIdentifier:X,targetType:Wt,value:ft};if(this._middleware){if(He=this._middleware(lt),He==null)throw new Error(U.INVALID_MIDDLEWARE_RETURN)}else He=this._planAndResolve()(lt);return He},Ct.prototype._planAndResolve=function(){var st=this;return function(ht){var Wt=he.plan(st._metadataReader,st,ht.isMultiInject,ht.targetType,ht.serviceIdentifier,ht.key,ht.value,ht.avoidConstraints);Wt=ht.contextInterceptor(Wt);var X=$e.resolve(Wt);return X}},Ct}();$.Container=Qt},33244:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.AsyncContainerModule=$.ContainerModule=void 0;var ce=V(37791),pe=function(){function de(U){this.id=ce.id(),this.registry=U}return de}();$.ContainerModule=pe;var v=function(){function de(U){this.id=ce.id(),this.registry=U}return de}();$.AsyncContainerModule=v},85700:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.ContainerSnapshot=void 0;var V=function(){function ce(){}return ce.of=function(pe,v){var de=new ce;return de.bindings=pe,de.middleware=v,de},ce}();$.ContainerSnapshot=V},80175:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Lookup=void 0;var ce=V(16674),pe=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(de,U){if(de==null)throw new Error(ce.NULL_ARGUMENT);if(U==null)throw new Error(ce.NULL_ARGUMENT);var te=this._map.get(de);te!==void 0?(te.push(U),this._map.set(de,te)):this._map.set(de,[U])},v.prototype.get=function(de){if(de==null)throw new Error(ce.NULL_ARGUMENT);var U=this._map.get(de);if(U!==void 0)return U;throw new Error(ce.KEY_NOT_FOUND)},v.prototype.remove=function(de){if(de==null)throw new Error(ce.NULL_ARGUMENT);if(!this._map.delete(de))throw new Error(ce.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(de){var U=this;this._map.forEach(function(te,se){var Re=te.filter(function(he){return!de(he)});Re.length>0?U._map.set(se,Re):U._map.delete(se)})},v.prototype.hasKey=function(de){if(de==null)throw new Error(ce.NULL_ARGUMENT);return this._map.has(de)},v.prototype.clone=function(){var de=new v;return this._map.forEach(function(U,te){U.forEach(function(se){return de.add(te,se.clone())})}),de},v.prototype.traverse=function(de){this._map.forEach(function(U,te){de(te,U)})},v}();$.Lookup=pe},86700:function(It,$,V){"use strict";var ce;ce={value:!0},ce=ce=ce=ce=ce=ce=$.GW=ce=ce=$.zY=ce=ce=ce=ce=ce=$.f3=ce=ce=$.b2=ce=ce=ce=ce=ce=$.W2=ce=void 0;var pe=V(6867);ce=pe;var v=V(51389);Object.defineProperty($,"W2",{enumerable:!0,get:function(){return v.Container}});var de=V(28421);ce={enumerable:!0,get:function(){return de.BindingScopeEnum}},ce={enumerable:!0,get:function(){return de.BindingTypeEnum}},ce={enumerable:!0,get:function(){return de.TargetTypeEnum}};var U=V(33244);ce={enumerable:!0,get:function(){return U.AsyncContainerModule}},ce={enumerable:!0,get:function(){return U.ContainerModule}};var te=V(64315);Object.defineProperty($,"b2",{enumerable:!0,get:function(){return te.injectable}});var se=V(32052);ce={enumerable:!0,get:function(){return se.tagged}};var Re=V(38085);ce={enumerable:!0,get:function(){return Re.named}};var he=V(5744);Object.defineProperty($,"f3",{enumerable:!0,get:function(){return he.inject}}),ce={enumerable:!0,get:function(){return he.LazyServiceIdentifer}};var $e=V(6515);ce={enumerable:!0,get:function(){return $e.optional}};var tt=V(86757);ce={enumerable:!0,get:function(){return tt.unmanaged}};var gt=V(71693);ce={enumerable:!0,get:function(){return gt.multiInject}};var Jt=V(55638);ce={enumerable:!0,get:function(){return Jt.targetName}};var ir=V(7014);Object.defineProperty($,"zY",{enumerable:!0,get:function(){return ir.postConstruct}});var yt=V(51377);ce={enumerable:!0,get:function(){return yt.MetadataReader}};var Qt=V(37791);ce={enumerable:!0,get:function(){return Qt.id}};var Ct=V(99934);Object.defineProperty($,"GW",{enumerable:!0,get:function(){return Ct.decorate}});var st=V(80758);ce={enumerable:!0,get:function(){return st.traverseAncerstors}},ce={enumerable:!0,get:function(){return st.taggedConstraint}},ce={enumerable:!0,get:function(){return st.namedConstraint}},ce={enumerable:!0,get:function(){return st.typeConstraint}};var ht=V(55800);ce={enumerable:!0,get:function(){return ht.getServiceIdentifierAsString}};var Wt=V(70600);ce={enumerable:!0,get:function(){return Wt.multiBindToService}}},95228:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Context=void 0;var ce=V(37791),pe=function(){function v(de){this.id=ce.id(),this.container=de}return v.prototype.addPlan=function(de){this.plan=de},v.prototype.setCurrentRequest=function(de){this.currentRequest=de},v}();$.Context=pe},47738:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Metadata=void 0;var ce=V(6867),pe=function(){function v(de,U){this.key=de,this.value=U}return v.prototype.toString=function(){return this.key===ce.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();$.Metadata=pe},51377:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.MetadataReader=void 0;var ce=V(6867),pe=function(){function v(){}return v.prototype.getConstructorMetadata=function(de){var U=Reflect.getMetadata(ce.PARAM_TYPES,de),te=Reflect.getMetadata(ce.TAGGED,de);return{compilerGeneratedMetadata:U,userGeneratedMetadata:te||{}}},v.prototype.getPropertiesMetadata=function(de){var U=Reflect.getMetadata(ce.TAGGED_PROP,de)||[];return U},v}();$.MetadataReader=pe},55314:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Plan=void 0;var V=function(){function ce(pe,v){this.parentContext=pe,this.rootRequest=v}return ce}();$.Plan=V},86311:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.getBindingDictionary=$.createMockRequest=$.plan=void 0;var ce=V(23184),pe=V(16674),v=V(28421),de=V(6867),U=V(85265),te=V(55800),se=V(95228),Re=V(47738),he=V(55314),$e=V(6e3),tt=V(6748),gt=V(18924);function Jt(X){return X._bindingDictionary}$.getBindingDictionary=Jt;function ir(X,Xt,ft,He,lt,Qe){var Ut=X?de.MULTI_INJECT_TAG:de.INJECT_TAG,xr=new Re.Metadata(Ut,ft),Dr=new gt.Target(Xt,He,ft,xr);if(lt!==void 0){var Kr=new Re.Metadata(lt,Qe);Dr.metadata.push(Kr)}return Dr}function yt(X,Xt,ft,He,lt){var Qe=st(ft.container,lt.serviceIdentifier),Ut=[];return Qe.length===ce.BindingCount.NoBindingsAvailable&&ft.container.options.autoBindInjectable&&typeof lt.serviceIdentifier=="function"&&X.getConstructorMetadata(lt.serviceIdentifier).compilerGeneratedMetadata&&(ft.container.bind(lt.serviceIdentifier).toSelf(),Qe=st(ft.container,lt.serviceIdentifier)),Xt?Ut=Qe:Ut=Qe.filter(function(xr){var Dr=new tt.Request(xr.serviceIdentifier,ft,He,xr,lt);return xr.constraint(Dr)}),Qt(lt.serviceIdentifier,Ut,lt,ft.container),Ut}function Qt(X,Xt,ft,He){switch(Xt.length){case ce.BindingCount.NoBindingsAvailable:if(ft.isOptional())return Xt;var lt=te.getServiceIdentifierAsString(X),Qe=pe.NOT_REGISTERED;throw Qe+=te.listMetadataForTarget(lt,ft),Qe+=te.listRegisteredBindingsForServiceIdentifier(He,lt,st),new Error(Qe);case ce.BindingCount.OnlyOneBindingAvailable:if(!ft.isArray())return Xt;case ce.BindingCount.MultipleBindingsAvailable:default:if(ft.isArray())return Xt;var lt=te.getServiceIdentifierAsString(X),Qe=pe.AMBIGUOUS_MATCH+" "+lt;throw Qe+=te.listRegisteredBindingsForServiceIdentifier(He,lt,st),new Error(Qe)}}function Ct(X,Xt,ft,He,lt,Qe){var Ut,xr;if(lt===null){Ut=yt(X,Xt,He,null,Qe),xr=new tt.Request(ft,He,null,Ut,Qe);var Dr=new he.Plan(He,xr);He.addPlan(Dr)}else Ut=yt(X,Xt,He,lt,Qe),xr=lt.addChildRequest(Qe.serviceIdentifier,Ut,Qe);Ut.forEach(function(Kr){var Me=null;if(Qe.isArray())Me=xr.addChildRequest(Kr.serviceIdentifier,Kr,Qe);else{if(Kr.cache)return;Me=xr}if(Kr.type===v.BindingTypeEnum.Instance&&Kr.implementationType!==null){var A=$e.getDependencies(X,Kr.implementationType);if(!He.container.options.skipBaseClassChecks){var _e=$e.getBaseClassDependencyCount(X,Kr.implementationType);if(A.length<_e){var Et=pe.ARGUMENTS_LENGTH_MISMATCH($e.getFunctionName(Kr.implementationType));throw new Error(Et)}}A.forEach(function(dt){Ct(X,!1,dt.serviceIdentifier,He,Me,dt)})}})}function st(X,Xt){var ft=[],He=Jt(X);return He.hasKey(Xt)?ft=He.get(Xt):X.parent!==null&&(ft=st(X.parent,Xt)),ft}function ht(X,Xt,ft,He,lt,Qe,Ut,xr){xr===void 0&&(xr=!1);var Dr=new se.Context(Xt),Kr=ir(ft,He,lt,"",Qe,Ut);try{return Ct(X,xr,lt,Dr,null,Kr),Dr}catch(Me){throw U.isStackOverflowExeption(Me)&&Dr.plan&&te.circularDependencyToException(Dr.plan.rootRequest),Me}}$.plan=ht;function Wt(X,Xt,ft,He){var lt=new gt.Target(v.TargetTypeEnum.Variable,"",Xt,new Re.Metadata(ft,He)),Qe=new se.Context(X),Ut=new tt.Request(Xt,Qe,null,[],lt);return Ut}$.createMockRequest=Wt},88460:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.QueryableString=void 0;var V=function(){function ce(pe){this.str=pe}return ce.prototype.startsWith=function(pe){return this.str.indexOf(pe)===0},ce.prototype.endsWith=function(pe){var v="",de=pe.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},de)},ce.prototype.contains=function(pe){return this.str.indexOf(pe)!==-1},ce.prototype.equals=function(pe){return this.str===pe},ce.prototype.value=function(){return this.str},ce}();$.QueryableString=V},6e3:function(It,$,V){"use strict";var ce=this&&this.__spreadArray||function(yt,Qt){for(var Ct=0,st=Qt.length,ht=yt.length;Ct<st;Ct++,ht++)yt[ht]=Qt[Ct];return yt};Object.defineProperty($,"__esModule",{value:!0}),$.getFunctionName=$.getBaseClassDependencyCount=$.getDependencies=void 0;var pe=V(5744),v=V(16674),de=V(28421),U=V(6867),te=V(55800);Object.defineProperty($,"getFunctionName",{enumerable:!0,get:function(){return te.getFunctionName}});var se=V(18924);function Re(yt,Qt){var Ct=te.getFunctionName(Qt),st=he(yt,Ct,Qt,!1);return st}$.getDependencies=Re;function he(yt,Qt,Ct,st){var ht=yt.getConstructorMetadata(Ct),Wt=ht.compilerGeneratedMetadata;if(Wt===void 0){var X=v.MISSING_INJECTABLE_ANNOTATION+" "+Qt+".";throw new Error(X)}var Xt=ht.userGeneratedMetadata,ft=Object.keys(Xt),He=Ct.length===0&&ft.length>0,lt=ft.length>Ct.length,Qe=He||lt?ft.length:Ct.length,Ut=tt(st,Qt,Wt,Xt,Qe),xr=gt(yt,Ct),Dr=ce(ce([],Ut),xr);return Dr}function $e(yt,Qt,Ct,st,ht){var Wt=ht[yt.toString()]||[],X=ir(Wt),Xt=X.unmanaged!==!0,ft=st[yt],He=X.inject||X.multiInject;if(ft=He||ft,ft instanceof pe.LazyServiceIdentifer&&(ft=ft.unwrap()),Xt){var lt=ft===Object,Qe=ft===Function,Ut=ft===void 0,xr=lt||Qe||Ut;if(!Qt&&xr){var Dr=v.MISSING_INJECT_ANNOTATION+" argument "+yt+" in class "+Ct+".";throw new Error(Dr)}var Kr=new se.Target(de.TargetTypeEnum.ConstructorArgument,X.targetName,ft);return Kr.metadata=Wt,Kr}return null}function tt(yt,Qt,Ct,st,ht){for(var Wt=[],X=0;X<ht;X++){var Xt=X,ft=$e(Xt,yt,Qt,Ct,st);ft!==null&&Wt.push(ft)}return Wt}function gt(yt,Qt){for(var Ct=yt.getPropertiesMetadata(Qt),st=[],ht=Object.keys(Ct),Wt=0,X=ht;Wt<X.length;Wt++){var Xt=X[Wt],ft=Ct[Xt],He=ir(Ct[Xt]),lt=He.targetName||Xt,Qe=He.inject||He.multiInject,Ut=new se.Target(de.TargetTypeEnum.ClassProperty,lt,Qe);Ut.metadata=ft,st.push(Ut)}var xr=Object.getPrototypeOf(Qt.prototype).constructor;if(xr!==Object){var Dr=gt(yt,xr);st=ce(ce([],st),Dr)}return st}function Jt(yt,Qt){var Ct=Object.getPrototypeOf(Qt.prototype).constructor;if(Ct!==Object){var st=te.getFunctionName(Ct),ht=he(yt,st,Ct,!0),Wt=ht.map(function(ft){return ft.metadata.filter(function(He){return He.key===U.UNMANAGED_TAG})}),X=[].concat.apply([],Wt).length,Xt=ht.length-X;return Xt>0?Xt:Jt(yt,Ct)}else return 0}$.getBaseClassDependencyCount=Jt;function ir(yt){var Qt={};return yt.forEach(function(Ct){Qt[Ct.key.toString()]=Ct.value}),{inject:Qt[U.INJECT_TAG],multiInject:Qt[U.MULTI_INJECT_TAG],targetName:Qt[U.NAME_TAG],unmanaged:Qt[U.UNMANAGED_TAG]}}},6748:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Request=void 0;var ce=V(37791),pe=function(){function v(de,U,te,se,Re){this.id=ce.id(),this.serviceIdentifier=de,this.parentContext=U,this.parentRequest=te,this.target=Re,this.childRequests=[],this.bindings=Array.isArray(se)?se:[se],this.requestScope=te===null?new Map:null}return v.prototype.addChildRequest=function(de,U,te){var se=new v(de,this.parentContext,this,U,te);return this.childRequests.push(se),se},v}();$.Request=pe},18924:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Target=void 0;var ce=V(6867),pe=V(37791),v=V(47738),de=V(88460),U=function(){function te(se,Re,he,$e){this.id=pe.id(),this.type=se,this.serviceIdentifier=he,this.name=new de.QueryableString(Re||""),this.metadata=new Array;var tt=null;typeof $e=="string"?tt=new v.Metadata(ce.NAMED_TAG,$e):$e instanceof v.Metadata&&(tt=$e),tt!==null&&this.metadata.push(tt)}return te.prototype.hasTag=function(se){for(var Re=0,he=this.metadata;Re<he.length;Re++){var $e=he[Re];if($e.key===se)return!0}return!1},te.prototype.isArray=function(){return this.hasTag(ce.MULTI_INJECT_TAG)},te.prototype.matchesArray=function(se){return this.matchesTag(ce.MULTI_INJECT_TAG)(se)},te.prototype.isNamed=function(){return this.hasTag(ce.NAMED_TAG)},te.prototype.isTagged=function(){return this.metadata.some(function(se){return ce.NON_CUSTOM_TAG_KEYS.every(function(Re){return se.key!==Re})})},te.prototype.isOptional=function(){return this.matchesTag(ce.OPTIONAL_TAG)(!0)},te.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(se){return se.key===ce.NAMED_TAG})[0]:null},te.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(se){return ce.NON_CUSTOM_TAG_KEYS.every(function(Re){return se.key!==Re})}):null},te.prototype.matchesNamedTag=function(se){return this.matchesTag(ce.NAMED_TAG)(se)},te.prototype.matchesTag=function(se){var Re=this;return function(he){for(var $e=0,tt=Re.metadata;$e<tt.length;$e++){var gt=tt[$e];if(gt.key===se&&gt.value===he)return!0}return!1}},te}();$.Target=U},52279:function(It,$,V){"use strict";var ce=this&&this.__spreadArray||function(he,$e){for(var tt=0,gt=$e.length,Jt=he.length;tt<gt;tt++,Jt++)he[Jt]=$e[tt];return he};Object.defineProperty($,"__esModule",{value:!0}),$.resolveInstance=void 0;var pe=V(16674),v=V(28421),de=V(6867);function U(he,$e,tt){var gt=$e.filter(function(ir){return ir.target!==null&&ir.target.type===v.TargetTypeEnum.ClassProperty}),Jt=gt.map(tt);return gt.forEach(function(ir,yt){var Qt="";Qt=ir.target.name.value();var Ct=Jt[yt];he[Qt]=Ct}),he}function te(he,$e){return new(he.bind.apply(he,ce([void 0],$e)))}function se(he,$e){if(Reflect.hasMetadata(de.POST_CONSTRUCT,he)){var tt=Reflect.getMetadata(de.POST_CONSTRUCT,he);try{$e[tt.value]()}catch(gt){throw new Error(pe.POST_CONSTRUCT_ERROR(he.name,gt.message))}}}function Re(he,$e,tt){var gt=null;if($e.length>0){var Jt=$e.filter(function(yt){return yt.target!==null&&yt.target.type===v.TargetTypeEnum.ConstructorArgument}),ir=Jt.map(tt);gt=te(he,ir),gt=U(gt,$e,tt)}else gt=new he;return se(he,gt),gt}$.resolveInstance=Re},31927:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.resolve=void 0;var ce=V(16674),pe=V(28421),v=V(85265),de=V(55800),U=V(52279),te=function(he,$e,tt){try{return tt()}catch(gt){throw v.isStackOverflowExeption(gt)?new Error(ce.CIRCULAR_DEPENDENCY_IN_FACTORY(he,$e.toString())):gt}},se=function(he){return function($e){$e.parentContext.setCurrentRequest($e);var tt=$e.bindings,gt=$e.childRequests,Jt=$e.target&&$e.target.isArray(),ir=!$e.parentRequest||!$e.parentRequest.target||!$e.target||!$e.parentRequest.target.matchesArray($e.target.serviceIdentifier);if(Jt&&ir)return gt.map(function(Wt){var X=se(he);return X(Wt)});var yt=null;if($e.target.isOptional()&&tt.length===0)return;var Qt=tt[0],Ct=Qt.scope===pe.BindingScopeEnum.Singleton,st=Qt.scope===pe.BindingScopeEnum.Request;if(Ct&&Qt.activated)return Qt.cache;if(st&&he!==null&&he.has(Qt.id))return he.get(Qt.id);if(Qt.type===pe.BindingTypeEnum.ConstantValue)yt=Qt.cache,Qt.activated=!0;else if(Qt.type===pe.BindingTypeEnum.Function)yt=Qt.cache,Qt.activated=!0;else if(Qt.type===pe.BindingTypeEnum.Constructor)yt=Qt.implementationType;else if(Qt.type===pe.BindingTypeEnum.DynamicValue&&Qt.dynamicValue!==null)yt=te("toDynamicValue",Qt.serviceIdentifier,function(){return Qt.dynamicValue($e.parentContext)});else if(Qt.type===pe.BindingTypeEnum.Factory&&Qt.factory!==null)yt=te("toFactory",Qt.serviceIdentifier,function(){return Qt.factory($e.parentContext)});else if(Qt.type===pe.BindingTypeEnum.Provider&&Qt.provider!==null)yt=te("toProvider",Qt.serviceIdentifier,function(){return Qt.provider($e.parentContext)});else if(Qt.type===pe.BindingTypeEnum.Instance&&Qt.implementationType!==null)yt=U.resolveInstance(Qt.implementationType,gt,se(he));else{var ht=de.getServiceIdentifierAsString($e.serviceIdentifier);throw new Error(ce.INVALID_BINDING_TYPE+" "+ht)}return typeof Qt.onActivation=="function"&&(yt=Qt.onActivation($e.parentContext,yt)),Ct&&(Qt.cache=yt,Qt.activated=!0),st&&he!==null&&!he.has(Qt.id)&&he.set(Qt.id,yt),yt}};function Re(he){var $e=se(he.plan.rootRequest.requestScope);return $e(he.plan.rootRequest)}$.resolve=Re},83366:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingInSyntax=void 0;var ce=V(28421),pe=V(71325),v=function(){function de(U){this._binding=U}return de.prototype.inRequestScope=function(){return this._binding.scope=ce.BindingScopeEnum.Request,new pe.BindingWhenOnSyntax(this._binding)},de.prototype.inSingletonScope=function(){return this._binding.scope=ce.BindingScopeEnum.Singleton,new pe.BindingWhenOnSyntax(this._binding)},de.prototype.inTransientScope=function(){return this._binding.scope=ce.BindingScopeEnum.Transient,new pe.BindingWhenOnSyntax(this._binding)},de}();$.BindingInSyntax=v},99812:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingInWhenOnSyntax=void 0;var ce=V(83366),pe=V(51811),v=V(98370),de=function(){function U(te){this._binding=te,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new pe.BindingOnSyntax(this._binding),this._bindingInSyntax=new ce.BindingInSyntax(te)}return U.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},U.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},U.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},U.prototype.when=function(te){return this._bindingWhenSyntax.when(te)},U.prototype.whenTargetNamed=function(te){return this._bindingWhenSyntax.whenTargetNamed(te)},U.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},U.prototype.whenTargetTagged=function(te,se){return this._bindingWhenSyntax.whenTargetTagged(te,se)},U.prototype.whenInjectedInto=function(te){return this._bindingWhenSyntax.whenInjectedInto(te)},U.prototype.whenParentNamed=function(te){return this._bindingWhenSyntax.whenParentNamed(te)},U.prototype.whenParentTagged=function(te,se){return this._bindingWhenSyntax.whenParentTagged(te,se)},U.prototype.whenAnyAncestorIs=function(te){return this._bindingWhenSyntax.whenAnyAncestorIs(te)},U.prototype.whenNoAncestorIs=function(te){return this._bindingWhenSyntax.whenNoAncestorIs(te)},U.prototype.whenAnyAncestorNamed=function(te){return this._bindingWhenSyntax.whenAnyAncestorNamed(te)},U.prototype.whenAnyAncestorTagged=function(te,se){return this._bindingWhenSyntax.whenAnyAncestorTagged(te,se)},U.prototype.whenNoAncestorNamed=function(te){return this._bindingWhenSyntax.whenNoAncestorNamed(te)},U.prototype.whenNoAncestorTagged=function(te,se){return this._bindingWhenSyntax.whenNoAncestorTagged(te,se)},U.prototype.whenAnyAncestorMatches=function(te){return this._bindingWhenSyntax.whenAnyAncestorMatches(te)},U.prototype.whenNoAncestorMatches=function(te){return this._bindingWhenSyntax.whenNoAncestorMatches(te)},U.prototype.onActivation=function(te){return this._bindingOnSyntax.onActivation(te)},U}();$.BindingInWhenOnSyntax=de},51811:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingOnSyntax=void 0;var ce=V(98370),pe=function(){function v(de){this._binding=de}return v.prototype.onActivation=function(de){return this._binding.onActivation=de,new ce.BindingWhenSyntax(this._binding)},v}();$.BindingOnSyntax=pe},51860:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingToSyntax=void 0;var ce=V(16674),pe=V(28421),v=V(99812),de=V(71325),U=function(){function te(se){this._binding=se}return te.prototype.to=function(se){return this._binding.type=pe.BindingTypeEnum.Instance,this._binding.implementationType=se,new v.BindingInWhenOnSyntax(this._binding)},te.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ce.INVALID_TO_SELF_VALUE);var se=this._binding.serviceIdentifier;return this.to(se)},te.prototype.toConstantValue=function(se){return this._binding.type=pe.BindingTypeEnum.ConstantValue,this._binding.cache=se,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=pe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},te.prototype.toDynamicValue=function(se){return this._binding.type=pe.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=se,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},te.prototype.toConstructor=function(se){return this._binding.type=pe.BindingTypeEnum.Constructor,this._binding.implementationType=se,this._binding.scope=pe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},te.prototype.toFactory=function(se){return this._binding.type=pe.BindingTypeEnum.Factory,this._binding.factory=se,this._binding.scope=pe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},te.prototype.toFunction=function(se){if(typeof se!="function")throw new Error(ce.INVALID_FUNCTION_BINDING);var Re=this.toConstantValue(se);return this._binding.type=pe.BindingTypeEnum.Function,this._binding.scope=pe.BindingScopeEnum.Singleton,Re},te.prototype.toAutoFactory=function(se){return this._binding.type=pe.BindingTypeEnum.Factory,this._binding.factory=function(Re){var he=function(){return Re.container.get(se)};return he},this._binding.scope=pe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},te.prototype.toProvider=function(se){return this._binding.type=pe.BindingTypeEnum.Provider,this._binding.provider=se,this._binding.scope=pe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},te.prototype.toService=function(se){this.toDynamicValue(function(Re){return Re.container.get(se)})},te}();$.BindingToSyntax=U},71325:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingWhenOnSyntax=void 0;var ce=V(51811),pe=V(98370),v=function(){function de(U){this._binding=U,this._bindingWhenSyntax=new pe.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ce.BindingOnSyntax(this._binding)}return de.prototype.when=function(U){return this._bindingWhenSyntax.when(U)},de.prototype.whenTargetNamed=function(U){return this._bindingWhenSyntax.whenTargetNamed(U)},de.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},de.prototype.whenTargetTagged=function(U,te){return this._bindingWhenSyntax.whenTargetTagged(U,te)},de.prototype.whenInjectedInto=function(U){return this._bindingWhenSyntax.whenInjectedInto(U)},de.prototype.whenParentNamed=function(U){return this._bindingWhenSyntax.whenParentNamed(U)},de.prototype.whenParentTagged=function(U,te){return this._bindingWhenSyntax.whenParentTagged(U,te)},de.prototype.whenAnyAncestorIs=function(U){return this._bindingWhenSyntax.whenAnyAncestorIs(U)},de.prototype.whenNoAncestorIs=function(U){return this._bindingWhenSyntax.whenNoAncestorIs(U)},de.prototype.whenAnyAncestorNamed=function(U){return this._bindingWhenSyntax.whenAnyAncestorNamed(U)},de.prototype.whenAnyAncestorTagged=function(U,te){return this._bindingWhenSyntax.whenAnyAncestorTagged(U,te)},de.prototype.whenNoAncestorNamed=function(U){return this._bindingWhenSyntax.whenNoAncestorNamed(U)},de.prototype.whenNoAncestorTagged=function(U,te){return this._bindingWhenSyntax.whenNoAncestorTagged(U,te)},de.prototype.whenAnyAncestorMatches=function(U){return this._bindingWhenSyntax.whenAnyAncestorMatches(U)},de.prototype.whenNoAncestorMatches=function(U){return this._bindingWhenSyntax.whenNoAncestorMatches(U)},de.prototype.onActivation=function(U){return this._bindingOnSyntax.onActivation(U)},de}();$.BindingWhenOnSyntax=v},98370:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingWhenSyntax=void 0;var ce=V(51811),pe=V(80758),v=function(){function de(U){this._binding=U}return de.prototype.when=function(U){return this._binding.constraint=U,new ce.BindingOnSyntax(this._binding)},de.prototype.whenTargetNamed=function(U){return this._binding.constraint=pe.namedConstraint(U),new ce.BindingOnSyntax(this._binding)},de.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(U){var te=U.target!==null&&!U.target.isNamed()&&!U.target.isTagged();return te},new ce.BindingOnSyntax(this._binding)},de.prototype.whenTargetTagged=function(U,te){return this._binding.constraint=pe.taggedConstraint(U)(te),new ce.BindingOnSyntax(this._binding)},de.prototype.whenInjectedInto=function(U){return this._binding.constraint=function(te){return pe.typeConstraint(U)(te.parentRequest)},new ce.BindingOnSyntax(this._binding)},de.prototype.whenParentNamed=function(U){return this._binding.constraint=function(te){return pe.namedConstraint(U)(te.parentRequest)},new ce.BindingOnSyntax(this._binding)},de.prototype.whenParentTagged=function(U,te){return this._binding.constraint=function(se){return pe.taggedConstraint(U)(te)(se.parentRequest)},new ce.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorIs=function(U){return this._binding.constraint=function(te){return pe.traverseAncerstors(te,pe.typeConstraint(U))},new ce.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorIs=function(U){return this._binding.constraint=function(te){return!pe.traverseAncerstors(te,pe.typeConstraint(U))},new ce.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorNamed=function(U){return this._binding.constraint=function(te){return pe.traverseAncerstors(te,pe.namedConstraint(U))},new ce.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorNamed=function(U){return this._binding.constraint=function(te){return!pe.traverseAncerstors(te,pe.namedConstraint(U))},new ce.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorTagged=function(U,te){return this._binding.constraint=function(se){return pe.traverseAncerstors(se,pe.taggedConstraint(U)(te))},new ce.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorTagged=function(U,te){return this._binding.constraint=function(se){return!pe.traverseAncerstors(se,pe.taggedConstraint(U)(te))},new ce.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorMatches=function(U){return this._binding.constraint=function(te){return pe.traverseAncerstors(te,U)},new ce.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorMatches=function(U){return this._binding.constraint=function(te){return!pe.traverseAncerstors(te,U)},new ce.BindingOnSyntax(this._binding)},de}();$.BindingWhenSyntax=v},80758:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.typeConstraint=$.namedConstraint=$.taggedConstraint=$.traverseAncerstors=void 0;var ce=V(6867),pe=V(47738),v=function(se,Re){var he=se.parentRequest;return he!==null?Re(he)?!0:v(he,Re):!1};$.traverseAncerstors=v;var de=function(se){return function(Re){var he=function($e){return $e!==null&&$e.target!==null&&$e.target.matchesTag(se)(Re)};return he.metaData=new pe.Metadata(se,Re),he}};$.taggedConstraint=de;var U=de(ce.NAMED_TAG);$.namedConstraint=U;var te=function(se){return function(Re){var he=null;if(Re!==null)if(he=Re.bindings[0],typeof se=="string"){var $e=he.serviceIdentifier;return $e===se}else{var tt=Re.bindings[0].implementationType;return se===tt}return!1}};$.typeConstraint=te},70600:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.multiBindToService=void 0;var V=function(ce){return function(pe){return function(){for(var v=[],de=0;de<arguments.length;de++)v[de]=arguments[de];return v.forEach(function(U){return ce.bind(U).toService(pe)})}}};$.multiBindToService=V},85265:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.isStackOverflowExeption=void 0;var ce=V(16674);function pe(v){return v instanceof RangeError||v.message===ce.STACK_OVERFLOW}$.isStackOverflowExeption=pe},37791:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.id=void 0;var V=0;function ce(){return V++}$.id=ce},55800:function(It,$,V){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.circularDependencyToException=$.listMetadataForTarget=$.listRegisteredBindingsForServiceIdentifier=$.getServiceIdentifierAsString=$.getFunctionName=void 0;var ce=V(16674);function pe(he){if(typeof he=="function"){var $e=he;return $e.name}else{if(typeof he=="symbol")return he.toString();var $e=he;return $e}}$.getServiceIdentifierAsString=pe;function v(he,$e,tt){var gt="",Jt=tt(he,$e);return Jt.length!==0&&(gt=`
Registered bindings:`,Jt.forEach(function(ir){var yt="Object";ir.implementationType!==null&&(yt=Re(ir.implementationType)),gt=gt+`
 `+yt,ir.constraint.metaData&&(gt=gt+" - "+ir.constraint.metaData)})),gt}$.listRegisteredBindingsForServiceIdentifier=v;function de(he,$e){return he.parentRequest===null?!1:he.parentRequest.serviceIdentifier===$e?!0:de(he.parentRequest,$e)}function U(he){function $e(gt,Jt){Jt===void 0&&(Jt=[]);var ir=pe(gt.serviceIdentifier);return Jt.push(ir),gt.parentRequest!==null?$e(gt.parentRequest,Jt):Jt}var tt=$e(he);return tt.reverse().join(" --> ")}function te(he){he.childRequests.forEach(function($e){if(de($e,$e.serviceIdentifier)){var tt=U($e);throw new Error(ce.CIRCULAR_DEPENDENCY+" "+tt)}else te($e)})}$.circularDependencyToException=te;function se(he,$e){if($e.isTagged()||$e.isNamed()){var tt="",gt=$e.getNamedTag(),Jt=$e.getCustomTags();return gt!==null&&(tt+=gt.toString()+`
`),Jt!==null&&Jt.forEach(function(ir){tt+=ir.toString()+`
`})," "+he+`
 `+he+" - "+tt}else return" "+he}$.listMetadataForTarget=se;function Re(he){if(he.name)return he.name;var $e=he.toString(),tt=$e.match(/^function\s*([^\s(]+)/);return tt?tt[1]:"Anonymous function: "+$e}$.getFunctionName=Re},31745:function(It){"use strict";It.exports=V,It.exports.default=V;var $=1e20;function V(U,te,se,Re,he,$e){this.fontSize=U||24,this.buffer=te===void 0?3:te,this.cutoff=Re||.25,this.fontFamily=he||"sans-serif",this.fontWeight=$e||"normal",this.radius=se||8;var tt=this.size=this.fontSize+this.buffer*2,gt=tt+this.buffer*2,Jt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";Jt?this.canvas=my.createOffscreenCanvas(tt,tt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=tt),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(gt*gt),this.gridInner=new Float64Array(gt*gt),this.f=new Float64Array(gt),this.z=new Float64Array(gt+1),this.v=new Uint16Array(gt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Jt?this.middle=Math.round(tt/2*1):this.middle=Math.round(tt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ce(U,te,se,Re,he,$e,tt){$e.fill($,0,te*se),tt.fill(0,0,te*se);for(var gt=(te-Re)/2,Jt=0;Jt<he;Jt++)for(var ir=0;ir<Re;ir++){var yt=(Jt+gt)*te+ir+gt,Qt=U.data[4*(Jt*Re+ir)+3]/255;if(Qt===1)$e[yt]=0,tt[yt]=$;else if(Qt===0)$e[yt]=$,tt[yt]=0;else{var Ct=Math.max(0,.5-Qt),st=Math.max(0,Qt-.5);$e[yt]=Ct*Ct,tt[yt]=st*st}}}function pe(U,te,se,Re,he,$e,tt){for(var gt=0;gt<te*se;gt++){var Jt=Math.sqrt(Re[gt])-Math.sqrt(he[gt]);U[gt]=Math.round(255-255*(Jt/$e+tt))}}V.prototype._draw=function(U,te){var se=this.ctx.measureText(U),Re=se.width,he=2*this.buffer,$e,tt,gt,Jt,ir,yt,Qt,Ct;te&&this.useMetrics?(ir=Math.floor(se.actualBoundingBoxAscent),Ct=this.buffer+Math.ceil(se.actualBoundingBoxAscent),yt=this.buffer,Qt=this.buffer,tt=Math.min(this.size,Math.ceil(se.actualBoundingBoxRight-se.actualBoundingBoxLeft)),Jt=Math.min(this.size-yt,Math.ceil(se.actualBoundingBoxAscent+se.actualBoundingBoxDescent)),$e=tt+he,gt=Jt+he,this.ctx.textBaseline="alphabetic"):($e=tt=this.size,gt=Jt=this.size,ir=19*this.fontSize/24,yt=Qt=0,Ct=this.middle,this.ctx.textBaseline="middle");var st;tt&&Jt&&(this.ctx.clearRect(Qt,yt,tt,Jt),this.ctx.fillText(U,this.buffer,Ct),st=this.ctx.getImageData(Qt,yt,tt,Jt));var ht=new Uint8ClampedArray($e*gt);return ce(st,$e,gt,tt,Jt,this.gridOuter,this.gridInner),v(this.gridOuter,$e,gt,this.f,this.v,this.z),v(this.gridInner,$e,gt,this.f,this.v,this.z),pe(ht,$e,gt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:ht,metrics:{width:tt,height:Jt,sdfWidth:$e,sdfHeight:gt,top:ir,left:0,advance:Re}}},V.prototype.draw=function(U){return this._draw(U,!1).data},V.prototype.drawWithMetrics=function(U){return this._draw(U,!0)};function v(U,te,se,Re,he,$e){for(var tt=0;tt<te;tt++)de(U,tt,te,se,Re,he,$e);for(var gt=0;gt<se;gt++)de(U,gt*te,1,te,Re,he,$e)}function de(U,te,se,Re,he,$e,tt){var gt,Jt,ir,yt;for($e[0]=0,tt[0]=-$,tt[1]=$,gt=0;gt<Re;gt++)he[gt]=U[te+gt*se];for(gt=1,Jt=0,ir=0;gt<Re;gt++){do yt=$e[Jt],ir=(he[gt]-he[yt]+gt*gt-yt*yt)/(gt-yt)/2;while(ir<=tt[Jt]&&--Jt>-1);Jt++,$e[Jt]=gt,tt[Jt]=ir,tt[Jt+1]=$}for(gt=0,Jt=0;gt<Re;gt++){for(;tt[Jt+1]<gt;)Jt++;yt=$e[Jt],U[te+gt*se]=he[yt]+(gt-yt)*(gt-yt)}}},81336:function(It,$,V){"use strict";V.r($),V.d($,{Function:function(){return Xs},Interpreter:function(){return go},default:function(){return rl},evaluate:function(){return Il},vm:function(){return ce}});var ce={};V.r(ce),V.d(ce,{Script:function(){return Ps},compileFunction:function(){return gs},createContext:function(){return Qo},runInContext:function(){return Pl},runInNewContext:function(){return rf}});var pe={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",de={5:v,"5module":v+" export import",6:v+" const class extends export import super"},U=/^in(stanceof)?$/,te="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",se="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Re=new RegExp("["+te+"]"),he=new RegExp("["+te+se+"]");te=se=null;var $e=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],tt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function gt(_,T){for(var F=65536,O=0;O<T.length;O+=2){if(F+=T[O],F>_)return!1;if(F+=T[O+1],F>=_)return!0}}function Jt(_,T){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Re.test(String.fromCharCode(_)):T===!1?!1:gt(_,$e)}function ir(_,T){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&he.test(String.fromCharCode(_)):T===!1?!1:gt(_,$e)||gt(_,tt)}var yt=function(T,F){F===void 0&&(F={}),this.label=T,this.keyword=F.keyword,this.beforeExpr=!!F.beforeExpr,this.startsExpr=!!F.startsExpr,this.isLoop=!!F.isLoop,this.isAssign=!!F.isAssign,this.prefix=!!F.prefix,this.postfix=!!F.postfix,this.binop=F.binop||null,this.updateContext=null};function Qt(_,T){return new yt(_,{beforeExpr:!0,binop:T})}var Ct={beforeExpr:!0},st={startsExpr:!0},ht={};function Wt(_,T){return T===void 0&&(T={}),T.keyword=_,ht[_]=new yt(_,T)}var X={num:new yt("num",st),regexp:new yt("regexp",st),string:new yt("string",st),name:new yt("name",st),eof:new yt("eof"),bracketL:new yt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new yt("]"),braceL:new yt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new yt("}"),parenL:new yt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new yt(")"),comma:new yt(",",Ct),semi:new yt(";",Ct),colon:new yt(":",Ct),dot:new yt("."),question:new yt("?",Ct),questionDot:new yt("?."),arrow:new yt("=>",Ct),template:new yt("template"),invalidTemplate:new yt("invalidTemplate"),ellipsis:new yt("...",Ct),backQuote:new yt("`",st),dollarBraceL:new yt("${",{beforeExpr:!0,startsExpr:!0}),eq:new yt("=",{beforeExpr:!0,isAssign:!0}),assign:new yt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new yt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new yt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Qt("||",1),logicalAND:Qt("&&",2),bitwiseOR:Qt("|",3),bitwiseXOR:Qt("^",4),bitwiseAND:Qt("&",5),equality:Qt("==/!=/===/!==",6),relational:Qt("</>/<=/>=",7),bitShift:Qt("<</>>/>>>",8),plusMin:new yt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Qt("%",10),star:Qt("*",10),slash:Qt("/",10),starstar:new yt("**",{beforeExpr:!0}),coalesce:Qt("??",1),_break:Wt("break"),_case:Wt("case",Ct),_catch:Wt("catch"),_continue:Wt("continue"),_debugger:Wt("debugger"),_default:Wt("default",Ct),_do:Wt("do",{isLoop:!0,beforeExpr:!0}),_else:Wt("else",Ct),_finally:Wt("finally"),_for:Wt("for",{isLoop:!0}),_function:Wt("function",st),_if:Wt("if"),_return:Wt("return",Ct),_switch:Wt("switch"),_throw:Wt("throw",Ct),_try:Wt("try"),_var:Wt("var"),_const:Wt("const"),_while:Wt("while",{isLoop:!0}),_with:Wt("with"),_new:Wt("new",{beforeExpr:!0,startsExpr:!0}),_this:Wt("this",st),_super:Wt("super",st),_class:Wt("class",st),_extends:Wt("extends",Ct),_export:Wt("export"),_import:Wt("import",st),_null:Wt("null",st),_true:Wt("true",st),_false:Wt("false",st),_in:Wt("in",{beforeExpr:!0,binop:7}),_instanceof:Wt("instanceof",{beforeExpr:!0,binop:7}),_typeof:Wt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Wt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Wt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Xt=/\r\n?|\n|\u2028|\u2029/,ft=new RegExp(Xt.source,"g");function He(_,T){return _===10||_===13||!T&&(_===8232||_===8233)}var lt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Qe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ut=Object.prototype,xr=Ut.hasOwnProperty,Dr=Ut.toString;function Kr(_,T){return xr.call(_,T)}var Me=Array.isArray||function(_){return Dr.call(_)==="[object Array]"};function A(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var _e=function(T,F){this.line=T,this.column=F};_e.prototype.offset=function(T){return new _e(this.line,this.column+T)};var Et=function(T,F,O){this.start=F,this.end=O,T.sourceFile!==null&&(this.source=T.sourceFile)};function dt(_,T){for(var F=1,O=0;;){ft.lastIndex=O;var Y=ft.exec(_);if(Y&&Y.index<T)++F,O=Y.index+Y[0].length;else return new _e(F,T-O)}}var Ft={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function qt(_){var T={};for(var F in Ft)T[F]=_&&Kr(_,F)?_[F]:Ft[F];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),Me(T.onToken)){var O=T.onToken;T.onToken=function(Y){return O.push(Y)}}return Me(T.onComment)&&(T.onComment=Sr(T,T.onComment)),T}function Sr(_,T){return function(F,O,Y,me,Ge,ut){var ct={type:F?"Block":"Line",value:O,start:Y,end:me};_.locations&&(ct.loc=new Et(this,Ge,ut)),_.ranges&&(ct.range=[Y,me]),T.push(ct)}}var Qn=1,gn=2,ea=Qn|gn,wn=4,ii=8,Si=16,si=32,Wn=64,ma=128;function zi(_,T){return gn|(_?wn:0)|(T?ii:0)}var ji=0,Wi=1,ga=2,vo=3,Va=4,la=5,Ui=function(T,F,O){this.options=T=qt(T),this.sourceFile=T.sourceFile,this.keywords=A(de[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var Y="";if(T.allowReserved!==!0){for(var me=T.ecmaVersion;!(Y=pe[me]);me--);T.sourceType==="module"&&(Y+=" await")}this.reservedWords=A(Y);var Ge=(Y?Y+" ":"")+pe.strict;this.reservedWordsStrict=A(Ge),this.reservedWordsStrictBind=A(Ge+" "+pe.strictBind),this.input=String(F),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Xt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=X.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Qn),this.regexpState=null},ra={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ui.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},ra.inFunction.get=function(){return(this.currentVarScope().flags&gn)>0},ra.inGenerator.get=function(){return(this.currentVarScope().flags&ii)>0},ra.inAsync.get=function(){return(this.currentVarScope().flags&wn)>0},ra.allowSuper.get=function(){return(this.currentThisScope().flags&Wn)>0},ra.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ma)>0},ra.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ui.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&gn)>0},Ui.extend=function(){for(var T=[],F=arguments.length;F--;)T[F]=arguments[F];for(var O=this,Y=0;Y<T.length;Y++)O=T[Y](O);return O},Ui.parse=function(T,F){return new this(F,T).parse()},Ui.parseExpressionAt=function(T,F,O){var Y=new this(O,T,F);return Y.nextToken(),Y.parseExpression()},Ui.tokenizer=function(T,F){return new this(F,T)},Object.defineProperties(Ui.prototype,ra);var qi=Ui.prototype,Ts=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;qi.strictDirective=function(_){for(;;){Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length;var T=Ts.exec(this.input.slice(_));if(!T)return!1;if((T[1]||T[2])==="use strict"){Qe.lastIndex=_+T[0].length;var F=Qe.exec(this.input),O=F.index+F[0].length,Y=this.input.charAt(O);return Y===";"||Y==="}"||Xt.test(F[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(Y)||Y==="!"&&this.input.charAt(O+1)==="=")}_+=T[0].length,Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length,this.input[_]===";"&&_++}},qi.eat=function(_){return this.type===_?(this.next(),!0):!1},qi.isContextual=function(_){return this.type===X.name&&this.value===_&&!this.containsEsc},qi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},qi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},qi.canInsertSemicolon=function(){return this.type===X.eof||this.type===X.braceR||Xt.test(this.input.slice(this.lastTokEnd,this.start))},qi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},qi.semicolon=function(){!this.eat(X.semi)&&!this.insertSemicolon()&&this.unexpected()},qi.afterTrailingComma=function(_,T){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},qi.expect=function(_){this.eat(_)||this.unexpected()},qi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function ge(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}qi.checkPatternErrors=function(_,T){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var F=T?_.parenthesizedAssign:_.parenthesizedBind;F>-1&&this.raiseRecoverable(F,"Parenthesized pattern")}},qi.checkExpressionErrors=function(_,T){if(!_)return!1;var F=_.shorthandAssign,O=_.doubleProto;if(!T)return F>=0||O>=0;F>=0&&this.raise(F,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},qi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},qi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var ui=Ui.prototype;ui.parseTopLevel=function(_){var T={};for(_.body||(_.body=[]);this.type!==X.eof;){var F=this.parseStatement(null,!0,T);_.body.push(F)}if(this.inModule)for(var O=0,Y=Object.keys(this.undefinedExports);O<Y.length;O+=1){var me=Y[O];this.raiseRecoverable(this.undefinedExports[me].start,"Export '"+me+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var no={kind:"loop"},ru={kind:"switch"};ui.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Qe.lastIndex=this.pos;var T=Qe.exec(this.input),F=this.pos+T[0].length,O=this.input.charCodeAt(F);if(O===91)return!0;if(_)return!1;if(O===123)return!0;if(Jt(O,!0)){for(var Y=F+1;ir(this.input.charCodeAt(Y),!0);)++Y;var me=this.input.slice(F,Y);if(!U.test(me))return!0}return!1},ui.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Qe.lastIndex=this.pos;var _=Qe.exec(this.input),T=this.pos+_[0].length;return!Xt.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!ir(this.input.charAt(T+8)))},ui.parseStatement=function(_,T,F){var O=this.type,Y=this.startNode(),me;switch(this.isLet(_)&&(O=X._var,me="let"),O){case X._break:case X._continue:return this.parseBreakContinueStatement(Y,O.keyword);case X._debugger:return this.parseDebuggerStatement(Y);case X._do:return this.parseDoStatement(Y);case X._for:return this.parseForStatement(Y);case X._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(Y,!1,!_);case X._class:return _&&this.unexpected(),this.parseClass(Y,!0);case X._if:return this.parseIfStatement(Y);case X._return:return this.parseReturnStatement(Y);case X._switch:return this.parseSwitchStatement(Y);case X._throw:return this.parseThrowStatement(Y);case X._try:return this.parseTryStatement(Y);case X._const:case X._var:return me=me||this.value,_&&me!=="var"&&this.unexpected(),this.parseVarStatement(Y,me);case X._while:return this.parseWhileStatement(Y);case X._with:return this.parseWithStatement(Y);case X.braceL:return this.parseBlock(!0,Y);case X.semi:return this.parseEmptyStatement(Y);case X._export:case X._import:if(this.options.ecmaVersion>10&&O===X._import){Qe.lastIndex=this.pos;var Ge=Qe.exec(this.input),ut=this.pos+Ge[0].length,ct=this.input.charCodeAt(ut);if(ct===40||ct===46)return this.parseExpressionStatement(Y,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===X._import?this.parseImport(Y):this.parseExport(Y,F);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(Y,!0,!_);var lr=this.value,mr=this.parseExpression();return O===X.name&&mr.type==="Identifier"&&this.eat(X.colon)?this.parseLabeledStatement(Y,lr,mr,_):this.parseExpressionStatement(Y,mr)}},ui.parseBreakContinueStatement=function(_,T){var F=T==="break";this.next(),this.eat(X.semi)||this.insertSemicolon()?_.label=null:this.type!==X.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var Y=this.labels[O];if((_.label==null||Y.name===_.label.name)&&(Y.kind!=null&&(F||Y.kind==="loop")||_.label&&F))break}return O===this.labels.length&&this.raise(_.start,"Unsyntactic "+T),this.finishNode(_,F?"BreakStatement":"ContinueStatement")},ui.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},ui.parseDoStatement=function(_){return this.next(),this.labels.push(no),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(X._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(X.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},ui.parseForStatement=function(_){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(no),this.enterScope(0),this.expect(X.parenL),this.type===X.semi)return T>-1&&this.unexpected(T),this.parseFor(_,null);var F=this.isLet();if(this.type===X._var||this.type===X._const||F){var O=this.startNode(),Y=F?"let":this.value;return this.next(),this.parseVar(O,!0,Y),this.finishNode(O,"VariableDeclaration"),(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===X._in?T>-1&&this.unexpected(T):_.await=T>-1),this.parseForIn(_,O)):(T>-1&&this.unexpected(T),this.parseFor(_,O))}var me=new ge,Ge=this.parseExpression(!0,me);return this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===X._in?T>-1&&this.unexpected(T):_.await=T>-1),this.toAssignable(Ge,!1,me),this.checkLVal(Ge),this.parseForIn(_,Ge)):(this.checkExpressionErrors(me,!0),T>-1&&this.unexpected(T),this.parseFor(_,Ge))},ui.parseFunctionStatement=function(_,T,F){return this.next(),this.parseFunction(_,ar|(F?0:Ar),!1,T)},ui.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(X._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},ui.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(X.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},ui.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(X.braceL),this.labels.push(ru),this.enterScope(0);for(var T,F=!1;this.type!==X.braceR;)if(this.type===X._case||this.type===X._default){var O=this.type===X._case;T&&this.finishNode(T,"SwitchCase"),_.cases.push(T=this.startNode()),T.consequent=[],this.next(),O?T.test=this.parseExpression():(F&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),F=!0,T.test=null),this.expect(X.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},ui.parseThrowStatement=function(_){return this.next(),Xt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Vt=[];ui.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===X._catch){var T=this.startNode();if(this.next(),this.eat(X.parenL)){T.param=this.parseBindingAtom();var F=T.param.type==="Identifier";this.enterScope(F?si:0),this.checkLVal(T.param,F?Va:ga),this.expect(X.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(T,"CatchClause")}return _.finalizer=this.eat(X._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},ui.parseVarStatement=function(_,T){return this.next(),this.parseVar(_,!1,T),this.semicolon(),this.finishNode(_,"VariableDeclaration")},ui.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(no),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},ui.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},ui.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},ui.parseLabeledStatement=function(_,T,F,O){for(var Y=0,me=this.labels;Y<me.length;Y+=1){var Ge=me[Y];Ge.name===T&&this.raise(F.start,"Label '"+T+"' is already declared")}for(var ut=this.type.isLoop?"loop":this.type===X._switch?"switch":null,ct=this.labels.length-1;ct>=0;ct--){var lr=this.labels[ct];if(lr.statementStart===_.start)lr.statementStart=this.start,lr.kind=ut;else break}return this.labels.push({name:T,kind:ut,statementStart:this.start}),_.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),_.label=F,this.finishNode(_,"LabeledStatement")},ui.parseExpressionStatement=function(_,T){return _.expression=T,this.semicolon(),this.finishNode(_,"ExpressionStatement")},ui.parseBlock=function(_,T,F){for(_===void 0&&(_=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(X.braceL),_&&this.enterScope(0);this.type!==X.braceR;){var O=this.parseStatement(null);T.body.push(O)}return F&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(T,"BlockStatement")},ui.parseFor=function(_,T){return _.init=T,this.expect(X.semi),_.test=this.type===X.semi?null:this.parseExpression(),this.expect(X.semi),_.update=this.type===X.parenR?null:this.parseExpression(),this.expect(X.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},ui.parseForIn=function(_,T){var F=this.type===X._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!F||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(F?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),_.left=T,_.right=F?this.parseExpression():this.parseMaybeAssign(),this.expect(X.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,F?"ForInStatement":"ForOfStatement")},ui.parseVar=function(_,T,F){for(_.declarations=[],_.kind=F;;){var O=this.startNode();if(this.parseVarId(O,F),this.eat(X.eq)?O.init=this.parseMaybeAssign(T):F==="const"&&!(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(T&&(this.type===X._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,_.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(X.comma))break}return _},ui.parseVarId=function(_,T){_.id=this.parseBindingAtom(),this.checkLVal(_.id,T==="var"?Wi:ga,!1)};var ar=1,Ar=2,on=4;ui.parseFunction=function(_,T,F,O){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===X.star&&T&Ar&&this.unexpected(),_.generator=this.eat(X.star)),this.options.ecmaVersion>=8&&(_.async=!!O),T&ar&&(_.id=T&on&&this.type!==X.name?null:this.parseIdent(),_.id&&!(T&Ar)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Wi:ga:vo));var Y=this.yieldPos,me=this.awaitPos,Ge=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(zi(_.async,_.generator)),T&ar||(_.id=this.type===X.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,F,!1),this.yieldPos=Y,this.awaitPos=me,this.awaitIdentPos=Ge,this.finishNode(_,T&ar?"FunctionDeclaration":"FunctionExpression")},ui.parseFunctionParams=function(_){this.expect(X.parenL),_.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ui.parseClass=function(_,T){this.next();var F=this.strict;this.strict=!0,this.parseClassId(_,T),this.parseClassSuper(_);var O=this.startNode(),Y=!1;for(O.body=[],this.expect(X.braceL);this.type!==X.braceR;){var me=this.parseClassElement(_.superClass!==null);me&&(O.body.push(me),me.type==="MethodDefinition"&&me.kind==="constructor"&&(Y&&this.raise(me.start,"Duplicate constructor in the same class"),Y=!0))}return this.strict=F,this.next(),_.body=this.finishNode(O,"ClassBody"),this.finishNode(_,T?"ClassDeclaration":"ClassExpression")},ui.parseClassElement=function(_){var T=this;if(this.eat(X.semi))return null;var F=this.startNode(),O=function(ct,lr){lr===void 0&&(lr=!1);var mr=T.start,cn=T.startLoc;return T.eatContextual(ct)?T.type!==X.parenL&&(!lr||!T.canInsertSemicolon())?!0:(F.key&&T.unexpected(),F.computed=!1,F.key=T.startNodeAt(mr,cn),F.key.name=ct,T.finishNode(F.key,"Identifier"),!1):!1};F.kind="method",F.static=O("static");var Y=this.eat(X.star),me=!1;Y||(this.options.ecmaVersion>=8&&O("async",!0)?(me=!0,Y=this.options.ecmaVersion>=9&&this.eat(X.star)):O("get")?F.kind="get":O("set")&&(F.kind="set")),F.key||this.parsePropertyName(F);var Ge=F.key,ut=!1;return!F.computed&&!F.static&&(Ge.type==="Identifier"&&Ge.name==="constructor"||Ge.type==="Literal"&&Ge.value==="constructor")?(F.kind!=="method"&&this.raise(Ge.start,"Constructor can't have get/set modifier"),Y&&this.raise(Ge.start,"Constructor can't be a generator"),me&&this.raise(Ge.start,"Constructor can't be an async method"),F.kind="constructor",ut=_):F.static&&Ge.type==="Identifier"&&Ge.name==="prototype"&&this.raise(Ge.start,"Classes may not have a static property named prototype"),this.parseClassMethod(F,Y,me,ut),F.kind==="get"&&F.value.params.length!==0&&this.raiseRecoverable(F.value.start,"getter should have no params"),F.kind==="set"&&F.value.params.length!==1&&this.raiseRecoverable(F.value.start,"setter should have exactly one param"),F.kind==="set"&&F.value.params[0].type==="RestElement"&&this.raiseRecoverable(F.value.params[0].start,"Setter cannot use rest params"),F},ui.parseClassMethod=function(_,T,F,O){return _.value=this.parseMethod(T,F,O),this.finishNode(_,"MethodDefinition")},ui.parseClassId=function(_,T){this.type===X.name?(_.id=this.parseIdent(),T&&this.checkLVal(_.id,ga,!1)):(T===!0&&this.unexpected(),_.id=null)},ui.parseClassSuper=function(_){_.superClass=this.eat(X._extends)?this.parseExprSubscripts():null},ui.parseExport=function(_,T){if(this.next(),this.eat(X.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(T,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==X.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(X._default)){this.checkExport(T,"default",this.lastTokStart);var F;if(this.type===X._function||(F=this.isAsyncFunction())){var O=this.startNode();this.next(),F&&this.next(),_.declaration=this.parseFunction(O,ar|on,!1,F)}else if(this.type===X._class){var Y=this.startNode();_.declaration=this.parseClass(Y,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,_.declaration.declarations):this.checkExport(T,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==X.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var me=0,Ge=_.specifiers;me<Ge.length;me+=1){var ut=Ge[me];this.checkUnreserved(ut.local),this.checkLocalExport(ut.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},ui.checkExport=function(_,T,F){!_||(Kr(_,T)&&this.raiseRecoverable(F,"Duplicate export '"+T+"'"),_[T]=!0)},ui.checkPatternExport=function(_,T){var F=T.type;if(F==="Identifier")this.checkExport(_,T.name,T.start);else if(F==="ObjectPattern")for(var O=0,Y=T.properties;O<Y.length;O+=1){var me=Y[O];this.checkPatternExport(_,me)}else if(F==="ArrayPattern")for(var Ge=0,ut=T.elements;Ge<ut.length;Ge+=1){var ct=ut[Ge];ct&&this.checkPatternExport(_,ct)}else F==="Property"?this.checkPatternExport(_,T.value):F==="AssignmentPattern"?this.checkPatternExport(_,T.left):F==="RestElement"?this.checkPatternExport(_,T.argument):F==="ParenthesizedExpression"&&this.checkPatternExport(_,T.expression)},ui.checkVariableExport=function(_,T){if(!!_)for(var F=0,O=T;F<O.length;F+=1){var Y=O[F];this.checkPatternExport(_,Y.id)}},ui.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ui.parseExportSpecifiers=function(_){var T=[],F=!0;for(this.expect(X.braceL);!this.eat(X.braceR);){if(F)F=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(_,O.exported.name,O.exported.start),T.push(this.finishNode(O,"ExportSpecifier"))}return T},ui.parseImport=function(_){return this.next(),this.type===X.string?(_.specifiers=Vt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===X.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},ui.parseImportSpecifiers=function(){var _=[],T=!0;if(this.type===X.name){var F=this.startNode();if(F.local=this.parseIdent(),this.checkLVal(F.local,ga),_.push(this.finishNode(F,"ImportDefaultSpecifier")),!this.eat(X.comma))return _}if(this.type===X.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,ga),_.push(this.finishNode(O,"ImportNamespaceSpecifier")),_}for(this.expect(X.braceL);!this.eat(X.braceR);){if(T)T=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var Y=this.startNode();Y.imported=this.parseIdent(!0),this.eatContextual("as")?Y.local=this.parseIdent():(this.checkUnreserved(Y.imported),Y.local=Y.imported),this.checkLVal(Y.local,ga),_.push(this.finishNode(Y,"ImportSpecifier"))}return _},ui.adaptDirectivePrologue=function(_){for(var T=0;T<_.length&&this.isDirectiveCandidate(_[T]);++T)_[T].directive=_[T].expression.raw.slice(1,-1)},ui.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var In=Ui.prototype;In.toAssignable=function(_,T,F){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",F&&this.checkPatternErrors(F,!0);for(var O=0,Y=_.properties;O<Y.length;O+=1){var me=Y[O];this.toAssignable(me,T),me.type==="RestElement"&&(me.argument.type==="ArrayPattern"||me.argument.type==="ObjectPattern")&&this.raise(me.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,T);break;case"ArrayExpression":_.type="ArrayPattern",F&&this.checkPatternErrors(F,!0),this.toAssignableList(_.elements,T);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,T),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,T,F);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(_.start,"Assigning to rvalue")}else F&&this.checkPatternErrors(F,!0);return _},In.toAssignableList=function(_,T){for(var F=_.length,O=0;O<F;O++){var Y=_[O];Y&&this.toAssignable(Y,T)}if(F){var me=_[F-1];this.options.ecmaVersion===6&&T&&me&&me.type==="RestElement"&&me.argument.type!=="Identifier"&&this.unexpected(me.argument.start)}return _},In.parseSpread=function(_){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,_),this.finishNode(T,"SpreadElement")},In.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==X.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},In.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case X.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(X.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case X.braceL:return this.parseObj(!0)}return this.parseIdent()},In.parseBindingList=function(_,T,F){for(var O=[],Y=!0;!this.eat(_);)if(Y?Y=!1:this.expect(X.comma),T&&this.type===X.comma)O.push(null);else{if(F&&this.afterTrailingComma(_))break;if(this.type===X.ellipsis){var me=this.parseRestBinding();this.parseBindingListItem(me),O.push(me),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var Ge=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Ge),O.push(Ge)}}return O},In.parseBindingListItem=function(_){return _},In.parseMaybeDefault=function(_,T,F){if(F=F||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(X.eq))return F;var O=this.startNodeAt(_,T);return O.left=F,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},In.checkLVal=function(_,T,F){switch(T===void 0&&(T=ji),_.type){case"Identifier":T===ga&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(T?"Binding ":"Assigning to ")+_.name+" in strict mode"),F&&(Kr(F,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),F[_.name]=!0),T!==ji&&T!==la&&this.declareName(_.name,T,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,Y=_.properties;O<Y.length;O+=1){var me=Y[O];this.checkLVal(me,T,F)}break;case"Property":this.checkLVal(_.value,T,F);break;case"ArrayPattern":for(var Ge=0,ut=_.elements;Ge<ut.length;Ge+=1){var ct=ut[Ge];ct&&this.checkLVal(ct,T,F)}break;case"AssignmentPattern":this.checkLVal(_.left,T,F);break;case"RestElement":this.checkLVal(_.argument,T,F);break;case"ParenthesizedExpression":this.checkLVal(_.expression,T,F);break;default:this.raise(_.start,(T?"Binding":"Assigning to")+" rvalue")}};var Rn=Ui.prototype;Rn.checkPropClash=function(_,T,F){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var O=_.key,Y;switch(O.type){case"Identifier":Y=O.name;break;case"Literal":Y=String(O.value);break;default:return}var me=_.kind;if(this.options.ecmaVersion>=6){Y==="__proto__"&&me==="init"&&(T.proto&&(F?F.doubleProto<0&&(F.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),T.proto=!0);return}Y="$"+Y;var Ge=T[Y];if(Ge){var ut;me==="init"?ut=this.strict&&Ge.init||Ge.get||Ge.set:ut=Ge.init||Ge[me],ut&&this.raiseRecoverable(O.start,"Redefinition of property")}else Ge=T[Y]={init:!1,get:!1,set:!1};Ge[me]=!0}},Rn.parseExpression=function(_,T){var F=this.start,O=this.startLoc,Y=this.parseMaybeAssign(_,T);if(this.type===X.comma){var me=this.startNodeAt(F,O);for(me.expressions=[Y];this.eat(X.comma);)me.expressions.push(this.parseMaybeAssign(_,T));return this.finishNode(me,"SequenceExpression")}return Y},Rn.parseMaybeAssign=function(_,T,F){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var O=!1,Y=-1,me=-1;T?(Y=T.parenthesizedAssign,me=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new ge,O=!0);var Ge=this.start,ut=this.startLoc;(this.type===X.parenL||this.type===X.name)&&(this.potentialArrowAt=this.start);var ct=this.parseMaybeConditional(_,T);if(F&&(ct=F.call(this,ct,Ge,ut)),this.type.isAssign){var lr=this.startNodeAt(Ge,ut);return lr.operator=this.value,lr.left=this.type===X.eq?this.toAssignable(ct,!1,T):ct,O||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=lr.left.start&&(T.shorthandAssign=-1),this.checkLVal(ct),this.next(),lr.right=this.parseMaybeAssign(_),this.finishNode(lr,"AssignmentExpression")}else O&&this.checkExpressionErrors(T,!0);return Y>-1&&(T.parenthesizedAssign=Y),me>-1&&(T.trailingComma=me),ct},Rn.parseMaybeConditional=function(_,T){var F=this.start,O=this.startLoc,Y=this.parseExprOps(_,T);if(this.checkExpressionErrors(T))return Y;if(this.eat(X.question)){var me=this.startNodeAt(F,O);return me.test=Y,me.consequent=this.parseMaybeAssign(),this.expect(X.colon),me.alternate=this.parseMaybeAssign(_),this.finishNode(me,"ConditionalExpression")}return Y},Rn.parseExprOps=function(_,T){var F=this.start,O=this.startLoc,Y=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||Y.start===F&&Y.type==="ArrowFunctionExpression"?Y:this.parseExprOp(Y,F,O,-1,_)},Rn.parseExprOp=function(_,T,F,O,Y){var me=this.type.binop;if(me!=null&&(!Y||this.type!==X._in)&&me>O){var Ge=this.type===X.logicalOR||this.type===X.logicalAND,ut=this.type===X.coalesce;ut&&(me=X.logicalAND.binop);var ct=this.value;this.next();var lr=this.start,mr=this.startLoc,cn=this.parseExprOp(this.parseMaybeUnary(null,!1),lr,mr,me,Y),ei=this.buildBinary(T,F,_,cn,ct,Ge||ut);return(Ge&&this.type===X.coalesce||ut&&(this.type===X.logicalOR||this.type===X.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ei,T,F,O,Y)}return _},Rn.buildBinary=function(_,T,F,O,Y,me){var Ge=this.startNodeAt(_,T);return Ge.left=F,Ge.operator=Y,Ge.right=O,this.finishNode(Ge,me?"LogicalExpression":"BinaryExpression")},Rn.parseMaybeUnary=function(_,T){var F=this.start,O=this.startLoc,Y;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))Y=this.parseAwait(),T=!0;else if(this.type.prefix){var me=this.startNode(),Ge=this.type===X.incDec;me.operator=this.value,me.prefix=!0,this.next(),me.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),Ge?this.checkLVal(me.argument):this.strict&&me.operator==="delete"&&me.argument.type==="Identifier"?this.raiseRecoverable(me.start,"Deleting local variable in strict mode"):T=!0,Y=this.finishNode(me,Ge?"UpdateExpression":"UnaryExpression")}else{if(Y=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return Y;for(;this.type.postfix&&!this.canInsertSemicolon();){var ut=this.startNodeAt(F,O);ut.operator=this.value,ut.prefix=!1,ut.argument=Y,this.checkLVal(Y),this.next(),Y=this.finishNode(ut,"UpdateExpression")}}return!T&&this.eat(X.starstar)?this.buildBinary(F,O,Y,this.parseMaybeUnary(null,!1),"**",!1):Y},Rn.parseExprSubscripts=function(_){var T=this.start,F=this.startLoc,O=this.parseExprAtom(_);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var Y=this.parseSubscripts(O,T,F);return _&&Y.type==="MemberExpression"&&(_.parenthesizedAssign>=Y.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=Y.start&&(_.parenthesizedBind=-1)),Y},Rn.parseSubscripts=function(_,T,F,O){for(var Y=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,me=!1;;){var Ge=this.parseSubscript(_,T,F,O,Y,me);if(Ge.optional&&(me=!0),Ge===_||Ge.type==="ArrowFunctionExpression"){if(me){var ut=this.startNodeAt(T,F);ut.expression=Ge,Ge=this.finishNode(ut,"ChainExpression")}return Ge}_=Ge}},Rn.parseSubscript=function(_,T,F,O,Y,me){var Ge=this.options.ecmaVersion>=11,ut=Ge&&this.eat(X.questionDot);O&&ut&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var ct=this.eat(X.bracketL);if(ct||ut&&this.type!==X.parenL&&this.type!==X.backQuote||this.eat(X.dot)){var lr=this.startNodeAt(T,F);lr.object=_,lr.property=ct?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),lr.computed=!!ct,ct&&this.expect(X.bracketR),Ge&&(lr.optional=ut),_=this.finishNode(lr,"MemberExpression")}else if(!O&&this.eat(X.parenL)){var mr=new ge,cn=this.yieldPos,ei=this.awaitPos,Hn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var vi=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1,mr);if(Y&&!ut&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(mr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=cn,this.awaitPos=ei,this.awaitIdentPos=Hn,this.parseArrowExpression(this.startNodeAt(T,F),vi,!0);this.checkExpressionErrors(mr,!0),this.yieldPos=cn||this.yieldPos,this.awaitPos=ei||this.awaitPos,this.awaitIdentPos=Hn||this.awaitIdentPos;var ca=this.startNodeAt(T,F);ca.callee=_,ca.arguments=vi,Ge&&(ca.optional=ut),_=this.finishNode(ca,"CallExpression")}else if(this.type===X.backQuote){(ut||me)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var xa=this.startNodeAt(T,F);xa.tag=_,xa.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(xa,"TaggedTemplateExpression")}return _},Rn.parseExprAtom=function(_){this.type===X.slash&&this.readRegexp();var T,F=this.potentialArrowAt===this.start;switch(this.type){case X._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===X.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==X.dot&&this.type!==X.bracketL&&this.type!==X.parenL&&this.unexpected(),this.finishNode(T,"Super");case X._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case X.name:var O=this.start,Y=this.startLoc,me=this.containsEsc,Ge=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!me&&Ge.name==="async"&&!this.canInsertSemicolon()&&this.eat(X._function))return this.parseFunction(this.startNodeAt(O,Y),0,!1,!0);if(F&&!this.canInsertSemicolon()){if(this.eat(X.arrow))return this.parseArrowExpression(this.startNodeAt(O,Y),[Ge],!1);if(this.options.ecmaVersion>=8&&Ge.name==="async"&&this.type===X.name&&!me)return Ge=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(X.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,Y),[Ge],!0)}return Ge;case X.regexp:var ut=this.value;return T=this.parseLiteral(ut.value),T.regex={pattern:ut.pattern,flags:ut.flags},T;case X.num:case X.string:return this.parseLiteral(this.value);case X._null:case X._true:case X._false:return T=this.startNode(),T.value=this.type===X._null?null:this.type===X._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case X.parenL:var ct=this.start,lr=this.parseParenAndDistinguishExpression(F);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(lr)&&(_.parenthesizedAssign=ct),_.parenthesizedBind<0&&(_.parenthesizedBind=ct)),lr;case X.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(X.bracketR,!0,!0,_),this.finishNode(T,"ArrayExpression");case X.braceL:return this.parseObj(!1,_);case X._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case X._class:return this.parseClass(this.startNode(),!1);case X._new:return this.parseNew();case X.backQuote:return this.parseTemplate();case X._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Rn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case X.parenL:return this.parseDynamicImport(_);case X.dot:return _.meta=T,this.parseImportMeta(_);default:this.unexpected()}},Rn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(X.parenR)){var T=this.start;this.eat(X.comma)&&this.eat(X.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(_,"ImportExpression")},Rn.parseImportMeta=function(_){this.next();var T=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Rn.parseLiteral=function(_){var T=this.startNode();return T.value=_,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},Rn.parseParenExpression=function(){this.expect(X.parenL);var _=this.parseExpression();return this.expect(X.parenR),_},Rn.parseParenAndDistinguishExpression=function(_){var T=this.start,F=this.startLoc,O,Y=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var me=this.start,Ge=this.startLoc,ut=[],ct=!0,lr=!1,mr=new ge,cn=this.yieldPos,ei=this.awaitPos,Hn;for(this.yieldPos=0,this.awaitPos=0;this.type!==X.parenR;)if(ct?ct=!1:this.expect(X.comma),Y&&this.afterTrailingComma(X.parenR,!0)){lr=!0;break}else if(this.type===X.ellipsis){Hn=this.start,ut.push(this.parseParenItem(this.parseRestBinding())),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ut.push(this.parseMaybeAssign(!1,mr,this.parseParenItem));var vi=this.start,ca=this.startLoc;if(this.expect(X.parenR),_&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(mr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=cn,this.awaitPos=ei,this.parseParenArrowList(T,F,ut);(!ut.length||lr)&&this.unexpected(this.lastTokStart),Hn&&this.unexpected(Hn),this.checkExpressionErrors(mr,!0),this.yieldPos=cn||this.yieldPos,this.awaitPos=ei||this.awaitPos,ut.length>1?(O=this.startNodeAt(me,Ge),O.expressions=ut,this.finishNodeAt(O,"SequenceExpression",vi,ca)):O=ut[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var xa=this.startNodeAt(T,F);return xa.expression=O,this.finishNode(xa,"ParenthesizedExpression")}else return O},Rn.parseParenItem=function(_){return _},Rn.parseParenArrowList=function(_,T,F){return this.parseArrowExpression(this.startNodeAt(_,T),F)};var bi=[];Rn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(X.dot)){_.meta=T;var F=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),F&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var O=this.start,Y=this.startLoc,me=this.type===X._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),O,Y,!0),me&&_.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(X.parenL)?_.arguments=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1):_.arguments=bi,this.finishNode(_,"NewExpression")},Rn.parseTemplateElement=function(_){var T=_.isTagged,F=this.startNode();return this.type===X.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),F.value={raw:this.value,cooked:null}):F.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),F.tail=this.type===X.backQuote,this.finishNode(F,"TemplateElement")},Rn.parseTemplate=function(_){_===void 0&&(_={});var T=_.isTagged;T===void 0&&(T=!1);var F=this.startNode();this.next(),F.expressions=[];var O=this.parseTemplateElement({isTagged:T});for(F.quasis=[O];!O.tail;)this.type===X.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(X.dollarBraceL),F.expressions.push(this.parseExpression()),this.expect(X.braceR),F.quasis.push(O=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(F,"TemplateLiteral")},Rn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===X.name||this.type===X.num||this.type===X.string||this.type===X.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===X.star)&&!Xt.test(this.input.slice(this.lastTokEnd,this.start))},Rn.parseObj=function(_,T){var F=this.startNode(),O=!0,Y={};for(F.properties=[],this.next();!this.eat(X.braceR);){if(O)O=!1;else if(this.expect(X.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(X.braceR))break;var me=this.parseProperty(_,T);_||this.checkPropClash(me,Y,T),F.properties.push(me)}return this.finishNode(F,_?"ObjectPattern":"ObjectExpression")},Rn.parseProperty=function(_,T){var F=this.startNode(),O,Y,me,Ge;if(this.options.ecmaVersion>=9&&this.eat(X.ellipsis))return _?(F.argument=this.parseIdent(!1),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(F,"RestElement")):(this.type===X.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),F.argument=this.parseMaybeAssign(!1,T),this.type===X.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(F,"SpreadElement"));this.options.ecmaVersion>=6&&(F.method=!1,F.shorthand=!1,(_||T)&&(me=this.start,Ge=this.startLoc),_||(O=this.eat(X.star)));var ut=this.containsEsc;return this.parsePropertyName(F),!_&&!ut&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(F)?(Y=!0,O=this.options.ecmaVersion>=9&&this.eat(X.star),this.parsePropertyName(F,T)):Y=!1,this.parsePropertyValue(F,_,O,Y,me,Ge,T,ut),this.finishNode(F,"Property")},Rn.parsePropertyValue=function(_,T,F,O,Y,me,Ge,ut){if((F||O)&&this.type===X.colon&&this.unexpected(),this.eat(X.colon))_.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Ge),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===X.parenL)T&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(F,O);else if(!T&&!ut&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==X.comma&&this.type!==X.braceR&&this.type!==X.eq){(F||O)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var ct=_.kind==="get"?0:1;if(_.value.params.length!==ct){var lr=_.value.start;_.kind==="get"?this.raiseRecoverable(lr,"getter should have no params"):this.raiseRecoverable(lr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((F||O)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=Y),_.kind="init",T?_.value=this.parseMaybeDefault(Y,me,_.key):this.type===X.eq&&Ge?(Ge.shorthandAssign<0&&(Ge.shorthandAssign=this.start),_.value=this.parseMaybeDefault(Y,me,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Rn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(X.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(X.bracketR),_.key;_.computed=!1}return _.key=this.type===X.num||this.type===X.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Rn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Rn.parseMethod=function(_,T,F){var O=this.startNode(),Y=this.yieldPos,me=this.awaitPos,Ge=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=_),this.options.ecmaVersion>=8&&(O.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(zi(T,O.generator)|Wn|(F?ma:0)),this.expect(X.parenL),O.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=Y,this.awaitPos=me,this.awaitIdentPos=Ge,this.finishNode(O,"FunctionExpression")},Rn.parseArrowExpression=function(_,T,F){var O=this.yieldPos,Y=this.awaitPos,me=this.awaitIdentPos;return this.enterScope(zi(F,!1)|Si),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!F),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(T,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=O,this.awaitPos=Y,this.awaitIdentPos=me,this.finishNode(_,"ArrowFunctionExpression")},Rn.parseFunctionBody=function(_,T,F){var O=T&&this.type!==X.braceL,Y=this.strict,me=!1;if(O)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var Ge=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!Y||Ge)&&(me=this.strictDirective(this.end),me&&Ge&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ut=this.labels;this.labels=[],me&&(this.strict=!0),this.checkParams(_,!Y&&!me&&!T&&!F&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,la),_.body=this.parseBlock(!1,void 0,me&&!Y),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ut}this.exitScope()},Rn.isSimpleParamList=function(_){for(var T=0,F=_;T<F.length;T+=1){var O=F[T];if(O.type!=="Identifier")return!1}return!0},Rn.checkParams=function(_,T){for(var F={},O=0,Y=_.params;O<Y.length;O+=1){var me=Y[O];this.checkLVal(me,Wi,T?null:F)}},Rn.parseExprList=function(_,T,F,O){for(var Y=[],me=!0;!this.eat(_);){if(me)me=!1;else if(this.expect(X.comma),T&&this.afterTrailingComma(_))break;var Ge=void 0;F&&this.type===X.comma?Ge=null:this.type===X.ellipsis?(Ge=this.parseSpread(O),O&&this.type===X.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):Ge=this.parseMaybeAssign(!1,O),Y.push(Ge)}return Y},Rn.checkUnreserved=function(_){var T=_.start,F=_.end,O=_.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(T,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,F).indexOf("\\")!==-1)){var Y=this.strict?this.reservedWordsStrict:this.reservedWords;Y.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+O+"' is reserved"))}},Rn.parseIdent=function(_,T){var F=this.startNode();return this.type===X.name?F.name=this.value:this.type.keyword?(F.name=this.type.keyword,(F.name==="class"||F.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(F,"Identifier"),_||(this.checkUnreserved(F),F.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=F.start)),F},Rn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===X.semi||this.canInsertSemicolon()||this.type!==X.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(X.star),T.argument=this.parseMaybeAssign(_)),this.finishNode(T,"YieldExpression")},Rn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var gi=Ui.prototype;gi.raise=function(_,T){var F=dt(this.input,_);T+=" ("+F.line+":"+F.column+")";var O=new SyntaxError(T);throw O.pos=_,O.loc=F,O.raisedAt=this.pos,O},gi.raiseRecoverable=gi.raise,gi.curPosition=function(){if(this.options.locations)return new _e(this.curLine,this.pos-this.lineStart)};var En=Ui.prototype,Oi=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};En.enterScope=function(_){this.scopeStack.push(new Oi(_))},En.exitScope=function(){this.scopeStack.pop()},En.treatFunctionsAsVarInScope=function(_){return _.flags&gn||!this.inModule&&_.flags&Qn},En.declareName=function(_,T,F){var O=!1;if(T===ga){var Y=this.currentScope();O=Y.lexical.indexOf(_)>-1||Y.functions.indexOf(_)>-1||Y.var.indexOf(_)>-1,Y.lexical.push(_),this.inModule&&Y.flags&Qn&&delete this.undefinedExports[_]}else if(T===Va){var me=this.currentScope();me.lexical.push(_)}else if(T===vo){var Ge=this.currentScope();this.treatFunctionsAsVar?O=Ge.lexical.indexOf(_)>-1:O=Ge.lexical.indexOf(_)>-1||Ge.var.indexOf(_)>-1,Ge.functions.push(_)}else for(var ut=this.scopeStack.length-1;ut>=0;--ut){var ct=this.scopeStack[ut];if(ct.lexical.indexOf(_)>-1&&!(ct.flags&si&&ct.lexical[0]===_)||!this.treatFunctionsAsVarInScope(ct)&&ct.functions.indexOf(_)>-1){O=!0;break}if(ct.var.push(_),this.inModule&&ct.flags&Qn&&delete this.undefinedExports[_],ct.flags&ea)break}O&&this.raiseRecoverable(F,"Identifier '"+_+"' has already been declared")},En.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},En.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},En.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&ea)return T}},En.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&ea&&!(T.flags&Si))return T}};var Ii=function(T,F,O){this.type="",this.start=F,this.end=0,T.options.locations&&(this.loc=new Et(T,O)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[F,0])},ja=Ui.prototype;ja.startNode=function(){return new Ii(this,this.start,this.startLoc)},ja.startNodeAt=function(_,T){return new Ii(this,_,T)};function ps(_,T,F,O){return _.type=T,_.end=F,this.options.locations&&(_.loc.end=O),this.options.ranges&&(_.range[1]=F),_}ja.finishNode=function(_,T){return ps.call(this,_,T,this.lastTokEnd,this.lastTokEndLoc)},ja.finishNodeAt=function(_,T,F,O){return ps.call(this,_,T,F,O)};var Ho=function(T,F,O,Y,me){this.token=T,this.isExpr=!!F,this.preserveSpace=!!O,this.override=Y,this.generator=!!me},ka={b_stat:new Ho("{",!1),b_expr:new Ho("{",!0),b_tmpl:new Ho("${",!1),p_stat:new Ho("(",!1),p_expr:new Ho("(",!0),q_tmpl:new Ho("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Ho("function",!1),f_expr:new Ho("function",!0),f_expr_gen:new Ho("function",!0,!1,null,!0),f_gen:new Ho("function",!1,!1,null,!0)},ya=Ui.prototype;ya.initialContext=function(){return[ka.b_stat]},ya.braceIsBlock=function(_){var T=this.curContext();return T===ka.f_expr||T===ka.f_stat?!0:_===X.colon&&(T===ka.b_stat||T===ka.b_expr)?!T.isExpr:_===X._return||_===X.name&&this.exprAllowed?Xt.test(this.input.slice(this.lastTokEnd,this.start)):_===X._else||_===X.semi||_===X.eof||_===X.parenR||_===X.arrow?!0:_===X.braceL?T===ka.b_stat:_===X._var||_===X._const||_===X.name?!1:!this.exprAllowed},ya.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var T=this.context[_];if(T.token==="function")return T.generator}return!1},ya.updateContext=function(_){var T,F=this.type;F.keyword&&_===X.dot?this.exprAllowed=!1:(T=F.updateContext)?T.call(this,_):this.exprAllowed=F.beforeExpr},X.parenR.updateContext=X.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===ka.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},X.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?ka.b_stat:ka.b_expr),this.exprAllowed=!0},X.dollarBraceL.updateContext=function(){this.context.push(ka.b_tmpl),this.exprAllowed=!0},X.parenL.updateContext=function(_){var T=_===X._if||_===X._for||_===X._with||_===X._while;this.context.push(T?ka.p_stat:ka.p_expr),this.exprAllowed=!0},X.incDec.updateContext=function(){},X._function.updateContext=X._class.updateContext=function(_){_.beforeExpr&&_!==X.semi&&_!==X._else&&!(_===X._return&&Xt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===X.colon||_===X.braceL)&&this.curContext()===ka.b_stat)?this.context.push(ka.f_expr):this.context.push(ka.f_stat),this.exprAllowed=!1},X.backQuote.updateContext=function(){this.curContext()===ka.q_tmpl?this.context.pop():this.context.push(ka.q_tmpl),this.exprAllowed=!1},X.star.updateContext=function(_){if(_===X._function){var T=this.context.length-1;this.context[T]===ka.f_expr?this.context[T]=ka.f_expr_gen:this.context[T]=ka.f_gen}this.exprAllowed=!0},X.name.updateContext=function(_){var T=!1;this.options.ecmaVersion>=6&&_!==X.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var j="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",K=j+" Extended_Pictographic",re=K,ye={9:j,10:K,11:re},ke="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",je="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Je=je+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",le=Je+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",De={9:je,10:Je,11:le},vt={};function fr(_){var T=vt[_]={binary:A(ye[_]+" "+ke),nonBinary:{General_Category:A(ke),Script:A(De[_])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}fr(9),fr(10),fr(11);var Rt=Ui.prototype,Lt=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=vt[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Lt.prototype.reset=function(T,F,O){var Y=O.indexOf("u")!==-1;this.start=T|0,this.source=F+"",this.flags=O,this.switchU=Y&&this.parser.options.ecmaVersion>=6,this.switchN=Y&&this.parser.options.ecmaVersion>=9},Lt.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},Lt.prototype.at=function(T,F){F===void 0&&(F=!1);var O=this.source,Y=O.length;if(T>=Y)return-1;var me=O.charCodeAt(T);if(!(F||this.switchU)||me<=55295||me>=57344||T+1>=Y)return me;var Ge=O.charCodeAt(T+1);return Ge>=56320&&Ge<=57343?(me<<10)+Ge-56613888:me},Lt.prototype.nextIndex=function(T,F){F===void 0&&(F=!1);var O=this.source,Y=O.length;if(T>=Y)return Y;var me=O.charCodeAt(T),Ge;return!(F||this.switchU)||me<=55295||me>=57344||T+1>=Y||(Ge=O.charCodeAt(T+1))<56320||Ge>57343?T+1:T+2},Lt.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},Lt.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},Lt.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},Lt.prototype.eat=function(T,F){return F===void 0&&(F=!1),this.current(F)===T?(this.advance(F),!0):!1};function vr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Rt.validateRegExpFlags=function(_){for(var T=_.validFlags,F=_.flags,O=0;O<F.length;O++){var Y=F.charAt(O);T.indexOf(Y)===-1&&this.raise(_.start,"Invalid regular expression flag"),F.indexOf(Y,O+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Rt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Rt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var T=0,F=_.backReferenceNames;T<F.length;T+=1){var O=F[T];_.groupNames.indexOf(O)===-1&&_.raise("Invalid named capture referenced")}},Rt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Rt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Rt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Rt.regexp_eatAssertion=function(_){var T=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=T}if(_.eat(40)&&_.eat(63)){var F=!1;if(this.options.ecmaVersion>=9&&(F=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!F,!0}return _.pos=T,!1},Rt.regexp_eatQuantifier=function(_,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(_,T)?(_.eat(63),!0):!1},Rt.regexp_eatQuantifierPrefix=function(_,T){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,T)},Rt.regexp_eatBracedQuantifier=function(_,T){var F=_.pos;if(_.eat(123)){var O=0,Y=-1;if(this.regexp_eatDecimalDigits(_)&&(O=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(Y=_.lastIntValue),_.eat(125)))return Y!==-1&&Y<O&&!T&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!T&&_.raise("Incomplete quantifier"),_.pos=F}return!1},Rt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Rt.regexp_eatReverseSolidusAtomEscape=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=T}return!1},Rt.regexp_eatUncapturingGroup=function(_){var T=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=T}return!1},Rt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Rt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Rt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Rt.regexp_eatSyntaxCharacter=function(_){var T=_.current();return yn(T)?(_.lastIntValue=T,_.advance(),!0):!1};function yn(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Rt.regexp_eatPatternCharacters=function(_){for(var T=_.pos,F=0;(F=_.current())!==-1&&!yn(F);)_.advance();return _.pos!==T},Rt.regexp_eatExtendedPatternCharacter=function(_){var T=_.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(_.advance(),!0):!1},Rt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Rt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Rt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=vr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=vr(_.lastIntValue);return!0}return!1},Rt.regexp_eatRegExpIdentifierStart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,O=_.current(F);return _.advance(F),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(O=_.lastIntValue),ln(O)?(_.lastIntValue=O,!0):(_.pos=T,!1)};function ln(_){return Jt(_,!0)||_===36||_===95}Rt.regexp_eatRegExpIdentifierPart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,O=_.current(F);return _.advance(F),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(O=_.lastIntValue),wt(O)?(_.lastIntValue=O,!0):(_.pos=T,!1)};function wt(_){return ir(_,!0)||_===36||_===95||_===8204||_===8205}Rt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Rt.regexp_eatBackReference=function(_){var T=_.pos;if(this.regexp_eatDecimalEscape(_)){var F=_.lastIntValue;if(_.switchU)return F>_.maxBackReference&&(_.maxBackReference=F),!0;if(F<=_.numCapturingParens)return!0;_.pos=T}return!1},Rt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Rt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Rt.regexp_eatCControlLetter=function(_){var T=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=T}return!1},Rt.regexp_eatZero=function(_){return _.current()===48&&!Ai(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Rt.regexp_eatControlEscape=function(_){var T=_.current();return T===116?(_.lastIntValue=9,_.advance(),!0):T===110?(_.lastIntValue=10,_.advance(),!0):T===118?(_.lastIntValue=11,_.advance(),!0):T===102?(_.lastIntValue=12,_.advance(),!0):T===114?(_.lastIntValue=13,_.advance(),!0):!1},Rt.regexp_eatControlLetter=function(_){var T=_.current();return nn(T)?(_.lastIntValue=T%32,_.advance(),!0):!1};function nn(_){return _>=65&&_<=90||_>=97&&_<=122}Rt.regexp_eatRegExpUnicodeEscapeSequence=function(_,T){T===void 0&&(T=!1);var F=_.pos,O=T||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var Y=_.lastIntValue;if(O&&Y>=55296&&Y<=56319){var me=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var Ge=_.lastIntValue;if(Ge>=56320&&Ge<=57343)return _.lastIntValue=(Y-55296)*1024+(Ge-56320)+65536,!0}_.pos=me,_.lastIntValue=Y}return!0}if(O&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Fr(_.lastIntValue))return!0;O&&_.raise("Invalid unicode escape"),_.pos=F}return!1};function Fr(_){return _>=0&&_<=1114111}Rt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var T=_.current();return T!==99&&(!_.switchN||T!==107)?(_.lastIntValue=T,_.advance(),!0):!1},Rt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var T=_.current();if(T>=49&&T<=57){do _.lastIntValue=10*_.lastIntValue+(T-48),_.advance();while((T=_.current())>=48&&T<=57);return!0}return!1},Rt.regexp_eatCharacterClassEscape=function(_){var T=_.current();if(Vr(T))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Vr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Rt.regexp_eatUnicodePropertyValueExpression=function(_){var T=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var F=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var O=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,F,O),!0}}if(_.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var Y=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,Y),!0}return!1},Rt.regexp_validateUnicodePropertyNameAndValue=function(_,T,F){Kr(_.unicodeProperties.nonBinary,T)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[T].test(F)||_.raise("Invalid property value")},Rt.regexp_validateUnicodePropertyNameOrValue=function(_,T){_.unicodeProperties.binary.test(T)||_.raise("Invalid property name")},Rt.regexp_eatUnicodePropertyName=function(_){var T=0;for(_.lastStringValue="";di(T=_.current());)_.lastStringValue+=vr(T),_.advance();return _.lastStringValue!==""};function di(_){return nn(_)||_===95}Rt.regexp_eatUnicodePropertyValue=function(_){var T=0;for(_.lastStringValue="";en(T=_.current());)_.lastStringValue+=vr(T),_.advance();return _.lastStringValue!==""};function en(_){return di(_)||Ai(_)}Rt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Rt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Rt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var T=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var F=_.lastIntValue;_.switchU&&(T===-1||F===-1)&&_.raise("Invalid character class"),T!==-1&&F!==-1&&T>F&&_.raise("Range out of order in character class")}}},Rt.regexp_eatClassAtom=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var F=_.current();(F===99||Ci(F))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=T}var O=_.current();return O!==93?(_.lastIntValue=O,_.advance(),!0):!1},Rt.regexp_eatClassEscape=function(_){var T=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=T}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Rt.regexp_eatClassControlLetter=function(_){var T=_.current();return Ai(T)||T===95?(_.lastIntValue=T%32,_.advance(),!0):!1},Rt.regexp_eatHexEscapeSequence=function(_){var T=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=T}return!1},Rt.regexp_eatDecimalDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;Ai(F=_.current());)_.lastIntValue=10*_.lastIntValue+(F-48),_.advance();return _.pos!==T};function Ai(_){return _>=48&&_<=57}Rt.regexp_eatHexDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;Vn(F=_.current());)_.lastIntValue=16*_.lastIntValue+li(F),_.advance();return _.pos!==T};function Vn(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function li(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Rt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var T=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var F=_.lastIntValue;T<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=T*64+F*8+_.lastIntValue:_.lastIntValue=T*8+F}else _.lastIntValue=T;return!0}return!1},Rt.regexp_eatOctalDigit=function(_){var T=_.current();return Ci(T)?(_.lastIntValue=T-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Ci(_){return _>=48&&_<=55}Rt.regexp_eatFixedHexDigits=function(_,T){var F=_.pos;_.lastIntValue=0;for(var O=0;O<T;++O){var Y=_.current();if(!Vn(Y))return _.pos=F,!1;_.lastIntValue=16*_.lastIntValue+li(Y),_.advance()}return!0};var Ei=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new Et(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},Xn=Ui.prototype;Xn.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ei(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Xn.getToken=function(){return this.next(),new Ei(this)},typeof Symbol!="undefined"&&(Xn[Symbol.iterator]=function(){var _=this;return{next:function(){var T=_.getToken();return{done:T.type===X.eof,value:T}}}}),Xn.curContext=function(){return this.context[this.context.length-1]},Xn.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(X.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},Xn.readToken=function(_){return Jt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},Xn.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var T=this.input.charCodeAt(this.pos+1);return(_<<10)+T-56613888},Xn.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),T=this.pos,F=this.input.indexOf("*/",this.pos+=2);if(F===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=F+2,this.options.locations){ft.lastIndex=T;for(var O;(O=ft.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,F),T,this.pos,_,this.curPosition())},Xn.skipLineComment=function(_){for(var T=this.pos,F=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!He(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+_,this.pos),T,this.pos,F,this.curPosition())},Xn.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&lt.test(String.fromCharCode(_)))++this.pos;else break e}}},Xn.finishToken=function(_,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var F=this.type;this.type=_,this.value=T,this.updateContext(F)},Xn.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&T===46?(this.pos+=3,this.finishToken(X.ellipsis)):(++this.pos,this.finishToken(X.dot))},Xn.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(X.assign,2):this.finishOp(X.slash,1)},Xn.readToken_mult_modulo_exp=function(_){var T=this.input.charCodeAt(this.pos+1),F=1,O=_===42?X.star:X.modulo;return this.options.ecmaVersion>=7&&_===42&&T===42&&(++F,O=X.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(X.assign,F+1):this.finishOp(O,F)},Xn.readToken_pipe_amp=function(_){var T=this.input.charCodeAt(this.pos+1);if(T===_){if(this.options.ecmaVersion>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(X.assign,3)}return this.finishOp(_===124?X.logicalOR:X.logicalAND,2)}return T===61?this.finishOp(X.assign,2):this.finishOp(_===124?X.bitwiseOR:X.bitwiseAND,1)},Xn.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(X.assign,2):this.finishOp(X.bitwiseXOR,1)},Xn.readToken_plus_min=function(_){var T=this.input.charCodeAt(this.pos+1);return T===_?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Xt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(X.incDec,2):T===61?this.finishOp(X.assign,2):this.finishOp(X.plusMin,1)},Xn.readToken_lt_gt=function(_){var T=this.input.charCodeAt(this.pos+1),F=1;return T===_?(F=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+F)===61?this.finishOp(X.assign,F+1):this.finishOp(X.bitShift,F)):T===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(F=2),this.finishOp(X.relational,F))},Xn.readToken_eq_excl=function(_){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(X.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(X.arrow)):this.finishOp(_===61?X.eq:X.prefix,1)},Xn.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var F=this.input.charCodeAt(this.pos+2);if(F<48||F>57)return this.finishOp(X.questionDot,2)}if(T===63){if(_>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(X.assign,3)}return this.finishOp(X.coalesce,2)}}return this.finishOp(X.question,1)},Xn.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(X.parenL);case 41:return++this.pos,this.finishToken(X.parenR);case 59:return++this.pos,this.finishToken(X.semi);case 44:return++this.pos,this.finishToken(X.comma);case 91:return++this.pos,this.finishToken(X.bracketL);case 93:return++this.pos,this.finishToken(X.bracketR);case 123:return++this.pos,this.finishToken(X.braceL);case 125:return++this.pos,this.finishToken(X.braceR);case 58:return++this.pos,this.finishToken(X.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(X.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(X.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ki(_)+"'")},Xn.finishOp=function(_,T){var F=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(_,F)},Xn.readRegexp=function(){for(var _,T,F=this.pos;;){this.pos>=this.input.length&&this.raise(F,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Xt.test(O)&&this.raise(F,"Unterminated regular expression"),_)_=!1;else{if(O==="[")T=!0;else if(O==="]"&&T)T=!1;else if(O==="/"&&!T)break;_=O==="\\"}++this.pos}var Y=this.input.slice(F,this.pos);++this.pos;var me=this.pos,Ge=this.readWord1();this.containsEsc&&this.unexpected(me);var ut=this.regexpState||(this.regexpState=new Lt(this));ut.reset(F,Y,Ge),this.validateRegExpFlags(ut),this.validateRegExpPattern(ut);var ct=null;try{ct=new RegExp(Y,Ge)}catch(lr){}return this.finishToken(X.regexp,{pattern:Y,flags:Ge,value:ct})},Xn.readInt=function(_,T,F){for(var O=this.options.ecmaVersion>=12&&T===void 0,Y=F&&this.input.charCodeAt(this.pos)===48,me=this.pos,Ge=0,ut=0,ct=0,lr=T==null?Infinity:T;ct<lr;++ct,++this.pos){var mr=this.input.charCodeAt(this.pos),cn=void 0;if(O&&mr===95){Y&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ut===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),ct===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ut=mr;continue}if(mr>=97?cn=mr-97+10:mr>=65?cn=mr-65+10:mr>=48&&mr<=57?cn=mr-48:cn=Infinity,cn>=_)break;ut=mr,Ge=Ge*_+cn}return O&&ut===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===me||T!=null&&this.pos-me!==T?null:Ge};function Bt(_,T){return T?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Yt(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}Xn.readRadixNumber=function(_){var T=this.pos;this.pos+=2;var F=this.readInt(_);return F==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(F=Yt(this.input.slice(T,this.pos)),++this.pos):Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,F)},Xn.readNumber=function(_){var T=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var F=this.pos-T>=2&&this.input.charCodeAt(T)===48;F&&this.strict&&this.raise(T,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!F&&!_&&this.options.ecmaVersion>=11&&O===110){var Y=Yt(this.input.slice(T,this.pos));return++this.pos,Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,Y)}F&&/[89]/.test(this.input.slice(T,this.pos))&&(F=!1),O===46&&!F&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!F&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var me=Bt(this.input.slice(T,this.pos),F);return this.finishToken(X.num,me)},Xn.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),T;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var F=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(F,"Code point out of bounds")}else T=this.readHexChar(4);return T};function Ki(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Xn.readString=function(_){for(var T="",F=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===_)break;O===92?(T+=this.input.slice(F,this.pos),T+=this.readEscapedChar(!1),F=this.pos):(He(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(F,this.pos++),this.finishToken(X.string,T)};var Jn={};Xn.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Jn)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},Xn.invalidStringToken=function(_,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Jn;this.raise(_,T)},Xn.readTmplToken=function(){for(var _="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var F=this.input.charCodeAt(this.pos);if(F===96||F===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===X.template||this.type===X.invalidTemplate)?F===36?(this.pos+=2,this.finishToken(X.dollarBraceL)):(++this.pos,this.finishToken(X.backQuote)):(_+=this.input.slice(T,this.pos),this.finishToken(X.template,_));if(F===92)_+=this.input.slice(T,this.pos),_+=this.readEscapedChar(!0),T=this.pos;else if(He(F)){switch(_+=this.input.slice(T,this.pos),++this.pos,F){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(F);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},Xn.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(X.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Xn.readEscapedChar=function(_){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ki(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var F=this.pos-1;return this.invalidStringToken(F,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],Y=parseInt(O,8);return Y>255&&(O=O.slice(0,-1),Y=parseInt(O,8)),this.pos+=O.length-1,T=this.input.charCodeAt(this.pos),(O!=="0"||T===56||T===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-O.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(Y)}return He(T)?"":String.fromCharCode(T)}},Xn.readHexChar=function(_){var T=this.pos,F=this.readInt(16,_);return F===null&&this.invalidStringToken(T,"Bad character escape sequence"),F},Xn.readWord1=function(){this.containsEsc=!1;for(var _="",T=!0,F=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var Y=this.fullCharCodeAtPos();if(ir(Y,O))this.pos+=Y<=65535?1:2;else if(Y===92){this.containsEsc=!0,_+=this.input.slice(F,this.pos);var me=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Ge=this.readCodePoint();(T?Jt:ir)(Ge,O)||this.invalidStringToken(me,"Invalid Unicode escape"),_+=Ki(Ge),F=this.pos}else break;T=!1}return _+this.input.slice(F,this.pos)},Xn.readWord=function(){var _=this.readWord1(),T=X.name;return this.keywords.test(_)&&(T=ht[_]),this.finishToken(T,_)};var Di="7.4.1";Ui.acorn={Parser:Ui,version:Di,defaultOptions:Ft,Position:_e,SourceLocation:Et,getLineInfo:dt,Node:Ii,TokenType:yt,tokTypes:X,keywordTypes:ht,TokContext:Ho,tokContexts:ka,isIdentifierChar:ir,isIdentifierStart:Jt,Token:Ei,isNewLine:He,lineBreak:Xt,lineBreakG:ft,nonASCIIwhitespace:lt};function Sa(_,T){return Ui.parse(_,T)}function bn(_,T,F){return Ui.parseExpressionAt(_,T,F)}function Wr(_,T){return Ui.tokenizer(_,T)}function At(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,_.__proto__=T}function Ro(_){var T=typeof Map=="function"?new Map:void 0;return Ro=function(O){if(O===null||!Au(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(O))return T.get(O);T.set(O,Y)}function Y(){return $i(O,arguments,_a(this).constructor)}return Y.prototype=Object.create(O.prototype,{constructor:{value:Y,enumerable:!1,writable:!0,configurable:!0}}),$a(Y,O)},Ro(_)}function be(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function $i(_,T,F){return be()?$i=Reflect.construct:$i=function(Y,me,Ge){var ut=[null];ut.push.apply(ut,me);var ct=Function.bind.apply(Y,ut),lr=new ct;return Ge&&$a(lr,Ge.prototype),lr},$i.apply(null,arguments)}function Au(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function $a(_,T){return $a=Object.setPrototypeOf||function(O,Y){return O.__proto__=Y,O},$a(_,T)}function _a(_){return _a=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},_a(_)}var La=function(_){At(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ro(Error)),ta=function(_){At(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ro(SyntaxError)),ko=function(_){At(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ro(ReferenceError)),Lo=function(_){At(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ro(TypeError)),Tu=function(_){At(T,_);function T(){return _.apply(this,arguments)||this}return T}(La),mo=function(_){At(T,_);function T(){return _.apply(this,arguments)||this}return T}(ta),wo=function(_){At(T,_);function T(){return _.apply(this,arguments)||this}return T}(ko),aa={UnknownError:[3001,"%0",Tu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Tu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",wo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",wo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",wo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",wo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",wo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",wo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",wo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",wo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",wo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",wo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",ko],VariableUndefinedReferenceError:[2002,"%0 is not defined",ko],IsNotConstructor:[2003,"%0 is not a constructor",Lo]};function Ga(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Do(_,T,F){return Ga()?Do=Reflect.construct:Do=function(Y,me,Ge){var ut=[null];ut.push.apply(ut,me);var ct=Function.bind.apply(Y,ut),lr=new ct;return Ge&&Ha(lr,Ge.prototype),lr},Do.apply(null,arguments)}function Ha(_,T){return Ha=Object.setPrototypeOf||function(O,Y){return O.__proto__=Y,O},Ha(_,T)}var Ls="0.0.3";function Uu(_,T){Object.defineProperty(_,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var ds=Object.prototype.hasOwnProperty,ee=Symbol("Break"),Ee=Symbol("Continue"),Xe=Symbol("DefaultCase"),Pt=Symbol("EmptyStatementReturn"),Pr=Symbol("WithScopeName"),An=Symbol("SuperScopeName"),Ti=Symbol("RootScopeName"),Qa=Symbol("GlobalScopeName");function Aa(_){return typeof _=="function"}var Fa=function(){function _(F){this.interpreter=F}var T=_.prototype;return T.generator=function(){var O=this.interpreter;function Y(){return this.getCurrentScope()}function me(){return this.getGlobalScope()}function Ge(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:Y.bind(O),getGlobalScope:me.bind(O),getCurrentContext:Ge.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},_}();function Fo(_,T,F){if(F===void 0&&(F=!0),!(_ instanceof Fa))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var O=_.generator(),Y=O.getOptions(),me={timeout:Y.timeout,_initEnv:function(){F||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},Ge=F?O.getGlobalScope():O.getCurrentScope(),ut=new go(Ge,me);return ut.evaluate(T)}}Object.defineProperty(Fo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function vs(_){if(!(_ instanceof Fa))throw new Error("Illegal call");for(var T=_.generator(),F=arguments.length,O=new Array(F>1?F-1:0),Y=1;Y<F;Y++)O[Y-1]=arguments[Y];var me=O.pop(),Ge=new go(T.getGlobalScope(),T.getOptions()),ut=`
		    (function anonymous(`+O.join(",")+`){
		        `+me+`
		    });
		    `;return Ge.evaluate(ut)}Object.defineProperty(vs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Wo=function(T){this.value=T},Ao=function(T){this.value=T},To=function(T){this.value=T},Ms=function(T,F,O){F===void 0&&(F=null),this.name=O,this.parent=F,this.data=T,this.labelStack=[]};function Hs(){}function Ws(_,T){return _===void 0&&(_=null),new Ms(Object.create(null),_,T)}function ms(_){return Object.create(_)}var va={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Fo,Function:vs};typeof JSON!="undefined"&&(va.JSON=JSON),typeof Promise!="undefined"&&(va.Promise=Promise),typeof Set!="undefined"&&(va.Set=Set),typeof Map!="undefined"&&(va.Map=Map),typeof Symbol!="undefined"&&(va.Symbol=Symbol),typeof Proxy!="undefined"&&(va.Proxy=Proxy),typeof WeakMap!="undefined"&&(va.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(va.WeakSet=WeakSet),typeof Reflect!="undefined"&&(va.Reflect=Reflect);var go=function(){function _(F,O){F===void 0&&(F=_.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||_.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?_.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=F||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=_.prototype;return T.initEnvironment=function(O){var Y;if(O instanceof Ms)Y=O;else{var me=null,Ge=this.createSuperScope(O);this.options.rootContext&&(me=new Ms(ms(this.options.rootContext),Ge,Ti)),Y=new Ms(O,me||Ge,Qa)}this.globalScope=Y,this.currentScope=this.globalScope,this.globalContext=Y.data,this.currentContext=Y.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ut=this.options._initEnv;ut&&ut.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(O){return O instanceof Tu||O instanceof wo||O instanceof mo},T.createSuperScope=function(O){var Y=Object.assign({},va),me=Object.keys(Y);return me.forEach(function(Ge){Ge in O&&delete Y[Ge]}),new Ms(Y,null,An)},T.setCurrentContext=function(O){this.currentContext=O},T.setCurrentScope=function(O){this.currentScope=O},T.evaluate=function(O){O===void 0&&(O="");var Y;if(!!O)return Y=Sa(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(Y,O)},T.appendCode=function(O){return this.evaluate(O)},T.evaluateNode=function(O,Y){var me=this;Y===void 0&&(Y=""),this.value=void 0,this.source=Y,this.sourceList.push(Y),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Ge=this.getCurrentScope(),ut=this.getCurrentContext(),ct=Ge.labelStack.concat([]),lr=this.callStack.concat([]),mr=function(){me.setCurrentScope(Ge),me.setCurrentContext(ut),Ge.labelStack=ct,me.callStack=lr};try{var cn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),cn()}catch(ei){throw ei}finally{mr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(O,Y,me){var Ge=O[1].replace("%0",String(Y));return me!==null&&(Ge+=this.getNodePosition(me||this.lastExecNode)),Ge},T.createError=function(O,Y){return new Y(O)},T.createThrowError=function(O,Y){return this.createError(O,Y)},T.createInternalThrowError=function(O,Y,me){return this.createError(this.createErrorMessage(O,Y,me),O[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,Y=Date.now();return Y-this.execStartTime>O},T.getNodePosition=function(O){if(O){var Y="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+Y:""}return""},T.createClosure=function(O){var Y=this,me;switch(O.type){case"BinaryExpression":me=this.binaryExpressionHandler(O);break;case"LogicalExpression":me=this.logicalExpressionHandler(O);break;case"UnaryExpression":me=this.unaryExpressionHandler(O);break;case"UpdateExpression":me=this.updateExpressionHandler(O);break;case"ObjectExpression":me=this.objectExpressionHandler(O);break;case"ArrayExpression":me=this.arrayExpressionHandler(O);break;case"CallExpression":me=this.callExpressionHandler(O);break;case"NewExpression":me=this.newExpressionHandler(O);break;case"MemberExpression":me=this.memberExpressionHandler(O);break;case"ThisExpression":me=this.thisExpressionHandler(O);break;case"SequenceExpression":me=this.sequenceExpressionHandler(O);break;case"Literal":me=this.literalHandler(O);break;case"Identifier":me=this.identifierHandler(O);break;case"AssignmentExpression":me=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":me=this.functionDeclarationHandler(O);break;case"VariableDeclaration":me=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":me=this.programHandler(O);break;case"ExpressionStatement":me=this.expressionStatementHandler(O);break;case"EmptyStatement":me=this.emptyStatementHandler(O);break;case"ReturnStatement":me=this.returnStatementHandler(O);break;case"FunctionExpression":me=this.functionExpressionHandler(O);break;case"IfStatement":me=this.ifStatementHandler(O);break;case"ConditionalExpression":me=this.conditionalExpressionHandler(O);break;case"ForStatement":me=this.forStatementHandler(O);break;case"WhileStatement":me=this.whileStatementHandler(O);break;case"DoWhileStatement":me=this.doWhileStatementHandler(O);break;case"ForInStatement":me=this.forInStatementHandler(O);break;case"WithStatement":me=this.withStatementHandler(O);break;case"ThrowStatement":me=this.throwStatementHandler(O);break;case"TryStatement":me=this.tryStatementHandler(O);break;case"ContinueStatement":me=this.continueStatementHandler(O);break;case"BreakStatement":me=this.breakStatementHandler(O);break;case"SwitchStatement":me=this.switchStatementHandler(O);break;case"LabeledStatement":me=this.labeledStatementHandler(O);break;case"DebuggerStatement":me=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(aa.NodeTypeSyntaxError,O.type,O)}return function(){var Ge=Y.options.timeout;if(Ge&&Ge>0&&Y.checkTimeout())throw Y.createInternalThrowError(aa.ExecutionTimeOutError,Ge,null);return Y.lastExecNode=O,me.apply(void 0,arguments)}},T.binaryExpressionHandler=function(O){var Y=this,me=this.createClosure(O.left),Ge=this.createClosure(O.right);return function(){var ut=me(),ct=Ge();switch(O.operator){case"==":return ut==ct;case"!=":return ut!=ct;case"===":return ut===ct;case"!==":return ut!==ct;case"<":return ut<ct;case"<=":return ut<=ct;case">":return ut>ct;case">=":return ut>=ct;case"<<":return ut<<ct;case">>":return ut>>ct;case">>>":return ut>>>ct;case"+":return ut+ct;case"-":return ut-ct;case"*":return ut*ct;case"**":return Math.pow(ut,ct);case"/":return ut/ct;case"%":return ut%ct;case"|":return ut|ct;case"^":return ut^ct;case"&":return ut&ct;case"in":return ut in ct;case"instanceof":return ut instanceof ct;default:throw Y.createInternalThrowError(aa.BinaryOperatorSyntaxError,O.operator,O)}}},T.logicalExpressionHandler=function(O){var Y=this,me=this.createClosure(O.left),Ge=this.createClosure(O.right);return function(){switch(O.operator){case"||":return me()||Ge();case"&&":return me()&&Ge();default:throw Y.createInternalThrowError(aa.LogicalOperatorSyntaxError,O.operator,O)}}},T.unaryExpressionHandler=function(O){var Y=this;switch(O.operator){case"delete":var me=this.createObjectGetter(O.argument),Ge=this.createNameGetter(O.argument);return function(){var mr=me(),cn=Ge();return delete mr[cn]};default:var ut;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var ct=this.createObjectGetter(O.argument),lr=this.createNameGetter(O.argument);ut=function(){return ct()[lr()]}}else ut=this.createClosure(O.argument);return function(){var mr=ut();switch(O.operator){case"-":return-mr;case"+":return+mr;case"!":return!mr;case"~":return~mr;case"void":return;case"typeof":return typeof mr;default:throw Y.createInternalThrowError(aa.UnaryOperatorSyntaxError,O.operator,O)}}}},T.updateExpressionHandler=function(O){var Y=this,me=this.createObjectGetter(O.argument),Ge=this.createNameGetter(O.argument);return function(){var ut=me(),ct=Ge();switch(Y.assertVariable(ut,ct,O),O.operator){case"++":return O.prefix?++ut[ct]:ut[ct]++;case"--":return O.prefix?--ut[ct]:ut[ct]--;default:throw Y.createInternalThrowError(aa.UpdateOperatorSyntaxError,O.operator,O)}}},T.objectExpressionHandler=function(O){var Y=this,me=[];function Ge(ct){return ct.type==="Identifier"?ct.name:ct.type==="Literal"?ct.value:this.throwError(aa.ObjectStructureSyntaxError,ct.type,ct)}var ut=Object.create(null);return O.properties.forEach(function(ct){var lr=ct.kind,mr=Ge(ct.key);(!ut[mr]||lr==="init")&&(ut[mr]={}),ut[mr][lr]=Y.createClosure(ct.value),me.push({key:mr,property:ct})}),function(){for(var ct={},lr=me.length,mr=0;mr<lr;mr++){var cn=me[mr],ei=cn.key,Hn=ut[ei],vi=Hn.init?Hn.init():void 0,ca=Hn.get?Hn.get():function(){},xa=Hn.set?Hn.set():function(Zu){};if("set"in Hn||"get"in Hn){var Zi={configurable:!0,enumerable:!0,get:ca,set:xa};Object.defineProperty(ct,ei,Zi)}else{var ys=cn.property,hu=ys.kind;ys.key.type==="Identifier"&&ys.value.type==="FunctionExpression"&&hu==="init"&&!ys.value.id&&Uu(vi,ys.key.name),ct[ei]=vi}}return ct}},T.arrayExpressionHandler=function(O){var Y=this,me=O.elements.map(function(Ge){return Ge&&Y.createClosure(Ge)});return function(){for(var Ge=me.length,ut=Array(Ge),ct=0;ct<Ge;ct++){var lr=me[ct];lr&&(ut[ct]=lr())}return ut}},T.safeObjectGet=function(O,Y,me){return O[Y]},T.createCallFunctionGetter=function(O){var Y=this;switch(O.type){case"MemberExpression":var me=this.createClosure(O.object),Ge=this.createMemberKeyGetter(O),ut=this.source;return function(){var lr=me(),mr=Ge(),cn=Y.safeObjectGet(lr,mr,O);if(!cn||!Aa(cn)){var ei=ut.slice(O.start,O.end);throw Y.createInternalThrowError(aa.FunctionUndefinedReferenceError,ei,O)}return cn.__IS_EVAL_FUNC?function(Hn){return cn(new Fa(Y),Hn,!0)}:cn.__IS_FUNCTION_FUNC?function(){for(var Hn=arguments.length,vi=new Array(Hn),ca=0;ca<Hn;ca++)vi[ca]=arguments[ca];return cn.apply(void 0,[new Fa(Y)].concat(vi))}:cn.bind(lr)};default:var ct=this.createClosure(O);return function(){var lr="";O.type==="Identifier"&&(lr=O.name);var mr=ct();if(!mr||!Aa(mr))throw Y.createInternalThrowError(aa.FunctionUndefinedReferenceError,lr,O);if(O.type==="Identifier"&&mr.__IS_EVAL_FUNC&&lr==="eval")return function(Hn){var vi=Y.getScopeFromName(lr,Y.getCurrentScope()),ca=vi.name===An||vi.name===Qa||vi.name===Ti;return mr(new Fa(Y),Hn,!ca)};if(mr.__IS_EVAL_FUNC)return function(Hn){return mr(new Fa(Y),Hn,!0)};if(mr.__IS_FUNCTION_FUNC)return function(){for(var Hn=arguments.length,vi=new Array(Hn),ca=0;ca<Hn;ca++)vi[ca]=arguments[ca];return mr.apply(void 0,[new Fa(Y)].concat(vi))};var cn=Y.options.globalContextInFunction;if(O.type==="Identifier"){var ei=Y.getIdentifierScope(O);ei.name===Pr&&(cn=ei.data)}return mr.bind(cn)}}},T.callExpressionHandler=function(O){var Y=this,me=this.createCallFunctionGetter(O.callee),Ge=O.arguments.map(function(ut){return Y.createClosure(ut)});return function(){return me().apply(void 0,Ge.map(function(ut){return ut()}))}},T.functionExpressionHandler=function(O){var Y=this,me=this,Ge=this.source,ut=this.collectDeclVars,ct=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var lr=O.id?O.id.name:"",mr=O.params.length,cn=O.params.map(function(ca){return Y.createParamNameGetter(ca)}),ei=this.createClosure(O.body),Hn=this.collectDeclVars,vi=this.collectDeclFuncs;return this.collectDeclVars=ut,this.collectDeclFuncs=ct,function(){var ca=me.getCurrentScope(),xa=function Zi(){for(var ys=arguments.length,hu=new Array(ys),Zu=0;Zu<ys;Zu++)hu[Zu]=arguments[Zu];me.callStack.push(""+lr);var Mc=me.getCurrentScope(),nl=Ws(ca,"FunctionScope("+lr+")");me.setCurrentScope(nl),me.addDeclarationsToScope(Hn,vi,nl),lr&&(nl.data[lr]=Zi),nl.data.arguments=arguments,cn.forEach(function(Pu,Iu){nl.data[Pu()]=hu[Iu]});var Pc=me.getCurrentContext();me.setCurrentContext(this);var Mu=ei();if(me.setCurrentContext(Pc),me.setCurrentScope(Mc),me.callStack.pop(),Mu instanceof Wo)return Mu.value};return Uu(xa,lr),Object.defineProperty(xa,"length",{value:mr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(xa,"toString",{value:function(){return Ge.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(xa,"valueOf",{value:function(){return Ge.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),xa}},T.newExpressionHandler=function(O){var Y=this,me=this.source,Ge=this.createClosure(O.callee),ut=O.arguments.map(function(ct){return Y.createClosure(ct)});return function(){var ct=Ge();if(!Aa(ct)||ct.__IS_EVAL_FUNC){var lr=O.callee,mr=me.slice(lr.start,lr.end);throw Y.createInternalThrowError(aa.IsNotConstructor,mr,O)}return ct.__IS_FUNCTION_FUNC?ct.apply(void 0,[new Fa(Y)].concat(ut.map(function(cn){return cn()}))):Do(ct,ut.map(function(cn){return cn()}))}},T.memberExpressionHandler=function(O){var Y=this.createClosure(O.object),me=this.createMemberKeyGetter(O);return function(){var Ge=Y(),ut=me();return Ge[ut]}},T.thisExpressionHandler=function(O){var Y=this;return function(){return Y.getCurrentContext()}},T.sequenceExpressionHandler=function(O){var Y=this,me=O.expressions.map(function(Ge){return Y.createClosure(Ge)});return function(){for(var Ge,ut=me.length,ct=0;ct<ut;ct++){var lr=me[ct];Ge=lr()}return Ge}},T.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},T.identifierHandler=function(O){var Y=this;return function(){var me=Y.getCurrentScope(),Ge=Y.getScopeDataFromName(O.name,me);return Y.assertVariable(Ge,O.name,O),Ge[O.name]}},T.getIdentifierScope=function(O){var Y=this.getCurrentScope(),me=this.getScopeFromName(O.name,Y);return me},T.assignmentExpressionHandler=function(O){var Y=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var me=this.createObjectGetter(O.left),Ge=this.createNameGetter(O.left),ut=this.createClosure(O.right);return function(){var ct=me(),lr=Ge(),mr=ut();switch(O.operator!=="="&&Y.assertVariable(ct,lr,O),O.operator){case"=":return ct[lr]=mr;case"+=":return ct[lr]+=mr;case"-=":return ct[lr]-=mr;case"*=":return ct[lr]*=mr;case"**=":return ct[lr]=Math.pow(ct[lr],mr);case"/=":return ct[lr]/=mr;case"%=":return ct[lr]%=mr;case"<<=":return ct[lr]<<=mr;case">>=":return ct[lr]>>=mr;case">>>=":return ct[lr]>>>=mr;case"&=":return ct[lr]&=mr;case"^=":return ct[lr]^=mr;case"|=":return ct[lr]|=mr;default:throw Y.createInternalThrowError(aa.AssignmentExpressionSyntaxError,O.type,O)}}},T.functionDeclarationHandler=function(O){if(O.id){var Y=this.functionExpressionHandler(O);Object.defineProperty(Y,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,Y)}return function(){return Pt}},T.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(aa.VariableTypeSyntaxError,O.type,O)},T.variableDeclarationHandler=function(O){for(var Y=this,me,Ge=[],ut=0;ut<O.declarations.length;ut++){var ct=O.declarations[ut];this.varDeclaration(this.getVariableName(ct.id)),ct.init&&Ge.push({type:"AssignmentExpression",operator:"=",left:ct.id,right:ct.init})}return Ge.length&&(me=this.createClosure({type:"BlockStatement",body:Ge})),function(){if(me){var lr=Y.isVarDeclMode;Y.isVarDeclMode=!0,me(),Y.isVarDeclMode=lr}return Pt}},T.assertVariable=function(O,Y,me){if(O===this.globalScope.data&&!(Y in O))throw this.createInternalThrowError(aa.VariableUndefinedReferenceError,Y,me)},T.programHandler=function(O){var Y=this,me=O.body.map(function(Ge){return Y.createClosure(Ge)});return function(){for(var Ge=Pt,ut=0;ut<me.length;ut++){var ct=me[ut],lr=Y.setValue(ct());if(lr!==Pt&&(Ge=lr,Ge instanceof Wo||Ge instanceof Ao||Ge instanceof To||Ge===ee||Ge===Ee))break}return Ge}},T.expressionStatementHandler=function(O){return this.createClosure(O.expression)},T.emptyStatementHandler=function(O){return function(){return Pt}},T.returnStatementHandler=function(O){var Y=O.argument?this.createClosure(O.argument):Hs;return function(){return new Wo(Y())}},T.ifStatementHandler=function(O){var Y=this.createClosure(O.test),me=this.createClosure(O.consequent),Ge=O.alternate?this.createClosure(O.alternate):function(){return Pt};return function(){return Y()?me():Ge()}},T.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},T.forStatementHandler=function(O){var Y=this,me=Hs,Ge=O.test?this.createClosure(O.test):function(){return!0},ut=Hs,ct=this.createClosure(O.body);return O.type==="ForStatement"&&(me=O.init?this.createClosure(O.init):me,ut=O.update?this.createClosure(O.update):Hs),function(lr){var mr,cn=Pt,ei=O.type==="DoWhileStatement";for(lr&&lr.type==="LabeledStatement"&&(mr=lr.label.name),me();ei||Ge();ut()){ei=!1;var Hn=Y.setValue(ct());if(!(Hn===Pt||Hn===Ee)){if(Hn===ee)break;if(cn=Hn,cn instanceof To&&cn.value===mr){cn=Pt;continue}if(cn instanceof Wo||cn instanceof Ao||cn instanceof To)break}}return cn}},T.whileStatementHandler=function(O){return this.forStatementHandler(O)},T.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},T.forInStatementHandler=function(O){var Y=this,me=O.left,Ge=this.createClosure(O.right),ut=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),me=O.left.declarations[0].id),function(ct){var lr,mr=Pt,cn;ct&&ct.type==="LabeledStatement"&&(lr=ct.label.name);var ei=Ge();for(cn in ei){Y.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:me,right:{type:"Literal",value:cn}})();var Hn=Y.setValue(ut());if(!(Hn===Pt||Hn===Ee)){if(Hn===ee)break;if(mr=Hn,mr instanceof To&&mr.value===lr){mr=Pt;continue}if(mr instanceof Wo||mr instanceof Ao||mr instanceof To)break}}return mr}},T.withStatementHandler=function(O){var Y=this,me=this.createClosure(O.object),Ge=this.createClosure(O.body);return function(){var ut=me(),ct=Y.getCurrentScope(),lr=new Ms(ut,ct,Pr);Y.setCurrentScope(lr);var mr=Y.setValue(Ge());return Y.setCurrentScope(ct),mr}},T.throwStatementHandler=function(O){var Y=this,me=this.createClosure(O.argument);return function(){throw Y.setValue(void 0),me()}},T.tryStatementHandler=function(O){var Y=this,me=this.createClosure(O.block),Ge=O.handler?this.catchClauseHandler(O.handler):null,ut=O.finalizer?this.createClosure(O.finalizer):null;return function(){var ct=Y.getCurrentScope(),lr=Y.getCurrentContext(),mr=ct.labelStack.concat([]),cn=Y.callStack.concat([]),ei=Pt,Hn,vi,ca=function(){Y.setCurrentScope(ct),Y.setCurrentContext(lr),ct.labelStack=mr,Y.callStack=cn};try{ei=Y.setValue(me()),ei instanceof Wo&&(Hn=ei)}catch(xa){if(ca(),Y.isInterruptThrow(xa))throw xa;if(Ge)try{ei=Y.setValue(Ge(xa)),ei instanceof Wo&&(Hn=ei)}catch(Zi){if(ca(),Y.isInterruptThrow(Zi))throw Zi;vi=Zi}}if(ut)try{ei=ut(),ei instanceof Wo&&(Hn=ei)}catch(xa){if(ca(),Y.isInterruptThrow(xa))throw xa;vi=xa}if(vi)throw vi;return Hn||ei}},T.catchClauseHandler=function(O){var Y=this,me=this.createParamNameGetter(O.param),Ge=this.createClosure(O.body);return function(ut){var ct,lr=Y.getCurrentScope(),mr=lr.data,cn=me(),ei=ds.call(mr,cn),Hn=mr[cn];return mr[cn]=ut,ct=Ge(),ei?mr[cn]=Hn:delete mr[cn],ct}},T.continueStatementHandler=function(O){return function(){return O.label?new To(O.label.name):Ee}},T.breakStatementHandler=function(O){return function(){return O.label?new Ao(O.label.name):ee}},T.switchStatementHandler=function(O){var Y=this,me=this.createClosure(O.discriminant),Ge=O.cases.map(function(ut){return Y.switchCaseHandler(ut)});return function(){for(var ut=me(),ct=!1,lr,mr,cn,ei=0;ei<Ge.length;ei++){var Hn=Ge[ei](),vi=Hn.testClosure();if(vi===Xe){cn=Hn;continue}if(ct||vi===ut){if(ct=!0,mr=Y.setValue(Hn.bodyClosure()),mr===Pt)continue;if(mr===ee||(lr=mr,lr instanceof Wo||lr instanceof Ao||lr instanceof To||lr===Ee))break}}if(!ct&&cn){mr=Y.setValue(cn.bodyClosure());var ca=mr===Pt||mr===ee||mr===Ee;ca||(lr=mr)}return lr}},T.switchCaseHandler=function(O){var Y=O.test?this.createClosure(O.test):function(){return Xe},me=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:Y,bodyClosure:me}}},T.labeledStatementHandler=function(O){var Y=this,me=O.label.name,Ge=this.createClosure(O.body);return function(){var ut,ct=Y.getCurrentScope();return ct.labelStack.push(me),ut=Ge(O),ut instanceof Ao&&ut.value===me&&(ut=Pt),ct.labelStack.pop(),ut}},T.debuggerStatementHandler=function(O){return function(){debugger;return Pt}},T.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(aa.ParamTypeSyntaxError,O.type,O)},T.createObjectKeyGetter=function(O){var Y;return O.type==="Identifier"?Y=function(){return O.name}:Y=this.createClosure(O),function(){return Y()}},T.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},T.createObjectGetter=function(O){var Y=this;switch(O.type){case"Identifier":return function(){return Y.getScopeDataFromName(O.name,Y.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(aa.AssignmentTypeSyntaxError,O.type,O)}},T.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(aa.AssignmentTypeSyntaxError,O.type,O)}},T.varDeclaration=function(O){var Y=this.collectDeclVars;Y[O]=void 0},T.funcDeclaration=function(O,Y){var me=this.collectDeclFuncs;me[O]=Y},T.addDeclarationsToScope=function(O,Y,me){var Ge=me.data;for(var ut in Y){var ct=Y[ut];Ge[ut]=ct&&ct()}for(var lr in O)lr in Ge||(Ge[lr]=void 0)},T.getScopeValue=function(O,Y){var me=this.getScopeFromName(O,Y);return me.data[O]},T.getScopeDataFromName=function(O,Y){return this.getScopeFromName(O,Y).data},T.getScopeFromName=function(O,Y){var me=Y;do if(O in me.data)return me;while(me=me.parent);return this.globalScope},T.setValue=function(O){var Y=this.callStack.length;return this.isVarDeclMode||Y||O===Pt||O===ee||O===Ee||O instanceof Ao||O instanceof To||(this.value=O instanceof Wo?O.value:O),O},T.getValue=function(){return this.value},_}();go.version=Ls,go.eval=Fo,go.Function=vs,go.ecmaVersion=5,go.globalContextInFunction=void 0,go.global=Object.create(null);function Qo(_){return _===void 0&&(_=Object.create(null)),_}function gs(_,T,F){T===void 0&&(T=[]),F===void 0&&(F={});var O=F.parsingContext,Y=F.timeout===void 0?0:F.timeout,me=`
    (function anonymous(`+T.join(",")+`){
         `+_+`
    });
    `,Ge=new go(O,{ecmaVersion:F.ecmaVersion,timeout:Y,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction});return Ge.evaluate(me)}function Pl(_,T,F){var O=new go(T,F);return O.evaluate(_)}var rf=Pl,Ps=function(){function _(F){this._code=F}var T=_.prototype;return T.runInContext=function(O){return Pl(this._code,O)},T.runInNewContext=function(O){return Pl(this._code,O)},_}(),Il=function(_,T,F){return Pl(_,T,F)};function Xs(){for(var _=arguments.length,T=new Array(_),F=0;F<_;F++)T[F]=arguments[F];var O=T.pop();return gs(O||"",T)}var rl=Il},20396:function(It,$,V){var ce;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(pe,v,de,U){"use strict";var te=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",se=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Re=te||se,he=["","webkit","Moz","MS","ms","o"],$e=Re?"":v.createElement("div"),tt="function",gt=Math.round,Jt=Math.abs,ir=Date.now;function yt(ee,Ee,Xe){return setTimeout(ft(ee,Xe),Ee)}function Qt(ee,Ee,Xe){return Array.isArray(ee)?(Ct(ee,Xe[Ee],Xe),!0):!1}function Ct(ee,Ee,Xe){var Pt;if(!!ee)if(ee.forEach)ee.forEach(Ee,Xe);else if(ee.length!==U)for(Pt=0;Pt<ee.length;)Ee.call(Xe,ee[Pt],Pt,ee),Pt++;else for(Pt in ee)ee.hasOwnProperty(Pt)&&Ee.call(Xe,ee[Pt],Pt,ee)}function st(ee,Ee,Xe){var Pt="DEPRECATED METHOD: "+Ee+`
`+Xe+` AT 
`;return function(){var Pr=new Error("get-stack-trace"),An=Pr&&Pr.stack?Pr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ti=pe.console&&(pe.console.warn||pe.console.log);return Ti&&Ti.call(pe.console,Pt,An),ee.apply(this,arguments)}}var ht;typeof Object.assign!="function"?ht=function(Ee){if(Ee===U||Ee===null)throw new TypeError("Cannot convert undefined or null to object");for(var Xe=Object(Ee),Pt=1;Pt<arguments.length;Pt++){var Pr=arguments[Pt];if(Pr!==U&&Pr!==null)for(var An in Pr)Pr.hasOwnProperty(An)&&(Xe[An]=Pr[An])}return Xe}:ht=Object.assign;var Wt=st(function(Ee,Xe,Pt){for(var Pr=Object.keys(Xe),An=0;An<Pr.length;)(!Pt||Pt&&Ee[Pr[An]]===U)&&(Ee[Pr[An]]=Xe[Pr[An]]),An++;return Ee},"extend","Use `assign`."),X=st(function(Ee,Xe){return Wt(Ee,Xe,!0)},"merge","Use `assign`.");function Xt(ee,Ee,Xe){var Pt=Ee.prototype,Pr;Pr=ee.prototype=Object.create(Pt),Pr.constructor=ee,Pr._super=Pt,Xe&&ht(Pr,Xe)}function ft(ee,Ee){return function(){return ee.apply(Ee,arguments)}}function He(ee,Ee){return typeof ee==tt?ee.apply(Ee&&Ee[0]||U,Ee):ee}function lt(ee,Ee){return ee===U?Ee:ee}function Qe(ee,Ee,Xe){Ct(Kr(Ee),function(Pt){ee.addEventListener(Pt,Xe,!1)})}function Ut(ee,Ee,Xe){Ct(Kr(Ee),function(Pt){ee.removeEventListener(Pt,Xe,!1)})}function xr(ee,Ee){for(;ee;){if(ee==Ee)return!0;ee=ee.parentNode}return!1}function Dr(ee,Ee){return ee.indexOf(Ee)>-1}function Kr(ee){return ee.trim().split(/\s+/g)}function Me(ee,Ee,Xe){if(ee.indexOf&&!Xe)return ee.indexOf(Ee);for(var Pt=0;Pt<ee.length;){if(Xe&&ee[Pt][Xe]==Ee||!Xe&&ee[Pt]===Ee)return Pt;Pt++}return-1}function A(ee){return Array.prototype.slice.call(ee,0)}function _e(ee,Ee,Xe){for(var Pt=[],Pr=[],An=0;An<ee.length;){var Ti=Ee?ee[An][Ee]:ee[An];Me(Pr,Ti)<0&&Pt.push(ee[An]),Pr[An]=Ti,An++}return Xe&&(Ee?Pt=Pt.sort(function(Aa,Fa){return Aa[Ee]>Fa[Ee]}):Pt=Pt.sort()),Pt}function Et(ee,Ee){for(var Xe,Pt,Pr=Ee[0].toUpperCase()+Ee.slice(1),An=0;An<he.length;){if(Xe=he[An],Pt=Xe?Xe+Pr:Ee,Pt in ee)return Pt;An++}return U}var dt=1;function Ft(){return dt++}function qt(ee){var Ee=ee.ownerDocument||ee;return Ee.defaultView||Ee.parentWindow||pe}var Sr=/mobile|tablet|ip(ad|hone|od)|android/i,Qn="ontouchstart"in pe,gn=Et(pe,"PointerEvent")!==U,ea=Qn&&Sr.test(navigator.userAgent),wn="touch",ii="pen",Si="mouse",si="kinect",Wn=25,ma=1,zi=2,ji=4,Wi=8,ga=1,vo=2,Va=4,la=8,Ui=16,ra=vo|Va,qi=la|Ui,Ts=ra|qi,ge=["x","y"],ui=["clientX","clientY"];function no(ee,Ee){var Xe=this;this.manager=ee,this.callback=Ee,this.element=ee.element,this.target=ee.options.inputTarget,this.domHandler=function(Pt){He(ee.options.enable,[ee])&&Xe.handler(Pt)},this.init()}no.prototype={handler:function(){},init:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(qt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ut(this.element,this.evEl,this.domHandler),this.evTarget&&Ut(this.target,this.evTarget,this.domHandler),this.evWin&&Ut(qt(this.element),this.evWin,this.domHandler)}};function ru(ee){var Ee,Xe=ee.options.inputClass;return Xe?Ee=Xe:gn?Ee=ke:ea?Ee=Lt:Qn?Ee=wt:Ee=ya,new Ee(ee,Vt)}function Vt(ee,Ee,Xe){var Pt=Xe.pointers.length,Pr=Xe.changedPointers.length,An=Ee&ma&&Pt-Pr==0,Ti=Ee&(ji|Wi)&&Pt-Pr==0;Xe.isFirst=!!An,Xe.isFinal=!!Ti,An&&(ee.session={}),Xe.eventType=Ee,ar(ee,Xe),ee.emit("hammer.input",Xe),ee.recognize(Xe),ee.session.prevInput=Xe}function ar(ee,Ee){var Xe=ee.session,Pt=Ee.pointers,Pr=Pt.length;Xe.firstInput||(Xe.firstInput=In(Ee)),Pr>1&&!Xe.firstMultiple?Xe.firstMultiple=In(Ee):Pr===1&&(Xe.firstMultiple=!1);var An=Xe.firstInput,Ti=Xe.firstMultiple,Qa=Ti?Ti.center:An.center,Aa=Ee.center=Rn(Pt);Ee.timeStamp=ir(),Ee.deltaTime=Ee.timeStamp-An.timeStamp,Ee.angle=Oi(Qa,Aa),Ee.distance=En(Qa,Aa),Ar(Xe,Ee),Ee.offsetDirection=gi(Ee.deltaX,Ee.deltaY);var Fa=bi(Ee.deltaTime,Ee.deltaX,Ee.deltaY);Ee.overallVelocityX=Fa.x,Ee.overallVelocityY=Fa.y,Ee.overallVelocity=Jt(Fa.x)>Jt(Fa.y)?Fa.x:Fa.y,Ee.scale=Ti?ja(Ti.pointers,Pt):1,Ee.rotation=Ti?Ii(Ti.pointers,Pt):0,Ee.maxPointers=Xe.prevInput?Ee.pointers.length>Xe.prevInput.maxPointers?Ee.pointers.length:Xe.prevInput.maxPointers:Ee.pointers.length,on(Xe,Ee);var Fo=ee.element;xr(Ee.srcEvent.target,Fo)&&(Fo=Ee.srcEvent.target),Ee.target=Fo}function Ar(ee,Ee){var Xe=Ee.center,Pt=ee.offsetDelta||{},Pr=ee.prevDelta||{},An=ee.prevInput||{};(Ee.eventType===ma||An.eventType===ji)&&(Pr=ee.prevDelta={x:An.deltaX||0,y:An.deltaY||0},Pt=ee.offsetDelta={x:Xe.x,y:Xe.y}),Ee.deltaX=Pr.x+(Xe.x-Pt.x),Ee.deltaY=Pr.y+(Xe.y-Pt.y)}function on(ee,Ee){var Xe=ee.lastInterval||Ee,Pt=Ee.timeStamp-Xe.timeStamp,Pr,An,Ti,Qa;if(Ee.eventType!=Wi&&(Pt>Wn||Xe.velocity===U)){var Aa=Ee.deltaX-Xe.deltaX,Fa=Ee.deltaY-Xe.deltaY,Fo=bi(Pt,Aa,Fa);An=Fo.x,Ti=Fo.y,Pr=Jt(Fo.x)>Jt(Fo.y)?Fo.x:Fo.y,Qa=gi(Aa,Fa),ee.lastInterval=Ee}else Pr=Xe.velocity,An=Xe.velocityX,Ti=Xe.velocityY,Qa=Xe.direction;Ee.velocity=Pr,Ee.velocityX=An,Ee.velocityY=Ti,Ee.direction=Qa}function In(ee){for(var Ee=[],Xe=0;Xe<ee.pointers.length;)Ee[Xe]={clientX:gt(ee.pointers[Xe].clientX),clientY:gt(ee.pointers[Xe].clientY)},Xe++;return{timeStamp:ir(),pointers:Ee,center:Rn(Ee),deltaX:ee.deltaX,deltaY:ee.deltaY}}function Rn(ee){var Ee=ee.length;if(Ee===1)return{x:gt(ee[0].clientX),y:gt(ee[0].clientY)};for(var Xe=0,Pt=0,Pr=0;Pr<Ee;)Xe+=ee[Pr].clientX,Pt+=ee[Pr].clientY,Pr++;return{x:gt(Xe/Ee),y:gt(Pt/Ee)}}function bi(ee,Ee,Xe){return{x:Ee/ee||0,y:Xe/ee||0}}function gi(ee,Ee){return ee===Ee?ga:Jt(ee)>=Jt(Ee)?ee<0?vo:Va:Ee<0?la:Ui}function En(ee,Ee,Xe){Xe||(Xe=ge);var Pt=Ee[Xe[0]]-ee[Xe[0]],Pr=Ee[Xe[1]]-ee[Xe[1]];return Math.sqrt(Pt*Pt+Pr*Pr)}function Oi(ee,Ee,Xe){Xe||(Xe=ge);var Pt=Ee[Xe[0]]-ee[Xe[0]],Pr=Ee[Xe[1]]-ee[Xe[1]];return Math.atan2(Pr,Pt)*180/Math.PI}function Ii(ee,Ee){return Oi(Ee[1],Ee[0],ui)+Oi(ee[1],ee[0],ui)}function ja(ee,Ee){return En(Ee[0],Ee[1],ui)/En(ee[0],ee[1],ui)}var ps={mousedown:ma,mousemove:zi,mouseup:ji},Ho="mousedown",ka="mousemove mouseup";function ya(){this.evEl=Ho,this.evWin=ka,this.pressed=!1,no.apply(this,arguments)}Xt(ya,no,{handler:function(Ee){var Xe=ps[Ee.type];Xe&ma&&Ee.button===0&&(this.pressed=!0),Xe&zi&&Ee.which!==1&&(Xe=ji),!!this.pressed&&(Xe&ji&&(this.pressed=!1),this.callback(this.manager,Xe,{pointers:[Ee],changedPointers:[Ee],pointerType:Si,srcEvent:Ee}))}});var j={pointerdown:ma,pointermove:zi,pointerup:ji,pointercancel:Wi,pointerout:Wi},K={2:wn,3:ii,4:Si,5:si},re="pointerdown",ye="pointermove pointerup pointercancel";!Re&&pe.MSPointerEvent&&!pe.PointerEvent&&(re="MSPointerDown",ye="MSPointerMove MSPointerUp MSPointerCancel");function ke(){this.evEl=re,this.evWin=ye,no.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Xt(ke,no,{handler:function(Ee){var Xe=this.store,Pt=!1,Pr=Ee.type.toLowerCase().replace("ms",""),An=j[Pr],Ti=K[Ee.pointerType]||Ee.pointerType,Qa=Ti==wn,Aa=Me(Xe,Ee.pointerId,"pointerId");An&ma&&(Ee.button===0||Qa)?Aa<0&&(Xe.push(Ee),Aa=Xe.length-1):An&(ji|Wi)&&(Pt=!0),!(Aa<0)&&(Xe[Aa]=Ee,this.callback(this.manager,An,{pointers:Xe,changedPointers:[Ee],pointerType:Ti,srcEvent:Ee}),Pt&&Xe.splice(Aa,1))}});var je={touchstart:ma,touchmove:zi,touchend:ji,touchcancel:Wi},Je="touchstart",le="touchstart touchmove touchend touchcancel";function De(){this.evTarget=Je,this.evWin=le,this.started=!1,no.apply(this,arguments)}Xt(De,no,{handler:function(Ee){var Xe=je[Ee.type];if(Xe===ma&&(this.started=!0),!!this.started){var Pt=vt.call(this,Ee,Xe);Xe&(ji|Wi)&&Pt[0].length-Pt[1].length==0&&(this.started=!1),this.callback(this.manager,Xe,{pointers:Pt[0],changedPointers:Pt[1],pointerType:wn,srcEvent:Ee})}}});function vt(ee,Ee){var Xe=A(ee.touches),Pt=A(ee.changedTouches);return Ee&(ji|Wi)&&(Xe=_e(Xe.concat(Pt),"identifier",!0)),[Xe,Pt]}var fr={touchstart:ma,touchmove:zi,touchend:ji,touchcancel:Wi},Rt="touchstart touchmove touchend touchcancel";function Lt(){this.evTarget=Rt,this.targetIds={},no.apply(this,arguments)}Xt(Lt,no,{handler:function(Ee){var Xe=fr[Ee.type],Pt=vr.call(this,Ee,Xe);!Pt||this.callback(this.manager,Xe,{pointers:Pt[0],changedPointers:Pt[1],pointerType:wn,srcEvent:Ee})}});function vr(ee,Ee){var Xe=A(ee.touches),Pt=this.targetIds;if(Ee&(ma|zi)&&Xe.length===1)return Pt[Xe[0].identifier]=!0,[Xe,Xe];var Pr,An,Ti=A(ee.changedTouches),Qa=[],Aa=this.target;if(An=Xe.filter(function(Fa){return xr(Fa.target,Aa)}),Ee===ma)for(Pr=0;Pr<An.length;)Pt[An[Pr].identifier]=!0,Pr++;for(Pr=0;Pr<Ti.length;)Pt[Ti[Pr].identifier]&&Qa.push(Ti[Pr]),Ee&(ji|Wi)&&delete Pt[Ti[Pr].identifier],Pr++;if(!!Qa.length)return[_e(An.concat(Qa),"identifier",!0),Qa]}var yn=2500,ln=25;function wt(){no.apply(this,arguments);var ee=ft(this.handler,this);this.touch=new Lt(this.manager,ee),this.mouse=new ya(this.manager,ee),this.primaryTouch=null,this.lastTouches=[]}Xt(wt,no,{handler:function(Ee,Xe,Pt){var Pr=Pt.pointerType==wn,An=Pt.pointerType==Si;if(!(An&&Pt.sourceCapabilities&&Pt.sourceCapabilities.firesTouchEvents)){if(Pr)nn.call(this,Xe,Pt);else if(An&&Vr.call(this,Pt))return;this.callback(Ee,Xe,Pt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function nn(ee,Ee){ee&ma?(this.primaryTouch=Ee.changedPointers[0].identifier,Fr.call(this,Ee)):ee&(ji|Wi)&&Fr.call(this,Ee)}function Fr(ee){var Ee=ee.changedPointers[0];if(Ee.identifier===this.primaryTouch){var Xe={x:Ee.clientX,y:Ee.clientY};this.lastTouches.push(Xe);var Pt=this.lastTouches,Pr=function(){var An=Pt.indexOf(Xe);An>-1&&Pt.splice(An,1)};setTimeout(Pr,yn)}}function Vr(ee){for(var Ee=ee.srcEvent.clientX,Xe=ee.srcEvent.clientY,Pt=0;Pt<this.lastTouches.length;Pt++){var Pr=this.lastTouches[Pt],An=Math.abs(Ee-Pr.x),Ti=Math.abs(Xe-Pr.y);if(An<=ln&&Ti<=ln)return!0}return!1}var di=Re?U:Et($e.style,"touchAction"),en=di!==U,Ai="compute",Vn="auto",li="manipulation",Ci="none",Ei="pan-x",Xn="pan-y",Bt=Jn();function Yt(ee,Ee){this.manager=ee,this.set(Ee)}Yt.prototype={set:function(ee){ee==Ai&&(ee=this.compute()),en&&this.manager.element.style&&Bt[ee]&&(this.manager.element.style[di]=ee),this.actions=ee.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ee=[];return Ct(this.manager.recognizers,function(Ee){He(Ee.options.enable,[Ee])&&(ee=ee.concat(Ee.getTouchAction()))}),Ki(ee.join(" "))},preventDefaults:function(ee){var Ee=ee.srcEvent,Xe=ee.offsetDirection;if(this.manager.session.prevented){Ee.preventDefault();return}var Pt=this.actions,Pr=Dr(Pt,Ci)&&!Bt[Ci],An=Dr(Pt,Xn)&&!Bt[Xn],Ti=Dr(Pt,Ei)&&!Bt[Ei];if(Pr){var Qa=ee.pointers.length===1,Aa=ee.distance<2,Fa=ee.deltaTime<250;if(Qa&&Aa&&Fa)return}if(!(Ti&&An)&&(Pr||An&&Xe&ra||Ti&&Xe&qi))return this.preventSrc(Ee)},preventSrc:function(ee){this.manager.session.prevented=!0,ee.preventDefault()}};function Ki(ee){if(Dr(ee,Ci))return Ci;var Ee=Dr(ee,Ei),Xe=Dr(ee,Xn);return Ee&&Xe?Ci:Ee||Xe?Ee?Ei:Xn:Dr(ee,li)?li:Vn}function Jn(){if(!en)return!1;var ee={};if(Re)return ee;var Ee=pe.CSS&&pe.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Xe){ee[Xe]=Ee?pe.CSS.supports("touch-action",Xe):!0}),ee}var Di=1,Sa=2,bn=4,Wr=8,At=Wr,Ro=16,be=32;function $i(ee){this.options=ht({},this.defaults,ee||{}),this.id=Ft(),this.manager=null,this.options.enable=lt(this.options.enable,!0),this.state=Di,this.simultaneous={},this.requireFail=[]}$i.prototype={defaults:{},set:function(ee){return ht(this.options,ee),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ee){if(Qt(ee,"recognizeWith",this))return this;var Ee=this.simultaneous;return ee=_a(ee,this),Ee[ee.id]||(Ee[ee.id]=ee,ee.recognizeWith(this)),this},dropRecognizeWith:function(ee){return Qt(ee,"dropRecognizeWith",this)?this:(ee=_a(ee,this),delete this.simultaneous[ee.id],this)},requireFailure:function(ee){if(Qt(ee,"requireFailure",this))return this;var Ee=this.requireFail;return ee=_a(ee,this),Me(Ee,ee)===-1&&(Ee.push(ee),ee.requireFailure(this)),this},dropRequireFailure:function(ee){if(Qt(ee,"dropRequireFailure",this))return this;ee=_a(ee,this);var Ee=Me(this.requireFail,ee);return Ee>-1&&this.requireFail.splice(Ee,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ee){return!!this.simultaneous[ee.id]},emit:function(ee){var Ee=this,Xe=this.state;function Pt(Pr){Ee.manager.emit(Pr,ee)}Xe<Wr&&Pt(Ee.options.event+Au(Xe)),Pt(Ee.options.event),ee.additionalEvent&&Pt(ee.additionalEvent),Xe>=Wr&&Pt(Ee.options.event+Au(Xe))},tryEmit:function(ee){if(this.canEmit())return this.emit(ee);this.state=be},canEmit:function(){for(var ee=0;ee<this.requireFail.length;){if(!(this.requireFail[ee].state&(be|Di)))return!1;ee++}return!0},recognize:function(ee){var Ee=ht({},ee);if(!He(this.options.enable,[this,Ee])){this.reset(),this.state=be;return}this.state&(At|Ro|be)&&(this.state=Di),this.state=this.process(Ee),this.state&(Sa|bn|Wr|Ro)&&this.tryEmit(Ee)},process:function(ee){},getTouchAction:function(){},reset:function(){}};function Au(ee){return ee&Ro?"cancel":ee&Wr?"end":ee&bn?"move":ee&Sa?"start":""}function $a(ee){return ee==Ui?"down":ee==la?"up":ee==vo?"left":ee==Va?"right":""}function _a(ee,Ee){var Xe=Ee.manager;return Xe?Xe.get(ee):ee}function La(){$i.apply(this,arguments)}Xt(La,$i,{defaults:{pointers:1},attrTest:function(ee){var Ee=this.options.pointers;return Ee===0||ee.pointers.length===Ee},process:function(ee){var Ee=this.state,Xe=ee.eventType,Pt=Ee&(Sa|bn),Pr=this.attrTest(ee);return Pt&&(Xe&Wi||!Pr)?Ee|Ro:Pt||Pr?Xe&ji?Ee|Wr:Ee&Sa?Ee|bn:Sa:be}});function ta(){La.apply(this,arguments),this.pX=null,this.pY=null}Xt(ta,La,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ts},getTouchAction:function(){var ee=this.options.direction,Ee=[];return ee&ra&&Ee.push(Xn),ee&qi&&Ee.push(Ei),Ee},directionTest:function(ee){var Ee=this.options,Xe=!0,Pt=ee.distance,Pr=ee.direction,An=ee.deltaX,Ti=ee.deltaY;return Pr&Ee.direction||(Ee.direction&ra?(Pr=An===0?ga:An<0?vo:Va,Xe=An!=this.pX,Pt=Math.abs(ee.deltaX)):(Pr=Ti===0?ga:Ti<0?la:Ui,Xe=Ti!=this.pY,Pt=Math.abs(ee.deltaY))),ee.direction=Pr,Xe&&Pt>Ee.threshold&&Pr&Ee.direction},attrTest:function(ee){return La.prototype.attrTest.call(this,ee)&&(this.state&Sa||!(this.state&Sa)&&this.directionTest(ee))},emit:function(ee){this.pX=ee.deltaX,this.pY=ee.deltaY;var Ee=$a(ee.direction);Ee&&(ee.additionalEvent=this.options.event+Ee),this._super.emit.call(this,ee)}});function ko(){La.apply(this,arguments)}Xt(ko,La,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(ee){return this._super.attrTest.call(this,ee)&&(Math.abs(ee.scale-1)>this.options.threshold||this.state&Sa)},emit:function(ee){if(ee.scale!==1){var Ee=ee.scale<1?"in":"out";ee.additionalEvent=this.options.event+Ee}this._super.emit.call(this,ee)}});function Lo(){$i.apply(this,arguments),this._timer=null,this._input=null}Xt(Lo,$i,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Vn]},process:function(ee){var Ee=this.options,Xe=ee.pointers.length===Ee.pointers,Pt=ee.distance<Ee.threshold,Pr=ee.deltaTime>Ee.time;if(this._input=ee,!Pt||!Xe||ee.eventType&(ji|Wi)&&!Pr)this.reset();else if(ee.eventType&ma)this.reset(),this._timer=yt(function(){this.state=At,this.tryEmit()},Ee.time,this);else if(ee.eventType&ji)return At;return be},reset:function(){clearTimeout(this._timer)},emit:function(ee){this.state===At&&(ee&&ee.eventType&ji?this.manager.emit(this.options.event+"up",ee):(this._input.timeStamp=ir(),this.manager.emit(this.options.event,this._input)))}});function Tu(){La.apply(this,arguments)}Xt(Tu,La,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(ee){return this._super.attrTest.call(this,ee)&&(Math.abs(ee.rotation)>this.options.threshold||this.state&Sa)}});function mo(){La.apply(this,arguments)}Xt(mo,La,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ra|qi,pointers:1},getTouchAction:function(){return ta.prototype.getTouchAction.call(this)},attrTest:function(ee){var Ee=this.options.direction,Xe;return Ee&(ra|qi)?Xe=ee.overallVelocity:Ee&ra?Xe=ee.overallVelocityX:Ee&qi&&(Xe=ee.overallVelocityY),this._super.attrTest.call(this,ee)&&Ee&ee.offsetDirection&&ee.distance>this.options.threshold&&ee.maxPointers==this.options.pointers&&Jt(Xe)>this.options.velocity&&ee.eventType&ji},emit:function(ee){var Ee=$a(ee.offsetDirection);Ee&&this.manager.emit(this.options.event+Ee,ee),this.manager.emit(this.options.event,ee)}});function wo(){$i.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Xt(wo,$i,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[li]},process:function(ee){var Ee=this.options,Xe=ee.pointers.length===Ee.pointers,Pt=ee.distance<Ee.threshold,Pr=ee.deltaTime<Ee.time;if(this.reset(),ee.eventType&ma&&this.count===0)return this.failTimeout();if(Pt&&Pr&&Xe){if(ee.eventType!=ji)return this.failTimeout();var An=this.pTime?ee.timeStamp-this.pTime<Ee.interval:!0,Ti=!this.pCenter||En(this.pCenter,ee.center)<Ee.posThreshold;this.pTime=ee.timeStamp,this.pCenter=ee.center,!Ti||!An?this.count=1:this.count+=1,this._input=ee;var Qa=this.count%Ee.taps;if(Qa===0)return this.hasRequireFailures()?(this._timer=yt(function(){this.state=At,this.tryEmit()},Ee.interval,this),Sa):At}return be},failTimeout:function(){return this._timer=yt(function(){this.state=be},this.options.interval,this),be},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==At&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function aa(ee,Ee){return Ee=Ee||{},Ee.recognizers=lt(Ee.recognizers,aa.defaults.preset),new Ha(ee,Ee)}aa.VERSION="2.0.7",aa.defaults={domEvents:!1,touchAction:Ai,enable:!0,inputTarget:null,inputClass:null,preset:[[Tu,{enable:!1}],[ko,{enable:!1},["rotate"]],[mo,{direction:ra}],[ta,{direction:ra},["swipe"]],[wo],[wo,{event:"doubletap",taps:2},["tap"]],[Lo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ga=1,Do=2;function Ha(ee,Ee){this.options=ht({},aa.defaults,Ee||{}),this.options.inputTarget=this.options.inputTarget||ee,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ee,this.input=ru(this),this.touchAction=new Yt(this,this.options.touchAction),Ls(this,!0),Ct(this.options.recognizers,function(Xe){var Pt=this.add(new Xe[0](Xe[1]));Xe[2]&&Pt.recognizeWith(Xe[2]),Xe[3]&&Pt.requireFailure(Xe[3])},this)}Ha.prototype={set:function(ee){return ht(this.options,ee),ee.touchAction&&this.touchAction.update(),ee.inputTarget&&(this.input.destroy(),this.input.target=ee.inputTarget,this.input.init()),this},stop:function(ee){this.session.stopped=ee?Do:Ga},recognize:function(ee){var Ee=this.session;if(!Ee.stopped){this.touchAction.preventDefaults(ee);var Xe,Pt=this.recognizers,Pr=Ee.curRecognizer;(!Pr||Pr&&Pr.state&At)&&(Pr=Ee.curRecognizer=null);for(var An=0;An<Pt.length;)Xe=Pt[An],Ee.stopped!==Do&&(!Pr||Xe==Pr||Xe.canRecognizeWith(Pr))?Xe.recognize(ee):Xe.reset(),!Pr&&Xe.state&(Sa|bn|Wr)&&(Pr=Ee.curRecognizer=Xe),An++}},get:function(ee){if(ee instanceof $i)return ee;for(var Ee=this.recognizers,Xe=0;Xe<Ee.length;Xe++)if(Ee[Xe].options.event==ee)return Ee[Xe];return null},add:function(ee){if(Qt(ee,"add",this))return this;var Ee=this.get(ee.options.event);return Ee&&this.remove(Ee),this.recognizers.push(ee),ee.manager=this,this.touchAction.update(),ee},remove:function(ee){if(Qt(ee,"remove",this))return this;if(ee=this.get(ee),ee){var Ee=this.recognizers,Xe=Me(Ee,ee);Xe!==-1&&(Ee.splice(Xe,1),this.touchAction.update())}return this},on:function(ee,Ee){if(ee!==U&&Ee!==U){var Xe=this.handlers;return Ct(Kr(ee),function(Pt){Xe[Pt]=Xe[Pt]||[],Xe[Pt].push(Ee)}),this}},off:function(ee,Ee){if(ee!==U){var Xe=this.handlers;return Ct(Kr(ee),function(Pt){Ee?Xe[Pt]&&Xe[Pt].splice(Me(Xe[Pt],Ee),1):delete Xe[Pt]}),this}},emit:function(ee,Ee){this.options.domEvents&&Uu(ee,Ee);var Xe=this.handlers[ee]&&this.handlers[ee].slice();if(!(!Xe||!Xe.length)){Ee.type=ee,Ee.preventDefault=function(){Ee.srcEvent.preventDefault()};for(var Pt=0;Pt<Xe.length;)Xe[Pt](Ee),Pt++}},destroy:function(){this.element&&Ls(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ls(ee,Ee){var Xe=ee.element;if(!!Xe.style){var Pt;Ct(ee.options.cssProps,function(Pr,An){Pt=Et(Xe.style,An),Ee?(ee.oldCssProps[Pt]=Xe.style[Pt],Xe.style[Pt]=Pr):Xe.style[Pt]=ee.oldCssProps[Pt]||""}),Ee||(ee.oldCssProps={})}}function Uu(ee,Ee){if(!Re){var Xe=v.createEvent("Event");Xe.initEvent(ee,!0,!0),Xe.gesture=Ee,Ee.target.dispatchEvent(Xe)}}if(!Re){ht(aa,{INPUT_START:ma,INPUT_MOVE:zi,INPUT_END:ji,INPUT_CANCEL:Wi,STATE_POSSIBLE:Di,STATE_BEGAN:Sa,STATE_CHANGED:bn,STATE_ENDED:Wr,STATE_RECOGNIZED:At,STATE_CANCELLED:Ro,STATE_FAILED:be,DIRECTION_NONE:ga,DIRECTION_LEFT:vo,DIRECTION_RIGHT:Va,DIRECTION_UP:la,DIRECTION_DOWN:Ui,DIRECTION_HORIZONTAL:ra,DIRECTION_VERTICAL:qi,DIRECTION_ALL:Ts,Manager:Ha,Input:no,TouchAction:Yt,TouchInput:Lt,MouseInput:ya,PointerEventInput:ke,TouchMouseInput:wt,SingleTouchInput:De,Recognizer:$i,AttrRecognizer:La,Tap:wo,Pan:ta,Swipe:mo,Pinch:ko,Rotate:Tu,Press:Lo,on:Qe,off:Ut,each:Ct,merge:X,extend:Wt,assign:ht,inherit:Xt,bindFn:ft,prefixed:Et});var ds=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ds.Hammer=aa,ce=function(){return aa}.call($,V,$,It),ce!==U&&(It.exports=ce)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(It,$,V){(function(ce,pe){It.exports=pe(V(81336))})(this,function(ce){"use strict";var pe=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},v=function(B,ve){for(var Be=Object.keys(ve),Ot=0;Ot<Be.length;++Ot)B[Be[Ot]]=ve[Be[Ot]];return B},de=`
`;function U(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function te(B){var ve=new Error("(regl) "+B);throw console.error(ve),ve}function se(B,ve){B||te(ve)}function Re(B){return B?": "+B:""}function he(B,ve,Be){B in ve||te("unknown parameter ("+B+")"+Re(Be)+". possible values: "+Object.keys(ve).join())}function $e(B,ve){pe(B)||te("invalid parameter type"+Re(ve)+". must be a typed array")}function tt(B,ve){switch(ve){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function gt(B,ve,Be){tt(B,ve)||te("invalid parameter type"+Re(Be)+". expected "+ve+", got "+typeof B)}function Jt(B,ve){B>=0&&(B|0)===B||te("invalid parameter type, ("+B+")"+Re(ve)+". must be a nonnegative integer")}function ir(B,ve,Be){ve.indexOf(B)<0&&te("invalid value"+Re(Be)+". must be one of: "+ve)}var yt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Qt(B){Object.keys(B).forEach(function(ve){yt.indexOf(ve)<0&&te('invalid regl constructor argument "'+ve+'". must be one of '+yt)})}function Ct(B,ve){for(B=B+"";B.length<ve;)B=" "+B;return B}function st(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ht(B,ve){this.number=B,this.line=ve,this.errors=[]}function Wt(B,ve,Be){this.file=B,this.line=ve,this.message=Be}function X(){var B=new Error,ve=(B.stack||B).toString(),Be=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ve);if(Be)return Be[1];var Ot=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ve);return Ot?Ot[1]:"unknown"}function Xt(){var B=new Error,ve=(B.stack||B).toString(),Be=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ve);if(Be)return Be[1];var Ot=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ve);return Ot?Ot[1]:"unknown"}function ft(B,ve){var Be=B.split(`
`),Ot=1,sr=0,Tt={unknown:new st,0:new st};Tt.unknown.name=Tt[0].name=ve||X(),Tt.unknown.lines.push(new ht(0,""));for(var er=0;er<Be.length;++er){var $t=Be[er],or=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec($t);if(or)switch(or[1]){case"line":var yr=/(\d+)(\s+\d+)?/.exec(or[2]);yr&&(Ot=yr[1]|0,yr[2]&&(sr=yr[2]|0,sr in Tt||(Tt[sr]=new st)));break;case"define":var Tr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(or[2]);Tr&&(Tt[sr].name=Tr[1]?U(Tr[2]):Tr[2]);break}Tt[sr].lines.push(new ht(Ot++,$t))}return Object.keys(Tt).forEach(function(Mr){var jr=Tt[Mr];jr.lines.forEach(function(br){jr.index[br.number]=br})}),Tt}function He(B){var ve=[];return B.split(`
`).forEach(function(Be){if(!(Be.length<5)){var Ot=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Be);Ot?ve.push(new Wt(Ot[1]|0,Ot[2]|0,Ot[3].trim())):Be.length>0&&ve.push(new Wt("unknown",0,Be))}}),ve}function lt(B,ve){ve.forEach(function(Be){var Ot=B[Be.file];if(Ot){var sr=Ot.index[Be.line];if(sr){sr.errors.push(Be),Ot.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Be)})}function Qe(B,ve,Be,Ot,sr){if(!B.getShaderParameter(ve,B.COMPILE_STATUS)){var Tt=B.getShaderInfoLog(ve),er=Ot===B.FRAGMENT_SHADER?"fragment":"vertex";_e(Be,"string",er+" shader source must be a string",sr);var $t=ft(Be,sr),or=He(Tt);lt($t,or),Object.keys($t).forEach(function(yr){var Tr=$t[yr];if(!Tr.hasErrors)return;var Mr=[""],jr=[""];function br(gr,it){Mr.push(gr),jr.push(it||"")}br("file number "+yr+": "+Tr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Tr.lines.forEach(function(gr){if(gr.errors.length>0){br(Ct(gr.number,4)+"|  ","background-color:yellow; font-weight:bold"),br(gr.line+de,"color:red; background-color:yellow; font-weight:bold");var it=0;gr.errors.forEach(function(Gt){var _r=Gt.message,Br=/^\s*'(.*)'\s*:\s*(.*)$/.exec(_r);if(Br){var cr=Br[1];switch(_r=Br[2],cr){case"assign":cr="=";break}it=Math.max(gr.line.indexOf(cr,it),0)}else it=0;br(Ct("| ",6)),br(Ct("^^^",it+3)+de,"font-weight:bold"),br(Ct("| ",6)),br(_r+de,"font-weight:bold")}),br(Ct("| ",6)+de)}else br(Ct(gr.number,4)+"|  "),br(gr.line+de,"color:red")}),typeof document!="undefined"&&!window.chrome?(jr[0]=Mr.join("%c"),console.log.apply(console,jr)):console.log(Mr.join(""))}),se.raise("Error compiling "+er+" shader, "+$t[0].name)}}function Ut(B,ve,Be,Ot,sr){if(!B.getProgramParameter(ve,B.LINK_STATUS)){var Tt=B.getProgramInfoLog(ve),er=ft(Be,sr),$t=ft(Ot,sr),or='Error linking program with vertex shader, "'+$t[0].name+'", and fragment shader "'+er[0].name+'"';typeof document!="undefined"?console.log("%c"+or+de+"%c"+Tt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(or+de+Tt),se.raise(or)}}function xr(B){B._commandRef=X()}function Dr(B,ve,Be,Ot){xr(B);function sr(or){return or?Ot.id(or):0}B._fragId=sr(B.static.frag),B._vertId=sr(B.static.vert);function Tt(or,yr){Object.keys(yr).forEach(function(Tr){or[Ot.id(Tr)]=!0})}var er=B._uniformSet={};Tt(er,ve.static),Tt(er,ve.dynamic);var $t=B._attributeSet={};Tt($t,Be.static),Tt($t,Be.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function Kr(B,ve){var Be=Xt();te(B+" in command "+(ve||X())+(Be==="unknown"?"":" called from "+Be))}function Me(B,ve,Be){B||Kr(ve,Be||X())}function A(B,ve,Be,Ot){B in ve||Kr("unknown parameter ("+B+")"+Re(Be)+". possible values: "+Object.keys(ve).join(),Ot||X())}function _e(B,ve,Be,Ot){tt(B,ve)||Kr("invalid parameter type"+Re(Be)+". expected "+ve+", got "+typeof B,Ot||X())}function Et(B){B()}function dt(B,ve,Be){B.texture?ir(B.texture._texture.internalformat,ve,"unsupported texture format for attachment"):ir(B.renderbuffer._renderbuffer.format,Be,"unsupported renderbuffer format for attachment")}var Ft=33071,qt=9728,Sr=9984,Qn=9985,gn=9986,ea=9987,wn=5120,ii=5121,Si=5122,si=5123,Wn=5124,ma=5125,zi=5126,ji=32819,Wi=32820,ga=33635,vo=34042,Va=36193,la={};la[wn]=la[ii]=1,la[Si]=la[si]=la[Va]=la[ga]=la[ji]=la[Wi]=2,la[Wn]=la[ma]=la[zi]=la[vo]=4;function Ui(B,ve){return B===Wi||B===ji||B===ga?2:B===vo?4:la[B]*ve}function ra(B){return!(B&B-1)&&!!B}function qi(B,ve,Be){var Ot,sr=ve.width,Tt=ve.height,er=ve.channels;se(sr>0&&sr<=Be.maxTextureSize&&Tt>0&&Tt<=Be.maxTextureSize,"invalid texture shape"),(B.wrapS!==Ft||B.wrapT!==Ft)&&se(ra(sr)&&ra(Tt),"incompatible wrap mode for texture, both width and height must be power of 2"),ve.mipmask===1?sr!==1&&Tt!==1&&se(B.minFilter!==Sr&&B.minFilter!==gn&&B.minFilter!==Qn&&B.minFilter!==ea,"min filter requires mipmap"):(se(ra(sr)&&ra(Tt),"texture must be a square power of 2 to support mipmapping"),se(ve.mipmask===(sr<<1)-1,"missing or incomplete mipmap data")),ve.type===zi&&(Be.extensions.indexOf("oes_texture_float_linear")<0&&se(B.minFilter===qt&&B.magFilter===qt,"filter not supported, must enable oes_texture_float_linear"),se(!B.genMipmaps,"mipmap generation not supported with float textures"));var $t=ve.images;for(Ot=0;Ot<16;++Ot)if($t[Ot]){var or=sr>>Ot,yr=Tt>>Ot;se(ve.mipmask&1<<Ot,"missing mipmap data");var Tr=$t[Ot];if(se(Tr.width===or&&Tr.height===yr,"invalid shape for mip images"),se(Tr.format===ve.format&&Tr.internalformat===ve.internalformat&&Tr.type===ve.type,"incompatible type for mip image"),!Tr.compressed)if(Tr.data){var Mr=Math.ceil(Ui(Tr.type,er)*or/Tr.unpackAlignment)*Tr.unpackAlignment;se(Tr.data.byteLength===Mr*yr,"invalid data for image, buffer size is inconsistent with image format")}else Tr.element||Tr.copy}else B.genMipmaps||se((ve.mipmask&1<<Ot)==0,"extra mipmap data");ve.compressed&&se(!B.genMipmaps,"mipmap generation for compressed images not supported")}function Ts(B,ve,Be,Ot){var sr=B.width,Tt=B.height,er=B.channels;se(sr>0&&sr<=Ot.maxTextureSize&&Tt>0&&Tt<=Ot.maxTextureSize,"invalid texture shape"),se(sr===Tt,"cube map must be square"),se(ve.wrapS===Ft&&ve.wrapT===Ft,"wrap mode not supported by cube map");for(var $t=0;$t<Be.length;++$t){var or=Be[$t];se(or.width===sr&&or.height===Tt,"inconsistent cube map face shape"),ve.genMipmaps&&(se(!or.compressed,"can not generate mipmap for compressed textures"),se(or.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var yr=or.images,Tr=0;Tr<16;++Tr){var Mr=yr[Tr];if(Mr){var jr=sr>>Tr,br=Tt>>Tr;se(or.mipmask&1<<Tr,"missing mipmap data"),se(Mr.width===jr&&Mr.height===br,"invalid shape for mip images"),se(Mr.format===B.format&&Mr.internalformat===B.internalformat&&Mr.type===B.type,"incompatible type for mip image"),Mr.compressed||(Mr.data?se(Mr.data.byteLength===jr*br*Math.max(Ui(Mr.type,er),Mr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Mr.element||Mr.copy)}}}}var ge=v(se,{optional:Et,raise:te,commandRaise:Kr,command:Me,parameter:he,commandParameter:A,constructor:Qt,type:gt,commandType:_e,isTypedArray:$e,nni:Jt,oneOf:ir,shaderError:Qe,linkError:Ut,callSite:Xt,saveCommandRef:xr,saveDrawInfo:Dr,framebufferFormat:dt,guessCommand:X,texture2D:qi,textureCube:Ts}),ui=0,no=0,ru=5,Vt=6;function ar(B,ve){this.id=ui++,this.type=B,this.data=ve}function Ar(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function on(B){if(B.length===0)return[];var ve=B.charAt(0),Be=B.charAt(B.length-1);if(B.length>1&&ve===Be&&(ve==='"'||ve==="'"))return['"'+Ar(B.substr(1,B.length-2))+'"'];var Ot=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(Ot)return on(B.substr(0,Ot.index)).concat(on(Ot[1])).concat(on(B.substr(Ot.index+Ot[0].length)));var sr=B.split(".");if(sr.length===1)return['"'+Ar(B)+'"'];for(var Tt=[],er=0;er<sr.length;++er)Tt=Tt.concat(on(sr[er]));return Tt}function In(B){return"["+on(B).join("][")+"]"}function Rn(B,ve){return new ar(B,In(ve+""))}function bi(B){return typeof B=="function"&&!B._reglType||B instanceof ar}function gi(B,ve){if(typeof B=="function")return new ar(no,B);if(typeof B=="number"||typeof B=="boolean")return new ar(ru,B);if(Array.isArray(B))return new ar(Vt,B.map(function(Be,Ot){return gi(Be,ve+"["+Ot+"]")}));if(B instanceof ar)return B;ge(!1,"invalid option type in uniform "+ve)}var En={DynamicVariable:ar,define:Rn,isDynamic:bi,unbox:gi,accessor:In},Oi={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Ii=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ja=Ii?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ps(){var B={"":0},ve=[""];return{id:function(Be){var Ot=B[Be];return Ot||(Ot=B[Be]=ve.length,ve.push(Be),Ot)},str:function(Be){return ve[Be]}}}function Ho(B,ve,Be){var Ot=document.createElement("canvas");v(Ot.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(Ot),B===document.body&&(Ot.style.position="absolute",v(B.style,{margin:0,padding:0}));function sr(){var $t=window.innerWidth,or=window.innerHeight;if(B!==document.body){var yr=Ot.getBoundingClientRect();$t=yr.right-yr.left,or=yr.bottom-yr.top}Ot.width=Be*$t,Ot.height=Be*or}var Tt;B!==document.body&&typeof ResizeObserver=="function"?(Tt=new ResizeObserver(function(){setTimeout(sr)}),Tt.observe(B)):window.addEventListener("resize",sr,!1);function er(){Tt?Tt.disconnect():window.removeEventListener("resize",sr),B.removeChild(Ot)}return sr(),{canvas:Ot,onDestroy:er}}function ka(B,ve){function Be(Ot){try{return B.getContext(Ot,ve)}catch(sr){return null}}return Be("webgl")||Be("experimental-webgl")||Be("webgl-experimental")}function ya(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function j(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function K(B){return typeof B=="string"?B.split():(ge(Array.isArray(B),"invalid extension array"),B)}function re(B){return typeof B=="string"?(ge(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function ye(B){var ve=B||{},Be,Ot,sr,Tt,er={},$t=[],or=[],yr=typeof window=="undefined"?1:window.devicePixelRatio,Tr=!1,Mr=function(gr){gr&&ge.raise(gr)},jr=function(){};if(typeof ve=="string"?(ge(typeof document!="undefined","selector queries only supported in DOM environments"),Be=document.querySelector(ve),ge(Be,"invalid query string for element")):typeof ve=="object"?ya(ve)?Be=ve:j(ve)?(Tt=ve,sr=Tt.canvas):(ge.constructor(ve),"gl"in ve?Tt=ve.gl:"canvas"in ve?sr=re(ve.canvas):"container"in ve&&(Ot=re(ve.container)),"attributes"in ve&&(er=ve.attributes,ge.type(er,"object","invalid context attributes")),"extensions"in ve&&($t=K(ve.extensions)),"optionalExtensions"in ve&&(or=K(ve.optionalExtensions)),"onDone"in ve&&(ge.type(ve.onDone,"function","invalid or missing onDone callback"),Mr=ve.onDone),"profile"in ve&&(Tr=!!ve.profile),"pixelRatio"in ve&&(yr=+ve.pixelRatio,ge(yr>0,"invalid pixel ratio"))):ge.raise("invalid arguments to regl"),Be&&(Be.nodeName.toLowerCase()==="canvas"?sr=Be:Ot=Be),!Tt){if(!sr){ge(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var br=Ho(Ot||document.body,Mr,yr);if(!br)return null;sr=br.canvas,jr=br.onDestroy}er.premultipliedAlpha===void 0&&(er.premultipliedAlpha=!0),Tt=ka(sr,er)}return Tt?{gl:Tt,canvas:sr,container:Ot,extensions:$t,optionalExtensions:or,pixelRatio:yr,profile:Tr,onDone:Mr,onDestroy:jr}:(jr(),Mr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ke(B,ve){var Be={};function Ot($t){ge.type($t,"string","extension name must be string");var or=$t.toLowerCase(),yr;try{yr=Be[or]=sr($t)}catch(Tr){}return!!yr}function sr($t){return B.getExtension($t)?B.getExtension($t):B.getExtension($t.toLowerCase())?B.getExtension($t.toLowerCase()):null}for(var Tt=0;Tt<ve.extensions.length;++Tt){var er=ve.extensions[Tt];if(!Ot(er))return ve.onDestroy(),ve.onDone('"'+er+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ve.optionalExtensions.forEach(Ot),{extensions:Be,restore:function(){Object.keys(Be).forEach(function($t){if(Be[$t]&&!Ot($t))throw new Error("(regl): error restoring extension "+$t)})}}}function je(B,ve){for(var Be=Array(B),Ot=0;Ot<B;++Ot)Be[Ot]=ve(Ot);return Be}var Je=5120,le=5121,De=5122,vt=5123,fr=5124,Rt=5125,Lt=5126;function vr(B){for(var ve=16;ve<=1<<28;ve*=16)if(B<=ve)return ve;return 0}function yn(B){var ve,Be;return ve=(B>65535)<<4,B>>>=ve,Be=(B>255)<<3,B>>>=Be,ve|=Be,Be=(B>15)<<2,B>>>=Be,ve|=Be,Be=(B>3)<<1,B>>>=Be,ve|=Be,ve|B>>1}function ln(){var B=je(8,function(){return[]});function ve(Tt){var er=vr(Tt),$t=B[yn(er)>>2];return $t.length>0?$t.pop():new ArrayBuffer(er)}function Be(Tt){B[yn(Tt.byteLength)>>2].push(Tt)}function Ot(Tt,er){var $t=null;switch(Tt){case Je:$t=new Int8Array(ve(er),0,er);break;case le:$t=new Uint8Array(ve(er),0,er);break;case De:$t=new Int16Array(ve(2*er),0,er);break;case vt:$t=new Uint16Array(ve(2*er),0,er);break;case fr:$t=new Int32Array(ve(4*er),0,er);break;case Rt:$t=new Uint32Array(ve(4*er),0,er);break;case Lt:$t=new Float32Array(ve(4*er),0,er);break;default:return null}return $t.length!==er?$t.subarray(0,er):$t}function sr(Tt){Be(Tt.buffer)}return{alloc:ve,free:Be,allocType:Ot,freeType:sr}}var wt=ln();wt.zero=ln();var nn=3408,Fr=3410,Vr=3411,di=3412,en=3413,Ai=3414,Vn=3415,li=33901,Ci=33902,Ei=3379,Xn=3386,Bt=34921,Yt=36347,Ki=36348,Jn=35661,Di=35660,Sa=34930,bn=36349,Wr=34076,At=34024,Ro=7936,be=7937,$i=7938,Au=35724,$a=34047,_a=36063,La=34852,ta=3553,ko=34067,Lo=34069,Tu=33984,mo=6408,wo=5126,aa=5121,Ga=36160,Do=36053,Ha=36064,Ls=16384,Uu=function(B,ve){var Be=1;ve.ext_texture_filter_anisotropic&&(Be=B.getParameter($a));var Ot=1,sr=1;ve.webgl_draw_buffers&&(Ot=B.getParameter(La),sr=B.getParameter(_a));var Tt=!!ve.oes_texture_float;if(Tt){var er=B.createTexture();B.bindTexture(ta,er),B.texImage2D(ta,0,mo,1,1,0,mo,wo,null);var $t=B.createFramebuffer();if(B.bindFramebuffer(Ga,$t),B.framebufferTexture2D(Ga,Ha,ta,er,0),B.bindTexture(ta,null),B.checkFramebufferStatus(Ga)!==Do)Tt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(Ls);var or=wt.allocType(wo,4);B.readPixels(0,0,1,1,mo,wo,or),B.getError()?Tt=!1:(B.deleteFramebuffer($t),B.deleteTexture(er),Tt=or[0]===1),wt.freeType(or)}}var yr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Tr=!0;if(!yr){var Mr=B.createTexture(),jr=wt.allocType(aa,36);B.activeTexture(Tu),B.bindTexture(ko,Mr),B.texImage2D(Lo,0,mo,3,3,0,mo,aa,jr),wt.freeType(jr),B.bindTexture(ko,null),B.deleteTexture(Mr),Tr=!B.getError()}return{colorBits:[B.getParameter(Fr),B.getParameter(Vr),B.getParameter(di),B.getParameter(en)],depthBits:B.getParameter(Ai),stencilBits:B.getParameter(Vn),subpixelBits:B.getParameter(nn),extensions:Object.keys(ve).filter(function(br){return!!ve[br]}),maxAnisotropic:Be,maxDrawbuffers:Ot,maxColorAttachments:sr,pointSizeDims:B.getParameter(li),lineWidthDims:B.getParameter(Ci),maxViewportDims:B.getParameter(Xn),maxCombinedTextureUnits:B.getParameter(Jn),maxCubeMapSize:B.getParameter(Wr),maxRenderbufferSize:B.getParameter(At),maxTextureUnits:B.getParameter(Sa),maxTextureSize:B.getParameter(Ei),maxAttributes:B.getParameter(Bt),maxVertexUniforms:B.getParameter(Yt),maxVertexTextureUnits:B.getParameter(Di),maxVaryingVectors:B.getParameter(Ki),maxFragmentUniforms:B.getParameter(bn),glsl:B.getParameter(Au),renderer:B.getParameter(be),vendor:B.getParameter(Ro),version:B.getParameter($i),readFloat:Tt,npotTextureCube:Tr}};function ds(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||pe(B.data))}var ee=function(B){return Object.keys(B).map(function(ve){return B[ve]})},Ee={shape:Qa,flatten:Ti};function Xe(B,ve,Be){for(var Ot=0;Ot<ve;++Ot)Be[Ot]=B[Ot]}function Pt(B,ve,Be,Ot){for(var sr=0,Tt=0;Tt<ve;++Tt)for(var er=B[Tt],$t=0;$t<Be;++$t)Ot[sr++]=er[$t]}function Pr(B,ve,Be,Ot,sr,Tt){for(var er=Tt,$t=0;$t<ve;++$t)for(var or=B[$t],yr=0;yr<Be;++yr)for(var Tr=or[yr],Mr=0;Mr<Ot;++Mr)sr[er++]=Tr[Mr]}function An(B,ve,Be,Ot,sr){for(var Tt=1,er=Be+1;er<ve.length;++er)Tt*=ve[er];var $t=ve[Be];if(ve.length-Be==4){var or=ve[Be+1],yr=ve[Be+2],Tr=ve[Be+3];for(er=0;er<$t;++er)Pr(B[er],or,yr,Tr,Ot,sr),sr+=Tt}else for(er=0;er<$t;++er)An(B[er],ve,Be+1,Ot,sr),sr+=Tt}function Ti(B,ve,Be,Ot){var sr=1;if(ve.length)for(var Tt=0;Tt<ve.length;++Tt)sr*=ve[Tt];else sr=0;var er=Ot||wt.allocType(Be,sr);switch(ve.length){case 0:break;case 1:Xe(B,ve[0],er);break;case 2:Pt(B,ve[0],ve[1],er);break;case 3:Pr(B,ve[0],ve[1],ve[2],er,0);break;default:An(B,ve,0,er,0)}return er}function Qa(B){for(var ve=[],Be=B;Be.length;Be=Be[0])ve.push(Be.length);return ve}var Aa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Fa=5120,Fo=5122,vs=5124,Wo=5121,Ao=5123,To=5125,Ms=5126,Hs=5126,Ws={int8:Fa,int16:Fo,int32:vs,uint8:Wo,uint16:Ao,uint32:To,float:Ms,float32:Hs},ms=35048,va=35040,go={dynamic:ms,stream:va,static:35044},Qo=Ee.flatten,gs=Ee.shape,Pl=35044,rf=35040,Ps=5121,Il=5126,Xs=[];Xs[5120]=1,Xs[5122]=2,Xs[5124]=4,Xs[5121]=1,Xs[5123]=2,Xs[5125]=4,Xs[5126]=4;function rl(B){return Aa[Object.prototype.toString.call(B)]|0}function _(B,ve){for(var Be=0;Be<ve.length;++Be)B[Be]=ve[Be]}function T(B,ve,Be,Ot,sr,Tt,er){for(var $t=0,or=0;or<Be;++or)for(var yr=0;yr<Ot;++yr)B[$t++]=ve[sr*or+Tt*yr+er]}function F(B,ve,Be,Ot){var sr=0,Tt={};function er(it){this.id=sr++,this.buffer=B.createBuffer(),this.type=it,this.usage=Pl,this.byteLength=0,this.dimension=1,this.dtype=Ps,this.persistentData=null,Be.profile&&(this.stats={size:0})}er.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},er.prototype.destroy=function(){jr(this)};var $t=[];function or(it,Gt){var _r=$t.pop();return _r||(_r=new er(it)),_r.bind(),Mr(_r,Gt,rf,0,1,!1),_r}function yr(it){$t.push(it)}function Tr(it,Gt,_r){it.byteLength=Gt.byteLength,B.bufferData(it.type,Gt,_r)}function Mr(it,Gt,_r,Br,cr,Ir){var Gr;if(it.usage=_r,Array.isArray(Gt)){if(it.dtype=Br||Il,Gt.length>0){var Bn;if(Array.isArray(Gt[0])){Gr=gs(Gt);for(var tr=1,rr=1;rr<Gr.length;++rr)tr*=Gr[rr];it.dimension=tr,Bn=Qo(Gt,Gr,it.dtype),Tr(it,Bn,_r),Ir?it.persistentData=Bn:wt.freeType(Bn)}else if(typeof Gt[0]=="number"){it.dimension=cr;var fn=wt.allocType(it.dtype,Gt.length);_(fn,Gt),Tr(it,fn,_r),Ir?it.persistentData=fn:wt.freeType(fn)}else pe(Gt[0])?(it.dimension=Gt[0].length,it.dtype=Br||rl(Gt[0])||Il,Bn=Qo(Gt,[Gt.length,Gt[0].length],it.dtype),Tr(it,Bn,_r),Ir?it.persistentData=Bn:wt.freeType(Bn)):ge.raise("invalid buffer data")}}else if(pe(Gt))it.dtype=Br||rl(Gt),it.dimension=cr,Tr(it,Gt,_r),Ir&&(it.persistentData=new Uint8Array(new Uint8Array(Gt.buffer)));else if(ds(Gt)){Gr=Gt.shape;var Nr=Gt.stride,Er=Gt.offset,Ur=0,Xr=0,mi=0,ri=0;Gr.length===1?(Ur=Gr[0],Xr=1,mi=Nr[0],ri=0):Gr.length===2?(Ur=Gr[0],Xr=Gr[1],mi=Nr[0],ri=Nr[1]):ge.raise("invalid shape"),it.dtype=Br||rl(Gt.data)||Il,it.dimension=Xr;var Yr=wt.allocType(it.dtype,Ur*Xr);T(Yr,Gt.data,Ur,Xr,mi,ri,Er),Tr(it,Yr,_r),Ir?it.persistentData=Yr:wt.freeType(Yr)}else Gt instanceof ArrayBuffer?(it.dtype=Ps,it.dimension=cr,Tr(it,Gt,_r),Ir&&(it.persistentData=new Uint8Array(new Uint8Array(Gt)))):ge.raise("invalid buffer data")}function jr(it){ve.bufferCount--,Ot(it);var Gt=it.buffer;ge(Gt,"buffer must not be deleted already"),B.deleteBuffer(Gt),it.buffer=null,delete Tt[it.id]}function br(it,Gt,_r,Br){ve.bufferCount++;var cr=new er(Gt);Tt[cr.id]=cr;function Ir(tr){var rr=Pl,fn=null,Nr=0,Er=0,Ur=1;return Array.isArray(tr)||pe(tr)||ds(tr)||tr instanceof ArrayBuffer?fn=tr:typeof tr=="number"?Nr=tr|0:tr&&(ge.type(tr,"object","buffer arguments must be an object, a number or an array"),"data"in tr&&(ge(fn===null||Array.isArray(fn)||pe(fn)||ds(fn),"invalid data for buffer"),fn=tr.data),"usage"in tr&&(ge.parameter(tr.usage,go,"invalid buffer usage"),rr=go[tr.usage]),"type"in tr&&(ge.parameter(tr.type,Ws,"invalid buffer type"),Er=Ws[tr.type]),"dimension"in tr&&(ge.type(tr.dimension,"number","invalid dimension"),Ur=tr.dimension|0),"length"in tr&&(ge.nni(Nr,"buffer length must be a nonnegative integer"),Nr=tr.length|0)),cr.bind(),fn?Mr(cr,fn,rr,Er,Ur,Br):(Nr&&B.bufferData(cr.type,Nr,rr),cr.dtype=Er||Ps,cr.usage=rr,cr.dimension=Ur,cr.byteLength=Nr),Be.profile&&(cr.stats.size=cr.byteLength*Xs[cr.dtype]),Ir}function Gr(tr,rr){ge(rr+tr.byteLength<=cr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+tr.byteLength+" starting from offset "+rr+" to a buffer of size "+cr.byteLength),B.bufferSubData(cr.type,rr,tr)}function Bn(tr,rr){var fn=(rr||0)|0,Nr;if(cr.bind(),pe(tr)||tr instanceof ArrayBuffer)Gr(tr,fn);else if(Array.isArray(tr)){if(tr.length>0)if(typeof tr[0]=="number"){var Er=wt.allocType(cr.dtype,tr.length);_(Er,tr),Gr(Er,fn),wt.freeType(Er)}else if(Array.isArray(tr[0])||pe(tr[0])){Nr=gs(tr);var Ur=Qo(tr,Nr,cr.dtype);Gr(Ur,fn),wt.freeType(Ur)}else ge.raise("invalid buffer data")}else if(ds(tr)){Nr=tr.shape;var Xr=tr.stride,mi=0,ri=0,Yr=0,rn=0;Nr.length===1?(mi=Nr[0],ri=1,Yr=Xr[0],rn=0):Nr.length===2?(mi=Nr[0],ri=Nr[1],Yr=Xr[0],rn=Xr[1]):ge.raise("invalid shape");var Yn=Array.isArray(tr.data)?cr.dtype:rl(tr.data),hi=wt.allocType(Yn,mi*ri);T(hi,tr.data,mi,ri,Yr,rn,tr.offset),Gr(hi,fn),wt.freeType(hi)}else ge.raise("invalid data for buffer subdata");return Ir}return _r||Ir(it),Ir._reglType="buffer",Ir._buffer=cr,Ir.subdata=Bn,Be.profile&&(Ir.stats=cr.stats),Ir.destroy=function(){jr(cr)},Ir}function gr(){ee(Tt).forEach(function(it){it.buffer=B.createBuffer(),B.bindBuffer(it.type,it.buffer),B.bufferData(it.type,it.persistentData||it.byteLength,it.usage)})}return Be.profile&&(ve.getTotalBufferSize=function(){var it=0;return Object.keys(Tt).forEach(function(Gt){it+=Tt[Gt].stats.size}),it}),{create:br,createStream:or,destroyStream:yr,clear:function(){ee(Tt).forEach(jr),$t.forEach(jr)},getBuffer:function(it){return it&&it._buffer instanceof er?it._buffer:null},restore:gr,_initBuffer:Mr}}var O=0,Y=0,me=1,Ge=1,ut=4,ct=4,lr={points:O,point:Y,lines:me,line:Ge,triangles:ut,triangle:ct,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},mr=0,cn=1,ei=4,Hn=5120,vi=5121,ca=5122,xa=5123,Zi=5124,ys=5125,hu=34963,Zu=35040,Mc=35044;function nl(B,ve,Be,Ot){var sr={},Tt=0,er={uint8:vi,uint16:xa};ve.oes_element_index_uint&&(er.uint32=ys);function $t(gr){this.id=Tt++,sr[this.id]=this,this.buffer=gr,this.primType=ei,this.vertCount=0,this.type=0}$t.prototype.bind=function(){this.buffer.bind()};var or=[];function yr(gr){var it=or.pop();return it||(it=new $t(Be.create(null,hu,!0,!1)._buffer)),Mr(it,gr,Zu,-1,-1,0,0),it}function Tr(gr){or.push(gr)}function Mr(gr,it,Gt,_r,Br,cr,Ir){gr.buffer.bind();var Gr;if(it){var Bn=Ir;!Ir&&(!pe(it)||ds(it)&&!pe(it.data))&&(Bn=ve.oes_element_index_uint?ys:xa),Be._initBuffer(gr.buffer,it,Gt,Bn,3)}else B.bufferData(hu,cr,Gt),gr.buffer.dtype=Gr||vi,gr.buffer.usage=Gt,gr.buffer.dimension=3,gr.buffer.byteLength=cr;if(Gr=Ir,!Ir){switch(gr.buffer.dtype){case vi:case Hn:Gr=vi;break;case xa:case ca:Gr=xa;break;case ys:case Zi:Gr=ys;break;default:ge.raise("unsupported type for element array")}gr.buffer.dtype=Gr}gr.type=Gr,ge(Gr!==ys||!!ve.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var tr=Br;tr<0&&(tr=gr.buffer.byteLength,Gr===xa?tr>>=1:Gr===ys&&(tr>>=2)),gr.vertCount=tr;var rr=_r;if(_r<0){rr=ei;var fn=gr.buffer.dimension;fn===1&&(rr=mr),fn===2&&(rr=cn),fn===3&&(rr=ei)}gr.primType=rr}function jr(gr){Ot.elementsCount--,ge(gr.buffer!==null,"must not double destroy elements"),delete sr[gr.id],gr.buffer.destroy(),gr.buffer=null}function br(gr,it){var Gt=Be.create(null,hu,!0),_r=new $t(Gt._buffer);Ot.elementsCount++;function Br(cr){if(!cr)Gt(),_r.primType=ei,_r.vertCount=0,_r.type=vi;else if(typeof cr=="number")Gt(cr),_r.primType=ei,_r.vertCount=cr|0,_r.type=vi;else{var Ir=null,Gr=Mc,Bn=-1,tr=-1,rr=0,fn=0;Array.isArray(cr)||pe(cr)||ds(cr)?Ir=cr:(ge.type(cr,"object","invalid arguments for elements"),"data"in cr&&(Ir=cr.data,ge(Array.isArray(Ir)||pe(Ir)||ds(Ir),"invalid data for element buffer")),"usage"in cr&&(ge.parameter(cr.usage,go,"invalid element buffer usage"),Gr=go[cr.usage]),"primitive"in cr&&(ge.parameter(cr.primitive,lr,"invalid element buffer primitive"),Bn=lr[cr.primitive]),"count"in cr&&(ge(typeof cr.count=="number"&&cr.count>=0,"invalid vertex count for elements"),tr=cr.count|0),"type"in cr&&(ge.parameter(cr.type,er,"invalid buffer type"),fn=er[cr.type]),"length"in cr?rr=cr.length|0:(rr=tr,fn===xa||fn===ca?rr*=2:(fn===ys||fn===Zi)&&(rr*=4))),Mr(_r,Ir,Gr,Bn,tr,rr,fn)}return Br}return Br(gr),Br._reglType="elements",Br._elements=_r,Br.subdata=function(cr,Ir){return Gt.subdata(cr,Ir),Br},Br.destroy=function(){jr(_r)},Br}return{create:br,createStream:yr,destroyStream:Tr,getElements:function(gr){return typeof gr=="function"&&gr._elements instanceof $t?gr._elements:null},clear:function(){ee(sr).forEach(jr)}}}var Pc=new Float32Array(1),Mu=new Uint32Array(Pc.buffer),Pu=5123;function Iu(B){for(var ve=wt.allocType(Pu,B.length),Be=0;Be<B.length;++Be)if(isNaN(B[Be]))ve[Be]=65535;else if(B[Be]===Infinity)ve[Be]=31744;else if(B[Be]===-Infinity)ve[Be]=64512;else{Pc[0]=B[Be];var Ot=Mu[0],sr=Ot>>>31<<15,Tt=(Ot<<1>>>24)-127,er=Ot>>13&(1<<10)-1;if(Tt<-24)ve[Be]=sr;else if(Tt<-14){var $t=-14-Tt;ve[Be]=sr+(er+(1<<10)>>$t)}else Tt>15?ve[Be]=sr+31744:ve[Be]=sr+(Tt+15<<10)+er}return ve}function io(B){return Array.isArray(B)||pe(B)}var kf=function(B){return!(B&B-1)&&!!B},Lf=34467,_s=3553,Kl=34067,pu=34069,Ys=6408,Df=6406,il=6407,ba=6409,Jo=6410,ph=32854,al=32855,Ff=36194,Bf=32819,nf=32820,af=33635,Ic=34042,$l=6402,Ql=34041,Jl=35904,ol=35906,Ol=36193,sl=33776,Ds=33777,of=33778,sf=33779,Nf=35986,ul=35987,Ou=34798,Oc=35840,uf=35841,Rc=35842,lf=35843,cf=36196,Rl=5121,zf=5123,ff=5125,ll=5126,dh=10242,kc=10243,vh=10497,ec=33071,np=33648,kl=10240,Ba=10241,es=9728,Ll=9729,Xi=9984,Vi=9985,Ta=9986,Is=9987,tc=33170,Vu=4352,Lc=4353,ao=4354,rc=34046,du=3317,ju=37440,Gu=37441,yo=37443,cl=37444,Dl=33984,_o=[Xi,Ta,Vi,Is],dn=[0,ba,Jo,il,Ys],Ja={};Ja[ba]=Ja[Df]=Ja[$l]=1,Ja[Ql]=Ja[Jo]=2,Ja[il]=Ja[Jl]=3,Ja[Ys]=Ja[ol]=4;function fl(B){return"[object "+B+"]"}var Fl=fl("HTMLCanvasElement"),fa=fl("OffscreenCanvas"),xs=fl("CanvasRenderingContext2D"),hf=fl("ImageBitmap"),qr=fl("HTMLImageElement"),Bl=fl("HTMLVideoElement"),nc=Object.keys(Aa).concat([Fl,fa,xs,hf,qr,Bl]),hl=[];hl[Rl]=1,hl[ll]=4,hl[Ol]=2,hl[zf]=2,hl[ff]=4;var Ma=[];Ma[ph]=2,Ma[al]=2,Ma[Ff]=2,Ma[Ql]=4,Ma[sl]=.5,Ma[Ds]=.5,Ma[of]=1,Ma[sf]=1,Ma[Nf]=.5,Ma[ul]=1,Ma[Ou]=1,Ma[Oc]=.5,Ma[uf]=.25,Ma[Rc]=.5,Ma[lf]=.25,Ma[cf]=.5;function ss(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function ic(B){if(!Array.isArray(B))return!1;var ve=B.length;return!(ve===0||!io(B[0]))}function Hu(B){return Object.prototype.toString.call(B)}function Os(B){return Hu(B)===Fl}function Wu(B){return Hu(B)===fa}function mh(B){return Hu(B)===xs}function ac(B){return Hu(B)===hf}function oc(B){return Hu(B)===qr}function Uf(B){return Hu(B)===Bl}function Fs(B){var ve=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ve&&B&&B.getContext)}function qs(B){var ve=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ve&&B&&"src"in B&&"crossOrigin"in B)}function Mi(B){if(!B)return!1;if(Fs(B)||qs(B))return!0;var ve=Hu(B);return nc.indexOf(ve)>=0?!0:ss(B)||ic(B)||ds(B)}function Ks(B){return Aa[Object.prototype.toString.call(B)]|0}function vu(B,ve){var Be=ve.length;switch(B.type){case Rl:case zf:case ff:case ll:var Ot=wt.allocType(B.type,Be);Ot.set(ve),B.data=Ot;break;case Ol:B.data=Iu(ve);break;default:ge.raise("unsupported texture type, must specify a typed array")}}function Xo(B,ve){return wt.allocType(B.type===Ol?ll:B.type,ve)}function pl(B,ve){B.type===Ol?(B.data=Iu(ve),wt.freeType(ve)):B.data=ve}function dl(B,ve,Be,Ot,sr,Tt){for(var er=B.width,$t=B.height,or=B.channels,yr=er*$t*or,Tr=Xo(B,yr),Mr=0,jr=0;jr<$t;++jr)for(var br=0;br<er;++br)for(var gr=0;gr<or;++gr)Tr[Mr++]=ve[Be*br+Ot*jr+sr*gr+Tt];pl(B,Tr)}function fo(B,ve,Be,Ot,sr,Tt){var er;if(typeof Ma[B]!="undefined"?er=Ma[B]:er=Ja[B]*hl[ve],Tt&&(er*=6),sr){for(var $t=0,or=Be;or>=1;)$t+=er*or*or,or/=2;return $t}else return er*Be*Ot}function Rs(B,ve,Be,Ot,sr,Tt,er){var $t={"don't care":Vu,"dont care":Vu,nice:ao,fast:Lc},or={repeat:vh,clamp:ec,mirror:np},yr={nearest:es,linear:Ll},Tr=v({mipmap:Is,"nearest mipmap nearest":Xi,"linear mipmap nearest":Vi,"nearest mipmap linear":Ta,"linear mipmap linear":Is},yr),Mr={none:0,browser:cl},jr={uint8:Rl,rgba4:Bf,rgb565:af,"rgb5 a1":nf},br={alpha:Df,luminance:ba,"luminance alpha":Jo,rgb:il,rgba:Ys,rgba4:ph,"rgb5 a1":al,rgb565:Ff},gr={};ve.ext_srgb&&(br.srgb=Jl,br.srgba=ol),ve.oes_texture_float&&(jr.float32=jr.float=ll),ve.oes_texture_half_float&&(jr.float16=jr["half float"]=Ol),ve.webgl_depth_texture&&(v(br,{depth:$l,"depth stencil":Ql}),v(jr,{uint16:zf,uint32:ff,"depth stencil":Ic})),ve.webgl_compressed_texture_s3tc&&v(gr,{"rgb s3tc dxt1":sl,"rgba s3tc dxt1":Ds,"rgba s3tc dxt3":of,"rgba s3tc dxt5":sf}),ve.webgl_compressed_texture_atc&&v(gr,{"rgb atc":Nf,"rgba atc explicit alpha":ul,"rgba atc interpolated alpha":Ou}),ve.webgl_compressed_texture_pvrtc&&v(gr,{"rgb pvrtc 4bppv1":Oc,"rgb pvrtc 2bppv1":uf,"rgba pvrtc 4bppv1":Rc,"rgba pvrtc 2bppv1":lf}),ve.webgl_compressed_texture_etc1&&(gr["rgb etc1"]=cf);var it=Array.prototype.slice.call(B.getParameter(Lf)||new Uint32Array(0));Object.keys(gr).forEach(function(Te){var Dt=gr[Te];it.indexOf(Dt)>=0&&(br[Te]=Dt)});var Gt=Object.keys(br);Be.textureFormats=Gt;var _r=[];Object.keys(br).forEach(function(Te){var Dt=br[Te];_r[Dt]=Te});var Br=[];Object.keys(jr).forEach(function(Te){var Dt=jr[Te];Br[Dt]=Te});var cr=[];Object.keys(yr).forEach(function(Te){var Dt=yr[Te];cr[Dt]=Te});var Ir=[];Object.keys(Tr).forEach(function(Te){var Dt=Tr[Te];Ir[Dt]=Te});var Gr=[];Object.keys(or).forEach(function(Te){var Dt=or[Te];Gr[Dt]=Te});var Bn=Gt.reduce(function(Te,Dt){var xt=br[Dt];return xt===ba||xt===Df||xt===ba||xt===Jo||xt===$l||xt===Ql||ve.ext_srgb&&(xt===Jl||xt===ol)?Te[xt]=xt:xt===al||Dt.indexOf("rgba")>=0?Te[xt]=Ys:Te[xt]=il,Te},{});function tr(){this.internalformat=Ys,this.format=Ys,this.type=Rl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=cl,this.width=0,this.height=0,this.channels=0}function rr(Te,Dt){Te.internalformat=Dt.internalformat,Te.format=Dt.format,Te.type=Dt.type,Te.compressed=Dt.compressed,Te.premultiplyAlpha=Dt.premultiplyAlpha,Te.flipY=Dt.flipY,Te.unpackAlignment=Dt.unpackAlignment,Te.colorSpace=Dt.colorSpace,Te.width=Dt.width,Te.height=Dt.height,Te.channels=Dt.channels}function fn(Te,Dt){if(!(typeof Dt!="object"||!Dt)){if("premultiplyAlpha"in Dt&&(ge.type(Dt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Te.premultiplyAlpha=Dt.premultiplyAlpha),"flipY"in Dt&&(ge.type(Dt.flipY,"boolean","invalid texture flip"),Te.flipY=Dt.flipY),"alignment"in Dt&&(ge.oneOf(Dt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Te.unpackAlignment=Dt.alignment),"colorSpace"in Dt&&(ge.parameter(Dt.colorSpace,Mr,"invalid colorSpace"),Te.colorSpace=Mr[Dt.colorSpace]),"type"in Dt){var xt=Dt.type;ge(ve.oes_texture_float||!(xt==="float"||xt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),ge(ve.oes_texture_half_float||!(xt==="half float"||xt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ge(ve.webgl_depth_texture||!(xt==="uint16"||xt==="uint32"||xt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ge.parameter(xt,jr,"invalid texture type"),Te.type=jr[xt]}var vn=Te.width,Bi=Te.height,Se=Te.channels,oe=!1;"shape"in Dt?(ge(Array.isArray(Dt.shape)&&Dt.shape.length>=2,"shape must be an array"),vn=Dt.shape[0],Bi=Dt.shape[1],Dt.shape.length===3&&(Se=Dt.shape[2],ge(Se>0&&Se<=4,"invalid number of channels"),oe=!0),ge(vn>=0&&vn<=Be.maxTextureSize,"invalid width"),ge(Bi>=0&&Bi<=Be.maxTextureSize,"invalid height")):("radius"in Dt&&(vn=Bi=Dt.radius,ge(vn>=0&&vn<=Be.maxTextureSize,"invalid radius")),"width"in Dt&&(vn=Dt.width,ge(vn>=0&&vn<=Be.maxTextureSize,"invalid width")),"height"in Dt&&(Bi=Dt.height,ge(Bi>=0&&Bi<=Be.maxTextureSize,"invalid height")),"channels"in Dt&&(Se=Dt.channels,ge(Se>0&&Se<=4,"invalid number of channels"),oe=!0)),Te.width=vn|0,Te.height=Bi|0,Te.channels=Se|0;var Ve=!1;if("format"in Dt){var at=Dt.format;ge(ve.webgl_depth_texture||!(at==="depth"||at==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ge.parameter(at,br,"invalid texture format");var Mt=Te.internalformat=br[at];Te.format=Bn[Mt],at in jr&&("type"in Dt||(Te.type=jr[at])),at in gr&&(Te.compressed=!0),Ve=!0}!oe&&Ve?Te.channels=Ja[Te.format]:oe&&!Ve?Te.channels!==dn[Te.format]&&(Te.format=Te.internalformat=dn[Te.channels]):Ve&&oe&&ge(Te.channels===Ja[Te.format],"number of channels inconsistent with specified format")}}function Nr(Te){B.pixelStorei(ju,Te.flipY),B.pixelStorei(Gu,Te.premultiplyAlpha),B.pixelStorei(yo,Te.colorSpace),B.pixelStorei(du,Te.unpackAlignment)}function Er(){tr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Ur(Te,Dt){var xt=null;if(Mi(Dt)?xt=Dt:Dt&&(ge.type(Dt,"object","invalid pixel data type"),fn(Te,Dt),"x"in Dt&&(Te.xOffset=Dt.x|0),"y"in Dt&&(Te.yOffset=Dt.y|0),Mi(Dt.data)&&(xt=Dt.data)),ge(!Te.compressed||xt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Dt.copy){ge(!xt,"can not specify copy and data field for the same texture");var vn=sr.viewportWidth,Bi=sr.viewportHeight;Te.width=Te.width||vn-Te.xOffset,Te.height=Te.height||Bi-Te.yOffset,Te.needsCopy=!0,ge(Te.xOffset>=0&&Te.xOffset<vn&&Te.yOffset>=0&&Te.yOffset<Bi&&Te.width>0&&Te.width<=vn&&Te.height>0&&Te.height<=Bi,"copy texture read out of bounds")}else if(!xt)Te.width=Te.width||1,Te.height=Te.height||1,Te.channels=Te.channels||4;else if(pe(xt))Te.channels=Te.channels||4,Te.data=xt,!("type"in Dt)&&Te.type===Rl&&(Te.type=Ks(xt));else if(ss(xt))Te.channels=Te.channels||4,vu(Te,xt),Te.alignment=1,Te.needsFree=!0;else if(ds(xt)){var Se=xt.data;!Array.isArray(Se)&&Te.type===Rl&&(Te.type=Ks(Se));var oe=xt.shape,Ve=xt.stride,at,Mt,Ye,Fe,et,xe;oe.length===3?(Ye=oe[2],xe=Ve[2]):(ge(oe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ye=1,xe=1),at=oe[0],Mt=oe[1],Fe=Ve[0],et=Ve[1],Te.alignment=1,Te.width=at,Te.height=Mt,Te.channels=Ye,Te.format=Te.internalformat=dn[Ye],Te.needsFree=!0,dl(Te,Se,Fe,et,xe,xt.offset)}else if(Fs(xt)||Os(xt)||Wu(xt)||mh(xt))Fs(xt)||Os(xt)||Wu(xt)?Te.element=xt:Te.element=xt.canvas,Te.width=Te.element.width,Te.height=Te.element.height,Te.channels=4;else if(ac(xt))Te.element=xt,Te.width=xt.width,Te.height=xt.height,Te.channels=4;else if(oc(xt))Te.element=xt,Te.width=xt.naturalWidth,Te.height=xt.naturalHeight,Te.channels=4;else if(qs(xt))Te.element=xt,Te.width=xt.width,Te.height=xt.height,Te.channels=4;else if(Uf(xt))Te.element=xt,Te.width=xt.videoWidth,Te.height=xt.videoHeight,Te.channels=4;else if(ic(xt)){var ze=Te.width||xt[0].length,we=Te.height||xt.length,ot=Te.channels;io(xt[0][0])?ot=ot||xt[0][0].length:ot=ot||1;for(var _t=Ee.shape(xt),hr=1,zr=0;zr<_t.length;++zr)hr*=_t[zr];var Lr=Xo(Te,hr);Ee.flatten(xt,_t,"",Lr),pl(Te,Lr),Te.alignment=1,Te.width=ze,Te.height=we,Te.channels=ot,Te.format=Te.internalformat=dn[ot],Te.needsFree=!0}Te.type===ll?ge(Be.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Te.type===Ol&&ge(Be.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Xr(Te,Dt,xt){var vn=Te.element,Bi=Te.data,Se=Te.internalformat,oe=Te.format,Ve=Te.type,at=Te.width,Mt=Te.height;Nr(Te),vn?B.texImage2D(Dt,xt,oe,oe,Ve,vn):Te.compressed?B.compressedTexImage2D(Dt,xt,Se,at,Mt,0,Bi):Te.needsCopy?(Ot(),B.copyTexImage2D(Dt,xt,oe,Te.xOffset,Te.yOffset,at,Mt,0)):B.texImage2D(Dt,xt,oe,at,Mt,0,oe,Ve,Bi||null)}function mi(Te,Dt,xt,vn,Bi){var Se=Te.element,oe=Te.data,Ve=Te.internalformat,at=Te.format,Mt=Te.type,Ye=Te.width,Fe=Te.height;Nr(Te),Se?B.texSubImage2D(Dt,Bi,xt,vn,at,Mt,Se):Te.compressed?B.compressedTexSubImage2D(Dt,Bi,xt,vn,Ve,Ye,Fe,oe):Te.needsCopy?(Ot(),B.copyTexSubImage2D(Dt,Bi,xt,vn,Te.xOffset,Te.yOffset,Ye,Fe)):B.texSubImage2D(Dt,Bi,xt,vn,Ye,Fe,at,Mt,oe)}var ri=[];function Yr(){return ri.pop()||new Er}function rn(Te){Te.needsFree&&wt.freeType(Te.data),Er.call(Te),ri.push(Te)}function Yn(){tr.call(this),this.genMipmaps=!1,this.mipmapHint=Vu,this.mipmask=0,this.images=Array(16)}function hi(Te,Dt,xt){var vn=Te.images[0]=Yr();Te.mipmask=1,vn.width=Te.width=Dt,vn.height=Te.height=xt,vn.channels=Te.channels=4}function Fi(Te,Dt){var xt=null;if(Mi(Dt))xt=Te.images[0]=Yr(),rr(xt,Te),Ur(xt,Dt),Te.mipmask=1;else if(fn(Te,Dt),Array.isArray(Dt.mipmap))for(var vn=Dt.mipmap,Bi=0;Bi<vn.length;++Bi)xt=Te.images[Bi]=Yr(),rr(xt,Te),xt.width>>=Bi,xt.height>>=Bi,Ur(xt,vn[Bi]),Te.mipmask|=1<<Bi;else xt=Te.images[0]=Yr(),rr(xt,Te),Ur(xt,Dt),Te.mipmask=1;rr(Te,Te.images[0]),Te.compressed&&(Te.internalformat===sl||Te.internalformat===Ds||Te.internalformat===of||Te.internalformat===sf)&&ge(Te.width%4==0&&Te.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Xa(Te,Dt){for(var xt=Te.images,vn=0;vn<xt.length;++vn){if(!xt[vn])return;Xr(xt[vn],Dt,vn)}}var uo=[];function ki(){var Te=uo.pop()||new Yn;tr.call(Te),Te.mipmask=0;for(var Dt=0;Dt<16;++Dt)Te.images[Dt]=null;return Te}function qo(Te){for(var Dt=Te.images,xt=0;xt<Dt.length;++xt)Dt[xt]&&rn(Dt[xt]),Dt[xt]=null;uo.push(Te)}function za(){this.minFilter=es,this.magFilter=es,this.wrapS=ec,this.wrapT=ec,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Vu}function Ko(Te,Dt){if("min"in Dt){var xt=Dt.min;ge.parameter(xt,Tr),Te.minFilter=Tr[xt],_o.indexOf(Te.minFilter)>=0&&!("faces"in Dt)&&(Te.genMipmaps=!0)}if("mag"in Dt){var vn=Dt.mag;ge.parameter(vn,yr),Te.magFilter=yr[vn]}var Bi=Te.wrapS,Se=Te.wrapT;if("wrap"in Dt){var oe=Dt.wrap;typeof oe=="string"?(ge.parameter(oe,or),Bi=Se=or[oe]):Array.isArray(oe)&&(ge.parameter(oe[0],or),ge.parameter(oe[1],or),Bi=or[oe[0]],Se=or[oe[1]])}else{if("wrapS"in Dt){var Ve=Dt.wrapS;ge.parameter(Ve,or),Bi=or[Ve]}if("wrapT"in Dt){var at=Dt.wrapT;ge.parameter(at,or),Se=or[at]}}if(Te.wrapS=Bi,Te.wrapT=Se,"anisotropic"in Dt){var Mt=Dt.anisotropic;ge(typeof Mt=="number"&&Mt>=1&&Mt<=Be.maxAnisotropic,"aniso samples must be between 1 and "),Te.anisotropic=Dt.anisotropic}if("mipmap"in Dt){var Ye=!1;switch(typeof Dt.mipmap){case"string":ge.parameter(Dt.mipmap,$t,"invalid mipmap hint"),Te.mipmapHint=$t[Dt.mipmap],Te.genMipmaps=!0,Ye=!0;break;case"boolean":Ye=Te.genMipmaps=Dt.mipmap;break;case"object":ge(Array.isArray(Dt.mipmap),"invalid mipmap type"),Te.genMipmaps=!1,Ye=!0;break;default:ge.raise("invalid mipmap type")}Ye&&!("min"in Dt)&&(Te.minFilter=Xi)}}function bo(Te,Dt){B.texParameteri(Dt,Ba,Te.minFilter),B.texParameteri(Dt,kl,Te.magFilter),B.texParameteri(Dt,dh,Te.wrapS),B.texParameteri(Dt,kc,Te.wrapT),ve.ext_texture_filter_anisotropic&&B.texParameteri(Dt,rc,Te.anisotropic),Te.genMipmaps&&(B.hint(tc,Te.mipmapHint),B.generateMipmap(Dt))}var $o=0,Zo={},rs=Be.maxTextureUnits,to=Array(rs).map(function(){return null});function _i(Te){tr.call(this),this.mipmask=0,this.internalformat=Ys,this.id=$o++,this.refCount=1,this.target=Te,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new za,er.profile&&(this.stats={size:0})}function Vo(Te){B.activeTexture(Dl),B.bindTexture(Te.target,Te.texture)}function Yi(){var Te=to[0];Te?B.bindTexture(Te.target,Te.texture):B.bindTexture(_s,null)}function ns(Te){var Dt=Te.texture;ge(Dt,"must not double destroy texture");var xt=Te.unit,vn=Te.target;xt>=0&&(B.activeTexture(Dl+xt),B.bindTexture(vn,null),to[xt]=null),B.deleteTexture(Dt),Te.texture=null,Te.params=null,Te.pixels=null,Te.refCount=0,delete Zo[Te.id],Tt.textureCount--}v(_i.prototype,{bind:function(){var Te=this;Te.bindCount+=1;var Dt=Te.unit;if(Dt<0){for(var xt=0;xt<rs;++xt){var vn=to[xt];if(vn){if(vn.bindCount>0)continue;vn.unit=-1}to[xt]=Te,Dt=xt;break}Dt>=rs&&ge.raise("insufficient number of texture units"),er.profile&&Tt.maxTextureUnits<Dt+1&&(Tt.maxTextureUnits=Dt+1),Te.unit=Dt,B.activeTexture(Dl+Dt),B.bindTexture(Te.target,Te.texture)}return Dt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ns(this)}});function ni(Te,Dt){var xt=new _i(_s);Zo[xt.id]=xt,Tt.textureCount++;function vn(oe,Ve){var at=xt.texInfo;za.call(at);var Mt=ki();return typeof oe=="number"?typeof Ve=="number"?hi(Mt,oe|0,Ve|0):hi(Mt,oe|0,oe|0):oe?(ge.type(oe,"object","invalid arguments to regl.texture"),Ko(at,oe),Fi(Mt,oe)):hi(Mt,1,1),at.genMipmaps&&(Mt.mipmask=(Mt.width<<1)-1),xt.mipmask=Mt.mipmask,rr(xt,Mt),ge.texture2D(at,Mt,Be),xt.internalformat=Mt.internalformat,vn.width=Mt.width,vn.height=Mt.height,Vo(xt),Xa(Mt,_s),bo(at,_s),Yi(),qo(Mt),er.profile&&(xt.stats.size=fo(xt.internalformat,xt.type,Mt.width,Mt.height,at.genMipmaps,!1)),vn.format=_r[xt.internalformat],vn.type=Br[xt.type],vn.mag=cr[at.magFilter],vn.min=Ir[at.minFilter],vn.wrapS=Gr[at.wrapS],vn.wrapT=Gr[at.wrapT],vn}function Bi(oe,Ve,at,Mt){ge(!!oe,"must specify image data");var Ye=Ve|0,Fe=at|0,et=Mt|0,xe=Yr();return rr(xe,xt),xe.width=0,xe.height=0,Ur(xe,oe),xe.width=xe.width||(xt.width>>et)-Ye,xe.height=xe.height||(xt.height>>et)-Fe,ge(xt.type===xe.type&&xt.format===xe.format&&xt.internalformat===xe.internalformat,"incompatible format for texture.subimage"),ge(Ye>=0&&Fe>=0&&Ye+xe.width<=xt.width&&Fe+xe.height<=xt.height,"texture.subimage write out of bounds"),ge(xt.mipmask&1<<et,"missing mipmap data"),ge(xe.data||xe.element||xe.needsCopy,"missing image data"),Vo(xt),mi(xe,_s,Ye,Fe,et),Yi(),rn(xe),vn}function Se(oe,Ve){var at=oe|0,Mt=Ve|0||at;if(at===xt.width&&Mt===xt.height)return vn;vn.width=xt.width=at,vn.height=xt.height=Mt,Vo(xt);for(var Ye=0;xt.mipmask>>Ye;++Ye){var Fe=at>>Ye,et=Mt>>Ye;if(!Fe||!et)break;B.texImage2D(_s,Ye,xt.format,Fe,et,0,xt.format,xt.type,null)}return Yi(),er.profile&&(xt.stats.size=fo(xt.internalformat,xt.type,at,Mt,!1,!1)),vn}return vn(Te,Dt),vn.subimage=Bi,vn.resize=Se,vn._reglType="texture2d",vn._texture=xt,er.profile&&(vn.stats=xt.stats),vn.destroy=function(){xt.decRef()},vn}function Li(Te,Dt,xt,vn,Bi,Se){var oe=new _i(Kl);Zo[oe.id]=oe,Tt.cubeCount++;var Ve=new Array(6);function at(Fe,et,xe,ze,we,ot){var _t,hr=oe.texInfo;for(za.call(hr),_t=0;_t<6;++_t)Ve[_t]=ki();if(typeof Fe=="number"||!Fe){var zr=Fe|0||1;for(_t=0;_t<6;++_t)hi(Ve[_t],zr,zr)}else if(typeof Fe=="object")if(et)Fi(Ve[0],Fe),Fi(Ve[1],et),Fi(Ve[2],xe),Fi(Ve[3],ze),Fi(Ve[4],we),Fi(Ve[5],ot);else if(Ko(hr,Fe),fn(oe,Fe),"faces"in Fe){var Lr=Fe.faces;for(ge(Array.isArray(Lr)&&Lr.length===6,"cube faces must be a length 6 array"),_t=0;_t<6;++_t)ge(typeof Lr[_t]=="object"&&!!Lr[_t],"invalid input for cube map face"),rr(Ve[_t],oe),Fi(Ve[_t],Lr[_t])}else for(_t=0;_t<6;++_t)Fi(Ve[_t],Fe);else ge.raise("invalid arguments to cube map");for(rr(oe,Ve[0]),ge.optional(function(){Be.npotTextureCube||ge(kf(oe.width)&&kf(oe.height),"your browser does not support non power or two texture dimensions")}),hr.genMipmaps?oe.mipmask=(Ve[0].width<<1)-1:oe.mipmask=Ve[0].mipmask,ge.textureCube(oe,hr,Ve,Be),oe.internalformat=Ve[0].internalformat,at.width=Ve[0].width,at.height=Ve[0].height,Vo(oe),_t=0;_t<6;++_t)Xa(Ve[_t],pu+_t);for(bo(hr,Kl),Yi(),er.profile&&(oe.stats.size=fo(oe.internalformat,oe.type,at.width,at.height,hr.genMipmaps,!0)),at.format=_r[oe.internalformat],at.type=Br[oe.type],at.mag=cr[hr.magFilter],at.min=Ir[hr.minFilter],at.wrapS=Gr[hr.wrapS],at.wrapT=Gr[hr.wrapT],_t=0;_t<6;++_t)qo(Ve[_t]);return at}function Mt(Fe,et,xe,ze,we){ge(!!et,"must specify image data"),ge(typeof Fe=="number"&&Fe===(Fe|0)&&Fe>=0&&Fe<6,"invalid face");var ot=xe|0,_t=ze|0,hr=we|0,zr=Yr();return rr(zr,oe),zr.width=0,zr.height=0,Ur(zr,et),zr.width=zr.width||(oe.width>>hr)-ot,zr.height=zr.height||(oe.height>>hr)-_t,ge(oe.type===zr.type&&oe.format===zr.format&&oe.internalformat===zr.internalformat,"incompatible format for texture.subimage"),ge(ot>=0&&_t>=0&&ot+zr.width<=oe.width&&_t+zr.height<=oe.height,"texture.subimage write out of bounds"),ge(oe.mipmask&1<<hr,"missing mipmap data"),ge(zr.data||zr.element||zr.needsCopy,"missing image data"),Vo(oe),mi(zr,pu+Fe,ot,_t,hr),Yi(),rn(zr),at}function Ye(Fe){var et=Fe|0;if(et!==oe.width){at.width=oe.width=et,at.height=oe.height=et,Vo(oe);for(var xe=0;xe<6;++xe)for(var ze=0;oe.mipmask>>ze;++ze)B.texImage2D(pu+xe,ze,oe.format,et>>ze,et>>ze,0,oe.format,oe.type,null);return Yi(),er.profile&&(oe.stats.size=fo(oe.internalformat,oe.type,at.width,at.height,!1,!0)),at}}return at(Te,Dt,xt,vn,Bi,Se),at.subimage=Mt,at.resize=Ye,at._reglType="textureCube",at._texture=oe,er.profile&&(at.stats=oe.stats),at.destroy=function(){oe.decRef()},at}function sa(){for(var Te=0;Te<rs;++Te)B.activeTexture(Dl+Te),B.bindTexture(_s,null),to[Te]=null;ee(Zo).forEach(ns),Tt.cubeCount=0,Tt.textureCount=0}er.profile&&(Tt.getTotalTextureSize=function(){var Te=0;return Object.keys(Zo).forEach(function(Dt){Te+=Zo[Dt].stats.size}),Te});function Eo(){for(var Te=0;Te<rs;++Te){var Dt=to[Te];Dt&&(Dt.bindCount=0,Dt.unit=-1,to[Te]=null)}ee(Zo).forEach(function(xt){xt.texture=B.createTexture(),B.bindTexture(xt.target,xt.texture);for(var vn=0;vn<32;++vn)if((xt.mipmask&1<<vn)!=0)if(xt.target===_s)B.texImage2D(_s,vn,xt.internalformat,xt.width>>vn,xt.height>>vn,0,xt.internalformat,xt.type,null);else for(var Bi=0;Bi<6;++Bi)B.texImage2D(pu+Bi,vn,xt.internalformat,xt.width>>vn,xt.height>>vn,0,xt.internalformat,xt.type,null);bo(xt.texInfo,xt.target)})}function Sl(){for(var Te=0;Te<rs;++Te){var Dt=to[Te];Dt&&(Dt.bindCount=0,Dt.unit=-1,to[Te]=null),B.activeTexture(Dl+Te),B.bindTexture(_s,null),B.bindTexture(Kl,null)}}return{create2D:ni,createCube:Li,clear:sa,getTexture:function(Te){return null},restore:Eo,refresh:Sl}}var nu=36161,kn=32854,Sn=32855,sc=36194,us=33189,iu=36168,Yo=34041,au=35907,Zf=34836,Dc=34842,ha=34843,Pa=[];Pa[kn]=2,Pa[Sn]=2,Pa[sc]=2,Pa[us]=2,Pa[iu]=1,Pa[Yo]=4,Pa[au]=4,Pa[Zf]=16,Pa[Dc]=8,Pa[ha]=6;function vl(B,ve,Be){return Pa[B]*ve*Be}var uc=function(B,ve,Be,Ot,sr){var Tt={rgba4:kn,rgb565:sc,"rgb5 a1":Sn,depth:us,stencil:iu,"depth stencil":Yo};ve.ext_srgb&&(Tt.srgba=au),ve.ext_color_buffer_half_float&&(Tt.rgba16f=Dc,Tt.rgb16f=ha),ve.webgl_color_buffer_float&&(Tt.rgba32f=Zf);var er=[];Object.keys(Tt).forEach(function(br){var gr=Tt[br];er[gr]=br});var $t=0,or={};function yr(br){this.id=$t++,this.refCount=1,this.renderbuffer=br,this.format=kn,this.width=0,this.height=0,sr.profile&&(this.stats={size:0})}yr.prototype.decRef=function(){--this.refCount<=0&&Tr(this)};function Tr(br){var gr=br.renderbuffer;ge(gr,"must not double destroy renderbuffer"),B.bindRenderbuffer(nu,null),B.deleteRenderbuffer(gr),br.renderbuffer=null,br.refCount=0,delete or[br.id],Ot.renderbufferCount--}function Mr(br,gr){var it=new yr(B.createRenderbuffer());or[it.id]=it,Ot.renderbufferCount++;function Gt(Br,cr){var Ir=0,Gr=0,Bn=kn;if(typeof Br=="object"&&Br){var tr=Br;if("shape"in tr){var rr=tr.shape;ge(Array.isArray(rr)&&rr.length>=2,"invalid renderbuffer shape"),Ir=rr[0]|0,Gr=rr[1]|0}else"radius"in tr&&(Ir=Gr=tr.radius|0),"width"in tr&&(Ir=tr.width|0),"height"in tr&&(Gr=tr.height|0);"format"in tr&&(ge.parameter(tr.format,Tt,"invalid renderbuffer format"),Bn=Tt[tr.format])}else typeof Br=="number"?(Ir=Br|0,typeof cr=="number"?Gr=cr|0:Gr=Ir):Br?ge.raise("invalid arguments to renderbuffer constructor"):Ir=Gr=1;if(ge(Ir>0&&Gr>0&&Ir<=Be.maxRenderbufferSize&&Gr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),!(Ir===it.width&&Gr===it.height&&Bn===it.format))return Gt.width=it.width=Ir,Gt.height=it.height=Gr,it.format=Bn,B.bindRenderbuffer(nu,it.renderbuffer),B.renderbufferStorage(nu,Bn,Ir,Gr),ge(B.getError()===0,"invalid render buffer format"),sr.profile&&(it.stats.size=vl(it.format,it.width,it.height)),Gt.format=er[it.format],Gt}function _r(Br,cr){var Ir=Br|0,Gr=cr|0||Ir;return Ir===it.width&&Gr===it.height||(ge(Ir>0&&Gr>0&&Ir<=Be.maxRenderbufferSize&&Gr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),Gt.width=it.width=Ir,Gt.height=it.height=Gr,B.bindRenderbuffer(nu,it.renderbuffer),B.renderbufferStorage(nu,it.format,Ir,Gr),ge(B.getError()===0,"invalid render buffer format"),sr.profile&&(it.stats.size=vl(it.format,it.width,it.height))),Gt}return Gt(br,gr),Gt.resize=_r,Gt._reglType="renderbuffer",Gt._renderbuffer=it,sr.profile&&(Gt.stats=it.stats),Gt.destroy=function(){it.decRef()},Gt}sr.profile&&(Ot.getTotalRenderbufferSize=function(){var br=0;return Object.keys(or).forEach(function(gr){br+=or[gr].stats.size}),br});function jr(){ee(or).forEach(function(br){br.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(nu,br.renderbuffer),B.renderbufferStorage(nu,br.format,br.width,br.height)}),B.bindRenderbuffer(nu,null)}return{create:Mr,clear:function(){ee(or).forEach(Tr)},restore:jr}},$s=36160,ou=36161,oo=3553,Qs=34069,Bs=36064,Ru=36096,mu=36128,ks=33306,pf=36053,lc=36054,Nl=36055,Vf=36057,ml=36061,gl=36193,df=5121,Xu=5126,Ns=6407,vf=6408,cc=6402,ku=[Ns,vf],zl=[];zl[vf]=4,zl[Ns]=3;var l=[];l[df]=1,l[Xu]=4,l[gl]=2;var f=32854,c=32855,d=36194,b=33189,C=36168,M=34041,R=35907,z=34836,H=34842,ne=34843,ue=[f,c,d,R,H,ne,z],fe={};fe[pf]="complete",fe[lc]="incomplete attachment",fe[Vf]="incomplete dimensions",fe[Nl]="incomplete, missing attachment",fe[ml]="unsupported";function Ce(B,ve,Be,Ot,sr,Tt){var er={cur:null,next:null,dirty:!1,setFBO:null},$t=["rgba"],or=["rgba4","rgb565","rgb5 a1"];ve.ext_srgb&&or.push("srgba"),ve.ext_color_buffer_half_float&&or.push("rgba16f","rgb16f"),ve.webgl_color_buffer_float&&or.push("rgba32f");var yr=["uint8"];ve.oes_texture_half_float&&yr.push("half float","float16"),ve.oes_texture_float&&yr.push("float","float32");function Tr(Er,Ur,Xr){this.target=Er,this.texture=Ur,this.renderbuffer=Xr;var mi=0,ri=0;Ur?(mi=Ur.width,ri=Ur.height):Xr&&(mi=Xr.width,ri=Xr.height),this.width=mi,this.height=ri}function Mr(Er){Er&&(Er.texture&&Er.texture._texture.decRef(),Er.renderbuffer&&Er.renderbuffer._renderbuffer.decRef())}function jr(Er,Ur,Xr){if(!!Er)if(Er.texture){var mi=Er.texture._texture,ri=Math.max(1,mi.width),Yr=Math.max(1,mi.height);ge(ri===Ur&&Yr===Xr,"inconsistent width/height for supplied texture"),mi.refCount+=1}else{var rn=Er.renderbuffer._renderbuffer;ge(rn.width===Ur&&rn.height===Xr,"inconsistent width/height for renderbuffer"),rn.refCount+=1}}function br(Er,Ur){Ur&&(Ur.texture?B.framebufferTexture2D($s,Er,Ur.target,Ur.texture._texture.texture,0):B.framebufferRenderbuffer($s,Er,ou,Ur.renderbuffer._renderbuffer.renderbuffer))}function gr(Er){var Ur=oo,Xr=null,mi=null,ri=Er;typeof Er=="object"&&(ri=Er.data,"target"in Er&&(Ur=Er.target|0)),ge.type(ri,"function","invalid attachment data");var Yr=ri._reglType;return Yr==="texture2d"?(Xr=ri,ge(Ur===oo)):Yr==="textureCube"?(Xr=ri,ge(Ur>=Qs&&Ur<Qs+6,"invalid cube map target")):Yr==="renderbuffer"?(mi=ri,Ur=ou):ge.raise("invalid regl object for attachment"),new Tr(Ur,Xr,mi)}function it(Er,Ur,Xr,mi,ri){if(Xr){var Yr=Ot.create2D({width:Er,height:Ur,format:mi,type:ri});return Yr._texture.refCount=0,new Tr(oo,Yr,null)}else{var rn=sr.create({width:Er,height:Ur,format:mi});return rn._renderbuffer.refCount=0,new Tr(ou,null,rn)}}function Gt(Er){return Er&&(Er.texture||Er.renderbuffer)}function _r(Er,Ur,Xr){Er&&(Er.texture?Er.texture.resize(Ur,Xr):Er.renderbuffer&&Er.renderbuffer.resize(Ur,Xr),Er.width=Ur,Er.height=Xr)}var Br=0,cr={};function Ir(){this.id=Br++,cr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Gr(Er){Er.colorAttachments.forEach(Mr),Mr(Er.depthAttachment),Mr(Er.stencilAttachment),Mr(Er.depthStencilAttachment)}function Bn(Er){var Ur=Er.framebuffer;ge(Ur,"must not double destroy framebuffer"),B.deleteFramebuffer(Ur),Er.framebuffer=null,Tt.framebufferCount--,delete cr[Er.id]}function tr(Er){var Ur;B.bindFramebuffer($s,Er.framebuffer);var Xr=Er.colorAttachments;for(Ur=0;Ur<Xr.length;++Ur)br(Bs+Ur,Xr[Ur]);for(Ur=Xr.length;Ur<Be.maxColorAttachments;++Ur)B.framebufferTexture2D($s,Bs+Ur,oo,null,0);B.framebufferTexture2D($s,ks,oo,null,0),B.framebufferTexture2D($s,Ru,oo,null,0),B.framebufferTexture2D($s,mu,oo,null,0),br(Ru,Er.depthAttachment),br(mu,Er.stencilAttachment),br(ks,Er.depthStencilAttachment);var mi=B.checkFramebufferStatus($s);!B.isContextLost()&&mi!==pf&&ge.raise("framebuffer configuration not supported, status = "+fe[mi]),B.bindFramebuffer($s,er.next?er.next.framebuffer:null),er.cur=er.next,B.getError()}function rr(Er,Ur){var Xr=new Ir;Tt.framebufferCount++;function mi(Yr,rn){var Yn;ge(er.next!==Xr,"can not update framebuffer which is currently in use");var hi=0,Fi=0,Xa=!0,uo=!0,ki=null,qo=!0,za="rgba",Ko="uint8",bo=1,$o=null,Zo=null,rs=null,to=!1;if(typeof Yr=="number")hi=Yr|0,Fi=rn|0||hi;else if(!Yr)hi=Fi=1;else{ge.type(Yr,"object","invalid arguments for framebuffer");var _i=Yr;if("shape"in _i){var Vo=_i.shape;ge(Array.isArray(Vo)&&Vo.length>=2,"invalid shape for framebuffer"),hi=Vo[0],Fi=Vo[1]}else"radius"in _i&&(hi=Fi=_i.radius),"width"in _i&&(hi=_i.width),"height"in _i&&(Fi=_i.height);("color"in _i||"colors"in _i)&&(ki=_i.color||_i.colors,Array.isArray(ki)&&ge(ki.length===1||ve.webgl_draw_buffers,"multiple render targets not supported")),ki||("colorCount"in _i&&(bo=_i.colorCount|0,ge(bo>0,"invalid color buffer count")),"colorTexture"in _i&&(qo=!!_i.colorTexture,za="rgba4"),"colorType"in _i&&(Ko=_i.colorType,qo?(ge(ve.oes_texture_float||!(Ko==="float"||Ko==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ge(ve.oes_texture_half_float||!(Ko==="half float"||Ko==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ko==="half float"||Ko==="float16"?(ge(ve.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),za="rgba16f"):(Ko==="float"||Ko==="float32")&&(ge(ve.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),za="rgba32f"),ge.oneOf(Ko,yr,"invalid color type")),"colorFormat"in _i&&(za=_i.colorFormat,$t.indexOf(za)>=0?qo=!0:or.indexOf(za)>=0?qo=!1:ge.optional(function(){qo?ge.oneOf(_i.colorFormat,$t,"invalid color format for texture"):ge.oneOf(_i.colorFormat,or,"invalid color format for renderbuffer")}))),("depthTexture"in _i||"depthStencilTexture"in _i)&&(to=!!(_i.depthTexture||_i.depthStencilTexture),ge(!to||ve.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in _i&&(typeof _i.depth=="boolean"?Xa=_i.depth:($o=_i.depth,uo=!1)),"stencil"in _i&&(typeof _i.stencil=="boolean"?uo=_i.stencil:(Zo=_i.stencil,Xa=!1)),"depthStencil"in _i&&(typeof _i.depthStencil=="boolean"?Xa=uo=_i.depthStencil:(rs=_i.depthStencil,Xa=!1,uo=!1))}var Yi=null,ns=null,ni=null,Li=null;if(Array.isArray(ki))Yi=ki.map(gr);else if(ki)Yi=[gr(ki)];else for(Yi=new Array(bo),Yn=0;Yn<bo;++Yn)Yi[Yn]=it(hi,Fi,qo,za,Ko);ge(ve.webgl_draw_buffers||Yi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ge(Yi.length<=Be.maxColorAttachments,"too many color attachments, not supported"),hi=hi||Yi[0].width,Fi=Fi||Yi[0].height,$o?ns=gr($o):Xa&&!uo&&(ns=it(hi,Fi,to,"depth","uint32")),Zo?ni=gr(Zo):uo&&!Xa&&(ni=it(hi,Fi,!1,"stencil","uint8")),rs?Li=gr(rs):!$o&&!Zo&&uo&&Xa&&(Li=it(hi,Fi,to,"depth stencil","depth stencil")),ge(!!$o+!!Zo+!!rs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var sa=null;for(Yn=0;Yn<Yi.length;++Yn)if(jr(Yi[Yn],hi,Fi),ge(!Yi[Yn]||Yi[Yn].texture&&ku.indexOf(Yi[Yn].texture._texture.format)>=0||Yi[Yn].renderbuffer&&ue.indexOf(Yi[Yn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Yn+" is invalid"),Yi[Yn]&&Yi[Yn].texture){var Eo=zl[Yi[Yn].texture._texture.format]*l[Yi[Yn].texture._texture.type];sa===null?sa=Eo:ge(sa===Eo,"all color attachments much have the same number of bits per pixel.")}return jr(ns,hi,Fi),ge(!ns||ns.texture&&ns.texture._texture.format===cc||ns.renderbuffer&&ns.renderbuffer._renderbuffer.format===b,"invalid depth attachment for framebuffer object"),jr(ni,hi,Fi),ge(!ni||ni.renderbuffer&&ni.renderbuffer._renderbuffer.format===C,"invalid stencil attachment for framebuffer object"),jr(Li,hi,Fi),ge(!Li||Li.texture&&Li.texture._texture.format===M||Li.renderbuffer&&Li.renderbuffer._renderbuffer.format===M,"invalid depth-stencil attachment for framebuffer object"),Gr(Xr),Xr.width=hi,Xr.height=Fi,Xr.colorAttachments=Yi,Xr.depthAttachment=ns,Xr.stencilAttachment=ni,Xr.depthStencilAttachment=Li,mi.color=Yi.map(Gt),mi.depth=Gt(ns),mi.stencil=Gt(ni),mi.depthStencil=Gt(Li),mi.width=Xr.width,mi.height=Xr.height,tr(Xr),mi}function ri(Yr,rn){ge(er.next!==Xr,"can not resize a framebuffer which is currently in use");var Yn=Math.max(Yr|0,1),hi=Math.max(rn|0||Yn,1);if(Yn===Xr.width&&hi===Xr.height)return mi;for(var Fi=Xr.colorAttachments,Xa=0;Xa<Fi.length;++Xa)_r(Fi[Xa],Yn,hi);return _r(Xr.depthAttachment,Yn,hi),_r(Xr.stencilAttachment,Yn,hi),_r(Xr.depthStencilAttachment,Yn,hi),Xr.width=mi.width=Yn,Xr.height=mi.height=hi,tr(Xr),mi}return mi(Er,Ur),v(mi,{resize:ri,_reglType:"framebuffer",_framebuffer:Xr,destroy:function(){Bn(Xr),Gr(Xr)},use:function(Yr){er.setFBO({framebuffer:mi},Yr)}})}function fn(Er){var Ur=Array(6);function Xr(ri){var Yr;ge(Ur.indexOf(er.next)<0,"can not update framebuffer which is currently in use");var rn={color:null},Yn=0,hi=null,Fi="rgba",Xa="uint8",uo=1;if(typeof ri=="number")Yn=ri|0;else if(!ri)Yn=1;else{ge.type(ri,"object","invalid arguments for framebuffer");var ki=ri;if("shape"in ki){var qo=ki.shape;ge(Array.isArray(qo)&&qo.length>=2,"invalid shape for framebuffer"),ge(qo[0]===qo[1],"cube framebuffer must be square"),Yn=qo[0]}else"radius"in ki&&(Yn=ki.radius|0),"width"in ki?(Yn=ki.width|0,"height"in ki&&ge(ki.height===Yn,"must be square")):"height"in ki&&(Yn=ki.height|0);("color"in ki||"colors"in ki)&&(hi=ki.color||ki.colors,Array.isArray(hi)&&ge(hi.length===1||ve.webgl_draw_buffers,"multiple render targets not supported")),hi||("colorCount"in ki&&(uo=ki.colorCount|0,ge(uo>0,"invalid color buffer count")),"colorType"in ki&&(ge.oneOf(ki.colorType,yr,"invalid color type"),Xa=ki.colorType),"colorFormat"in ki&&(Fi=ki.colorFormat,ge.oneOf(ki.colorFormat,$t,"invalid color format for texture"))),"depth"in ki&&(rn.depth=ki.depth),"stencil"in ki&&(rn.stencil=ki.stencil),"depthStencil"in ki&&(rn.depthStencil=ki.depthStencil)}var za;if(hi)if(Array.isArray(hi))for(za=[],Yr=0;Yr<hi.length;++Yr)za[Yr]=hi[Yr];else za=[hi];else{za=Array(uo);var Ko={radius:Yn,format:Fi,type:Xa};for(Yr=0;Yr<uo;++Yr)za[Yr]=Ot.createCube(Ko)}for(rn.color=Array(za.length),Yr=0;Yr<za.length;++Yr){var bo=za[Yr];ge(typeof bo=="function"&&bo._reglType==="textureCube","invalid cube map"),Yn=Yn||bo.width,ge(bo.width===Yn&&bo.height===Yn,"invalid cube map shape"),rn.color[Yr]={target:Qs,data:za[Yr]}}for(Yr=0;Yr<6;++Yr){for(var $o=0;$o<za.length;++$o)rn.color[$o].target=Qs+Yr;Yr>0&&(rn.depth=Ur[0].depth,rn.stencil=Ur[0].stencil,rn.depthStencil=Ur[0].depthStencil),Ur[Yr]?Ur[Yr](rn):Ur[Yr]=rr(rn)}return v(Xr,{width:Yn,height:Yn,color:za})}function mi(ri){var Yr,rn=ri|0;if(ge(rn>0&&rn<=Be.maxCubeMapSize,"invalid radius for cube fbo"),rn===Xr.width)return Xr;var Yn=Xr.color;for(Yr=0;Yr<Yn.length;++Yr)Yn[Yr].resize(rn);for(Yr=0;Yr<6;++Yr)Ur[Yr].resize(rn);return Xr.width=Xr.height=rn,Xr}return Xr(Er),v(Xr,{faces:Ur,resize:mi,_reglType:"framebufferCube",destroy:function(){Ur.forEach(function(ri){ri.destroy()})}})}function Nr(){er.cur=null,er.next=null,er.dirty=!0,ee(cr).forEach(function(Er){Er.framebuffer=B.createFramebuffer(),tr(Er)})}return v(er,{getFramebuffer:function(Er){if(typeof Er=="function"&&Er._reglType==="framebuffer"){var Ur=Er._framebuffer;if(Ur instanceof Ir)return Ur}return null},create:rr,createCube:fn,clear:function(){ee(cr).forEach(Bn)},restore:Nr})}var Pe=5126,Ue=34962,Ae=34963,Ze=["attributes","elements","offset","count","primitive","instances"];function Ke(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Pe,this.offset=0,this.stride=0,this.divisor=0}function mt(B,ve,Be,Ot,sr,Tt,er){for(var $t=Be.maxAttributes,or=new Array($t),yr=0;yr<$t;++yr)or[yr]=new Ke;var Tr=0,Mr={},jr={Record:Ke,scope:{},state:or,currentVAO:null,targetVAO:null,restore:gr()?Gr:function(){},createVAO:Bn,getVAO:Gt,destroyBuffer:br,setVAO:gr()?_r:Br,clear:gr()?cr:function(){}};function br(tr){for(var rr=0;rr<or.length;++rr){var fn=or[rr];fn.buffer===tr&&(B.disableVertexAttribArray(rr),fn.buffer=null)}}function gr(){return ve.oes_vertex_array_object}function it(){return ve.angle_instanced_arrays}function Gt(tr){return typeof tr=="function"&&tr._vao?tr._vao:null}function _r(tr){if(tr!==jr.currentVAO){var rr=gr();tr?rr.bindVertexArrayOES(tr.vao):rr.bindVertexArrayOES(null),jr.currentVAO=tr}}function Br(tr){if(tr!==jr.currentVAO){if(tr)tr.bindAttrs();else{for(var rr=it(),fn=0;fn<or.length;++fn){var Nr=or[fn];Nr.buffer?(B.enableVertexAttribArray(fn),Nr.buffer.bind(),B.vertexAttribPointer(fn,Nr.size,Nr.type,Nr.normalized,Nr.stride,Nr.offfset),rr&&Nr.divisor&&rr.vertexAttribDivisorANGLE(fn,Nr.divisor)):(B.disableVertexAttribArray(fn),B.vertexAttrib4f(fn,Nr.x,Nr.y,Nr.z,Nr.w))}er.elements?B.bindBuffer(Ae,er.elements.buffer.buffer):B.bindBuffer(Ae,null)}jr.currentVAO=tr}}function cr(){ee(Mr).forEach(function(tr){tr.destroy()})}function Ir(){this.id=++Tr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var tr=gr();tr?this.vao=tr.createVertexArrayOES():this.vao=null,Mr[this.id]=this,this.buffers=[]}Ir.prototype.bindAttrs=function(){for(var tr=it(),rr=this.attributes,fn=0;fn<rr.length;++fn){var Nr=rr[fn];Nr.buffer?(B.enableVertexAttribArray(fn),B.bindBuffer(Ue,Nr.buffer.buffer),B.vertexAttribPointer(fn,Nr.size,Nr.type,Nr.normalized,Nr.stride,Nr.offset),tr&&Nr.divisor&&tr.vertexAttribDivisorANGLE(fn,Nr.divisor)):(B.disableVertexAttribArray(fn),B.vertexAttrib4f(fn,Nr.x,Nr.y,Nr.z,Nr.w))}for(var Er=rr.length;Er<$t;++Er)B.disableVertexAttribArray(Er);var Ur=Tt.getElements(this.elements);Ur?B.bindBuffer(Ae,Ur.buffer.buffer):B.bindBuffer(Ae,null)},Ir.prototype.refresh=function(){var tr=gr();tr&&(tr.bindVertexArrayOES(this.vao),this.bindAttrs(),jr.currentVAO=null,tr.bindVertexArrayOES(null))},Ir.prototype.destroy=function(){if(this.vao){var tr=gr();this===jr.currentVAO&&(jr.currentVAO=null,tr.bindVertexArrayOES(null)),tr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Mr[this.id]&&(delete Mr[this.id],Ot.vaoCount-=1)};function Gr(){var tr=gr();tr&&ee(Mr).forEach(function(rr){rr.refresh()})}function Bn(tr){var rr=new Ir;Ot.vaoCount+=1;function fn(Nr){var Er;if(Array.isArray(Nr))Er=Nr,rr.elements&&rr.ownsElements&&rr.elements.destroy(),rr.elements=null,rr.ownsElements=!1,rr.offset=0,rr.count=0,rr.instances=-1,rr.primitive=4;else{if(ge(typeof Nr=="object","invalid arguments for create vao"),ge("attributes"in Nr,"must specify attributes for vao"),Nr.elements){var Ur=Nr.elements;rr.ownsElements?typeof Ur=="function"&&Ur._reglType==="elements"?(rr.elements.destroy(),rr.ownsElements=!1):(rr.elements(Ur),rr.ownsElements=!1):Tt.getElements(Nr.elements)?(rr.elements=Nr.elements,rr.ownsElements=!1):(rr.elements=Tt.create(Nr.elements),rr.ownsElements=!0)}else rr.elements=null,rr.ownsElements=!1;Er=Nr.attributes,rr.offset=0,rr.count=-1,rr.instances=-1,rr.primitive=4,rr.elements&&(rr.count=rr.elements._elements.vertCount,rr.primitive=rr.elements._elements.primType),"offset"in Nr&&(rr.offset=Nr.offset|0),"count"in Nr&&(rr.count=Nr.count|0),"instances"in Nr&&(rr.instances=Nr.instances|0),"primitive"in Nr&&(ge(Nr.primitive in lr,"bad primitive type: "+Nr.primitive),rr.primitive=lr[Nr.primitive]),ge.optional(()=>{for(var Xa=Object.keys(Nr),uo=0;uo<Xa.length;++uo)ge(Ze.indexOf(Xa[uo])>=0,'invalid option for vao: "'+Xa[uo]+'" valid options are '+Ze)}),ge(Array.isArray(Er),"attributes must be an array")}ge(Er.length<$t,"too many attributes"),ge(Er.length>0,"must specify at least one attribute");var Xr={},mi=rr.attributes;mi.length=Er.length;for(var ri=0;ri<Er.length;++ri){var Yr=Er[ri],rn=mi[ri]=new Ke,Yn=Yr.data||Yr;if(Array.isArray(Yn)||pe(Yn)||ds(Yn)){var hi;rr.buffers[ri]&&(hi=rr.buffers[ri],pe(Yn)&&hi._buffer.byteLength>=Yn.byteLength?hi.subdata(Yn):(hi.destroy(),rr.buffers[ri]=null)),rr.buffers[ri]||(hi=rr.buffers[ri]=sr.create(Yr,Ue,!1,!0)),rn.buffer=sr.getBuffer(hi),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1,Xr[ri]=1}else sr.getBuffer(Yr)?(rn.buffer=sr.getBuffer(Yr),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1):sr.getBuffer(Yr.buffer)?(rn.buffer=sr.getBuffer(Yr.buffer),rn.size=(+Yr.size||rn.buffer.dimension)|0,rn.normalized=!!Yr.normalized||!1,"type"in Yr?(ge.parameter(Yr.type,Ws,"invalid buffer type"),rn.type=Ws[Yr.type]):rn.type=rn.buffer.dtype,rn.offset=(Yr.offset||0)|0,rn.stride=(Yr.stride||0)|0,rn.divisor=(Yr.divisor||0)|0,rn.state=1,ge(rn.size>=1&&rn.size<=4,"size must be between 1 and 4"),ge(rn.offset>=0,"invalid offset"),ge(rn.stride>=0&&rn.stride<=255,"stride must be between 0 and 255"),ge(rn.divisor>=0,"divisor must be positive"),ge(!rn.divisor||!!ve.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Yr?(ge(ri>0,"first attribute must not be a constant"),rn.x=+Yr.x||0,rn.y=+Yr.y||0,rn.z=+Yr.z||0,rn.w=+Yr.w||0,rn.state=2):ge(!1,"invalid attribute spec for location "+ri)}for(var Fi=0;Fi<rr.buffers.length;++Fi)!Xr[Fi]&&rr.buffers[Fi]&&(rr.buffers[Fi].destroy(),rr.buffers[Fi]=null);return rr.refresh(),fn}return fn.destroy=function(){for(var Nr=0;Nr<rr.buffers.length;++Nr)rr.buffers[Nr]&&rr.buffers[Nr].destroy();rr.buffers.length=0,rr.ownsElements&&(rr.elements.destroy(),rr.elements=null,rr.ownsElements=!1),rr.destroy()},fn._vao=rr,fn._reglType="vao",fn(tr)}return jr}var St=35632,Zt=35633,Kt=35718,pr=35721;function kr(B,ve,Be,Ot){var sr={},Tt={};function er(it,Gt,_r,Br){this.name=it,this.id=Gt,this.location=_r,this.info=Br}function $t(it,Gt){for(var _r=0;_r<it.length;++_r)if(it[_r].id===Gt.id){it[_r].location=Gt.location;return}it.push(Gt)}function or(it,Gt,_r){var Br=it===St?sr:Tt,cr=Br[Gt];if(!cr){var Ir=ve.str(Gt);cr=B.createShader(it),B.shaderSource(cr,Ir),B.compileShader(cr),ge.shaderError(B,cr,Ir,it,_r),Br[Gt]=cr}return cr}var yr={},Tr=[],Mr=0;function jr(it,Gt){this.id=Mr++,this.fragId=it,this.vertId=Gt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Ot.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function br(it,Gt,_r){var Br,cr,Ir=or(St,it.fragId),Gr=or(Zt,it.vertId),Bn=it.program=B.createProgram();if(B.attachShader(Bn,Ir),B.attachShader(Bn,Gr),_r)for(Br=0;Br<_r.length;++Br){var tr=_r[Br];B.bindAttribLocation(Bn,tr[0],tr[1])}B.linkProgram(Bn),ge.linkError(B,Bn,ve.str(it.fragId),ve.str(it.vertId),Gt);var rr=B.getProgramParameter(Bn,Kt);Ot.profile&&(it.stats.uniformsCount=rr);var fn=it.uniforms;for(Br=0;Br<rr;++Br)if(cr=B.getActiveUniform(Bn,Br),cr)if(cr.size>1)for(var Nr=0;Nr<cr.size;++Nr){var Er=cr.name.replace("[0]","["+Nr+"]");$t(fn,new er(Er,ve.id(Er),B.getUniformLocation(Bn,Er),cr))}else $t(fn,new er(cr.name,ve.id(cr.name),B.getUniformLocation(Bn,cr.name),cr));var Ur=B.getProgramParameter(Bn,pr);Ot.profile&&(it.stats.attributesCount=Ur);var Xr=it.attributes;for(Br=0;Br<Ur;++Br)cr=B.getActiveAttrib(Bn,Br),cr&&$t(Xr,new er(cr.name,ve.id(cr.name),B.getAttribLocation(Bn,cr.name),cr))}Ot.profile&&(Be.getMaxUniformsCount=function(){var it=0;return Tr.forEach(function(Gt){Gt.stats.uniformsCount>it&&(it=Gt.stats.uniformsCount)}),it},Be.getMaxAttributesCount=function(){var it=0;return Tr.forEach(function(Gt){Gt.stats.attributesCount>it&&(it=Gt.stats.attributesCount)}),it});function gr(){sr={},Tt={};for(var it=0;it<Tr.length;++it)br(Tr[it],null,Tr[it].attributes.map(function(Gt){return[Gt.location,Gt.name]}))}return{clear:function(){var it=B.deleteShader.bind(B);ee(sr).forEach(it),sr={},ee(Tt).forEach(it),Tt={},Tr.forEach(function(Gt){B.deleteProgram(Gt.program)}),Tr.length=0,yr={},Be.shaderCount=0},program:function(it,Gt,_r,Br){ge.command(it>=0,"missing vertex shader",_r),ge.command(Gt>=0,"missing fragment shader",_r);var cr=yr[Gt];cr||(cr=yr[Gt]={});var Ir=cr[it];if(Ir&&(Ir.refCount++,!Br))return Ir;var Gr=new jr(Gt,it);return Be.shaderCount++,br(Gr,_r,Br),Ir||(cr[it]=Gr),Tr.push(Gr),v(Gr,{destroy:function(){if(Gr.refCount--,Gr.refCount<=0){B.deleteProgram(Gr.program);var Bn=Tr.indexOf(Gr);Tr.splice(Bn,1),Be.shaderCount--}cr[Gr.vertId].refCount<=0&&(B.deleteShader(Tt[Gr.vertId]),delete Tt[Gr.vertId],delete yr[Gr.fragId][Gr.vertId]),Object.keys(yr[Gr.fragId]).length||(B.deleteShader(sr[Gr.fragId]),delete sr[Gr.fragId],delete yr[Gr.fragId])}})},restore:gr,shader:or,frag:-1,vert:-1}}var Or=6408,tn=5121,Ln=3333,Fn=5126;function zn(B,ve,Be,Ot,sr,Tt,er){function $t(Tr){var Mr;ve.next===null?(ge(sr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Mr=tn):(ge(ve.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Mr=ve.next.colorAttachments[0].texture._texture.type,ge.optional(function(){Tt.oes_texture_float?(ge(Mr===tn||Mr===Fn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Mr===Fn&&ge(er.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ge(Mr===tn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var jr=0,br=0,gr=Ot.framebufferWidth,it=Ot.framebufferHeight,Gt=null;pe(Tr)?Gt=Tr:Tr&&(ge.type(Tr,"object","invalid arguments to regl.read()"),jr=Tr.x|0,br=Tr.y|0,ge(jr>=0&&jr<Ot.framebufferWidth,"invalid x offset for regl.read"),ge(br>=0&&br<Ot.framebufferHeight,"invalid y offset for regl.read"),gr=(Tr.width||Ot.framebufferWidth-jr)|0,it=(Tr.height||Ot.framebufferHeight-br)|0,Gt=Tr.data||null),Gt&&(Mr===tn?ge(Gt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Mr===Fn&&ge(Gt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ge(gr>0&&gr+jr<=Ot.framebufferWidth,"invalid width for read pixels"),ge(it>0&&it+br<=Ot.framebufferHeight,"invalid height for read pixels"),Be();var _r=gr*it*4;return Gt||(Mr===tn?Gt=new Uint8Array(_r):Mr===Fn&&(Gt=Gt||new Float32Array(_r))),ge.isTypedArray(Gt,"data buffer for regl.read() must be a typedarray"),ge(Gt.byteLength>=_r,"data buffer for regl.read() too small"),B.pixelStorei(Ln,4),B.readPixels(jr,br,gr,it,Or,Mr,Gt),Gt}function or(Tr){var Mr;return ve.setFBO({framebuffer:Tr.framebuffer},function(){Mr=$t(Tr)}),Mr}function yr(Tr){return!Tr||!("framebuffer"in Tr)?$t(Tr):or(Tr)}return yr}function Ri(B){return Array.prototype.slice.call(B)}function sn(B){return Ri(B).join("")}function ai(){var B=0,ve=[],Be=[];function Ot(Mr){for(var jr=0;jr<Be.length;++jr)if(Be[jr]===Mr)return ve[jr];var br="g"+B++;return ve.push(br),Be.push(Mr),br}function sr(){var Mr=[];function jr(){Mr.push.apply(Mr,Ri(arguments))}var br=[];function gr(){var it="v"+B++;return br.push(it),arguments.length>0&&(Mr.push(it,"="),Mr.push.apply(Mr,Ri(arguments)),Mr.push(";")),it}return v(jr,{def:gr,toString:function(){return sn([br.length>0?"var "+br.join(",")+";":"",sn(Mr)])}})}function Tt(){var Mr=sr(),jr=sr(),br=Mr.toString,gr=jr.toString;function it(Gt,_r){jr(Gt,_r,"=",Mr.def(Gt,_r),";")}return v(function(){Mr.apply(Mr,Ri(arguments))},{def:Mr.def,entry:Mr,exit:jr,save:it,set:function(Gt,_r,Br){it(Gt,_r),Mr(Gt,_r,"=",Br,";")},toString:function(){return br()+gr()}})}function er(){var Mr=sn(arguments),jr=Tt(),br=Tt(),gr=jr.toString,it=br.toString;return v(jr,{then:function(){return jr.apply(jr,Ri(arguments)),this},else:function(){return br.apply(br,Ri(arguments)),this},toString:function(){var Gt=it();return Gt&&(Gt="else{"+Gt+"}"),sn(["if(",Mr,"){",gr(),"}",Gt])}})}var $t=sr(),or={};function yr(Mr,jr){var br=[];function gr(){var cr="a"+br.length;return br.push(cr),cr}jr=jr||0;for(var it=0;it<jr;++it)gr();var Gt=Tt(),_r=Gt.toString,Br=or[Mr]=v(Gt,{arg:gr,toString:function(){return sn(["function(",br.join(),"){",_r(),"}"])}});return Br}function Tr(){var Mr=['"use strict";',$t,"return {"];Object.keys(or).forEach(function(it){Mr.push('"',it,'":',or[it].toString(),",")}),Mr.push("}");var jr=sn(Mr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),br=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",gr=br?ce.Function.apply(null,ve.concat(jr)):Function.apply(null,ve.concat(jr));return gr.apply(null,Be)}return{global:$t,link:Ot,block:sr,proc:yr,scope:Tt,cond:er,compile:Tr}}var fi="xyzw".split(""),ti=5121,On=1,yi=2,Un=0,jn=1,eo=2,Da=3,Bo=4,No=5,Wa=6,so="dither",pa="blend.enable",na="blend.color",Js="blend.equation",ts="blend.func",ls="depth.enable",su="depth.func",Fc="depth.range",fc="depth.mask",Yu="colorMask",yl="cull.enable",bs="cull.face",gu="frontFace",hc="lineWidth",Lu="polygonOffset.enable",Na="polygonOffset.offset",uu="sample.alpha",lu="sample.enable",Du="sample.coverage",Qi="stencil.enable",cs="stencil.mask",zo="stencil.func",Fu="stencil.opFront",pc="stencil.opBack",Ul="scissor.enable",Bc="scissor.box",eu="viewport",Zl="profile",Mo="framebuffer",qu="vert",Nc="frag",yu="elements",Uo="primitive",zc="count",jf="offset",gh="instances",Uc="vao",_u="Width",ip="Height",dc=Mo+_u,Zc=Mo+ip,Gf=eu+_u,ap=eu+ip,_l="drawingBuffer",mf=_l+_u,Vp=_l+ip,xd=[ts,Js,zo,Fu,pc,Du,eu,Bc,Na],Vc=34962,op=34963,bd=35632,Ed=35633,sp=3553,yh=34067,Sd=2884,gf=3042,Cd=3024,Po=2960,_h=2929,up=3089,xh=32823,Hf=32926,jc=32928,bh=5126,Wf=35664,vc=35665,yf=35666,Xf=5124,Eh=35667,xu=35668,Sh=35669,Yf=35670,Ch=35671,_f=35672,Gc=35673,zs=35674,qf=35675,Kf=35676,xf=35678,bf=35680,wh=4,xl=1028,Hc=1029,jp=2304,Ah=2305,wd=32775,$r=32776,Ad=519,Nt=7680,Gp=0,Th=1,Wc=32774,Bu=513,lp=36160,Td=36064,Ku={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},bl=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Xc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},mc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},cp={frag:bd,vert:Ed},Mh={cw:jp,ccw:Ah};function $f(B){return Array.isArray(B)||pe(B)||ds(B)}function Ph(B){return B.sort(function(ve,Be){return ve===eu?-1:Be===eu?1:ve<Be?-1:1})}function oa(B,ve,Be,Ot){this.thisDep=B,this.contextDep=ve,this.propDep=Be,this.append=Ot}function gc(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function xo(B){return new oa(!1,!1,!1,B)}function Us(B,ve){var Be=B.type;if(Be===Un){var Ot=B.data.length;return new oa(!0,Ot>=1,Ot>=2,ve)}else if(Be===Bo){var sr=B.data;return new oa(sr.thisDep,sr.contextDep,sr.propDep,ve)}else{if(Be===No)return new oa(!1,!1,!1,ve);if(Be===Wa){for(var Tt=!1,er=!1,$t=!1,or=0;or<B.data.length;++or){var yr=B.data[or];if(yr.type===jn)$t=!0;else if(yr.type===eo)er=!0;else if(yr.type===Da)Tt=!0;else if(yr.type===Un){Tt=!0;var Tr=yr.data;Tr>=1&&(er=!0),Tr>=2&&($t=!0)}else yr.type===Bo&&(Tt=Tt||yr.data.thisDep,er=er||yr.data.contextDep,$t=$t||yr.data.propDep)}return new oa(Tt,er,$t,ve)}else return new oa(Be===Da,Be===eo,Be===jn,ve)}}var Ih=new oa(!1,!1,!1,function(){});function Hp(B,ve,Be,Ot,sr,Tt,er,$t,or,yr,Tr,Mr,jr,br,gr){var it=yr.Record,Gt={add:32774,subtract:32778,"reverse subtract":32779};Be.ext_blend_minmax&&(Gt.min=wd,Gt.max=$r);var _r=Be.angle_instanced_arrays,Br=Be.webgl_draw_buffers,cr=Be.oes_vertex_array_object,Ir={dirty:!0,profile:gr.profile},Gr={},Bn=[],tr={},rr={};function fn(Se){return Se.replace(".","_")}function Nr(Se,oe,Ve){var at=fn(Se);Bn.push(Se),Gr[at]=Ir[at]=!!Ve,tr[at]=oe}function Er(Se,oe,Ve){var at=fn(Se);Bn.push(Se),Array.isArray(Ve)?(Ir[at]=Ve.slice(),Gr[at]=Ve.slice()):Ir[at]=Gr[at]=Ve,rr[at]=oe}Nr(so,Cd),Nr(pa,gf),Er(na,"blendColor",[0,0,0,0]),Er(Js,"blendEquationSeparate",[Wc,Wc]),Er(ts,"blendFuncSeparate",[Th,Gp,Th,Gp]),Nr(ls,_h,!0),Er(su,"depthFunc",Bu),Er(Fc,"depthRange",[0,1]),Er(fc,"depthMask",!0),Er(Yu,Yu,[!0,!0,!0,!0]),Nr(yl,Sd),Er(bs,"cullFace",Hc),Er(gu,gu,Ah),Er(hc,hc,1),Nr(Lu,xh),Er(Na,"polygonOffset",[0,0]),Nr(uu,Hf),Nr(lu,jc),Er(Du,"sampleCoverage",[1,!1]),Nr(Qi,Po),Er(cs,"stencilMask",-1),Er(zo,"stencilFunc",[Ad,0,-1]),Er(Fu,"stencilOpSeparate",[xl,Nt,Nt,Nt]),Er(pc,"stencilOpSeparate",[Hc,Nt,Nt,Nt]),Nr(Ul,up),Er(Bc,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Er(eu,eu,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Ur={gl:B,context:jr,strings:ve,next:Gr,current:Ir,draw:Mr,elements:Tt,buffer:sr,shader:Tr,attributes:yr.state,vao:yr,uniforms:or,framebuffer:$t,extensions:Be,timer:br,isBufferArgs:$f},Xr={primTypes:lr,compareFuncs:Xc,blendFuncs:Ku,blendEquations:Gt,stencilOps:mc,glTypes:Ws,orientationType:Mh};ge.optional(function(){Ur.isArrayLike=io}),Br&&(Xr.backBuffer=[Hc],Xr.drawBuffer=je(Ot.maxDrawbuffers,function(Se){return Se===0?[0]:je(Se,function(oe){return Td+oe})}));var mi=0;function ri(){var Se=ai(),oe=Se.link,Ve=Se.global;Se.id=mi++,Se.batchId="0";var at=oe(Ur),Mt=Se.shared={props:"a0"};Object.keys(Ur).forEach(function(ze){Mt[ze]=Ve.def(at,".",ze)}),ge.optional(function(){Se.CHECK=oe(ge),Se.commandStr=ge.guessCommand(),Se.command=oe(Se.commandStr),Se.assert=function(ze,we,ot){ze("if(!(",we,"))",this.CHECK,".commandRaise(",oe(ot),",",this.command,");")},Xr.invalidBlendCombinations=bl});var Ye=Se.next={},Fe=Se.current={};Object.keys(rr).forEach(function(ze){Array.isArray(Ir[ze])&&(Ye[ze]=Ve.def(Mt.next,".",ze),Fe[ze]=Ve.def(Mt.current,".",ze))});var et=Se.constants={};Object.keys(Xr).forEach(function(ze){et[ze]=Ve.def(JSON.stringify(Xr[ze]))}),Se.invoke=function(ze,we){switch(we.type){case Un:var ot=["this",Mt.context,Mt.props,Se.batchId];return ze.def(oe(we.data),".call(",ot.slice(0,Math.max(we.data.length+1,4)),")");case jn:return ze.def(Mt.props,we.data);case eo:return ze.def(Mt.context,we.data);case Da:return ze.def("this",we.data);case Bo:return we.data.append(Se,ze),we.data.ref;case No:return we.data.toString();case Wa:return we.data.map(function(_t){return Se.invoke(ze,_t)})}},Se.attribCache={};var xe={};return Se.scopeAttrib=function(ze){var we=ve.id(ze);if(we in xe)return xe[we];var ot=yr.scope[we];ot||(ot=yr.scope[we]=new it);var _t=xe[we]=oe(ot);return _t},Se}function Yr(Se){var oe=Se.static,Ve=Se.dynamic,at;if(Zl in oe){var Mt=!!oe[Zl];at=xo(function(Fe,et){return Mt}),at.enable=Mt}else if(Zl in Ve){var Ye=Ve[Zl];at=Us(Ye,function(Fe,et){return Fe.invoke(et,Ye)})}return at}function rn(Se,oe){var Ve=Se.static,at=Se.dynamic;if(Mo in Ve){var Mt=Ve[Mo];return Mt?(Mt=$t.getFramebuffer(Mt),ge.command(Mt,"invalid framebuffer object"),xo(function(Fe,et){var xe=Fe.link(Mt),ze=Fe.shared;et.set(ze.framebuffer,".next",xe);var we=ze.context;return et.set(we,"."+dc,xe+".width"),et.set(we,"."+Zc,xe+".height"),xe})):xo(function(Fe,et){var xe=Fe.shared;et.set(xe.framebuffer,".next","null");var ze=xe.context;return et.set(ze,"."+dc,ze+"."+mf),et.set(ze,"."+Zc,ze+"."+Vp),"null"})}else if(Mo in at){var Ye=at[Mo];return Us(Ye,function(Fe,et){var xe=Fe.invoke(et,Ye),ze=Fe.shared,we=ze.framebuffer,ot=et.def(we,".getFramebuffer(",xe,")");ge.optional(function(){Fe.assert(et,"!"+xe+"||"+ot,"invalid framebuffer object")}),et.set(we,".next",ot);var _t=ze.context;return et.set(_t,"."+dc,ot+"?"+ot+".width:"+_t+"."+mf),et.set(_t,"."+Zc,ot+"?"+ot+".height:"+_t+"."+Vp),ot})}else return null}function Yn(Se,oe,Ve){var at=Se.static,Mt=Se.dynamic;function Ye(xe){if(xe in at){var ze=at[xe];ge.commandType(ze,"object","invalid "+xe,Ve.commandStr);var we=!0,ot=ze.x|0,_t=ze.y|0,hr,zr;return"width"in ze?(hr=ze.width|0,ge.command(hr>=0,"invalid "+xe,Ve.commandStr)):we=!1,"height"in ze?(zr=ze.height|0,ge.command(zr>=0,"invalid "+xe,Ve.commandStr)):we=!1,new oa(!we&&oe&&oe.thisDep,!we&&oe&&oe.contextDep,!we&&oe&&oe.propDep,function(Rr,Cn){var an=Rr.shared.context,xn=hr;"width"in ze||(xn=Cn.def(an,".",dc,"-",ot));var _n=zr;return"height"in ze||(_n=Cn.def(an,".",Zc,"-",_t)),[ot,_t,xn,_n]})}else if(xe in Mt){var Lr=Mt[xe],Qr=Us(Lr,function(Rr,Cn){var an=Rr.invoke(Cn,Lr);ge.optional(function(){Rr.assert(Cn,an+"&&typeof "+an+'==="object"',"invalid "+xe)});var xn=Rr.shared.context,_n=Cn.def(an,".x|0"),hn=Cn.def(an,".y|0"),Gn=Cn.def('"width" in ',an,"?",an,".width|0:","(",xn,".",dc,"-",_n,")"),da=Cn.def('"height" in ',an,"?",an,".height|0:","(",xn,".",Zc,"-",hn,")");return ge.optional(function(){Rr.assert(Cn,Gn+">=0&&"+da+">=0","invalid "+xe)}),[_n,hn,Gn,da]});return oe&&(Qr.thisDep=Qr.thisDep||oe.thisDep,Qr.contextDep=Qr.contextDep||oe.contextDep,Qr.propDep=Qr.propDep||oe.propDep),Qr}else return oe?new oa(oe.thisDep,oe.contextDep,oe.propDep,function(Rr,Cn){var an=Rr.shared.context;return[0,0,Cn.def(an,".",dc),Cn.def(an,".",Zc)]}):null}var Fe=Ye(eu);if(Fe){var et=Fe;Fe=new oa(Fe.thisDep,Fe.contextDep,Fe.propDep,function(xe,ze){var we=et.append(xe,ze),ot=xe.shared.context;return ze.set(ot,"."+Gf,we[2]),ze.set(ot,"."+ap,we[3]),we})}return{viewport:Fe,scissor_box:Ye(Bc)}}function hi(Se,oe){var Ve=Se.static,at=typeof Ve[Nc]=="string"&&typeof Ve[qu]=="string";if(at){if(Object.keys(oe.dynamic).length>0)return null;var Mt=oe.static,Ye=Object.keys(Mt);if(Ye.length>0&&typeof Mt[Ye[0]]=="number"){for(var Fe=[],et=0;et<Ye.length;++et)ge(typeof Mt[Ye[et]]=="number","must specify all vertex attribute locations when using vaos"),Fe.push([Mt[Ye[et]]|0,Ye[et]]);return Fe}}return null}function Fi(Se,oe,Ve){var at=Se.static,Mt=Se.dynamic;function Ye(we){if(we in at){var ot=ve.id(at[we]);ge.optional(function(){Tr.shader(cp[we],ot,ge.guessCommand())});var _t=xo(function(){return ot});return _t.id=ot,_t}else if(we in Mt){var hr=Mt[we];return Us(hr,function(zr,Lr){var Qr=zr.invoke(Lr,hr),Rr=Lr.def(zr.shared.strings,".id(",Qr,")");return ge.optional(function(){Lr(zr.shared.shader,".shader(",cp[we],",",Rr,",",zr.command,");")}),Rr})}return null}var Fe=Ye(Nc),et=Ye(qu),xe=null,ze;return gc(Fe)&&gc(et)?(xe=Tr.program(et.id,Fe.id,null,Ve),ze=xo(function(we,ot){return we.link(xe)})):ze=new oa(Fe&&Fe.thisDep||et&&et.thisDep,Fe&&Fe.contextDep||et&&et.contextDep,Fe&&Fe.propDep||et&&et.propDep,function(we,ot){var _t=we.shared.shader,hr;Fe?hr=Fe.append(we,ot):hr=ot.def(_t,".",Nc);var zr;et?zr=et.append(we,ot):zr=ot.def(_t,".",qu);var Lr=_t+".program("+zr+","+hr;return ge.optional(function(){Lr+=","+we.command}),ot.def(Lr+")")}),{frag:Fe,vert:et,progVar:ze,program:xe}}function Xa(Se,oe){var Ve=Se.static,at=Se.dynamic,Mt={},Ye=!1;function Fe(){if(Uc in Ve){var Cn=Ve[Uc];return Cn!==null&&yr.getVAO(Cn)===null&&(Cn=yr.createVAO(Cn)),Ye=!0,Mt.vao=Cn,xo(function(xn){var _n=yr.getVAO(Cn);return _n?xn.link(_n):"null"})}else if(Uc in at){Ye=!0;var an=at[Uc];return Us(an,function(xn,_n){var hn=xn.invoke(_n,an);return _n.def(xn.shared.vao+".getVAO("+hn+")")})}return null}var et=Fe(),xe=!1;function ze(){if(yu in Ve){var Cn=Ve[yu];if(Mt.elements=Cn,$f(Cn)){var an=Mt.elements=Tt.create(Cn,!0);Cn=Tt.getElements(an),xe=!0}else Cn&&(Cn=Tt.getElements(Cn),xe=!0,ge.command(Cn,"invalid elements",oe.commandStr));var xn=xo(function(hn,Gn){if(Cn){var da=hn.link(Cn);return hn.ELEMENTS=da,da}return hn.ELEMENTS=null,null});return xn.value=Cn,xn}else if(yu in at){xe=!0;var _n=at[yu];return Us(_n,function(hn,Gn){var da=hn.shared,jo=da.isBufferArgs,Oa=da.elements,ua=hn.invoke(Gn,_n),Cl=Gn.def("null"),qn=Gn.def(jo,"(",ua,")"),ci=hn.cond(qn).then(Cl,"=",Oa,".createStream(",ua,");").else(Cl,"=",Oa,".getElements(",ua,");");return ge.optional(function(){hn.assert(ci.else,"!"+ua+"||"+Cl,"invalid elements")}),Gn.entry(ci),Gn.exit(hn.cond(qn).then(Oa,".destroyStream(",Cl,");")),hn.ELEMENTS=Cl,Cl})}else if(Ye)return new oa(et.thisDep,et.contextDep,et.propDep,function(hn,Gn){return Gn.def(hn.shared.vao+".currentVAO?"+hn.shared.elements+".getElements("+hn.shared.vao+".currentVAO.elements):null")});return null}var we=ze();function ot(){if(Uo in Ve){var Cn=Ve[Uo];return Mt.primitive=Cn,ge.commandParameter(Cn,lr,"invalid primitve",oe.commandStr),xo(function(xn,_n){return lr[Cn]})}else if(Uo in at){var an=at[Uo];return Us(an,function(xn,_n){var hn=xn.constants.primTypes,Gn=xn.invoke(_n,an);return ge.optional(function(){xn.assert(_n,Gn+" in "+hn,"invalid primitive, must be one of "+Object.keys(lr))}),_n.def(hn,"[",Gn,"]")})}else{if(xe)return gc(we)?we.value?xo(function(xn,_n){return _n.def(xn.ELEMENTS,".primType")}):xo(function(){return wh}):new oa(we.thisDep,we.contextDep,we.propDep,function(xn,_n){var hn=xn.ELEMENTS;return _n.def(hn,"?",hn,".primType:",wh)});if(Ye)return new oa(et.thisDep,et.contextDep,et.propDep,function(xn,_n){return _n.def(xn.shared.vao+".currentVAO?"+xn.shared.vao+".currentVAO.primitive:"+wh)})}return null}function _t(Cn,an){if(Cn in Ve){var xn=Ve[Cn]|0;return an?Mt.offset=xn:Mt.instances=xn,ge.command(!an||xn>=0,"invalid "+Cn,oe.commandStr),xo(function(hn,Gn){return an&&(hn.OFFSET=xn),xn})}else if(Cn in at){var _n=at[Cn];return Us(_n,function(hn,Gn){var da=hn.invoke(Gn,_n);return an&&(hn.OFFSET=da,ge.optional(function(){hn.assert(Gn,da+">=0","invalid "+Cn)})),da})}else if(an){if(xe)return xo(function(hn,Gn){return hn.OFFSET=0,0});if(Ye)return new oa(et.thisDep,et.contextDep,et.propDep,function(hn,Gn){return Gn.def(hn.shared.vao+".currentVAO?"+hn.shared.vao+".currentVAO.offset:0")})}else if(Ye)return new oa(et.thisDep,et.contextDep,et.propDep,function(hn,Gn){return Gn.def(hn.shared.vao+".currentVAO?"+hn.shared.vao+".currentVAO.instances:-1")});return null}var hr=_t(jf,!0);function zr(){if(zc in Ve){var Cn=Ve[zc]|0;return Mt.count=Cn,ge.command(typeof Cn=="number"&&Cn>=0,"invalid vertex count",oe.commandStr),xo(function(){return Cn})}else if(zc in at){var an=at[zc];return Us(an,function(Gn,da){var jo=Gn.invoke(da,an);return ge.optional(function(){Gn.assert(da,"typeof "+jo+'==="number"&&'+jo+">=0&&"+jo+"===("+jo+"|0)","invalid vertex count")}),jo})}else if(xe)if(gc(we)){if(we)return hr?new oa(hr.thisDep,hr.contextDep,hr.propDep,function(Gn,da){var jo=da.def(Gn.ELEMENTS,".vertCount-",Gn.OFFSET);return ge.optional(function(){Gn.assert(da,jo+">=0","invalid vertex offset/element buffer too small")}),jo}):xo(function(Gn,da){return da.def(Gn.ELEMENTS,".vertCount")});var xn=xo(function(){return-1});return ge.optional(function(){xn.MISSING=!0}),xn}else{var _n=new oa(we.thisDep||hr.thisDep,we.contextDep||hr.contextDep,we.propDep||hr.propDep,function(Gn,da){var jo=Gn.ELEMENTS;return Gn.OFFSET?da.def(jo,"?",jo,".vertCount-",Gn.OFFSET,":-1"):da.def(jo,"?",jo,".vertCount:-1")});return ge.optional(function(){_n.DYNAMIC=!0}),_n}else if(Ye){var hn=new oa(et.thisDep,et.contextDep,et.propDep,function(Gn,da){return da.def(Gn.shared.vao,".currentVAO?",Gn.shared.vao,".currentVAO.count:-1")});return hn}return null}var Lr=ot(),Qr=zr(),Rr=_t(gh,!1);return{elements:we,primitive:Lr,count:Qr,instances:Rr,offset:hr,vao:et,vaoActive:Ye,elementsActive:xe,static:Mt}}function uo(Se,oe){var Ve=Se.static,at=Se.dynamic,Mt={};return Bn.forEach(function(Ye){var Fe=fn(Ye);function et(xe,ze){if(Ye in Ve){var we=xe(Ve[Ye]);Mt[Fe]=xo(function(){return we})}else if(Ye in at){var ot=at[Ye];Mt[Fe]=Us(ot,function(_t,hr){return ze(_t,hr,_t.invoke(hr,ot))})}}switch(Ye){case yl:case pa:case so:case Qi:case ls:case Ul:case Lu:case uu:case lu:case fc:return et(function(xe){return ge.commandType(xe,"boolean",Ye,oe.commandStr),xe},function(xe,ze,we){return ge.optional(function(){xe.assert(ze,"typeof "+we+'==="boolean"',"invalid flag "+Ye,xe.commandStr)}),we});case su:return et(function(xe){return ge.commandParameter(xe,Xc,"invalid "+Ye,oe.commandStr),Xc[xe]},function(xe,ze,we){var ot=xe.constants.compareFuncs;return ge.optional(function(){xe.assert(ze,we+" in "+ot,"invalid "+Ye+", must be one of "+Object.keys(Xc))}),ze.def(ot,"[",we,"]")});case Fc:return et(function(xe){return ge.command(io(xe)&&xe.length===2&&typeof xe[0]=="number"&&typeof xe[1]=="number"&&xe[0]<=xe[1],"depth range is 2d array",oe.commandStr),xe},function(xe,ze,we){ge.optional(function(){xe.assert(ze,xe.shared.isArrayLike+"("+we+")&&"+we+".length===2&&typeof "+we+'[0]==="number"&&typeof '+we+'[1]==="number"&&'+we+"[0]<="+we+"[1]","depth range must be a 2d array")});var ot=ze.def("+",we,"[0]"),_t=ze.def("+",we,"[1]");return[ot,_t]});case ts:return et(function(xe){ge.commandType(xe,"object","blend.func",oe.commandStr);var ze="srcRGB"in xe?xe.srcRGB:xe.src,we="srcAlpha"in xe?xe.srcAlpha:xe.src,ot="dstRGB"in xe?xe.dstRGB:xe.dst,_t="dstAlpha"in xe?xe.dstAlpha:xe.dst;return ge.commandParameter(ze,Ku,Fe+".srcRGB",oe.commandStr),ge.commandParameter(we,Ku,Fe+".srcAlpha",oe.commandStr),ge.commandParameter(ot,Ku,Fe+".dstRGB",oe.commandStr),ge.commandParameter(_t,Ku,Fe+".dstAlpha",oe.commandStr),ge.command(bl.indexOf(ze+", "+ot)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ze+", "+ot+")",oe.commandStr),[Ku[ze],Ku[ot],Ku[we],Ku[_t]]},function(xe,ze,we){var ot=xe.constants.blendFuncs;ge.optional(function(){xe.assert(ze,we+"&&typeof "+we+'==="object"',"invalid blend func, must be an object")});function _t(an,xn){var _n=ze.def('"',an,xn,'" in ',we,"?",we,".",an,xn,":",we,".",an);return ge.optional(function(){xe.assert(ze,_n+" in "+ot,"invalid "+Ye+"."+an+xn+", must be one of "+Object.keys(Ku))}),_n}var hr=_t("src","RGB"),zr=_t("dst","RGB");ge.optional(function(){var an=xe.constants.invalidBlendCombinations;xe.assert(ze,an+".indexOf("+hr+'+", "+'+zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Lr=ze.def(ot,"[",hr,"]"),Qr=ze.def(ot,"[",_t("src","Alpha"),"]"),Rr=ze.def(ot,"[",zr,"]"),Cn=ze.def(ot,"[",_t("dst","Alpha"),"]");return[Lr,Rr,Qr,Cn]});case Js:return et(function(xe){if(typeof xe=="string")return ge.commandParameter(xe,Gt,"invalid "+Ye,oe.commandStr),[Gt[xe],Gt[xe]];if(typeof xe=="object")return ge.commandParameter(xe.rgb,Gt,Ye+".rgb",oe.commandStr),ge.commandParameter(xe.alpha,Gt,Ye+".alpha",oe.commandStr),[Gt[xe.rgb],Gt[xe.alpha]];ge.commandRaise("invalid blend.equation",oe.commandStr)},function(xe,ze,we){var ot=xe.constants.blendEquations,_t=ze.def(),hr=ze.def(),zr=xe.cond("typeof ",we,'==="string"');return ge.optional(function(){function Lr(Qr,Rr,Cn){xe.assert(Qr,Cn+" in "+ot,"invalid "+Rr+", must be one of "+Object.keys(Gt))}Lr(zr.then,Ye,we),xe.assert(zr.else,we+"&&typeof "+we+'==="object"',"invalid "+Ye),Lr(zr.else,Ye+".rgb",we+".rgb"),Lr(zr.else,Ye+".alpha",we+".alpha")}),zr.then(_t,"=",hr,"=",ot,"[",we,"];"),zr.else(_t,"=",ot,"[",we,".rgb];",hr,"=",ot,"[",we,".alpha];"),ze(zr),[_t,hr]});case na:return et(function(xe){return ge.command(io(xe)&&xe.length===4,"blend.color must be a 4d array",oe.commandStr),je(4,function(ze){return+xe[ze]})},function(xe,ze,we){return ge.optional(function(){xe.assert(ze,xe.shared.isArrayLike+"("+we+")&&"+we+".length===4","blend.color must be a 4d array")}),je(4,function(ot){return ze.def("+",we,"[",ot,"]")})});case cs:return et(function(xe){return ge.commandType(xe,"number",Fe,oe.commandStr),xe|0},function(xe,ze,we){return ge.optional(function(){xe.assert(ze,"typeof "+we+'==="number"',"invalid stencil.mask")}),ze.def(we,"|0")});case zo:return et(function(xe){ge.commandType(xe,"object",Fe,oe.commandStr);var ze=xe.cmp||"keep",we=xe.ref||0,ot="mask"in xe?xe.mask:-1;return ge.commandParameter(ze,Xc,Ye+".cmp",oe.commandStr),ge.commandType(we,"number",Ye+".ref",oe.commandStr),ge.commandType(ot,"number",Ye+".mask",oe.commandStr),[Xc[ze],we,ot]},function(xe,ze,we){var ot=xe.constants.compareFuncs;ge.optional(function(){function Lr(){xe.assert(ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Lr(we+"&&typeof ",we,'==="object"'),Lr('!("cmp" in ',we,")||(",we,".cmp in ",ot,")")});var _t=ze.def('"cmp" in ',we,"?",ot,"[",we,".cmp]",":",Nt),hr=ze.def(we,".ref|0"),zr=ze.def('"mask" in ',we,"?",we,".mask|0:-1");return[_t,hr,zr]});case Fu:case pc:return et(function(xe){ge.commandType(xe,"object",Fe,oe.commandStr);var ze=xe.fail||"keep",we=xe.zfail||"keep",ot=xe.zpass||"keep";return ge.commandParameter(ze,mc,Ye+".fail",oe.commandStr),ge.commandParameter(we,mc,Ye+".zfail",oe.commandStr),ge.commandParameter(ot,mc,Ye+".zpass",oe.commandStr),[Ye===pc?Hc:xl,mc[ze],mc[we],mc[ot]]},function(xe,ze,we){var ot=xe.constants.stencilOps;ge.optional(function(){xe.assert(ze,we+"&&typeof "+we+'==="object"',"invalid "+Ye)});function _t(hr){return ge.optional(function(){xe.assert(ze,'!("'+hr+'" in '+we+")||("+we+"."+hr+" in "+ot+")","invalid "+Ye+"."+hr+", must be one of "+Object.keys(mc))}),ze.def('"',hr,'" in ',we,"?",ot,"[",we,".",hr,"]:",Nt)}return[Ye===pc?Hc:xl,_t("fail"),_t("zfail"),_t("zpass")]});case Na:return et(function(xe){ge.commandType(xe,"object",Fe,oe.commandStr);var ze=xe.factor|0,we=xe.units|0;return ge.commandType(ze,"number",Fe+".factor",oe.commandStr),ge.commandType(we,"number",Fe+".units",oe.commandStr),[ze,we]},function(xe,ze,we){ge.optional(function(){xe.assert(ze,we+"&&typeof "+we+'==="object"',"invalid "+Ye)});var ot=ze.def(we,".factor|0"),_t=ze.def(we,".units|0");return[ot,_t]});case bs:return et(function(xe){var ze=0;return xe==="front"?ze=xl:xe==="back"&&(ze=Hc),ge.command(!!ze,Fe,oe.commandStr),ze},function(xe,ze,we){return ge.optional(function(){xe.assert(ze,we+'==="front"||'+we+'==="back"',"invalid cull.face")}),ze.def(we,'==="front"?',xl,":",Hc)});case hc:return et(function(xe){return ge.command(typeof xe=="number"&&xe>=Ot.lineWidthDims[0]&&xe<=Ot.lineWidthDims[1],"invalid line width, must be a positive number between "+Ot.lineWidthDims[0]+" and "+Ot.lineWidthDims[1],oe.commandStr),xe},function(xe,ze,we){return ge.optional(function(){xe.assert(ze,"typeof "+we+'==="number"&&'+we+">="+Ot.lineWidthDims[0]+"&&"+we+"<="+Ot.lineWidthDims[1],"invalid line width")}),we});case gu:return et(function(xe){return ge.commandParameter(xe,Mh,Fe,oe.commandStr),Mh[xe]},function(xe,ze,we){return ge.optional(function(){xe.assert(ze,we+'==="cw"||'+we+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ze.def(we+'==="cw"?'+jp+":"+Ah)});case Yu:return et(function(xe){return ge.command(io(xe)&&xe.length===4,"color.mask must be length 4 array",oe.commandStr),xe.map(function(ze){return!!ze})},function(xe,ze,we){return ge.optional(function(){xe.assert(ze,xe.shared.isArrayLike+"("+we+")&&"+we+".length===4","invalid color.mask")}),je(4,function(ot){return"!!"+we+"["+ot+"]"})});case Du:return et(function(xe){ge.command(typeof xe=="object"&&xe,Fe,oe.commandStr);var ze="value"in xe?xe.value:1,we=!!xe.invert;return ge.command(typeof ze=="number"&&ze>=0&&ze<=1,"sample.coverage.value must be a number between 0 and 1",oe.commandStr),[ze,we]},function(xe,ze,we){ge.optional(function(){xe.assert(ze,we+"&&typeof "+we+'==="object"',"invalid sample.coverage")});var ot=ze.def('"value" in ',we,"?+",we,".value:1"),_t=ze.def("!!",we,".invert");return[ot,_t]})}}),Mt}function ki(Se,oe){var Ve=Se.static,at=Se.dynamic,Mt={};return Object.keys(Ve).forEach(function(Ye){var Fe=Ve[Ye],et;if(typeof Fe=="number"||typeof Fe=="boolean")et=xo(function(){return Fe});else if(typeof Fe=="function"){var xe=Fe._reglType;xe==="texture2d"||xe==="textureCube"?et=xo(function(ze){return ze.link(Fe)}):xe==="framebuffer"||xe==="framebufferCube"?(ge.command(Fe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ye+'"',oe.commandStr),et=xo(function(ze){return ze.link(Fe.color[0])})):ge.commandRaise('invalid data for uniform "'+Ye+'"',oe.commandStr)}else io(Fe)?et=xo(function(ze){var we=ze.global.def("[",je(Fe.length,function(ot){return ge.command(typeof Fe[ot]=="number"||typeof Fe[ot]=="boolean","invalid uniform "+Ye,ze.commandStr),Fe[ot]}),"]");return we}):ge.commandRaise('invalid or missing data for uniform "'+Ye+'"',oe.commandStr);et.value=Fe,Mt[Ye]=et}),Object.keys(at).forEach(function(Ye){var Fe=at[Ye];Mt[Ye]=Us(Fe,function(et,xe){return et.invoke(xe,Fe)})}),Mt}function qo(Se,oe){var Ve=Se.static,at=Se.dynamic,Mt={};return Object.keys(Ve).forEach(function(Ye){var Fe=Ve[Ye],et=ve.id(Ye),xe=new it;if($f(Fe))xe.state=On,xe.buffer=sr.getBuffer(sr.create(Fe,Vc,!1,!0)),xe.type=0;else{var ze=sr.getBuffer(Fe);if(ze)xe.state=On,xe.buffer=ze,xe.type=0;else if(ge.command(typeof Fe=="object"&&Fe,"invalid data for attribute "+Ye,oe.commandStr),"constant"in Fe){var we=Fe.constant;xe.buffer="null",xe.state=yi,typeof we=="number"?xe.x=we:(ge.command(io(we)&&we.length>0&&we.length<=4,"invalid constant for attribute "+Ye,oe.commandStr),fi.forEach(function(Rr,Cn){Cn<we.length&&(xe[Rr]=we[Cn])}))}else{$f(Fe.buffer)?ze=sr.getBuffer(sr.create(Fe.buffer,Vc,!1,!0)):ze=sr.getBuffer(Fe.buffer),ge.command(!!ze,'missing buffer for attribute "'+Ye+'"',oe.commandStr);var ot=Fe.offset|0;ge.command(ot>=0,'invalid offset for attribute "'+Ye+'"',oe.commandStr);var _t=Fe.stride|0;ge.command(_t>=0&&_t<256,'invalid stride for attribute "'+Ye+'", must be integer betweeen [0, 255]',oe.commandStr);var hr=Fe.size|0;ge.command(!("size"in Fe)||hr>0&&hr<=4,'invalid size for attribute "'+Ye+'", must be 1,2,3,4',oe.commandStr);var zr=!!Fe.normalized,Lr=0;"type"in Fe&&(ge.commandParameter(Fe.type,Ws,"invalid type for attribute "+Ye,oe.commandStr),Lr=Ws[Fe.type]);var Qr=Fe.divisor|0;ge.optional(function(){"divisor"in Fe&&(ge.command(Qr===0||_r,'cannot specify divisor for attribute "'+Ye+'", instancing not supported',oe.commandStr),ge.command(Qr>=0,'invalid divisor for attribute "'+Ye+'"',oe.commandStr));var Rr=oe.commandStr,Cn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Fe).forEach(function(an){ge.command(Cn.indexOf(an)>=0,'unknown parameter "'+an+'" for attribute pointer "'+Ye+'" (valid parameters are '+Cn+")",Rr)})}),xe.buffer=ze,xe.state=On,xe.size=hr,xe.normalized=zr,xe.type=Lr||ze.dtype,xe.offset=ot,xe.stride=_t,xe.divisor=Qr}}Mt[Ye]=xo(function(Rr,Cn){var an=Rr.attribCache;if(et in an)return an[et];var xn={isStream:!1};return Object.keys(xe).forEach(function(_n){xn[_n]=xe[_n]}),xe.buffer&&(xn.buffer=Rr.link(xe.buffer),xn.type=xn.type||xn.buffer+".dtype"),an[et]=xn,xn})}),Object.keys(at).forEach(function(Ye){var Fe=at[Ye];function et(xe,ze){var we=xe.invoke(ze,Fe),ot=xe.shared,_t=xe.constants,hr=ot.isBufferArgs,zr=ot.buffer;ge.optional(function(){xe.assert(ze,we+"&&(typeof "+we+'==="object"||typeof '+we+'==="function")&&('+hr+"("+we+")||"+zr+".getBuffer("+we+")||"+zr+".getBuffer("+we+".buffer)||"+hr+"("+we+'.buffer)||("constant" in '+we+"&&(typeof "+we+'.constant==="number"||'+ot.isArrayLike+"("+we+".constant))))",'invalid dynamic attribute "'+Ye+'"')});var Lr={isStream:ze.def(!1)},Qr=new it;Qr.state=On,Object.keys(Qr).forEach(function(xn){Lr[xn]=ze.def(""+Qr[xn])});var Rr=Lr.buffer,Cn=Lr.type;ze("if(",hr,"(",we,")){",Lr.isStream,"=true;",Rr,"=",zr,".createStream(",Vc,",",we,");",Cn,"=",Rr,".dtype;","}else{",Rr,"=",zr,".getBuffer(",we,");","if(",Rr,"){",Cn,"=",Rr,".dtype;",'}else if("constant" in ',we,"){",Lr.state,"=",yi,";","if(typeof "+we+'.constant === "number"){',Lr[fi[0]],"=",we,".constant;",fi.slice(1).map(function(xn){return Lr[xn]}).join("="),"=0;","}else{",fi.map(function(xn,_n){return Lr[xn]+"="+we+".constant.length>"+_n+"?"+we+".constant["+_n+"]:0;"}).join(""),"}}else{","if(",hr,"(",we,".buffer)){",Rr,"=",zr,".createStream(",Vc,",",we,".buffer);","}else{",Rr,"=",zr,".getBuffer(",we,".buffer);","}",Cn,'="type" in ',we,"?",_t.glTypes,"[",we,".type]:",Rr,".dtype;",Lr.normalized,"=!!",we,".normalized;");function an(xn){ze(Lr[xn],"=",we,".",xn,"|0;")}return an("size"),an("offset"),an("stride"),an("divisor"),ze("}}"),ze.exit("if(",Lr.isStream,"){",zr,".destroyStream(",Rr,");","}"),Lr}Mt[Ye]=Us(Fe,et)}),Mt}function za(Se){var oe=Se.static,Ve=Se.dynamic,at={};return Object.keys(oe).forEach(function(Mt){var Ye=oe[Mt];at[Mt]=xo(function(Fe,et){return typeof Ye=="number"||typeof Ye=="boolean"?""+Ye:Fe.link(Ye)})}),Object.keys(Ve).forEach(function(Mt){var Ye=Ve[Mt];at[Mt]=Us(Ye,function(Fe,et){return Fe.invoke(et,Ye)})}),at}function Ko(Se,oe,Ve,at,Mt){var Ye=Se.static,Fe=Se.dynamic;ge.optional(function(){var an=[Mo,qu,Nc,yu,Uo,jf,zc,gh,Zl,Uc].concat(Bn);function xn(_n){Object.keys(_n).forEach(function(hn){ge.command(an.indexOf(hn)>=0,'unknown parameter "'+hn+'"',Mt.commandStr)})}xn(Ye),xn(Fe)});var et=hi(Se,oe),xe=rn(Se,Mt),ze=Yn(Se,xe,Mt),we=Xa(Se,Mt),ot=uo(Se,Mt),_t=Fi(Se,Mt,et);function hr(an){var xn=ze[an];xn&&(ot[an]=xn)}hr(eu),hr(fn(Bc));var zr=Object.keys(ot).length>0,Lr={framebuffer:xe,draw:we,shader:_t,state:ot,dirty:zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Lr.profile=Yr(Se,Mt),Lr.uniforms=ki(Ve,Mt),Lr.drawVAO=Lr.scopeVAO=we.vao,!Lr.drawVAO&&_t.program&&!et&&Be.angle_instanced_arrays&&we.static.elements){var Qr=!0,Rr=_t.program.attributes.map(function(an){var xn=oe.static[an];return Qr=Qr&&!!xn,xn});if(Qr&&Rr.length>0){var Cn=yr.getVAO(yr.createVAO({attributes:Rr,elements:we.static.elements}));Lr.drawVAO=new oa(null,null,null,function(an,xn){return an.link(Cn)}),Lr.useVAO=!0}}return et?Lr.useVAO=!0:Lr.attributes=qo(oe,Mt),Lr.context=za(at,Mt),Lr}function bo(Se,oe,Ve){var at=Se.shared,Mt=at.context,Ye=Se.scope();Object.keys(Ve).forEach(function(Fe){oe.save(Mt,"."+Fe);var et=Ve[Fe],xe=et.append(Se,oe);Array.isArray(xe)?Ye(Mt,".",Fe,"=[",xe.join(),"];"):Ye(Mt,".",Fe,"=",xe,";")}),oe(Ye)}function $o(Se,oe,Ve,at){var Mt=Se.shared,Ye=Mt.gl,Fe=Mt.framebuffer,et;Br&&(et=oe.def(Mt.extensions,".webgl_draw_buffers"));var xe=Se.constants,ze=xe.drawBuffer,we=xe.backBuffer,ot;Ve?ot=Ve.append(Se,oe):ot=oe.def(Fe,".next"),at||oe("if(",ot,"!==",Fe,".cur){"),oe("if(",ot,"){",Ye,".bindFramebuffer(",lp,",",ot,".framebuffer);"),Br&&oe(et,".drawBuffersWEBGL(",ze,"[",ot,".colorAttachments.length]);"),oe("}else{",Ye,".bindFramebuffer(",lp,",null);"),Br&&oe(et,".drawBuffersWEBGL(",we,");"),oe("}",Fe,".cur=",ot,";"),at||oe("}")}function Zo(Se,oe,Ve){var at=Se.shared,Mt=at.gl,Ye=Se.current,Fe=Se.next,et=at.current,xe=at.next,ze=Se.cond(et,".dirty");Bn.forEach(function(we){var ot=fn(we);if(!(ot in Ve.state)){var _t,hr;if(ot in Fe){_t=Fe[ot],hr=Ye[ot];var zr=je(Ir[ot].length,function(Qr){return ze.def(_t,"[",Qr,"]")});ze(Se.cond(zr.map(function(Qr,Rr){return Qr+"!=="+hr+"["+Rr+"]"}).join("||")).then(Mt,".",rr[ot],"(",zr,");",zr.map(function(Qr,Rr){return hr+"["+Rr+"]="+Qr}).join(";"),";"))}else{_t=ze.def(xe,".",ot);var Lr=Se.cond(_t,"!==",et,".",ot);ze(Lr),ot in tr?Lr(Se.cond(_t).then(Mt,".enable(",tr[ot],");").else(Mt,".disable(",tr[ot],");"),et,".",ot,"=",_t,";"):Lr(Mt,".",rr[ot],"(",_t,");",et,".",ot,"=",_t,";")}}}),Object.keys(Ve.state).length===0&&ze(et,".dirty=false;"),oe(ze)}function rs(Se,oe,Ve,at){var Mt=Se.shared,Ye=Se.current,Fe=Mt.current,et=Mt.gl;Ph(Object.keys(Ve)).forEach(function(xe){var ze=Ve[xe];if(!(at&&!at(ze))){var we=ze.append(Se,oe);if(tr[xe]){var ot=tr[xe];gc(ze)?we?oe(et,".enable(",ot,");"):oe(et,".disable(",ot,");"):oe(Se.cond(we).then(et,".enable(",ot,");").else(et,".disable(",ot,");")),oe(Fe,".",xe,"=",we,";")}else if(io(we)){var _t=Ye[xe];oe(et,".",rr[xe],"(",we,");",we.map(function(hr,zr){return _t+"["+zr+"]="+hr}).join(";"),";")}else oe(et,".",rr[xe],"(",we,");",Fe,".",xe,"=",we,";")}})}function to(Se,oe){_r&&(Se.instancing=oe.def(Se.shared.extensions,".angle_instanced_arrays"))}function _i(Se,oe,Ve,at,Mt){var Ye=Se.shared,Fe=Se.stats,et=Ye.current,xe=Ye.timer,ze=Ve.profile;function we(){var an=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return an||typeof performance=="undefined"?"Date.now()":"performance.now()"}var ot,_t;function hr(an){ot=oe.def(),an(ot,"=",we(),";"),typeof Mt=="string"?an(Fe,".count+=",Mt,";"):an(Fe,".count++;"),br&&(at?(_t=oe.def(),an(_t,"=",xe,".getNumPendingQueries();")):an(xe,".beginQuery(",Fe,");"))}function zr(an){an(Fe,".cpuTime+=",we(),"-",ot,";"),br&&(at?an(xe,".pushScopeStats(",_t,",",xe,".getNumPendingQueries(),",Fe,");"):an(xe,".endQuery();"))}function Lr(an){var xn=oe.def(et,".profile");oe(et,".profile=",an,";"),oe.exit(et,".profile=",xn,";")}var Qr;if(ze){if(gc(ze)){ze.enable?(hr(oe),zr(oe.exit),Lr("true")):Lr("false");return}Qr=ze.append(Se,oe),Lr(Qr)}else Qr=oe.def(et,".profile");var Rr=Se.block();hr(Rr),oe("if(",Qr,"){",Rr,"}");var Cn=Se.block();zr(Cn),oe.exit("if(",Qr,"){",Cn,"}")}function Vo(Se,oe,Ve,at,Mt){var Ye=Se.shared;function Fe(xe){switch(xe){case Wf:case Eh:case Ch:return 2;case vc:case xu:case _f:return 3;case yf:case Sh:case Gc:return 4;default:return 1}}function et(xe,ze,we){var ot=Ye.gl,_t=oe.def(xe,".location"),hr=oe.def(Ye.attributes,"[",_t,"]"),zr=we.state,Lr=we.buffer,Qr=[we.x,we.y,we.z,we.w],Rr=["buffer","normalized","offset","stride"];function Cn(){oe("if(!",hr,".buffer){",ot,".enableVertexAttribArray(",_t,");}");var xn=we.type,_n;if(we.size?_n=oe.def(we.size,"||",ze):_n=ze,oe("if(",hr,".type!==",xn,"||",hr,".size!==",_n,"||",Rr.map(function(Gn){return hr+"."+Gn+"!=="+we[Gn]}).join("||"),"){",ot,".bindBuffer(",Vc,",",Lr,".buffer);",ot,".vertexAttribPointer(",[_t,_n,xn,we.normalized,we.stride,we.offset],");",hr,".type=",xn,";",hr,".size=",_n,";",Rr.map(function(Gn){return hr+"."+Gn+"="+we[Gn]+";"}).join(""),"}"),_r){var hn=we.divisor;oe("if(",hr,".divisor!==",hn,"){",Se.instancing,".vertexAttribDivisorANGLE(",[_t,hn],");",hr,".divisor=",hn,";}")}}function an(){oe("if(",hr,".buffer){",ot,".disableVertexAttribArray(",_t,");",hr,".buffer=null;","}if(",fi.map(function(xn,_n){return hr+"."+xn+"!=="+Qr[_n]}).join("||"),"){",ot,".vertexAttrib4f(",_t,",",Qr,");",fi.map(function(xn,_n){return hr+"."+xn+"="+Qr[_n]+";"}).join(""),"}")}zr===On?Cn():zr===yi?an():(oe("if(",zr,"===",On,"){"),Cn(),oe("}else{"),an(),oe("}"))}at.forEach(function(xe){var ze=xe.name,we=Ve.attributes[ze],ot;if(we){if(!Mt(we))return;ot=we.append(Se,oe)}else{if(!Mt(Ih))return;var _t=Se.scopeAttrib(ze);ge.optional(function(){Se.assert(oe,_t+".state","missing attribute "+ze)}),ot={},Object.keys(new it).forEach(function(hr){ot[hr]=oe.def(_t,".",hr)})}et(Se.link(xe),Fe(xe.info.type),ot)})}function Yi(Se,oe,Ve,at,Mt,Ye){for(var Fe=Se.shared,et=Fe.gl,xe,ze=0;ze<at.length;++ze){var we=at[ze],ot=we.name,_t=we.info.type,hr=Ve.uniforms[ot],zr=Se.link(we),Lr=zr+".location",Qr;if(hr){if(!Mt(hr))continue;if(gc(hr)){var Rr=hr.value;if(ge.command(Rr!==null&&typeof Rr!="undefined",'missing uniform "'+ot+'"',Se.commandStr),_t===xf||_t===bf){ge.command(typeof Rr=="function"&&(_t===xf&&(Rr._reglType==="texture2d"||Rr._reglType==="framebuffer")||_t===bf&&(Rr._reglType==="textureCube"||Rr._reglType==="framebufferCube")),"invalid texture for uniform "+ot,Se.commandStr);var Cn=Se.link(Rr._texture||Rr.color[0]._texture);oe(et,".uniform1i(",Lr,",",Cn+".bind());"),oe.exit(Cn,".unbind();")}else if(_t===zs||_t===qf||_t===Kf){ge.optional(function(){ge.command(io(Rr),"invalid matrix for uniform "+ot,Se.commandStr),ge.command(_t===zs&&Rr.length===4||_t===qf&&Rr.length===9||_t===Kf&&Rr.length===16,"invalid length for matrix uniform "+ot,Se.commandStr)});var an=Se.global.def("new Float32Array(["+Array.prototype.slice.call(Rr)+"])"),xn=2;_t===qf?xn=3:_t===Kf&&(xn=4),oe(et,".uniformMatrix",xn,"fv(",Lr,",false,",an,");")}else{switch(_t){case bh:ge.commandType(Rr,"number","uniform "+ot,Se.commandStr),xe="1f";break;case Wf:ge.command(io(Rr)&&Rr.length===2,"uniform "+ot,Se.commandStr),xe="2f";break;case vc:ge.command(io(Rr)&&Rr.length===3,"uniform "+ot,Se.commandStr),xe="3f";break;case yf:ge.command(io(Rr)&&Rr.length===4,"uniform "+ot,Se.commandStr),xe="4f";break;case Yf:ge.commandType(Rr,"boolean","uniform "+ot,Se.commandStr),xe="1i";break;case Xf:ge.commandType(Rr,"number","uniform "+ot,Se.commandStr),xe="1i";break;case Ch:ge.command(io(Rr)&&Rr.length===2,"uniform "+ot,Se.commandStr),xe="2i";break;case Eh:ge.command(io(Rr)&&Rr.length===2,"uniform "+ot,Se.commandStr),xe="2i";break;case _f:ge.command(io(Rr)&&Rr.length===3,"uniform "+ot,Se.commandStr),xe="3i";break;case xu:ge.command(io(Rr)&&Rr.length===3,"uniform "+ot,Se.commandStr),xe="3i";break;case Gc:ge.command(io(Rr)&&Rr.length===4,"uniform "+ot,Se.commandStr),xe="4i";break;case Sh:ge.command(io(Rr)&&Rr.length===4,"uniform "+ot,Se.commandStr),xe="4i";break}oe(et,".uniform",xe,"(",Lr,",",io(Rr)?Array.prototype.slice.call(Rr):Rr,");")}continue}else Qr=hr.append(Se,oe)}else{if(!Mt(Ih))continue;Qr=oe.def(Fe.uniforms,"[",ve.id(ot),"]")}_t===xf?(ge(!Array.isArray(Qr),"must specify a scalar prop for textures"),oe("if(",Qr,"&&",Qr,'._reglType==="framebuffer"){',Qr,"=",Qr,".color[0];","}")):_t===bf&&(ge(!Array.isArray(Qr),"must specify a scalar prop for cube maps"),oe("if(",Qr,"&&",Qr,'._reglType==="framebufferCube"){',Qr,"=",Qr,".color[0];","}")),ge.optional(function(){function qn(bu,qc){Se.assert(oe,bu,'bad data or missing for uniform "'+ot+'".  '+qc)}function ci(bu){ge(!Array.isArray(Qr),"must not specify an array type for uniform"),qn("typeof "+Qr+'==="'+bu+'"',"invalid type, expected "+bu)}function cu(bu,qc){Array.isArray(Qr)?ge(Qr.length===bu,"must have length "+bu):qn(Fe.isArrayLike+"("+Qr+")&&"+Qr+".length==="+bu,"invalid vector, should have length "+bu,Se.commandStr)}function Yp(bu){ge(!Array.isArray(Qr),"must not specify a value type"),qn("typeof "+Qr+'==="function"&&'+Qr+'._reglType==="texture'+(bu===sp?"2d":"Cube")+'"',"invalid texture type",Se.commandStr)}switch(_t){case Xf:ci("number");break;case Eh:cu(2,"number");break;case xu:cu(3,"number");break;case Sh:cu(4,"number");break;case bh:ci("number");break;case Wf:cu(2,"number");break;case vc:cu(3,"number");break;case yf:cu(4,"number");break;case Yf:ci("boolean");break;case Ch:cu(2,"boolean");break;case _f:cu(3,"boolean");break;case Gc:cu(4,"boolean");break;case zs:cu(4,"number");break;case qf:cu(9,"number");break;case Kf:cu(16,"number");break;case xf:Yp(sp);break;case bf:Yp(yh);break}});var _n=1;switch(_t){case xf:case bf:var hn=oe.def(Qr,"._texture");oe(et,".uniform1i(",Lr,",",hn,".bind());"),oe.exit(hn,".unbind();");continue;case Xf:case Yf:xe="1i";break;case Eh:case Ch:xe="2i",_n=2;break;case xu:case _f:xe="3i",_n=3;break;case Sh:case Gc:xe="4i",_n=4;break;case bh:xe="1f";break;case Wf:xe="2f",_n=2;break;case vc:xe="3f",_n=3;break;case yf:xe="4f",_n=4;break;case zs:xe="Matrix2fv";break;case qf:xe="Matrix3fv";break;case Kf:xe="Matrix4fv";break}if(xe.charAt(0)==="M"){oe(et,".uniform",xe,"(",Lr,",");var Gn=Math.pow(_t-zs+2,2),da=Se.global.def("new Float32Array(",Gn,")");Array.isArray(Qr)?oe("false,(",je(Gn,function(qn){return da+"["+qn+"]="+Qr[qn]}),",",da,")"):oe("false,(Array.isArray(",Qr,")||",Qr," instanceof Float32Array)?",Qr,":(",je(Gn,function(qn){return da+"["+qn+"]="+Qr+"["+qn+"]"}),",",da,")"),oe(");")}else if(_n>1){for(var jo=[],Oa=[],ua=0;ua<_n;++ua)Array.isArray(Qr)?Oa.push(Qr[ua]):Oa.push(oe.def(Qr+"["+ua+"]")),Ye&&jo.push(oe.def());Ye&&oe("if(!",Se.batchId,"||",jo.map(function(qn,ci){return qn+"!=="+Oa[ci]}).join("||"),"){",jo.map(function(qn,ci){return qn+"="+Oa[ci]+";"}).join("")),oe(et,".uniform",xe,"(",Lr,",",Oa.join(","),");"),Ye&&oe("}")}else{if(ge(!Array.isArray(Qr),"uniform value must not be an array"),Ye){var Cl=oe.def();oe("if(!",Se.batchId,"||",Cl,"!==",Qr,"){",Cl,"=",Qr,";")}oe(et,".uniform",xe,"(",Lr,",",Qr,");"),Ye&&oe("}")}}}function ns(Se,oe,Ve,at){var Mt=Se.shared,Ye=Mt.gl,Fe=Mt.draw,et=at.draw;function xe(){var _n=et.elements,hn,Gn=oe;return _n?((_n.contextDep&&at.contextDynamic||_n.propDep)&&(Gn=Ve),hn=_n.append(Se,Gn),et.elementsActive&&Gn("if("+hn+")"+Ye+".bindBuffer("+op+","+hn+".buffer.buffer);")):(hn=Gn.def(),Gn(hn,"=",Fe,".",yu,";","if(",hn,"){",Ye,".bindBuffer(",op,",",hn,".buffer.buffer);}","else if(",Mt.vao,".currentVAO){",hn,"=",Se.shared.elements+".getElements("+Mt.vao,".currentVAO.elements);",cr?"":"if("+hn+")"+Ye+".bindBuffer("+op+","+hn+".buffer.buffer);","}")),hn}function ze(){var _n=et.count,hn,Gn=oe;return _n?((_n.contextDep&&at.contextDynamic||_n.propDep)&&(Gn=Ve),hn=_n.append(Se,Gn),ge.optional(function(){_n.MISSING&&Se.assert(oe,"false","missing vertex count"),_n.DYNAMIC&&Se.assert(Gn,hn+">=0","missing vertex count")})):(hn=Gn.def(Fe,".",zc),ge.optional(function(){Se.assert(Gn,hn+">=0","missing vertex count")})),hn}var we=xe();function ot(_n){var hn=et[_n];return hn?hn.contextDep&&at.contextDynamic||hn.propDep?hn.append(Se,Ve):hn.append(Se,oe):oe.def(Fe,".",_n)}var _t=ot(Uo),hr=ot(jf),zr=ze();if(typeof zr=="number"){if(zr===0)return}else Ve("if(",zr,"){"),Ve.exit("}");var Lr,Qr;_r&&(Lr=ot(gh),Qr=Se.instancing);var Rr=we+".type",Cn=et.elements&&gc(et.elements)&&!et.vaoActive;function an(){function _n(){Ve(Qr,".drawElementsInstancedANGLE(",[_t,zr,Rr,hr+"<<(("+Rr+"-"+ti+")>>1)",Lr],");")}function hn(){Ve(Qr,".drawArraysInstancedANGLE(",[_t,hr,zr,Lr],");")}we&&we!=="null"?Cn?_n():(Ve("if(",we,"){"),_n(),Ve("}else{"),hn(),Ve("}")):hn()}function xn(){function _n(){Ve(Ye+".drawElements("+[_t,zr,Rr,hr+"<<(("+Rr+"-"+ti+")>>1)"]+");")}function hn(){Ve(Ye+".drawArrays("+[_t,hr,zr]+");")}we&&we!=="null"?Cn?_n():(Ve("if(",we,"){"),_n(),Ve("}else{"),hn(),Ve("}")):hn()}_r&&(typeof Lr!="number"||Lr>=0)?typeof Lr=="string"?(Ve("if(",Lr,">0){"),an(),Ve("}else if(",Lr,"<0){"),xn(),Ve("}")):an():xn()}function ni(Se,oe,Ve,at,Mt){var Ye=ri(),Fe=Ye.proc("body",Mt);return ge.optional(function(){Ye.commandStr=oe.commandStr,Ye.command=Ye.link(oe.commandStr)}),_r&&(Ye.instancing=Fe.def(Ye.shared.extensions,".angle_instanced_arrays")),Se(Ye,Fe,Ve,at),Ye.compile().body}function Li(Se,oe,Ve,at){to(Se,oe),Ve.useVAO?Ve.drawVAO?oe(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,oe),");"):oe(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(oe(Se.shared.vao,".setVAO(null);"),Vo(Se,oe,Ve,at.attributes,function(){return!0})),Yi(Se,oe,Ve,at.uniforms,function(){return!0},!1),ns(Se,oe,oe,Ve)}function sa(Se,oe){var Ve=Se.proc("draw",1);to(Se,Ve),bo(Se,Ve,oe.context),$o(Se,Ve,oe.framebuffer),Zo(Se,Ve,oe),rs(Se,Ve,oe.state),_i(Se,Ve,oe,!1,!0);var at=oe.shader.progVar.append(Se,Ve);if(Ve(Se.shared.gl,".useProgram(",at,".program);"),oe.shader.program)Li(Se,Ve,oe,oe.shader.program);else{Ve(Se.shared.vao,".setVAO(null);");var Mt=Se.global.def("{}"),Ye=Ve.def(at,".id"),Fe=Ve.def(Mt,"[",Ye,"]");Ve(Se.cond(Fe).then(Fe,".call(this,a0);").else(Fe,"=",Mt,"[",Ye,"]=",Se.link(function(et){return ni(Li,Se,oe,et,1)}),"(",at,");",Fe,".call(this,a0);"))}Object.keys(oe.state).length>0&&Ve(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ve(Se.shared.vao,".setVAO(null);")}function Eo(Se,oe,Ve,at){Se.batchId="a1",to(Se,oe);function Mt(){return!0}Vo(Se,oe,Ve,at.attributes,Mt),Yi(Se,oe,Ve,at.uniforms,Mt,!1),ns(Se,oe,oe,Ve)}function Sl(Se,oe,Ve,at){to(Se,oe);var Mt=Ve.contextDep,Ye=oe.def(),Fe="a0",et="a1",xe=oe.def();Se.shared.props=xe,Se.batchId=Ye;var ze=Se.scope(),we=Se.scope();oe(ze.entry,"for(",Ye,"=0;",Ye,"<",et,";++",Ye,"){",xe,"=",Fe,"[",Ye,"];",we,"}",ze.exit);function ot(Rr){return Rr.contextDep&&Mt||Rr.propDep}function _t(Rr){return!ot(Rr)}if(Ve.needsContext&&bo(Se,we,Ve.context),Ve.needsFramebuffer&&$o(Se,we,Ve.framebuffer),rs(Se,we,Ve.state,ot),Ve.profile&&ot(Ve.profile)&&_i(Se,we,Ve,!1,!0),at)Ve.useVAO?Ve.drawVAO?ot(Ve.drawVAO)?we(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,we),");"):ze(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,ze),");"):ze(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(ze(Se.shared.vao,".setVAO(null);"),Vo(Se,ze,Ve,at.attributes,_t),Vo(Se,we,Ve,at.attributes,ot)),Yi(Se,ze,Ve,at.uniforms,_t,!1),Yi(Se,we,Ve,at.uniforms,ot,!0),ns(Se,ze,we,Ve);else{var hr=Se.global.def("{}"),zr=Ve.shader.progVar.append(Se,we),Lr=we.def(zr,".id"),Qr=we.def(hr,"[",Lr,"]");we(Se.shared.gl,".useProgram(",zr,".program);","if(!",Qr,"){",Qr,"=",hr,"[",Lr,"]=",Se.link(function(Rr){return ni(Eo,Se,Ve,Rr,2)}),"(",zr,");}",Qr,".call(this,a0[",Ye,"],",Ye,");")}}function Te(Se,oe){var Ve=Se.proc("batch",2);Se.batchId="0",to(Se,Ve);var at=!1,Mt=!0;Object.keys(oe.context).forEach(function(hr){at=at||oe.context[hr].propDep}),at||(bo(Se,Ve,oe.context),Mt=!1);var Ye=oe.framebuffer,Fe=!1;Ye?(Ye.propDep?at=Fe=!0:Ye.contextDep&&at&&(Fe=!0),Fe||$o(Se,Ve,Ye)):$o(Se,Ve,null),oe.state.viewport&&oe.state.viewport.propDep&&(at=!0);function et(hr){return hr.contextDep&&at||hr.propDep}Zo(Se,Ve,oe),rs(Se,Ve,oe.state,function(hr){return!et(hr)}),(!oe.profile||!et(oe.profile))&&_i(Se,Ve,oe,!1,"a1"),oe.contextDep=at,oe.needsContext=Mt,oe.needsFramebuffer=Fe;var xe=oe.shader.progVar;if(xe.contextDep&&at||xe.propDep)Sl(Se,Ve,oe,null);else{var ze=xe.append(Se,Ve);if(Ve(Se.shared.gl,".useProgram(",ze,".program);"),oe.shader.program)Sl(Se,Ve,oe,oe.shader.program);else{Ve(Se.shared.vao,".setVAO(null);");var we=Se.global.def("{}"),ot=Ve.def(ze,".id"),_t=Ve.def(we,"[",ot,"]");Ve(Se.cond(_t).then(_t,".call(this,a0,a1);").else(_t,"=",we,"[",ot,"]=",Se.link(function(hr){return ni(Sl,Se,oe,hr,2)}),"(",ze,");",_t,".call(this,a0,a1);"))}}Object.keys(oe.state).length>0&&Ve(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ve(Se.shared.vao,".setVAO(null);")}function Dt(Se,oe){var Ve=Se.proc("scope",3);Se.batchId="a2";var at=Se.shared,Mt=at.current;bo(Se,Ve,oe.context),oe.framebuffer&&oe.framebuffer.append(Se,Ve),Ph(Object.keys(oe.state)).forEach(function(Fe){var et=oe.state[Fe],xe=et.append(Se,Ve);io(xe)?xe.forEach(function(ze,we){Ve.set(Se.next[Fe],"["+we+"]",ze)}):Ve.set(at.next,"."+Fe,xe)}),_i(Se,Ve,oe,!0,!0),[yu,jf,zc,gh,Uo].forEach(function(Fe){var et=oe.draw[Fe];!et||Ve.set(at.draw,"."+Fe,""+et.append(Se,Ve))}),Object.keys(oe.uniforms).forEach(function(Fe){var et=oe.uniforms[Fe].append(Se,Ve);Array.isArray(et)&&(et="["+et.join()+"]"),Ve.set(at.uniforms,"["+ve.id(Fe)+"]",et)}),Object.keys(oe.attributes).forEach(function(Fe){var et=oe.attributes[Fe].append(Se,Ve),xe=Se.scopeAttrib(Fe);Object.keys(new it).forEach(function(ze){Ve.set(xe,"."+ze,et[ze])})}),oe.scopeVAO&&Ve.set(at.vao,".targetVAO",oe.scopeVAO.append(Se,Ve));function Ye(Fe){var et=oe.shader[Fe];et&&Ve.set(at.shader,"."+Fe,et.append(Se,Ve))}Ye(qu),Ye(Nc),Object.keys(oe.state).length>0&&(Ve(Mt,".dirty=true;"),Ve.exit(Mt,".dirty=true;")),Ve("a1(",Se.shared.context,",a0,",Se.batchId,");")}function xt(Se){if(!(typeof Se!="object"||io(Se))){for(var oe=Object.keys(Se),Ve=0;Ve<oe.length;++Ve)if(En.isDynamic(Se[oe[Ve]]))return!0;return!1}}function vn(Se,oe,Ve){var at=oe.static[Ve];if(!at||!xt(at))return;var Mt=Se.global,Ye=Object.keys(at),Fe=!1,et=!1,xe=!1,ze=Se.global.def("{}");Ye.forEach(function(ot){var _t=at[ot];if(En.isDynamic(_t)){typeof _t=="function"&&(_t=at[ot]=En.unbox(_t));var hr=Us(_t,null);Fe=Fe||hr.thisDep,xe=xe||hr.propDep,et=et||hr.contextDep}else{switch(Mt(ze,".",ot,"="),typeof _t){case"number":Mt(_t);break;case"string":Mt('"',_t,'"');break;case"object":Array.isArray(_t)&&Mt("[",_t.join(),"]");break;default:Mt(Se.link(_t));break}Mt(";")}});function we(ot,_t){Ye.forEach(function(hr){var zr=at[hr];if(!!En.isDynamic(zr)){var Lr=ot.invoke(_t,zr);_t(ze,".",hr,"=",Lr,";")}})}oe.dynamic[Ve]=new En.DynamicVariable(Bo,{thisDep:Fe,contextDep:et,propDep:xe,ref:ze,append:we}),delete oe.static[Ve]}function Bi(Se,oe,Ve,at,Mt){var Ye=ri();Ye.stats=Ye.link(Mt),Object.keys(oe.static).forEach(function(et){vn(Ye,oe,et)}),xd.forEach(function(et){vn(Ye,Se,et)});var Fe=Ko(Se,oe,Ve,at,Ye);return sa(Ye,Fe),Dt(Ye,Fe),Te(Ye,Fe),v(Ye.compile(),{destroy:function(){Fe.shader.program.destroy()}})}return{next:Gr,current:Ir,procs:function(){var Se=ri(),oe=Se.proc("poll"),Ve=Se.proc("refresh"),at=Se.block();oe(at),Ve(at);var Mt=Se.shared,Ye=Mt.gl,Fe=Mt.next,et=Mt.current;at(et,".dirty=false;"),$o(Se,oe),$o(Se,Ve,null,!0);var xe;_r&&(xe=Se.link(_r)),Be.oes_vertex_array_object&&Ve(Se.link(Be.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ze=0;ze<Ot.maxAttributes;++ze){var we=Ve.def(Mt.attributes,"[",ze,"]"),ot=Se.cond(we,".buffer");ot.then(Ye,".enableVertexAttribArray(",ze,");",Ye,".bindBuffer(",Vc,",",we,".buffer.buffer);",Ye,".vertexAttribPointer(",ze,",",we,".size,",we,".type,",we,".normalized,",we,".stride,",we,".offset);").else(Ye,".disableVertexAttribArray(",ze,");",Ye,".vertexAttrib4f(",ze,",",we,".x,",we,".y,",we,".z,",we,".w);",we,".buffer=null;"),Ve(ot),_r&&Ve(xe,".vertexAttribDivisorANGLE(",ze,",",we,".divisor);")}return Ve(Se.shared.vao,".currentVAO=null;",Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"),Object.keys(tr).forEach(function(_t){var hr=tr[_t],zr=at.def(Fe,".",_t),Lr=Se.block();Lr("if(",zr,"){",Ye,".enable(",hr,")}else{",Ye,".disable(",hr,")}",et,".",_t,"=",zr,";"),Ve(Lr),oe("if(",zr,"!==",et,".",_t,"){",Lr,"}")}),Object.keys(rr).forEach(function(_t){var hr=rr[_t],zr=Ir[_t],Lr,Qr,Rr=Se.block();if(Rr(Ye,".",hr,"("),io(zr)){var Cn=zr.length;Lr=Se.global.def(Fe,".",_t),Qr=Se.global.def(et,".",_t),Rr(je(Cn,function(an){return Lr+"["+an+"]"}),");",je(Cn,function(an){return Qr+"["+an+"]="+Lr+"["+an+"];"}).join("")),oe("if(",je(Cn,function(an){return Lr+"["+an+"]!=="+Qr+"["+an+"]"}).join("||"),"){",Rr,"}")}else Lr=at.def(Fe,".",_t),Qr=at.def(et,".",_t),Rr(Lr,");",et,".",_t,"=",Lr,";"),oe("if(",Lr,"!==",Qr,"){",Rr,"}");Ve(Rr)}),Se.compile()}(),compile:Bi}}function Md(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Pd=34918,Id=34919,fp=35007,Od=function(B,ve){if(!ve.ext_disjoint_timer_query)return null;var Be=[];function Ot(){return Be.pop()||ve.ext_disjoint_timer_query.createQueryEXT()}function sr(_r){Be.push(_r)}var Tt=[];function er(_r){var Br=Ot();ve.ext_disjoint_timer_query.beginQueryEXT(fp,Br),Tt.push(Br),br(Tt.length-1,Tt.length,_r)}function $t(){ve.ext_disjoint_timer_query.endQueryEXT(fp)}function or(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var yr=[];function Tr(){return yr.pop()||new or}function Mr(_r){yr.push(_r)}var jr=[];function br(_r,Br,cr){var Ir=Tr();Ir.startQueryIndex=_r,Ir.endQueryIndex=Br,Ir.sum=0,Ir.stats=cr,jr.push(Ir)}var gr=[],it=[];function Gt(){var _r,Br,cr=Tt.length;if(cr!==0){it.length=Math.max(it.length,cr+1),gr.length=Math.max(gr.length,cr+1),gr[0]=0,it[0]=0;var Ir=0;for(_r=0,Br=0;Br<Tt.length;++Br){var Gr=Tt[Br];ve.ext_disjoint_timer_query.getQueryObjectEXT(Gr,Id)?(Ir+=ve.ext_disjoint_timer_query.getQueryObjectEXT(Gr,Pd),sr(Gr)):Tt[_r++]=Gr,gr[Br+1]=Ir,it[Br+1]=_r}for(Tt.length=_r,_r=0,Br=0;Br<jr.length;++Br){var Bn=jr[Br],tr=Bn.startQueryIndex,rr=Bn.endQueryIndex;Bn.sum+=gr[rr]-gr[tr];var fn=it[tr],Nr=it[rr];Nr===fn?(Bn.stats.gpuTime+=Bn.sum/1e6,Mr(Bn)):(Bn.startQueryIndex=fn,Bn.endQueryIndex=Nr,jr[_r++]=Bn)}jr.length=_r}}return{beginQuery:er,endQuery:$t,pushScopeStats:br,update:Gt,getNumPendingQueries:function(){return Tt.length},clear:function(){Be.push.apply(Be,Tt);for(var _r=0;_r<Be.length;_r++)ve.ext_disjoint_timer_query.deleteQueryEXT(Be[_r]);Tt.length=0,Be.length=0},restore:function(){Tt.length=0,Be.length=0}}},Rd=16384,Ef=256,Wp=1024,hp=34962,Qf="webglcontextlost",Ia="webglcontextrestored",pp=1,El=2,Yc=3;function dp(B,ve){for(var Be=0;Be<B.length;++Be)if(B[Be]===ve)return Be;return-1}function Xp(B){var ve=ye(B);if(!ve)return null;var Be=ve.gl,Ot=Be.getContextAttributes(),sr=Be.isContextLost(),Tt=ke(Be,ve);if(!Tt)return null;var er=ps(),$t=Md(),or=Tt.extensions,yr=Od(Be,or),Tr=ja(),Mr=Be.drawingBufferWidth,jr=Be.drawingBufferHeight,br={tick:0,time:0,viewportWidth:Mr,viewportHeight:jr,framebufferWidth:Mr,framebufferHeight:jr,drawingBufferWidth:Mr,drawingBufferHeight:jr,pixelRatio:ve.pixelRatio},gr={},it={elements:null,primitive:4,count:-1,offset:0,instances:-1},Gt=Uu(Be,or),_r=F(Be,$t,ve,Ir),Br=nl(Be,or,_r,$t),cr=mt(Be,or,Gt,$t,_r,Br,it);function Ir(ni){return cr.destroyBuffer(ni)}var Gr=kr(Be,er,$t,ve),Bn=Rs(Be,or,Gt,function(){fn.procs.poll()},br,$t,ve),tr=uc(Be,or,Gt,$t,ve),rr=Ce(Be,or,Gt,Bn,tr,$t),fn=Hp(Be,er,or,Gt,_r,Br,Bn,rr,gr,cr,Gr,it,br,yr,ve),Nr=zn(Be,rr,fn.procs.poll,br,Ot,or,Gt),Er=fn.next,Ur=Be.canvas,Xr=[],mi=[],ri=[],Yr=[ve.onDestroy],rn=null;function Yn(){if(Xr.length===0){yr&&yr.update(),rn=null;return}rn=Oi.next(Yn),to();for(var ni=Xr.length-1;ni>=0;--ni){var Li=Xr[ni];Li&&Li(br,null,0)}Be.flush(),yr&&yr.update()}function hi(){!rn&&Xr.length>0&&(rn=Oi.next(Yn))}function Fi(){rn&&(Oi.cancel(Yn),rn=null)}function Xa(ni){ni.preventDefault(),sr=!0,Fi(),mi.forEach(function(Li){Li()})}function uo(ni){Be.getError(),sr=!1,Tt.restore(),Gr.restore(),_r.restore(),Bn.restore(),tr.restore(),rr.restore(),cr.restore(),yr&&yr.restore(),fn.procs.refresh(),hi(),ri.forEach(function(Li){Li()})}var ki=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!ki&&Ur&&(Ur.addEventListener(Qf,Xa,!1),Ur.addEventListener(Ia,uo,!1));function qo(){Xr.length=0,Fi(),!ki&&Ur&&(Ur.removeEventListener(Qf,Xa),Ur.removeEventListener(Ia,uo)),Gr.clear(),rr.clear(),tr.clear(),cr.clear(),Bn.clear(),Br.clear(),_r.clear(),yr&&yr.clear(),Yr.forEach(function(ni){ni()})}function za(ni){ge(!!ni,"invalid args to regl({...})"),ge.type(ni,"object","invalid args to regl({...})");function Li(Ye){var Fe=v({},Ye);delete Fe.uniforms,delete Fe.attributes,delete Fe.context,delete Fe.vao,"stencil"in Fe&&Fe.stencil.op&&(Fe.stencil.opBack=Fe.stencil.opFront=Fe.stencil.op,delete Fe.stencil.op);function et(xe){if(xe in Fe){var ze=Fe[xe];delete Fe[xe],Object.keys(ze).forEach(function(we){Fe[xe+"."+we]=ze[we]})}}return et("blend"),et("depth"),et("cull"),et("stencil"),et("polygonOffset"),et("scissor"),et("sample"),"vao"in Ye&&(Fe.vao=Ye.vao),Fe}function sa(Ye,Fe){var et={},xe={};return Object.keys(Ye).forEach(function(ze){var we=Ye[ze];if(En.isDynamic(we)){xe[ze]=En.unbox(we,ze);return}else if(Fe&&Array.isArray(we)){for(var ot=0;ot<we.length;++ot)if(En.isDynamic(we[ot])){xe[ze]=En.unbox(we,ze);return}}et[ze]=we}),{dynamic:xe,static:et}}var Eo=sa(ni.context||{},!0),Sl=sa(ni.uniforms||{},!0),Te=sa(ni.attributes||{},!1),Dt=sa(Li(ni),!1),xt={gpuTime:0,cpuTime:0,count:0},vn=fn.compile(Dt,Te,Sl,Eo,xt),Bi=vn.draw,Se=vn.batch,oe=vn.scope,Ve=[];function at(Ye){for(;Ve.length<Ye;)Ve.push(null);return Ve}function Mt(Ye,Fe){var et;if(sr&&ge.raise("context lost"),typeof Ye=="function")return oe.call(this,null,Ye,0);if(typeof Fe=="function")if(typeof Ye=="number")for(et=0;et<Ye;++et)oe.call(this,null,Fe,et);else if(Array.isArray(Ye))for(et=0;et<Ye.length;++et)oe.call(this,Ye[et],Fe,et);else return oe.call(this,Ye,Fe,0);else if(typeof Ye=="number"){if(Ye>0)return Se.call(this,at(Ye|0),Ye|0)}else if(Array.isArray(Ye)){if(Ye.length)return Se.call(this,Ye,Ye.length)}else return Bi.call(this,Ye)}return v(Mt,{stats:xt,destroy:function(){vn.destroy()}})}var Ko=rr.setFBO=za({framebuffer:En.define.call(null,pp,"framebuffer")});function bo(ni,Li){var sa=0;fn.procs.poll();var Eo=Li.color;Eo&&(Be.clearColor(+Eo[0]||0,+Eo[1]||0,+Eo[2]||0,+Eo[3]||0),sa|=Rd),"depth"in Li&&(Be.clearDepth(+Li.depth),sa|=Ef),"stencil"in Li&&(Be.clearStencil(Li.stencil|0),sa|=Wp),ge(!!sa,"called regl.clear with no buffer specified"),Be.clear(sa)}function $o(ni){if(ge(typeof ni=="object"&&ni,"regl.clear() takes an object as input"),"framebuffer"in ni)if(ni.framebuffer&&ni.framebuffer_reglType==="framebufferCube")for(var Li=0;Li<6;++Li)Ko(v({framebuffer:ni.framebuffer.faces[Li]},ni),bo);else Ko(ni,bo);else bo(null,ni)}function Zo(ni){ge.type(ni,"function","regl.frame() callback must be a function"),Xr.push(ni);function Li(){var sa=dp(Xr,ni);ge(sa>=0,"cannot cancel a frame twice");function Eo(){var Sl=dp(Xr,Eo);Xr[Sl]=Xr[Xr.length-1],Xr.length-=1,Xr.length<=0&&Fi()}Xr[sa]=Eo}return hi(),{cancel:Li}}function rs(){var ni=Er.viewport,Li=Er.scissor_box;ni[0]=ni[1]=Li[0]=Li[1]=0,br.viewportWidth=br.framebufferWidth=br.drawingBufferWidth=ni[2]=Li[2]=Be.drawingBufferWidth,br.viewportHeight=br.framebufferHeight=br.drawingBufferHeight=ni[3]=Li[3]=Be.drawingBufferHeight}function to(){br.tick+=1,br.time=Vo(),rs(),fn.procs.poll()}function _i(){Bn.refresh(),rs(),fn.procs.refresh(),yr&&yr.update()}function Vo(){return(ja()-Tr)/1e3}_i();function Yi(ni,Li){ge.type(Li,"function","listener callback must be a function");var sa;switch(ni){case"frame":return Zo(Li);case"lost":sa=mi;break;case"restore":sa=ri;break;case"destroy":sa=Yr;break;default:ge.raise("invalid event, must be one of frame,lost,restore,destroy")}return sa.push(Li),{cancel:function(){for(var Eo=0;Eo<sa.length;++Eo)if(sa[Eo]===Li){sa[Eo]=sa[sa.length-1],sa.pop();return}}}}var ns=v(za,{clear:$o,prop:En.define.bind(null,pp),context:En.define.bind(null,El),this:En.define.bind(null,Yc),draw:za({}),buffer:function(ni){return _r.create(ni,hp,!1,!1)},elements:function(ni){return Br.create(ni,!1)},texture:Bn.create2D,cube:Bn.createCube,renderbuffer:tr.create,framebuffer:rr.create,framebufferCube:rr.createCube,vao:cr.createVAO,attributes:Ot,frame:Zo,on:Yi,limits:Gt,hasExtension:function(ni){return Gt.extensions.indexOf(ni.toLowerCase())>=0},read:Nr,destroy:qo,_gl:Be,_refresh:_i,poll:function(){to(),yr&&yr.update()},now:Vo,stats:$t});return ve.onDone(null,ns),ns}return Xp})},96874:function(It){function $(V,ce,pe){switch(pe.length){case 0:return V.call(ce);case 1:return V.call(ce,pe[0]);case 2:return V.call(ce,pe[0],pe[1]);case 3:return V.call(ce,pe[0],pe[1],pe[2])}return V.apply(ce,pe)}It.exports=$},47443:function(It,$,V){var ce=V(42118);function pe(v,de){var U=v==null?0:v.length;return!!U&&ce(v,de,0)>-1}It.exports=pe},1196:function(It){function $(V,ce,pe){for(var v=-1,de=V==null?0:V.length;++v<de;)if(pe(ce,V[v]))return!0;return!1}It.exports=$},62663:function(It){function $(V,ce,pe,v){var de=-1,U=V==null?0:V.length;for(v&&U&&(pe=V[++de]);++de<U;)pe=ce(pe,V[de],de,V);return pe}It.exports=$},44286:function(It){function $(V){return V.split("")}It.exports=$},49029:function(It){var $=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function V(ce){return ce.match($)||[]}It.exports=V},86556:function(It,$,V){var ce=V(89465),pe=V(77813);function v(de,U,te){(te!==void 0&&!pe(de[U],te)||te===void 0&&!(U in de))&&ce(de,U,te)}It.exports=v},29750:function(It){function $(V,ce,pe){return V===V&&(pe!==void 0&&(V=V<=pe?V:pe),ce!==void 0&&(V=V>=ce?V:ce)),V}It.exports=$},41848:function(It){function $(V,ce,pe,v){for(var de=V.length,U=pe+(v?1:-1);v?U--:++U<de;)if(ce(V[U],U,V))return U;return-1}It.exports=$},42118:function(It,$,V){var ce=V(41848),pe=V(62722),v=V(42351);function de(U,te,se){return te===te?v(U,te,se):ce(U,pe,se)}It.exports=de},62722:function(It){function $(V){return V!==V}It.exports=$},42980:function(It,$,V){var ce=V(46384),pe=V(86556),v=V(28483),de=V(59783),U=V(13218),te=V(81704),se=V(36390);function Re(he,$e,tt,gt,Jt){he!==$e&&v($e,function(ir,yt){if(Jt||(Jt=new ce),U(ir))de(he,$e,yt,tt,Re,gt,Jt);else{var Qt=gt?gt(se(he,yt),ir,yt+"",he,$e,Jt):void 0;Qt===void 0&&(Qt=ir),pe(he,yt,Qt)}},te)}It.exports=Re},59783:function(It,$,V){var ce=V(86556),pe=V(64626),v=V(77133),de=V(278),U=V(38517),te=V(35694),se=V(1469),Re=V(29246),he=V(44144),$e=V(23560),tt=V(13218),gt=V(68630),Jt=V(36719),ir=V(36390),yt=V(59881);function Qt(Ct,st,ht,Wt,X,Xt,ft){var He=ir(Ct,ht),lt=ir(st,ht),Qe=ft.get(lt);if(Qe){ce(Ct,ht,Qe);return}var Ut=Xt?Xt(He,lt,ht+"",Ct,st,ft):void 0,xr=Ut===void 0;if(xr){var Dr=se(lt),Kr=!Dr&&he(lt),Me=!Dr&&!Kr&&Jt(lt);Ut=lt,Dr||Kr||Me?se(He)?Ut=He:Re(He)?Ut=de(He):Kr?(xr=!1,Ut=pe(lt,!0)):Me?(xr=!1,Ut=v(lt,!0)):Ut=[]:gt(lt)||te(lt)?(Ut=He,te(He)?Ut=yt(He):(!tt(He)||$e(He))&&(Ut=U(lt))):xr=!1}xr&&(ft.set(lt,Ut),X(Ut,lt,Wt,Xt,ft),ft.delete(lt)),ce(Ct,ht,Ut)}It.exports=Qt},18674:function(It){function $(V){return function(ce){return V==null?void 0:V[ce]}}It.exports=$},5976:function(It,$,V){var ce=V(6557),pe=V(45357),v=V(30061);function de(U,te){return v(pe(U,te,ce),U+"")}It.exports=de},56560:function(It,$,V){var ce=V(75703),pe=V(38777),v=V(6557),de=pe?function(U,te){return pe(U,"toString",{configurable:!0,enumerable:!1,value:ce(te),writable:!0})}:v;It.exports=de},14259:function(It){function $(V,ce,pe){var v=-1,de=V.length;ce<0&&(ce=-ce>de?0:de+ce),pe=pe>de?de:pe,pe<0&&(pe+=de),de=ce>pe?0:pe-ce>>>0,ce>>>=0;for(var U=Array(de);++v<de;)U[v]=V[v+ce];return U}It.exports=$},45652:function(It,$,V){var ce=V(88668),pe=V(47443),v=V(1196),de=V(74757),U=V(23593),te=V(21814),se=200;function Re(he,$e,tt){var gt=-1,Jt=pe,ir=he.length,yt=!0,Qt=[],Ct=Qt;if(tt)yt=!1,Jt=v;else if(ir>=se){var st=$e?null:U(he);if(st)return te(st);yt=!1,Jt=de,Ct=new ce}else Ct=$e?[]:Qt;e:for(;++gt<ir;){var ht=he[gt],Wt=$e?$e(ht):ht;if(ht=tt||ht!==0?ht:0,yt&&Wt===Wt){for(var X=Ct.length;X--;)if(Ct[X]===Wt)continue e;$e&&Ct.push(Wt),Qt.push(ht)}else Jt(Ct,Wt,tt)||(Ct!==Qt&&Ct.push(Wt),Qt.push(ht))}return Qt}It.exports=Re},40180:function(It,$,V){var ce=V(14259);function pe(v,de,U){var te=v.length;return U=U===void 0?te:U,!de&&U>=te?v:ce(v,de,U)}It.exports=pe},21463:function(It,$,V){var ce=V(5976),pe=V(16612);function v(de){return ce(function(U,te){var se=-1,Re=te.length,he=Re>1?te[Re-1]:void 0,$e=Re>2?te[2]:void 0;for(he=de.length>3&&typeof he=="function"?(Re--,he):void 0,$e&&pe(te[0],te[1],$e)&&(he=Re<3?void 0:he,Re=1),U=Object(U);++se<Re;){var tt=te[se];tt&&de(U,tt,se,he)}return U})}It.exports=v},98805:function(It,$,V){var ce=V(40180),pe=V(62689),v=V(83140),de=V(79833);function U(te){return function(se){se=de(se);var Re=pe(se)?v(se):void 0,he=Re?Re[0]:se.charAt(0),$e=Re?ce(Re,1).join(""):se.slice(1);return he[te]()+$e}}It.exports=U},35393:function(It,$,V){var ce=V(62663),pe=V(53816),v=V(58748),de="['\u2019]",U=RegExp(de,"g");function te(se){return function(Re){return ce(v(pe(Re).replace(U,"")),se,"")}}It.exports=te},23593:function(It,$,V){var ce=V(58525),pe=V(50308),v=V(21814),de=1/0,U=ce&&1/v(new ce([,-0]))[1]==de?function(te){return new ce(te)}:pe;It.exports=U},69389:function(It,$,V){var ce=V(18674),pe={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=ce(pe);It.exports=v},62689:function(It){var $="\\ud800-\\udfff",V="\\u0300-\\u036f",ce="\\ufe20-\\ufe2f",pe="\\u20d0-\\u20ff",v=V+ce+pe,de="\\ufe0e\\ufe0f",U="\\u200d",te=RegExp("["+U+$+v+de+"]");function se(Re){return te.test(Re)}It.exports=se},93157:function(It){var $=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function V(ce){return $.test(ce)}It.exports=V},16612:function(It,$,V){var ce=V(77813),pe=V(98612),v=V(65776),de=V(13218);function U(te,se,Re){if(!de(Re))return!1;var he=typeof se;return(he=="number"?pe(Re)&&v(se,Re.length):he=="string"&&se in Re)?ce(Re[se],te):!1}It.exports=U},45357:function(It,$,V){var ce=V(96874),pe=Math.max;function v(de,U,te){return U=pe(U===void 0?de.length-1:U,0),function(){for(var se=arguments,Re=-1,he=pe(se.length-U,0),$e=Array(he);++Re<he;)$e[Re]=se[U+Re];Re=-1;for(var tt=Array(U+1);++Re<U;)tt[Re]=se[Re];return tt[U]=te($e),ce(de,this,tt)}}It.exports=v},36390:function(It){function $(V,ce){if(!(ce==="constructor"&&typeof V[ce]=="function")&&ce!="__proto__")return V[ce]}It.exports=$},30061:function(It,$,V){var ce=V(56560),pe=V(21275),v=pe(ce);It.exports=v},21275:function(It){var $=800,V=16,ce=Date.now;function pe(v){var de=0,U=0;return function(){var te=ce(),se=V-(te-U);if(U=te,se>0){if(++de>=$)return arguments[0]}else de=0;return v.apply(void 0,arguments)}}It.exports=pe},42351:function(It){function $(V,ce,pe){for(var v=pe-1,de=V.length;++v<de;)if(V[v]===ce)return v;return-1}It.exports=$},83140:function(It,$,V){var ce=V(44286),pe=V(62689),v=V(676);function de(U){return pe(U)?v(U):ce(U)}It.exports=de},676:function(It){var $="\\ud800-\\udfff",V="\\u0300-\\u036f",ce="\\ufe20-\\ufe2f",pe="\\u20d0-\\u20ff",v=V+ce+pe,de="\\ufe0e\\ufe0f",U="["+$+"]",te="["+v+"]",se="\\ud83c[\\udffb-\\udfff]",Re="(?:"+te+"|"+se+")",he="[^"+$+"]",$e="(?:\\ud83c[\\udde6-\\uddff]){2}",tt="[\\ud800-\\udbff][\\udc00-\\udfff]",gt="\\u200d",Jt=Re+"?",ir="["+de+"]?",yt="(?:"+gt+"(?:"+[he,$e,tt].join("|")+")"+ir+Jt+")*",Qt=ir+Jt+yt,Ct="(?:"+[he+te+"?",te,$e,tt,U].join("|")+")",st=RegExp(se+"(?="+se+")|"+Ct+Qt,"g");function ht(Wt){return Wt.match(st)||[]}It.exports=ht},2757:function(It){var $="\\ud800-\\udfff",V="\\u0300-\\u036f",ce="\\ufe20-\\ufe2f",pe="\\u20d0-\\u20ff",v=V+ce+pe,de="\\u2700-\\u27bf",U="a-z\\xdf-\\xf6\\xf8-\\xff",te="\\xac\\xb1\\xd7\\xf7",se="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Re="\\u2000-\\u206f",he=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",$e="A-Z\\xc0-\\xd6\\xd8-\\xde",tt="\\ufe0e\\ufe0f",gt=te+se+Re+he,Jt="['\u2019]",ir="["+gt+"]",yt="["+v+"]",Qt="\\d+",Ct="["+de+"]",st="["+U+"]",ht="[^"+$+gt+Qt+de+U+$e+"]",Wt="\\ud83c[\\udffb-\\udfff]",X="(?:"+yt+"|"+Wt+")",Xt="[^"+$+"]",ft="(?:\\ud83c[\\udde6-\\uddff]){2}",He="[\\ud800-\\udbff][\\udc00-\\udfff]",lt="["+$e+"]",Qe="\\u200d",Ut="(?:"+st+"|"+ht+")",xr="(?:"+lt+"|"+ht+")",Dr="(?:"+Jt+"(?:d|ll|m|re|s|t|ve))?",Kr="(?:"+Jt+"(?:D|LL|M|RE|S|T|VE))?",Me=X+"?",A="["+tt+"]?",_e="(?:"+Qe+"(?:"+[Xt,ft,He].join("|")+")"+A+Me+")*",Et="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",dt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ft=A+Me+_e,qt="(?:"+[Ct,ft,He].join("|")+")"+Ft,Sr=RegExp([lt+"?"+st+"+"+Dr+"(?="+[ir,lt,"$"].join("|")+")",xr+"+"+Kr+"(?="+[ir,lt+Ut,"$"].join("|")+")",lt+"?"+Ut+"+"+Dr,lt+"+"+Kr,dt,Et,Qt,qt].join("|"),"g");function Qn(gn){return gn.match(Sr)||[]}It.exports=Qn},68929:function(It,$,V){var ce=V(48403),pe=V(35393),v=pe(function(de,U,te){return U=U.toLowerCase(),de+(te?ce(U):U)});It.exports=v},48403:function(It,$,V){var ce=V(79833),pe=V(11700);function v(de){return pe(ce(de).toLowerCase())}It.exports=v},74691:function(It,$,V){var ce=V(29750),pe=V(14841);function v(de,U,te){return te===void 0&&(te=U,U=void 0),te!==void 0&&(te=pe(te),te=te===te?te:0),U!==void 0&&(U=pe(U),U=U===U?U:0),ce(pe(de),U,te)}It.exports=v},75703:function(It){function $(V){return function(){return V}}It.exports=$},53816:function(It,$,V){var ce=V(69389),pe=V(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,de="\\u0300-\\u036f",U="\\ufe20-\\ufe2f",te="\\u20d0-\\u20ff",se=de+U+te,Re="["+se+"]",he=RegExp(Re,"g");function $e(tt){return tt=pe(tt),tt&&tt.replace(v,ce).replace(he,"")}It.exports=$e},29246:function(It,$,V){var ce=V(98612),pe=V(37005);function v(de){return pe(de)&&ce(de)}It.exports=v},14293:function(It){function $(V){return V==null}It.exports=$},81763:function(It,$,V){var ce=V(44239),pe=V(37005),v="[object Number]";function de(U){return typeof U=="number"||pe(U)&&ce(U)==v}It.exports=de},82492:function(It,$,V){var ce=V(42980),pe=V(21463),v=pe(function(de,U,te){ce(de,U,te)});It.exports=v},30236:function(It,$,V){var ce=V(42980),pe=V(21463),v=pe(function(de,U,te,se){ce(de,U,te,se)});It.exports=v},50308:function(It){function $(){}It.exports=$},59881:function(It,$,V){var ce=V(98363),pe=V(81704);function v(de){return ce(de,pe(de))}It.exports=v},44908:function(It,$,V){var ce=V(45652);function pe(v){return v&&v.length?ce(v):[]}It.exports=pe},11700:function(It,$,V){var ce=V(98805),pe=ce("toUpperCase");It.exports=pe},58748:function(It,$,V){var ce=V(49029),pe=V(93157),v=V(79833),de=V(2757);function U(te,se,Re){return te=v(te),se=Re?void 0:se,se===void 0?pe(te)?de(te):ce(te):te.match(se)||[]}It.exports=U},6158:function(It){(function($,V){It.exports=V()})(this,function(){"use strict";var $,V,ce;function pe(v,de){if(!$)$=de;else if(!V)V=de;else{var U="var sharedChunk = {}; ("+$+")(sharedChunk); ("+V+")(sharedChunk);",te={};$(te),ce=de(te),typeof window!="undefined"&&(ce.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}return pe(["exports"],function(v){"use strict";function de(t,o){return t(o={exports:{}},o.exports),o.exports}var U=te;function te(t,o,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=u,this.p2y=p}te.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},te.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},te.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},te.prototype.solveCurveX=function(t,o){var u,p,g,x,S;for(o===void 0&&(o=1e-6),g=t,S=0;S<8;S++){if(x=this.sampleCurveX(g)-t,Math.abs(x)<o)return g;var P=this.sampleCurveDerivativeX(g);if(Math.abs(P)<1e-6)break;g-=x/P}if((g=t)<(u=0))return u;if(g>(p=1))return p;for(;u<p;){if(x=this.sampleCurveX(g),Math.abs(x-t)<o)return g;t>x?u=g:p=g,g=.5*(p-u)+u}return g},te.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var se=Re;function Re(t,o){this.x=t,this.y=o}Re.prototype={clone:function(){return new Re(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(t,o){var u=Math.cos(t),p=Math.sin(t),g=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Re.convert=function(t){return t instanceof Re?t:Array.isArray(t)?new Re(t[0],t[1]):t};var he=typeof self!="undefined"?self:{},$e=Math.pow(2,53)-1;function tt(t,o,u,p){var g=new U(t,o,u,p);return function(x){return g.solve(x)}}var gt=tt(.25,.1,.25,1);function Jt(t,o,u){return Math.min(u,Math.max(o,t))}function ir(t,o,u){var p=u-o,g=((t-o)%p+p)%p+o;return g===o?u:g}function yt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,g=o;p<g.length;p+=1){var x=g[p];for(var S in x)t[S]=x[S]}return t}var Qt=1;function Ct(){return Qt++}function st(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function ht(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Wt(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function X(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Xt(t,o,u){var p={};for(var g in t)p[g]=o.call(u||this,t[g],g,t);return p}function ft(t,o,u){var p={};for(var g in t)o.call(u||this,t[g],g,t)&&(p[g]=t[g]);return p}function He(t){return Array.isArray(t)?t.map(He):typeof t=="object"&&t?Xt(t,He):t}var lt={};function Qe(t){lt[t]||(typeof console!="undefined"&&console.warn(t),lt[t]=!0)}function Ut(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function xr(t){for(var o=0,u=0,p=t.length,g=p-1,x=void 0,S=void 0;u<p;g=u++)o+=((S=t[g]).x-(x=t[u]).x)*(x.y+S.y);return o}function Dr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Kr(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,g,x,S){var P=x||S;return o[g]=!P||P.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var Me=null;function A(t){if(Me==null){var o=t.navigator?t.navigator.userAgent:null;Me=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Me}function _e(t){try{var o=he[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var Et,dt,Ft,qt,Sr=he.performance&&he.performance.now?he.performance.now.bind(he.performance):Date.now.bind(Date),Qn=he.requestAnimationFrame||he.mozRequestAnimationFrame||he.webkitRequestAnimationFrame||he.msRequestAnimationFrame,gn=he.cancelAnimationFrame||he.mozCancelAnimationFrame||he.webkitCancelAnimationFrame||he.msCancelAnimationFrame,ea={now:Sr,frame:function(t){var o=Qn(t);return{cancel:function(){return gn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=he.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return Et||(Et=he.document.createElement("a")),Et.href=t,Et.href},hardwareConcurrency:he.navigator&&he.navigator.hardwareConcurrency||4,get devicePixelRatio(){return he.devicePixelRatio},get prefersReducedMotion(){return!!he.matchMedia&&(dt==null&&(dt=he.matchMedia("(prefers-reduced-motion: reduce)")),dt.matches)}},wn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ii={supported:!1,testSupport:function(t){!Si&&qt&&(si?Wn(t):Ft=t)}},Si=!1,si=!1;function Wn(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,qt),t.isContextLost())return;ii.supported=!0}catch(u){}t.deleteTexture(o),Si=!0}he.document&&((qt=he.document.createElement("img")).onload=function(){Ft&&Wn(Ft),Ft=null,si=!0},qt.onerror=function(){Si=!0,Ft=null},qt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ma="01",zi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function ji(t){return t.indexOf("mapbox:")===0}zi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ma,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},zi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},zi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},zi.prototype.normalizeStyleURL=function(t,o){if(!ji(t))return t;var u=Va(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},zi.prototype.normalizeGlyphsURL=function(t,o){if(!ji(t))return t;var u=Va(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},zi.prototype.normalizeSourceURL=function(t,o){if(!ji(t))return t;var u=Va(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},zi.prototype.normalizeSpriteURL=function(t,o,u,p){var g=Va(t);return ji(t)?(g.path="/styles/v1"+g.path+"/sprite"+o+u,this._makeAPIURL(g,this._customAccessToken||p)):(g.path+=""+o+u,la(g))},zi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ji(t))return t;var u=Va(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(ea.devicePixelRatio>=2||o===512?"@2x":"")+(ii.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(g){for(var x=0,S=g;x<S.length;x+=1){var P=S[x].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(u.params)||wn.ACCESS_TOKEN;return wn.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},zi.prototype.canonicalizeTileURL=function(t,o){var u=Va(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var g=u.params;return o&&(g=g.filter(function(x){return!x.match(/^access_token=/)})),g.length&&(p+="?"+g.join("&")),p},zi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&ji(o),p=[],g=0,x=t.tiles||[];g<x.length;g+=1){var S=x[g];ga(S)?p.push(this.canonicalizeTileURL(S,u)):p.push(S)}return p},zi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=Va(wn.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!wn.REQUIRE_ACCESS_TOKEN)return la(t);if(!(o=o||wn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(x){return x.indexOf("access_token")===-1}),t.params.push("access_token="+o),la(t)};var Wi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ga(t){return Wi.test(t)}var vo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Va(t){var o=t.match(vo);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function la(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Ui(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(he.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var ra=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ra.prototype.getStorageKey=function(t){var o,u=Ui(wn.ACCESS_TOKEN);return o=u&&u.u?he.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,g){return String.fromCharCode(Number("0x"+g))})):wn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},ra.prototype.fetchEventData=function(){var t=_e("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var p=he.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var g=he.localStorage.getItem(u);g&&(this.anonId=g)}catch(x){Qe("Unable to read from LocalStorage")}},ra.prototype.saveEventData=function(){var t=_e("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{he.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&he.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){Qe("Unable to write to LocalStorage")}},ra.prototype.processRequests=function(t){},ra.prototype.postEvent=function(t,o,u,p){var g=this;if(wn.EVENTS_URL){var x=Va(wn.EVENTS_URL);x.params.push("access_token="+(p||wn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ma,userId:this.anonId},P=o?yt(S,o):S,L={url:la(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=ya(L,function(N){g.pendingRequest=null,u(N),g.saveEventData(),g.processRequests(p)})}},ra.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var qi,Ts,ge=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,g,x){this.skuToken=g,(wn.EVENTS_URL&&x||wn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return ji(S)||ga(S)}))&&this.queueRequest({id:p,timestamp:Date.now()},x)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var g=this.queue.shift(),x=g.id,S=g.timestamp;x&&this.success[x]||(this.anonId||this.fetchEventData(),ht(this.anonId)||(this.anonId=st()),this.postEvent(S,{skuToken:this.skuToken},function(P){P||x&&(p.success[x]=!0)},u))}},o}(ra),ui=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){wn.EVENTS_URL&&wn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(g){return ji(g)||ga(g)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var g=Ui(wn.ACCESS_TOKEN),x=g?g.u:wn.ACCESS_TOKEN,S=x!==this.eventData.tokenU;ht(this.anonId)||(this.anonId=st(),S=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var L=new Date(this.eventData.lastSuccess),N=new Date(P),Z=(P-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||L.getDate()!==N.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(G){G||(p.eventData.lastSuccess=P,p.eventData.tokenU=x)},u)}},o}(ra)),no=ui.postTurnstileEvent.bind(ui),ru=new ge,Vt=ru.postMapLoadEvent.bind(ru),ar=500,Ar=50;function on(){he.caches&&!qi&&(qi=he.caches.open("mapbox-tiles"))}function In(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Rn,bi=1/0;function gi(){return Rn==null&&(Rn=he.OffscreenCanvas&&new he.OffscreenCanvas(1,1).getContext("2d")&&typeof he.createImageBitmap=="function"),Rn}var En={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(En);var Oi=function(t){function o(u,p,g){p===401&&ga(g)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=p,this.url=g,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ii=Dr()?function(){return self.worker&&self.worker.referrer}:function(){return(he.location.protocol==="blob:"?he.parent:he).location.href},ja,ps,Ho=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Ii())&&!/^\w+:/.test(u))){if(he.fetch&&he.Request&&he.AbortController&&he.Request.prototype.hasOwnProperty("signal"))return function(p,g){var x,S=new he.AbortController,P=new he.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Ii(),signal:S.signal}),L=!1,N=!1,Z=(x=P.url).indexOf("sku=")>0&&ga(x);p.type==="json"&&P.headers.set("Accept","application/json");var G=function(ae,Ie,Le){if(!N){if(ae&&ae.message!=="SecurityError"&&Qe(ae),Ie&&Le)return Q(Ie);var We=Date.now();he.fetch(P).then(function(Ne){if(Ne.ok){var nt=Z?Ne.clone():null;return Q(Ne,nt,We)}return g(new Oi(Ne.statusText,Ne.status,p.url))}).catch(function(Ne){Ne.code!==20&&g(new Error(Ne.message))})}},Q=function(ae,Ie,Le){(p.type==="arrayBuffer"?ae.arrayBuffer():p.type==="json"?ae.json():ae.text()).then(function(We){N||(Ie&&Le&&function(Ne,nt,bt){if(on(),qi){var jt={status:nt.status,statusText:nt.statusText,headers:new he.Headers};nt.headers.forEach(function(ur,Cr){return jt.headers.set(Cr,ur)});var Ht=Kr(nt.headers.get("Cache-Control")||"");Ht["no-store"]||(Ht["max-age"]&&jt.headers.set("Expires",new Date(bt+1e3*Ht["max-age"]).toUTCString()),new Date(jt.headers.get("Expires")).getTime()-bt<42e4||function(ur,Cr){if(Ts===void 0)try{new Response(new ReadableStream),Ts=!0}catch(Hr){Ts=!1}Ts?Cr(ur.body):ur.blob().then(Cr)}(nt,function(ur){var Cr=new he.Response(ur,jt);on(),qi&&qi.then(function(Hr){return Hr.put(In(Ne.url),Cr)}).catch(function(Hr){return Qe(Hr.message)})}))}}(P,Ie,Le),L=!0,g(null,We,ae.headers.get("Cache-Control"),ae.headers.get("Expires")))}).catch(function(We){N||g(new Error(We.message))})};return Z?function(ae,Ie){if(on(),!qi)return Ie(null);var Le=In(ae.url);qi.then(function(We){We.match(Le).then(function(Ne){var nt=function(bt){if(!bt)return!1;var jt=new Date(bt.headers.get("Expires")||0),Ht=Kr(bt.headers.get("Cache-Control")||"");return jt>Date.now()&&!Ht["no-cache"]}(Ne);We.delete(Le),nt&&We.put(Le,Ne.clone()),Ie(null,Ne,nt)}).catch(Ie)}).catch(Ie)}(P,G):G(null,null),{cancel:function(){N=!0,L||S.abort()}}}(t,o);if(Dr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(p,g){var x=new he.XMLHttpRequest;for(var S in x.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(x.responseType="arraybuffer"),p.headers)x.setRequestHeader(S,p.headers[S]);return p.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=p.credentials==="include",x.onerror=function(){g(new Error(x.statusText))},x.onload=function(){if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){var P=x.response;if(p.type==="json")try{P=JSON.parse(x.response)}catch(L){return g(L)}g(null,P,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else g(new Oi(x.statusText,x.status,p.url))},x.send(p.body),{cancel:function(){return x.abort()}}}(t,o)},ka=function(t,o){return Ho(yt(t,{type:"arrayBuffer"}),o)},ya=function(t,o){return Ho(yt(t,{method:"POST"}),o)},j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ja=[],ps=0;var K=function(t,o){if(ii.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ps>=wn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return ja.push(u),u}ps++;var p=!1,g=function(){if(!p)for(p=!0,ps--;ja.length&&ps<wn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=ja.shift();S.cancelled||(S.cancel=K(S.requestParameters,S.callback).cancel)}},x=ka(t,function(S,P,L,N){g(),S?o(S):P&&(gi()?function(Z,G){var Q=new he.Blob([new Uint8Array(Z)],{type:"image/png"});he.createImageBitmap(Q).then(function(ae){G(null,ae)}).catch(function(ae){G(new Error("Could not load image because of "+ae.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,o):function(Z,G,Q,ae){var Ie=new he.Image,Le=he.URL;Ie.onload=function(){G(null,Ie),Le.revokeObjectURL(Ie.src),Ie.onload=null,he.requestAnimationFrame(function(){Ie.src=j})},Ie.onerror=function(){return G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var We=new he.Blob([new Uint8Array(Z)],{type:"image/png"});Ie.cacheControl=Q,Ie.expires=ae,Ie.src=Z.byteLength?Le.createObjectURL(We):j}(P,o,L,N))});return{cancel:function(){x.cancel(),g()}}};function re(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ye(t,o,u){if(u&&u[t]){var p=u[t].indexOf(o);p!==-1&&u[t].splice(p,1)}}var ke=function(t,o){o===void 0&&(o={}),yt(this,o),this.type=t},je=function(t){function o(u,p){p===void 0&&(p={}),t.call(this,"error",yt({error:u},p))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(ke),Je=function(){};Je.prototype.on=function(t,o){return this._listeners=this._listeners||{},re(t,o,this._listeners),this},Je.prototype.off=function(t,o){return ye(t,o,this._listeners),ye(t,o,this._oneTimeListeners),this},Je.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},re(t,o,this._oneTimeListeners),this},Je.prototype.fire=function(t,o){typeof t=="string"&&(t=new ke(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var p=0,g=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<g.length;p+=1)g[p].call(this,t);for(var x=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];x<S.length;x+=1){var P=S[x];ye(u,P,this._oneTimeListeners),P.call(this,t)}var L=this._eventedParent;L&&(yt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),L.fire(t))}else t instanceof je&&console.error(t.error);return this},Je.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Je.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},De=function(t,o,u,p){this.message=(t?t+": ":"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function vt(t){var o=t.value;return o?[new De(t.key,o,"constants have been deprecated as of v8")]:[]}function fr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,g=o;p<g.length;p+=1){var x=g[p];for(var S in x)t[S]=x[S]}return t}function Rt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Lt(t){if(Array.isArray(t))return t.map(Lt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Lt(t[u]);return o}return Rt(t)}var vr=function(t){function o(u,p){t.call(this,p),this.message=p,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),yn=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,p=o;u<p.length;u+=1){var g=p[u];this.bindings[g[0]]=g[1]}};yn.prototype.concat=function(t){return new yn(this,t)},yn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},yn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var ln={kind:"null"},wt={kind:"number"},nn={kind:"string"},Fr={kind:"boolean"},Vr={kind:"color"},di={kind:"object"},en={kind:"value"},Ai={kind:"collator"},Vn={kind:"formatted"},li={kind:"resolvedImage"};function Ci(t,o){return{kind:"array",itemType:t,N:o}}function Ei(t){if(t.kind==="array"){var o=Ei(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var Xn=[ln,wt,nn,Fr,Vr,Vn,di,Ci(en),li];function Bt(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Bt(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,p=Xn;u<p.length;u+=1)if(!Bt(p[u],o))return null}}return"Expected "+Ei(t)+" but found "+Ei(o)+" instead."}function Yt(t,o){return o.some(function(u){return u.kind===t.kind})}function Ki(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Jn=de(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(P){return(P=Math.round(P))<0?0:P>255?255:P}function g(P){return p(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function x(P){return(L=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:L>1?1:L;var L}function S(P,L,N){return N<0?N+=1:N>1&&(N-=1),6*N<1?P+(L-P)*N*6:2*N<1?L:3*N<2?P+(L-P)*(2/3-N)*6:P}try{o.parseCSSColor=function(P){var L,N=P.replace(/ /g,"").toLowerCase();if(N in u)return u[N].slice();if(N[0]==="#")return N.length===4?(L=parseInt(N.substr(1),16))>=0&&L<=4095?[(3840&L)>>4|(3840&L)>>8,240&L|(240&L)>>4,15&L|(15&L)<<4,1]:null:N.length===7&&(L=parseInt(N.substr(1),16))>=0&&L<=16777215?[(16711680&L)>>16,(65280&L)>>8,255&L,1]:null;var Z=N.indexOf("("),G=N.indexOf(")");if(Z!==-1&&G+1===N.length){var Q=N.substr(0,Z),ae=N.substr(Z+1,G-(Z+1)).split(","),Ie=1;switch(Q){case"rgba":if(ae.length!==4)return null;Ie=x(ae.pop());case"rgb":return ae.length!==3?null:[g(ae[0]),g(ae[1]),g(ae[2]),Ie];case"hsla":if(ae.length!==4)return null;Ie=x(ae.pop());case"hsl":if(ae.length!==3)return null;var Le=(parseFloat(ae[0])%360+360)%360/360,We=x(ae[1]),Ne=x(ae[2]),nt=Ne<=.5?Ne*(We+1):Ne+We-Ne*We,bt=2*Ne-nt;return[p(255*S(bt,nt,Le+1/3)),p(255*S(bt,nt,Le)),p(255*S(bt,nt,Le-1/3)),Ie];default:return null}}return null}}catch(P){}}).parseCSSColor,Di=function(t,o,u,p){p===void 0&&(p=1),this.r=t,this.g=o,this.b=u,this.a=p};Di.parse=function(t){if(t){if(t instanceof Di)return t;if(typeof t=="string"){var o=Jn(t);if(o)return new Di(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Di.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},Di.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1);var Sa=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Sa.prototype.compare=function(t,o){return this.collator.compare(t,o)},Sa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var bn=function(t,o,u,p,g){this.text=t,this.image=o,this.scale=u,this.fontStack=p,this.textColor=g},Wr=function(t){this.sections=t};Wr.fromString=function(t){return new Wr([new bn(t,null,null,null,null)])},Wr.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Wr.factory=function(t){return t instanceof Wr?t:Wr.fromString(t)},Wr.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Wr.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var g={};p.fontStack&&(g["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(g["font-scale"]=p.scale),p.textColor&&(g["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(g)}}return t};var At=function(t){this.name=t.name,this.available=t.available};function Ro(t,o,u,p){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,o,u,p]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function be(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Di||t instanceof Sa||t instanceof Wr||t instanceof At)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!be(u[o]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!be(t[p]))return!1;return!0}return!1}function $i(t){if(t===null)return ln;if(typeof t=="string")return nn;if(typeof t=="boolean")return Fr;if(typeof t=="number")return wt;if(t instanceof Di)return Vr;if(t instanceof Sa)return Ai;if(t instanceof Wr)return Vn;if(t instanceof At)return li;if(Array.isArray(t)){for(var o,u=t.length,p=0,g=t;p<g.length;p+=1){var x=$i(g[p]);if(o){if(o===x)continue;o=en;break}o=x}return Ci(o||en,u)}return di}function Au(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Di||t instanceof Wr||t instanceof At?t.toString():JSON.stringify(t)}At.prototype.toString=function(){return this.name},At.fromString=function(t){return t?new At({name:t,available:!1}):null},At.prototype.serialize=function(){return["image",this.name]};var $a=function(t,o){this.type=t,this.value=o};$a.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!be(t[1]))return o.error("invalid value");var u=t[1],p=$i(u),g=o.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new $a(p,u)},$a.prototype.evaluate=function(){return this.value},$a.prototype.eachChild=function(){},$a.prototype.outputDefined=function(){return!0},$a.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Di?["rgba"].concat(this.value.toArray()):this.value instanceof Wr?this.value.serialize():this.value};var _a=function(t){this.name="ExpressionEvaluationError",this.message=t};_a.prototype.toJSON=function(){return this.message};var La={string:nn,number:wt,boolean:Fr,object:di},ta=function(t,o){this.type=t,this.args=o};ta.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,p=1,g=t[0];if(g==="array"){var x,S;if(t.length>2){var P=t[1];if(typeof P!="string"||!(P in La)||P==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=La[P],p++}else x=en;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],p++}u=Ci(x,S)}else u=La[g];for(var L=[];p<t.length;p++){var N=o.parse(t[p],p,en);if(!N)return null;L.push(N)}return new ta(u,L)},ta.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Bt(this.type,$i(u)))return u;if(o===this.args.length-1)throw new _a("Expected value to be of type "+Ei(this.type)+", but found "+Ei($i(u))+" instead.")}return null},ta.prototype.eachChild=function(t){this.args.forEach(t)},ta.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ta.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(g){return g.serialize()}))};var ko=function(t){this.type=Vn,this.sections=t};ko.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],g=!1,x=1;x<=t.length-1;++x){var S=t[x];if(g&&typeof S=="object"&&!Array.isArray(S)){g=!1;var P=null;if(S["font-scale"]&&!(P=o.parse(S["font-scale"],1,wt)))return null;var L=null;if(S["text-font"]&&!(L=o.parse(S["text-font"],1,Ci(nn))))return null;var N=null;if(S["text-color"]&&!(N=o.parse(S["text-color"],1,Vr)))return null;var Z=p[p.length-1];Z.scale=P,Z.font=L,Z.textColor=N}else{var G=o.parse(t[x],1,en);if(!G)return null;var Q=G.type.kind;if(Q!=="string"&&Q!=="value"&&Q!=="null"&&Q!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:G,scale:null,font:null,textColor:null})}}return new ko(p)},ko.prototype.evaluate=function(t){return new Wr(this.sections.map(function(o){var u=o.content.evaluate(t);return $i(u)===li?new bn("",u,null,null,null):new bn(Au(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},ko.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},ko.prototype.outputDefined=function(){return!1},ko.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t.push(p.content.serialize());var g={};p.scale&&(g["font-scale"]=p.scale.serialize()),p.font&&(g["text-font"]=p.font.serialize()),p.textColor&&(g["text-color"]=p.textColor.serialize()),t.push(g)}return t};var Lo=function(t){this.type=li,this.input=t};Lo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,nn);return u?new Lo(u):o.error("No image name provided.")},Lo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=At.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Lo.prototype.eachChild=function(t){t(this.input)},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){return["image",this.input.serialize()]};var Tu={"to-boolean":Fr,"to-color":Vr,"to-number":wt,"to-string":nn},mo=function(t,o){this.type=t,this.args=o};mo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var p=Tu[u],g=[],x=1;x<t.length;x++){var S=o.parse(t[x],x,en);if(!S)return null;g.push(S)}return new mo(p,g)},mo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,p=0,g=this.args;p<g.length;p+=1){if(u=null,(o=g[p].evaluate(t))instanceof Di)return o;if(typeof o=="string"){var x=t.parseColor(o);if(x)return x}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":Ro(o[0],o[1],o[2],o[3])))return new Di(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new _a(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,P=0,L=this.args;P<L.length;P+=1){if((S=L[P].evaluate(t))===null)return 0;var N=Number(S);if(!isNaN(N))return N}throw new _a("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?Wr.fromString(Au(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?At.fromString(Au(this.args[0].evaluate(t))):Au(this.args[0].evaluate(t))},mo.prototype.eachChild=function(t){this.args.forEach(t)},mo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},mo.prototype.serialize=function(){if(this.type.kind==="formatted")return new ko([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Lo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var wo=["Unknown","Point","LineString","Polygon"],aa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};aa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},aa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?wo[this.feature.type]:this.feature.type:null},aa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},aa.prototype.canonicalID=function(){return this.canonical},aa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},aa.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Di.parse(t)),o};var Ga=function(t,o,u,p){this.name=t,this.type=o,this._evaluate=u,this.args=p};Ga.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ga.prototype.eachChild=function(t){this.args.forEach(t)},Ga.prototype.outputDefined=function(){return!1},Ga.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ga.parse=function(t,o){var u,p=t[0],g=Ga.definitions[p];if(!g)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var x=Array.isArray(g)?g[0]:g.type,S=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,P=S.filter(function(Zn){var pn=Zn[0];return!Array.isArray(pn)||pn.length===t.length-1}),L=null,N=0,Z=P;N<Z.length;N+=1){var G=Z[N],Q=G[0],ae=G[1];L=new Hs(o.registry,o.path,null,o.scope);for(var Ie=[],Le=!1,We=1;We<t.length;We++){var Ne=t[We],nt=Array.isArray(Q)?Q[We-1]:Q.type,bt=L.parse(Ne,1+Ie.length,nt);if(!bt){Le=!0;break}Ie.push(bt)}if(!Le)if(Array.isArray(Q)&&Q.length!==Ie.length)L.error("Expected "+Q.length+" arguments, but found "+Ie.length+" instead.");else{for(var jt=0;jt<Ie.length;jt++){var Ht=Array.isArray(Q)?Q[jt]:Q.type,ur=Ie[jt];L.concat(jt+1).checkSubtype(Ht,ur.type)}if(L.errors.length===0)return new Ga(p,x,ae,Ie)}}if(P.length===1)(u=o.errors).push.apply(u,L.errors);else{for(var Cr=(P.length?P:S).map(function(Zn){var pn;return pn=Zn[0],Array.isArray(pn)?"("+pn.map(Ei).join(", ")+")":"("+Ei(pn.type)+"...)"}).join(" | "),Hr=[],Tn=1;Tn<t.length;Tn++){var Jr=o.parse(t[Tn],1+Hr.length);if(!Jr)return null;Hr.push(Ei(Jr.type))}o.error("Expected arguments of type "+Cr+", but found ("+Hr.join(", ")+") instead.")}return null},Ga.register=function(t,o){for(var u in Ga.definitions=o,o)t[u]=Ga};var Do=function(t,o,u){this.type=Ai,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Ha(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function Ls(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Uu(t,o){var u=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(u*g*8192),Math.round(p*g*8192)]}function ds(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function ee(t,o){for(var u,p,g,x,S,P,L,N=!1,Z=0,G=o.length;Z<G;Z++)for(var Q=o[Z],ae=0,Ie=Q.length;ae<Ie-1;ae++){if((x=(u=t)[0]-(p=Q[ae])[0])*(L=u[1]-(g=Q[ae+1])[1])-(P=u[0]-g[0])*(S=u[1]-p[1])==0&&x*P<=0&&S*L<=0)return!1;ds(t,Q[ae],Q[ae+1])&&(N=!N)}return N}function Ee(t,o){for(var u=0;u<o.length;u++)if(ee(t,o[u]))return!0;return!1}function Xe(t,o,u,p){var g=p[0]-u[0],x=p[1]-u[1],S=(t[0]-u[0])*x-g*(t[1]-u[1]),P=(o[0]-u[0])*x-g*(o[1]-u[1]);return S>0&&P<0||S<0&&P>0}function Pt(t,o,u){for(var p=0,g=u;p<g.length;p+=1)for(var x=g[p],S=0;S<x.length-1;++S)if((G=[(Z=x[S+1])[0]-(N=x[S])[0],Z[1]-N[1]])[0]*(Q=[(L=o)[0]-(P=t)[0],L[1]-P[1]])[1]-G[1]*Q[0]!=0&&Xe(P,L,N,Z)&&Xe(N,Z,P,L))return!0;var P,L,N,Z,G,Q;return!1}function Pr(t,o){for(var u=0;u<t.length;++u)if(!ee(t[u],o))return!1;for(var p=0;p<t.length-1;++p)if(Pt(t[p],t[p+1],o))return!1;return!0}function An(t,o){for(var u=0;u<o.length;u++)if(Pr(t,o[u]))return!0;return!1}function Ti(t,o,u){for(var p=[],g=0;g<t.length;g++){for(var x=[],S=0;S<t[g].length;S++){var P=Uu(t[g][S],u);Ha(o,P),x.push(P)}p.push(x)}return p}function Qa(t,o,u){for(var p=[],g=0;g<t.length;g++){var x=Ti(t[g],o,u);p.push(x)}return p}function Aa(t,o,u,p){if(t[0]<u[0]||t[0]>u[2]){var g=.5*p,x=t[0]-u[0]>g?-p:u[0]-t[0]>g?p:0;x===0&&(x=t[0]-u[2]>g?-p:u[2]-t[0]>g?p:0),t[0]+=x}Ha(o,t)}function Fa(t,o,u,p){for(var g=8192*Math.pow(2,p.z),x=[8192*p.x,8192*p.y],S=[],P=0,L=t;P<L.length;P+=1)for(var N=0,Z=L[P];N<Z.length;N+=1){var G=Z[N],Q=[G.x+x[0],G.y+x[1]];Aa(Q,o,u,g),S.push(Q)}return S}function Fo(t,o,u,p){for(var g,x=8192*Math.pow(2,p.z),S=[8192*p.x,8192*p.y],P=[],L=0,N=t;L<N.length;L+=1){for(var Z=[],G=0,Q=N[L];G<Q.length;G+=1){var ae=Q[G],Ie=[ae.x+S[0],ae.y+S[1]];Ha(o,Ie),Z.push(Ie)}P.push(Z)}if(o[2]-o[0]<=x/2){(g=o)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(var Le=0,We=P;Le<We.length;Le+=1)for(var Ne=0,nt=We[Le];Ne<nt.length;Ne+=1)Aa(nt[Ne],o,u,x)}return P}Do.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Fr);if(!p)return null;var g=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Fr);if(!g)return null;var x=null;return u.locale&&!(x=o.parse(u.locale,1,nn))?null:new Do(p,g,x)},Do.prototype.evaluate=function(t){return new Sa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Do.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Do.prototype.outputDefined=function(){return!1},Do.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var vs=function(t,o){this.type=Fr,this.geojson=t,this.geometries=o};function Wo(t){if(t instanceof Ga&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof vs)return!1;var o=!0;return t.eachChild(function(u){o&&!Wo(u)&&(o=!1)}),o}function Ao(t){if(t instanceof Ga&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!Ao(u)&&(o=!1)}),o}function To(t,o){if(t instanceof Ga&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(p){u&&!To(p,o)&&(u=!1)}),u}vs.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(be(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var g=u.features[p].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new vs(u,u.features[p].geometry)}else if(u.type==="Feature"){var x=u.geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new vs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new vs(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},vs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(u.type==="Polygon"){var S=Ti(u.coordinates,g,x),P=Fa(o.geometry(),p,g,x);if(!Ls(p,g))return!1;for(var L=0,N=P;L<N.length;L+=1)if(!ee(N[L],S))return!1}if(u.type==="MultiPolygon"){var Z=Qa(u.coordinates,g,x),G=Fa(o.geometry(),p,g,x);if(!Ls(p,g))return!1;for(var Q=0,ae=G;Q<ae.length;Q+=1)if(!Ee(ae[Q],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(u.type==="Polygon"){var S=Ti(u.coordinates,g,x),P=Fo(o.geometry(),p,g,x);if(!Ls(p,g))return!1;for(var L=0,N=P;L<N.length;L+=1)if(!Pr(N[L],S))return!1}if(u.type==="MultiPolygon"){var Z=Qa(u.coordinates,g,x),G=Fo(o.geometry(),p,g,x);if(!Ls(p,g))return!1;for(var Q=0,ae=G;Q<ae.length;Q+=1)if(!An(ae[Q],Z))return!1}return!0}(t,this.geometries)}return!1},vs.prototype.eachChild=function(){},vs.prototype.outputDefined=function(){return!0},vs.prototype.serialize=function(){return["within",this.geojson]};var Ms=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};Ms.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new Ms(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Ms.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ms.prototype.eachChild=function(){},Ms.prototype.outputDefined=function(){return!1},Ms.prototype.serialize=function(){return["var",this.name]};var Hs=function(t,o,u,p,g){o===void 0&&(o=[]),p===void 0&&(p=new yn),g===void 0&&(g=[]),this.registry=t,this.path=o,this.key=o.map(function(x){return"["+x+"]"}).join(""),this.scope=p,this.errors=g,this.expectedType=u};function Ws(t,o){for(var u,p=t.length-1,g=0,x=p,S=0;g<=x;)if((u=t[S=Math.floor((g+x)/2)])<=o){if(S===p||o<t[S+1])return S;g=S+1}else{if(!(u>o))throw new _a("Input is not a number.");x=S-1}return 0}Hs.prototype.parse=function(t,o,u,p,g){return g===void 0&&(g={}),o?this.concat(o,u,p)._parse(t,g):this._parse(t,g)},Hs.prototype._parse=function(t,o){function u(N,Z,G){return G==="assert"?new ta(Z,[N]):G==="coerce"?new mo(Z,[N]):N}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var g=this.registry[p];if(g){var x=g.parse(t,this);if(!x)return null;if(this.expectedType){var S=this.expectedType,P=x.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||P.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(S,P))return null}else x=u(x,S,o.typeAnnotation||"coerce");else x=u(x,S,o.typeAnnotation||"assert")}if(!(x instanceof $a)&&x.type.kind!=="resolvedImage"&&function N(Z){if(Z instanceof Ms)return N(Z.boundExpression);if(Z instanceof Ga&&Z.name==="error"||Z instanceof Do||Z instanceof vs)return!1;var G=Z instanceof mo||Z instanceof ta,Q=!0;return Z.eachChild(function(ae){Q=G?Q&&N(ae):Q&&ae instanceof $a}),!!Q&&Wo(Z)&&To(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(x)){var L=new aa;try{x=new $a(x.type,x.evaluate(L))}catch(N){return this.error(N.message),null}}return x}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Hs.prototype.concat=function(t,o,u){var p=typeof t=="number"?this.path.concat(t):this.path,g=u?this.scope.concat(u):this.scope;return new Hs(this.registry,p,o||null,g,this.errors)},Hs.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(g){return"["+g+"]"}).join("");this.errors.push(new vr(p,t))},Hs.prototype.checkSubtype=function(t,o){var u=Bt(t,o);return u&&this.error(u),u};var ms=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var p=0,g=u;p<g.length;p+=1){var x=g[p],S=x[1];this.labels.push(x[0]),this.outputs.push(S)}};function va(t,o,u){return t*(1-u)+o*u}ms.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,wt);if(!u)return null;var p=[],g=null;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);for(var x=1;x<t.length;x+=2){var S=x===1?-1/0:t[x],P=t[x+1],L=x,N=x+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(p.length&&p[p.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);var Z=o.parse(P,N,g);if(!Z)return null;g=g||Z.type,p.push([S,Z])}return new ms(g,u,p)},ms.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var g=o.length;return p>=o[g-1]?u[g-1].evaluate(t):u[Ws(o,p)].evaluate(t)},ms.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},ms.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ms.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var go=Object.freeze({__proto__:null,number:va,color:function(t,o,u){return new Di(va(t.r,o.r,u),va(t.g,o.g,u),va(t.b,o.b,u),va(t.a,o.a,u))},array:function(t,o,u){return t.map(function(p,g){return va(p,o[g],u)})}}),Qo=6/29*3*(6/29),gs=Math.PI/180,Pl=180/Math.PI;function rf(t){return t>.008856451679035631?Math.pow(t,1/3):t/Qo+4/29}function Ps(t){return t>6/29?t*t*t:Qo*(t-4/29)}function Il(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Xs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function rl(t){var o=Xs(t.r),u=Xs(t.g),p=Xs(t.b),g=rf((.4124564*o+.3575761*u+.1804375*p)/.95047),x=rf((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*x-16,a:500*(g-x),b:200*(x-rf((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,p=isNaN(t.b)?o:o-t.b/200;return o=1*Ps(o),u=.95047*Ps(u),p=1.08883*Ps(p),new Di(Il(3.2404542*u-1.5371385*o-.4985314*p),Il(-.969266*u+1.8760108*o+.041556*p),Il(.0556434*u-.2040259*o+1.0572252*p),t.alpha)}function T(t,o,u){var p=o-t;return t+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var F={forward:rl,reverse:_,interpolate:function(t,o,u){return{l:va(t.l,o.l,u),a:va(t.a,o.a,u),b:va(t.b,o.b,u),alpha:va(t.alpha,o.alpha,u)}}},O={forward:function(t){var o=rl(t),u=o.l,p=o.a,g=o.b,x=Math.atan2(g,p)*Pl;return{h:x<0?x+360:x,c:Math.sqrt(p*p+g*g),l:u,alpha:t.a}},reverse:function(t){var o=t.h*gs,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:T(t.h,o.h,u),c:va(t.c,o.c,u),l:va(t.l,o.l,u),alpha:va(t.alpha,o.alpha,u)}}},Y=Object.freeze({__proto__:null,lab:F,hcl:O}),me=function(t,o,u,p,g){this.type=t,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var x=0,S=g;x<S.length;x+=1){var P=S[x],L=P[1];this.labels.push(P[0]),this.outputs.push(L)}};function Ge(t,o,u,p){var g=p-u,x=t-u;return g===0?0:o===1?x/g:(Math.pow(o,x)-1)/(Math.pow(o,g)-1)}me.interpolationFactor=function(t,o,u,p){var g=0;if(t.name==="exponential")g=Ge(o,t.base,u,p);else if(t.name==="linear")g=Ge(o,1,u,p);else if(t.name==="cubic-bezier"){var x=t.controlPoints;g=new U(x[0],x[1],x[2],x[3]).solve(Ge(o,1,u,p))}return g},me.parse=function(t,o){var u=t[0],p=t[1],g=t[2],x=t.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var S=p[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var P=p.slice(1);if(P.length!==4||P.some(function(We){return typeof We!="number"||We<0||We>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:P}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(g=o.parse(g,2,wt)))return null;var L=[],N=null;u==="interpolate-hcl"||u==="interpolate-lab"?N=Vr:o.expectedType&&o.expectedType.kind!=="value"&&(N=o.expectedType);for(var Z=0;Z<x.length;Z+=2){var G=x[Z],Q=x[Z+1],ae=Z+3,Ie=Z+4;if(typeof G!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ae);if(L.length&&L[L.length-1][0]>=G)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ae);var Le=o.parse(Q,Ie,N);if(!Le)return null;N=N||Le.type,L.push([G,Le])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new me(N,u,p,g,L):o.error("Type "+Ei(N)+" is not interpolatable.")},me.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var g=o.length;if(p>=o[g-1])return u[g-1].evaluate(t);var x=Ws(o,p),S=me.interpolationFactor(this.interpolation,p,o[x],o[x+1]),P=u[x].evaluate(t),L=u[x+1].evaluate(t);return this.operator==="interpolate"?go[this.type.kind.toLowerCase()](P,L,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(P),O.forward(L),S)):F.reverse(F.interpolate(F.forward(P),F.forward(L),S))},me.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},me.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},me.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ut=function(t,o){this.type=t,this.args=o};ut.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var g=[],x=0,S=t.slice(1);x<S.length;x+=1){var P=o.parse(S[x],1+g.length,u,void 0,{typeAnnotation:"omit"});if(!P)return null;u=u||P.type,g.push(P)}var L=p&&g.some(function(N){return Bt(p,N.type)});return new ut(L?en:u,g)},ut.prototype.evaluate=function(t){for(var o,u=null,p=0,g=0,x=this.args;g<x.length&&(p++,(u=x[g].evaluate(t))&&u instanceof At&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);g+=1);return u},ut.prototype.eachChild=function(t){this.args.forEach(t)},ut.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ut.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var ct=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};ct.prototype.evaluate=function(t){return this.result.evaluate(t)},ct.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},ct.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],p=1;p<t.length-1;p+=2){var g=t[p];if(typeof g!="string")return o.error("Expected string, but found "+typeof g+" instead.",p);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var x=o.parse(t[p+1],p+1);if(!x)return null;u.push([g,x])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new ct(u,S):null},ct.prototype.outputDefined=function(){return this.result.outputDefined()},ct.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var lr=function(t,o,u){this.type=t,this.index=o,this.input=u};lr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,wt),p=o.parse(t[2],2,Ci(o.expectedType||en));return u&&p?new lr(p.type.itemType,u,p):null},lr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new _a("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new _a("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new _a("Array index must be an integer, but found "+o+" instead.");return u[o]},lr.prototype.eachChild=function(t){t(this.index),t(this.input)},lr.prototype.outputDefined=function(){return!1},lr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var mr=function(t,o){this.type=Fr,this.needle=t,this.haystack=o};mr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),p=o.parse(t[2],2,en);return u&&p?Yt(u.type,[Fr,nn,wt,ln,en])?new mr(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+Ei(u.type)+" instead"):null},mr.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Ki(o,["boolean","string","number","null"]))throw new _a("Expected first argument to be of type boolean, string, number or null, but found "+Ei($i(o))+" instead.");if(!Ki(u,["string","array"]))throw new _a("Expected second argument to be of type array or string, but found "+Ei($i(u))+" instead.");return u.indexOf(o)>=0},mr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},mr.prototype.outputDefined=function(){return!0},mr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var cn=function(t,o,u){this.type=wt,this.needle=t,this.haystack=o,this.fromIndex=u};cn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),p=o.parse(t[2],2,en);if(!u||!p)return null;if(!Yt(u.type,[Fr,nn,wt,ln,en]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+Ei(u.type)+" instead");if(t.length===4){var g=o.parse(t[3],3,wt);return g?new cn(u,p,g):null}return new cn(u,p)},cn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Ki(o,["boolean","string","number","null"]))throw new _a("Expected first argument to be of type boolean, string, number or null, but found "+Ei($i(o))+" instead.");if(!Ki(u,["string","array"]))throw new _a("Expected second argument to be of type array or string, but found "+Ei($i(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return u.indexOf(o,p)}return u.indexOf(o)},cn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},cn.prototype.outputDefined=function(){return!1},cn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ei=function(t,o,u,p,g,x){this.inputType=t,this.type=o,this.input=u,this.cases=p,this.outputs=g,this.otherwise=x};ei.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var g={},x=[],S=2;S<t.length-1;S+=2){var P=t[S],L=t[S+1];Array.isArray(P)||(P=[P]);var N=o.concat(S);if(P.length===0)return N.error("Expected at least one branch label.");for(var Z=0,G=P;Z<G.length;Z+=1){var Q=G[Z];if(typeof Q!="number"&&typeof Q!="string")return N.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return N.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof Q=="number"&&Math.floor(Q)!==Q)return N.error("Numeric branch labels must be integer values.");if(u){if(N.checkSubtype(u,$i(Q)))return null}else u=$i(Q);if(g[String(Q)]!==void 0)return N.error("Branch labels must be unique.");g[String(Q)]=x.length}var ae=o.parse(L,S,p);if(!ae)return null;p=p||ae.type,x.push(ae)}var Ie=o.parse(t[1],1,en);if(!Ie)return null;var Le=o.parse(t[t.length-1],t.length-1,p);return Le?Ie.type.kind!=="value"&&o.concat(1).checkSubtype(u,Ie.type)?null:new ei(u,p,Ie,g,x,Le):null},ei.prototype.evaluate=function(t){var o=this.input.evaluate(t);return($i(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ei.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ei.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ei.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],p={},g=0,x=Object.keys(this.cases).sort();g<x.length;g+=1){var S=x[g];(G=p[this.cases[S]])===void 0?(p[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[G][1].push(S)}for(var P=function(ae){return t.inputType.kind==="number"?Number(ae):ae},L=0,N=u;L<N.length;L+=1){var Z=N[L],G=Z[0],Q=Z[1];o.push(Q.length===1?P(Q[0]):Q.map(P)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Hn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Hn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],g=1;g<t.length-1;g+=2){var x=o.parse(t[g],g,Fr);if(!x)return null;var S=o.parse(t[g+1],g+1,u);if(!S)return null;p.push([x,S]),u=u||S.type}var P=o.parse(t[t.length-1],t.length-1,u);return P?new Hn(u,p,P):null},Hn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],g=p[1];if(p[0].evaluate(t))return g.evaluate(t)}return this.otherwise.evaluate(t)},Hn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],g=p[1];t(p[0]),t(g)}t(this.otherwise)},Hn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Hn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var vi=function(t,o,u,p){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=p};function ca(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function xa(t,o,u,p){return p.compare(o,u)===0}function Zi(t,o,u){var p=t!=="=="&&t!=="!=";return function(){function g(x,S,P){this.type=Fr,this.lhs=x,this.rhs=S,this.collator=P,this.hasUntypedArgument=x.type.kind==="value"||S.type.kind==="value"}return g.parse=function(x,S){if(x.length!==3&&x.length!==4)return S.error("Expected two or three arguments.");var P=x[0],L=S.parse(x[1],1,en);if(!L)return null;if(!ca(P,L.type))return S.concat(1).error('"'+P+`" comparisons are not supported for type '`+Ei(L.type)+"'.");var N=S.parse(x[2],2,en);if(!N)return null;if(!ca(P,N.type))return S.concat(2).error('"'+P+`" comparisons are not supported for type '`+Ei(N.type)+"'.");if(L.type.kind!==N.type.kind&&L.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot compare types '"+Ei(L.type)+"' and '"+Ei(N.type)+"'.");p&&(L.type.kind==="value"&&N.type.kind!=="value"?L=new ta(N.type,[L]):L.type.kind!=="value"&&N.type.kind==="value"&&(N=new ta(L.type,[N])));var Z=null;if(x.length===4){if(L.type.kind!=="string"&&N.type.kind!=="string"&&L.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(x[3],3,Ai)))return null}return new g(L,N,Z)},g.prototype.evaluate=function(x){var S=this.lhs.evaluate(x),P=this.rhs.evaluate(x);if(p&&this.hasUntypedArgument){var L=$i(S),N=$i(P);if(L.kind!==N.kind||L.kind!=="string"&&L.kind!=="number")throw new _a('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+L.kind+", "+N.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var Z=$i(S),G=$i(P);if(Z.kind!=="string"||G.kind!=="string")return o(x,S,P)}return this.collator?u(x,S,P,this.collator.evaluate(x)):o(x,S,P)},g.prototype.eachChild=function(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)},g.prototype.outputDefined=function(){return!0},g.prototype.serialize=function(){var x=[t];return this.eachChild(function(S){x.push(S.serialize())}),x},g}()}vi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),p=o.parse(t[2],2,wt);if(!u||!p)return null;if(!Yt(u.type,[Ci(en),nn,en]))return o.error("Expected first argument to be of type array or string, but found "+Ei(u.type)+" instead");if(t.length===4){var g=o.parse(t[3],3,wt);return g?new vi(u.type,u,p,g):null}return new vi(u.type,u,p)},vi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Ki(o,["string","array"]))throw new _a("Expected first argument to be of type array or string, but found "+Ei($i(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return o.slice(u,p)}return o.slice(u)},vi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},vi.prototype.outputDefined=function(){return!1},vi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ys=Zi("==",function(t,o,u){return o===u},xa),hu=Zi("!=",function(t,o,u){return o!==u},function(t,o,u,p){return!xa(0,o,u,p)}),Zu=Zi("<",function(t,o,u){return o<u},function(t,o,u,p){return p.compare(o,u)<0}),Mc=Zi(">",function(t,o,u){return o>u},function(t,o,u,p){return p.compare(o,u)>0}),nl=Zi("<=",function(t,o,u){return o<=u},function(t,o,u,p){return p.compare(o,u)<=0}),Pc=Zi(">=",function(t,o,u){return o>=u},function(t,o,u,p){return p.compare(o,u)>=0}),Mu=function(t,o,u,p,g){this.type=nn,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=g};Mu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,wt);if(!u)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var g=null;if(p.locale&&!(g=o.parse(p.locale,1,nn)))return null;var x=null;if(p.currency&&!(x=o.parse(p.currency,1,nn)))return null;var S=null;if(p["min-fraction-digits"]&&!(S=o.parse(p["min-fraction-digits"],1,wt)))return null;var P=null;return p["max-fraction-digits"]&&!(P=o.parse(p["max-fraction-digits"],1,wt))?null:new Mu(u,g,x,S,P)},Mu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Mu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Mu.prototype.outputDefined=function(){return!1},Mu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Pu=function(t){this.type=wt,this.input=t};Pu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+Ei(u.type)+" instead."):new Pu(u):null},Pu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new _a("Expected value to be of type string or array, but found "+Ei($i(o))+" instead.")},Pu.prototype.eachChild=function(t){t(this.input)},Pu.prototype.outputDefined=function(){return!1},Pu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Iu={"==":ys,"!=":hu,">":Mc,"<":Zu,">=":Pc,"<=":nl,array:ta,at:lr,boolean:ta,case:Hn,coalesce:ut,collator:Do,format:ko,image:Lo,in:mr,"index-of":cn,interpolate:me,"interpolate-hcl":me,"interpolate-lab":me,length:Pu,let:ct,literal:$a,match:ei,number:ta,"number-format":Mu,object:ta,slice:vi,step:ms,string:ta,"to-boolean":mo,"to-color":mo,"to-number":mo,"to-string":mo,var:Ms,within:vs};function io(t,o){var u=o[0],p=o[1],g=o[2],x=o[3];u=u.evaluate(t),p=p.evaluate(t),g=g.evaluate(t);var S=x?x.evaluate(t):1,P=Ro(u,p,g,S);if(P)throw new _a(P);return new Di(u/255*S,p/255*S,g/255*S,S)}function kf(t,o){return t in o}function Lf(t,o){var u=o[t];return u===void 0?null:u}function _s(t){return{type:t}}function Kl(t){return{result:"success",value:t}}function pu(t){return{result:"error",value:t}}function Ys(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Df(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function il(t){return!!t.expression&&t.expression.interpolated}function ba(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Jo(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function ph(t){return t}function al(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Ff(t,o,u,p,g){return al(typeof u===g?p[u]:void 0,t.default,o.default)}function Bf(t,o,u){if(ba(u)!=="number")return al(t.default,o.default);var p=t.stops.length;if(p===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[p-1][0])return t.stops[p-1][1];var g=Ws(t.stops.map(function(x){return x[0]}),u);return t.stops[g][1]}function nf(t,o,u){var p=t.base!==void 0?t.base:1;if(ba(u)!=="number")return al(t.default,o.default);var g=t.stops.length;if(g===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[g-1][0])return t.stops[g-1][1];var x=Ws(t.stops.map(function(G){return G[0]}),u),S=function(G,Q,ae,Ie){var Le=Ie-ae,We=G-ae;return Le===0?0:Q===1?We/Le:(Math.pow(Q,We)-1)/(Math.pow(Q,Le)-1)}(u,p,t.stops[x][0],t.stops[x+1][0]),P=t.stops[x][1],L=t.stops[x+1][1],N=go[o.type]||ph;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=Y[t.colorSpace];N=function(G,Q){return Z.reverse(Z.interpolate(Z.forward(G),Z.forward(Q),S))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var G=[],Q=arguments.length;Q--;)G[Q]=arguments[Q];var ae=P.evaluate.apply(void 0,G),Ie=L.evaluate.apply(void 0,G);if(ae!==void 0&&Ie!==void 0)return N(ae,Ie,S)}}:N(P,L,S)}function af(t,o,u){return o.type==="color"?u=Di.parse(u):o.type==="formatted"?u=Wr.fromString(u.toString()):o.type==="resolvedImage"?u=At.fromString(u.toString()):ba(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),al(u,t.default,o.default)}Ga.register(Iu,{error:[{kind:"error"},[nn],function(t,o){throw new _a(o[0].evaluate(t))}],typeof:[nn,[en],function(t,o){return Ei($i(o[0].evaluate(t)))}],"to-rgba":[Ci(wt,4),[Vr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Vr,[wt,wt,wt],io],rgba:[Vr,[wt,wt,wt,wt],io],has:{type:Fr,overloads:[[[nn],function(t,o){return kf(o[0].evaluate(t),t.properties())}],[[nn,di],function(t,o){var u=o[1];return kf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:en,overloads:[[[nn],function(t,o){return Lf(o[0].evaluate(t),t.properties())}],[[nn,di],function(t,o){var u=o[1];return Lf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[en,[nn],function(t,o){return Lf(o[0].evaluate(t),t.featureState||{})}],properties:[di,[],function(t){return t.properties()}],"geometry-type":[nn,[],function(t){return t.geometryType()}],id:[en,[],function(t){return t.id()}],zoom:[wt,[],function(t){return t.globals.zoom}],"heatmap-density":[wt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[wt,[],function(t){return t.globals.lineProgress||0}],accumulated:[en,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[wt,_s(wt),function(t,o){for(var u=0,p=0,g=o;p<g.length;p+=1)u+=g[p].evaluate(t);return u}],"*":[wt,_s(wt),function(t,o){for(var u=1,p=0,g=o;p<g.length;p+=1)u*=g[p].evaluate(t);return u}],"-":{type:wt,overloads:[[[wt,wt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[wt],function(t,o){return-o[0].evaluate(t)}]]},"/":[wt,[wt,wt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[wt,[wt,wt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[wt,[],function(){return Math.LN2}],pi:[wt,[],function(){return Math.PI}],e:[wt,[],function(){return Math.E}],"^":[wt,[wt,wt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[wt,[wt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[wt,[wt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[wt,[wt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[wt,[wt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[wt,[wt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[wt,[wt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[wt,[wt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[wt,[wt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[wt,[wt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[wt,[wt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[wt,_s(wt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[wt,_s(wt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[wt,[wt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[wt,[wt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[wt,[wt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[wt,[wt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Fr,[nn,en],function(t,o){var u=o[0],p=o[1];return t.properties()[u.value]===p.value}],"filter-id-==":[Fr,[en],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Fr,[nn],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Fr,[nn,en],function(t,o){var u=o[0],p=o[1],g=t.properties()[u.value],x=p.value;return typeof g==typeof x&&g<x}],"filter-id-<":[Fr,[en],function(t,o){var u=o[0],p=t.id(),g=u.value;return typeof p==typeof g&&p<g}],"filter->":[Fr,[nn,en],function(t,o){var u=o[0],p=o[1],g=t.properties()[u.value],x=p.value;return typeof g==typeof x&&g>x}],"filter-id->":[Fr,[en],function(t,o){var u=o[0],p=t.id(),g=u.value;return typeof p==typeof g&&p>g}],"filter-<=":[Fr,[nn,en],function(t,o){var u=o[0],p=o[1],g=t.properties()[u.value],x=p.value;return typeof g==typeof x&&g<=x}],"filter-id-<=":[Fr,[en],function(t,o){var u=o[0],p=t.id(),g=u.value;return typeof p==typeof g&&p<=g}],"filter->=":[Fr,[nn,en],function(t,o){var u=o[0],p=o[1],g=t.properties()[u.value],x=p.value;return typeof g==typeof x&&g>=x}],"filter-id->=":[Fr,[en],function(t,o){var u=o[0],p=t.id(),g=u.value;return typeof p==typeof g&&p>=g}],"filter-has":[Fr,[en],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Fr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Fr,[Ci(nn)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Fr,[Ci(en)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Fr,[nn,Ci(en)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Fr,[nn,Ci(en)],function(t,o){var u=o[0],p=o[1];return function(g,x,S,P){for(;S<=P;){var L=S+P>>1;if(x[L]===g)return!0;x[L]>g?P=L-1:S=L+1}return!1}(t.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:Fr,overloads:[[[Fr,Fr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[_s(Fr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(t))return!1;return!0}]]},any:{type:Fr,overloads:[[[Fr,Fr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[_s(Fr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(t))return!0;return!1}]]},"!":[Fr,[Fr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Fr,[nn],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[nn,[nn],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[nn,[nn],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[nn,_s(en),function(t,o){return o.map(function(u){return Au(u.evaluate(t))}).join("")}],"resolved-locale":[nn,[Ai],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var Ic=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new aa,this._defaultValue=o?function(u){return u.type==="color"&&Jo(u.default)?new Di(0,0,0,0):u.type==="color"?Di.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function $l(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Iu}function Ql(t,o){var u=new Hs(Iu,[],o?function(g){var x={color:Vr,string:nn,number:wt,enum:nn,boolean:Fr,formatted:Vn,resolvedImage:li};return g.type==="array"?Ci(x[g.value]||en,g.length):x[g.type]}(o):void 0),p=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Kl(new Ic(p,o)):pu(u.errors)}Ic.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,g,x){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)},Ic.prototype.evaluate=function(t,o,u,p,g,x){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new _a("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Jl=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Ao(o.expression)};Jl.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,g,x){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,g,x)},Jl.prototype.evaluate=function(t,o,u,p,g,x){return this._styleExpression.evaluate(t,o,u,p,g,x)};var ol=function(t,o,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Ao(o.expression),this.interpolationType=p};function Ol(t,o){if((t=Ql(t,o)).result==="error")return t;var u=t.value.expression,p=Wo(u);if(!p&&!Ys(o))return pu([new vr("","data expressions not supported")]);var g=To(u,["zoom"]);if(!g&&!Df(o))return pu([new vr("","zoom expressions not supported")]);var x=function S(P){var L=null;if(P instanceof ct)L=S(P.result);else if(P instanceof ut)for(var N=0,Z=P.args;N<Z.length&&!(L=S(Z[N]));N+=1);else(P instanceof ms||P instanceof me)&&P.input instanceof Ga&&P.input.name==="zoom"&&(L=P);return L instanceof vr||P.eachChild(function(G){var Q=S(G);Q instanceof vr?L=Q:!L&&Q?L=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):L&&Q&&L!==Q&&(L=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),L}(u);return x||g?x instanceof vr?pu([x]):x instanceof me&&!il(o)?pu([new vr("",'"interpolate" expressions cannot be used with this property')]):Kl(x?new ol(p?"camera":"composite",t.value,x.labels,x instanceof me?x.interpolation:void 0):new Jl(p?"constant":"source",t.value)):pu([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ol.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,g,x){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,g,x)},ol.prototype.evaluate=function(t,o,u,p,g,x){return this._styleExpression.evaluate(t,o,u,p,g,x)},ol.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?me.interpolationFactor(this.interpolationType,t,o,u):0};var sl=function(t,o){this._parameters=t,this._specification=o,fr(this,function u(p,g){var x,S,P,L=g.type==="color",N=p.stops&&typeof p.stops[0][0]=="object",Z=N||!(N||p.property!==void 0),G=p.type||(il(g)?"exponential":"interval");if(L&&((p=fr({},p)).stops&&(p.stops=p.stops.map(function(Jr){return[Jr[0],Di.parse(Jr[1])]})),p.default=Di.parse(p.default?p.default:g.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!Y[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(G==="exponential")x=nf;else if(G==="interval")x=Bf;else if(G==="categorical"){x=Ff,S=Object.create(null);for(var Q=0,ae=p.stops;Q<ae.length;Q+=1){var Ie=ae[Q];S[Ie[0]]=Ie[1]}P=typeof p.stops[0][0]}else{if(G!=="identity")throw new Error('Unknown function type "'+G+'"');x=af}if(N){for(var Le={},We=[],Ne=0;Ne<p.stops.length;Ne++){var nt=p.stops[Ne],bt=nt[0].zoom;Le[bt]===void 0&&(Le[bt]={zoom:bt,type:p.type,property:p.property,default:p.default,stops:[]},We.push(bt)),Le[bt].stops.push([nt[0].value,nt[1]])}for(var jt=[],Ht=0,ur=We;Ht<ur.length;Ht+=1){var Cr=ur[Ht];jt.push([Le[Cr].zoom,u(Le[Cr],g)])}var Hr={name:"linear"};return{kind:"composite",interpolationType:Hr,interpolationFactor:me.interpolationFactor.bind(void 0,Hr),zoomStops:jt.map(function(Jr){return Jr[0]}),evaluate:function(Jr,Zn){var pn=Jr.zoom;return nf({stops:jt,base:p.base},g,pn).evaluate(pn,Zn)}}}if(Z){var Tn=G==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:Tn,interpolationFactor:me.interpolationFactor.bind(void 0,Tn),zoomStops:p.stops.map(function(Jr){return Jr[0]}),evaluate:function(Jr){return x(p,g,Jr.zoom,S,P)}}}return{kind:"source",evaluate:function(Jr,Zn){var pn=Zn&&Zn.properties?Zn.properties[p.property]:void 0;return pn===void 0?al(p.default,g.default):x(p,g,pn,S,P)}}}(this._parameters,this._specification))};function Ds(t){var o=t.key,u=t.value,p=t.valueSpec||{},g=t.objectElementValidators||{},x=t.style,S=t.styleSpec,P=[],L=ba(u);if(L!=="object")return[new De(o,u,"object expected, "+L+" found")];for(var N in u){var Z=N.split(".")[0],G=p[Z]||p["*"],Q=void 0;if(g[Z])Q=g[Z];else if(p[Z])Q=Vi;else if(g["*"])Q=g["*"];else{if(!p["*"]){P.push(new De(o,u[N],'unknown property "'+N+'"'));continue}Q=Vi}P=P.concat(Q({key:(o&&o+".")+N,value:u[N],valueSpec:G,style:x,styleSpec:S,object:u,objectKey:N},u))}for(var ae in p)g[ae]||p[ae].required&&p[ae].default===void 0&&u[ae]===void 0&&P.push(new De(o,u,'missing required property "'+ae+'"'));return P}function of(t){var o=t.value,u=t.valueSpec,p=t.style,g=t.styleSpec,x=t.key,S=t.arrayElementValidator||Vi;if(ba(o)!=="array")return[new De(x,o,"array expected, "+ba(o)+" found")];if(u.length&&o.length!==u.length)return[new De(x,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new De(x,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var P={type:u.value,values:u.values};g.$version<7&&(P.function=u.function),ba(u.value)==="object"&&(P=u.value);for(var L=[],N=0;N<o.length;N++)L=L.concat(S({array:o,arrayIndex:N,value:o[N],valueSpec:P,style:p,styleSpec:g,key:x+"["+N+"]"}));return L}function sf(t){var o=t.key,u=t.value,p=t.valueSpec,g=ba(u);return g==="number"&&u!=u&&(g="NaN"),g!=="number"?[new De(o,u,"number expected, "+g+" found")]:"minimum"in p&&u<p.minimum?[new De(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new De(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function Nf(t){var o,u,p,g=t.valueSpec,x=Rt(t.value.type),S={},P=x!=="categorical"&&t.value.property===void 0,L=!P,N=ba(t.value.stops)==="array"&&ba(t.value.stops[0])==="array"&&ba(t.value.stops[0][0])==="object",Z=Ds({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ae){if(x==="identity")return[new De(ae.key,ae.value,'identity function may not have a "stops" property')];var Ie=[],Le=ae.value;return Ie=Ie.concat(of({key:ae.key,value:Le,valueSpec:ae.valueSpec,style:ae.style,styleSpec:ae.styleSpec,arrayElementValidator:G})),ba(Le)==="array"&&Le.length===0&&Ie.push(new De(ae.key,Le,"array must have at least one stop")),Ie},default:function(ae){return Vi({key:ae.key,value:ae.value,valueSpec:g,style:ae.style,styleSpec:ae.styleSpec})}}});return x==="identity"&&P&&Z.push(new De(t.key,t.value,'missing required property "property"')),x==="identity"||t.value.stops||Z.push(new De(t.key,t.value,'missing required property "stops"')),x==="exponential"&&t.valueSpec.expression&&!il(t.valueSpec)&&Z.push(new De(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(L&&!Ys(t.valueSpec)?Z.push(new De(t.key,t.value,"property functions not supported")):P&&!Df(t.valueSpec)&&Z.push(new De(t.key,t.value,"zoom functions not supported"))),x!=="categorical"&&!N||t.value.property!==void 0||Z.push(new De(t.key,t.value,'"property" property is required')),Z;function G(ae){var Ie=[],Le=ae.value,We=ae.key;if(ba(Le)!=="array")return[new De(We,Le,"array expected, "+ba(Le)+" found")];if(Le.length!==2)return[new De(We,Le,"array length 2 expected, length "+Le.length+" found")];if(N){if(ba(Le[0])!=="object")return[new De(We,Le,"object expected, "+ba(Le[0])+" found")];if(Le[0].zoom===void 0)return[new De(We,Le,"object stop key must have zoom")];if(Le[0].value===void 0)return[new De(We,Le,"object stop key must have value")];if(p&&p>Rt(Le[0].zoom))return[new De(We,Le[0].zoom,"stop zoom values must appear in ascending order")];Rt(Le[0].zoom)!==p&&(p=Rt(Le[0].zoom),u=void 0,S={}),Ie=Ie.concat(Ds({key:We+"[0]",value:Le[0],valueSpec:{zoom:{}},style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{zoom:sf,value:Q}}))}else Ie=Ie.concat(Q({key:We+"[0]",value:Le[0],valueSpec:{},style:ae.style,styleSpec:ae.styleSpec},Le));return $l(Lt(Le[1]))?Ie.concat([new De(We+"[1]",Le[1],"expressions are not allowed in function stops.")]):Ie.concat(Vi({key:We+"[1]",value:Le[1],valueSpec:g,style:ae.style,styleSpec:ae.styleSpec}))}function Q(ae,Ie){var Le=ba(ae.value),We=Rt(ae.value),Ne=ae.value!==null?ae.value:Ie;if(o){if(Le!==o)return[new De(ae.key,Ne,Le+" stop domain type must match previous stop domain type "+o)]}else o=Le;if(Le!=="number"&&Le!=="string"&&Le!=="boolean")return[new De(ae.key,Ne,"stop domain value must be a number, string, or boolean")];if(Le!=="number"&&x!=="categorical"){var nt="number expected, "+Le+" found";return Ys(g)&&x===void 0&&(nt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(ae.key,Ne,nt)]}return x!=="categorical"||Le!=="number"||isFinite(We)&&Math.floor(We)===We?x!=="categorical"&&Le==="number"&&u!==void 0&&We<u?[new De(ae.key,Ne,"stop domain values must appear in ascending order")]:(u=We,x==="categorical"&&We in S?[new De(ae.key,Ne,"stop domain values must be unique")]:(S[We]=!0,[])):[new De(ae.key,Ne,"integer expected, found "+We)]}}function ul(t){var o=(t.expressionContext==="property"?Ol:Ql)(Lt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(p){return new De(""+t.key+p.key,t.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new De(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Ao(u))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Ao(u))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!To(u,["zoom","feature-state"]))return[new De(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Wo(u))return[new De(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ou(t){var o=t.key,u=t.value,p=t.valueSpec,g=[];return Array.isArray(p.values)?p.values.indexOf(Rt(u))===-1&&g.push(new De(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(Rt(u))===-1&&g.push(new De(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),g}function Oc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var p=u[o];if(!Oc(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}sl.deserialize=function(t){return new sl(t._parameters,t._specification)},sl.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var uf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Rc(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Oc(t)||(t=cf(t));var o=Ql(t,uf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,g){return o.value.evaluate(u,p,{},g)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var g=1;g<p.length;g++)if(u(p[g]))return!0;return!1}(t)}}function lf(t,o){return t<o?-1:t>o?1:0}function cf(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Rl(t[1],t[2],"=="):u==="!="?ll(Rl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Rl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(cf))):u==="all"?["all"].concat(t.slice(1).map(cf)):u==="none"?["all"].concat(t.slice(1).map(cf).map(ll)):u==="in"?zf(t[1],t.slice(2)):u==="!in"?ll(zf(t[1],t.slice(2))):u==="has"?ff(t[1]):u==="!has"?ll(ff(t[1])):u!=="within"||t}function Rl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function zf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(lf)]]:["filter-in-small",t,["literal",o]]}}function ff(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ll(t){return["!",t]}function dh(t){return Oc(Lt(t.value))?ul(fr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,g=u.key;if(ba(p)!=="array")return[new De(g,p,"array expected, "+ba(p)+" found")];var x,S=u.styleSpec,P=[];if(p.length<1)return[new De(g,p,"filter array must have at least 1 element")];switch(P=P.concat(Ou({key:g+"[0]",value:p[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Rt(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&Rt(p[1])==="$type"&&P.push(new De(g,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&P.push(new De(g,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(x=ba(p[1]))!=="string"&&P.push(new De(g+"[1]",p[1],"string expected, "+x+" found"));for(var L=2;L<p.length;L++)x=ba(p[L]),Rt(p[1])==="$type"?P=P.concat(Ou({key:g+"["+L+"]",value:p[L],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&P.push(new De(g+"["+L+"]",p[L],"string, number, or boolean expected, "+x+" found"));break;case"any":case"all":case"none":for(var N=1;N<p.length;N++)P=P.concat(o({key:g+"["+N+"]",value:p[N],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":x=ba(p[1]),p.length!==2?P.push(new De(g,p,'filter array for "'+p[0]+'" operator must have 2 elements')):x!=="string"&&P.push(new De(g+"[1]",p[1],"string expected, "+x+" found"));break;case"within":x=ba(p[1]),p.length!==2?P.push(new De(g,p,'filter array for "'+p[0]+'" operator must have 2 elements')):x!=="object"&&P.push(new De(g+"[1]",p[1],"object expected, "+x+" found"))}return P}(t)}function kc(t,o){var u=t.key,p=t.style,g=t.styleSpec,x=t.value,S=t.objectKey,P=g[o+"_"+t.layerType];if(!P)return[];var L=S.match(/^(.*)-transition$/);if(o==="paint"&&L&&P[L[1]]&&P[L[1]].transition)return Vi({key:u,value:x,valueSpec:g.transition,style:p,styleSpec:g});var N,Z=t.valueSpec||P[S];if(!Z)return[new De(u,x,'unknown property "'+S+'"')];if(ba(x)==="string"&&Ys(Z)&&!Z.tokens&&(N=/^{([^}]+)}$/.exec(x)))return[new De(u,x,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(N[1])+" }`.")];var G=[];return t.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&G.push(new De(u,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Jo(Lt(x))&&Rt(x.type)==="identity"&&G.push(new De(u,x,'"text-font" does not support identity functions'))),G.concat(Vi({key:t.key,value:x,valueSpec:Z,style:p,styleSpec:g,expressionContext:"property",propertyType:o,propertyKey:S}))}function vh(t){return kc(t,"paint")}function ec(t){return kc(t,"layout")}function np(t){var o=[],u=t.value,p=t.key,g=t.style,x=t.styleSpec;u.type||u.ref||o.push(new De(p,u,'either "type" or "ref" is required'));var S,P=Rt(u.type),L=Rt(u.ref);if(u.id)for(var N=Rt(u.id),Z=0;Z<t.arrayIndex;Z++){var G=g.layers[Z];Rt(G.id)===N&&o.push(new De(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+G.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Ie){Ie in u&&o.push(new De(p,u[Ie],'"'+Ie+'" is prohibited for ref layers'))}),g.layers.forEach(function(Ie){Rt(Ie.id)===L&&(S=Ie)}),S?S.ref?o.push(new De(p,u.ref,"ref cannot reference another ref layer")):P=Rt(S.type):o.push(new De(p,u.ref,'ref layer "'+L+'" not found'));else if(P!=="background")if(u.source){var Q=g.sources&&g.sources[u.source],ae=Q&&Rt(Q.type);Q?ae==="vector"&&P==="raster"?o.push(new De(p,u.source,'layer "'+u.id+'" requires a raster source')):ae==="raster"&&P!=="raster"?o.push(new De(p,u.source,'layer "'+u.id+'" requires a vector source')):ae!=="vector"||u["source-layer"]?ae==="raster-dem"&&P!=="hillshade"?o.push(new De(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!u.paint||!u.paint["line-gradient"]||ae==="geojson"&&Q.lineMetrics||o.push(new De(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new De(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new De(p,u.source,'source "'+u.source+'" not found'))}else o.push(new De(p,u,'missing required property "source"'));return o=o.concat(Ds({key:p,value:u,valueSpec:x.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Vi({key:p+".type",value:u.type,valueSpec:x.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:dh,layout:function(Ie){return Ds({layer:u,key:Ie.key,value:Ie.value,style:Ie.style,styleSpec:Ie.styleSpec,objectElementValidators:{"*":function(Le){return ec(fr({layerType:P},Le))}}})},paint:function(Ie){return Ds({layer:u,key:Ie.key,value:Ie.value,style:Ie.style,styleSpec:Ie.styleSpec,objectElementValidators:{"*":function(Le){return vh(fr({layerType:P},Le))}}})}}}))}function kl(t){var o=t.value,u=t.key,p=ba(o);return p!=="string"?[new De(u,o,"string expected, "+p+" found")]:[]}var Ba={promoteId:function(t){var o=t.key,u=t.value;if(ba(u)==="string")return kl({key:o,value:u});var p=[];for(var g in u)p.push.apply(p,kl({key:o+"."+g,value:u[g]}));return p}};function es(t){var o=t.value,u=t.key,p=t.styleSpec,g=t.style;if(!o.type)return[new De(u,o,'"type" is required')];var x,S=Rt(o.type);switch(S){case"vector":case"raster":case"raster-dem":return Ds({key:u,value:o,valueSpec:p["source_"+S.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:Ba});case"geojson":if(x=Ds({key:u,value:o,valueSpec:p.source_geojson,style:g,styleSpec:p,objectElementValidators:Ba}),o.cluster)for(var P in o.clusterProperties){var L=o.clusterProperties[P],N=L[0],Z=typeof N=="string"?[N,["accumulated"],["get",P]]:N;x.push.apply(x,ul({key:u+"."+P+".map",value:L[1],expressionContext:"cluster-map"})),x.push.apply(x,ul({key:u+"."+P+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return x;case"video":return Ds({key:u,value:o,valueSpec:p.source_video,style:g,styleSpec:p});case"image":return Ds({key:u,value:o,valueSpec:p.source_image,style:g,styleSpec:p});case"canvas":return[new De(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ou({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:p})}}function Ll(t){var o=t.value,u=t.styleSpec,p=u.light,g=t.style,x=[],S=ba(o);if(o===void 0)return x;if(S!=="object")return x.concat([new De("light",o,"object expected, "+S+" found")]);for(var P in o){var L=P.match(/^(.*)-transition$/);x=x.concat(L&&p[L[1]]&&p[L[1]].transition?Vi({key:P,value:o[P],valueSpec:u.transition,style:g,styleSpec:u}):p[P]?Vi({key:P,value:o[P],valueSpec:p[P],style:g,styleSpec:u}):[new De(P,o[P],'unknown property "'+P+'"')])}return x}var Xi={"*":function(){return[]},array:of,boolean:function(t){var o=t.value,u=t.key,p=ba(o);return p!=="boolean"?[new De(u,o,"boolean expected, "+p+" found")]:[]},number:sf,color:function(t){var o=t.key,u=t.value,p=ba(u);return p!=="string"?[new De(o,u,"color expected, "+p+" found")]:Jn(u)===null?[new De(o,u,'color expected, "'+u+'" found')]:[]},constants:vt,enum:Ou,filter:dh,function:Nf,layer:np,object:Ds,source:es,light:Ll,string:kl,formatted:function(t){return kl(t).length===0?[]:ul(t)},resolvedImage:function(t){return kl(t).length===0?[]:ul(t)}};function Vi(t){var o=t.value,u=t.valueSpec,p=t.styleSpec;return u.expression&&Jo(Rt(o))?Nf(t):u.expression&&$l(Lt(o))?ul(t):u.type&&Xi[u.type]?Xi[u.type](t):Ds(fr({},t,{valueSpec:u.type?p[u.type]:u}))}function Ta(t){var o=t.value,u=t.key,p=kl(t);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new De(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new De(u,o,'"glyphs" url must include a "{range}" token'))),p}function Is(t,o){o===void 0&&(o=le);var u=[];return u=u.concat(Vi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ta,"*":function(){return[]}}})),t.constants&&(u=u.concat(vt({key:"constants",value:t.constants,style:t,styleSpec:o}))),tc(u)}function tc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function Vu(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return tc(t.apply(this,o))}}Is.source=Vu(es),Is.light=Vu(Ll),Is.layer=Vu(np),Is.filter=Vu(dh),Is.paintProperty=Vu(vh),Is.layoutProperty=Vu(ec);var Lc=Is,ao=Lc.light,rc=Lc.paintProperty,du=Lc.layoutProperty;function ju(t,o){var u=!1;if(o&&o.length)for(var p=0,g=o;p<g.length;p+=1)t.fire(new je(new Error(g[p].message))),u=!0;return u}var Gu=yo;function yo(t,o,u){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(o=g[1])+2*(u=g[2]);for(var x=0;x<this.d*this.d;x++){var S=g[3+x],P=g[3+x+1];p.push(S===P?null:g.subarray(S,P))}var L=g[3+p.length+1];this.keys=g.subarray(g[3+p.length],L),this.bboxes=g.subarray(L),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var N=0;N<this.d*this.d;N++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}yo.prototype.insert=function(t,o,u,p,g){this._forEachCell(o,u,p,g,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g)},yo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},yo.prototype._insertCell=function(t,o,u,p,g,x){this.cells[g].push(x)},yo.prototype.query=function(t,o,u,p,g){var x=this.min,S=this.max;if(t<=x&&o<=x&&S<=u&&S<=p&&!g)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(t,o,u,p,this._queryCell,P,{},g),P},yo.prototype._queryCell=function(t,o,u,p,g,x,S,P){var L=this.cells[g];if(L!==null)for(var N=this.keys,Z=this.bboxes,G=0;G<L.length;G++){var Q=L[G];if(S[Q]===void 0){var ae=4*Q;(P?P(Z[ae+0],Z[ae+1],Z[ae+2],Z[ae+3]):t<=Z[ae+2]&&o<=Z[ae+3]&&u>=Z[ae+0]&&p>=Z[ae+1])?(S[Q]=!0,x.push(N[Q])):S[Q]=!1}}},yo.prototype._forEachCell=function(t,o,u,p,g,x,S,P){for(var L=this._convertToCellCoord(t),N=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),G=this._convertToCellCoord(p),Q=L;Q<=Z;Q++)for(var ae=N;ae<=G;ae++){var Ie=this.d*ae+Q;if((!P||P(this._convertFromCellCoord(Q),this._convertFromCellCoord(ae),this._convertFromCellCoord(Q+1),this._convertFromCellCoord(ae+1)))&&g.call(this,t,o,u,p,Ie,x,S,P))return}},yo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},yo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},yo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var g=new Int32Array(o+u+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var x=o,S=0;S<t.length;S++){var P=t[S];g[3+S]=x,g.set(P,x),x+=P.length}return g[3+t.length]=x,g.set(this.keys,x),g[3+t.length+1]=x+=this.keys.length,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer};var cl=he.ImageData,Dl=he.ImageBitmap,_o={};function dn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),_o[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var Ja in dn("Object",Object),Gu.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Gu.deserialize=function(t){return new Gu(t.buffer)},dn("Grid",Gu),dn("Color",Di),dn("Error",Error),dn("ResolvedImage",At),dn("StylePropertyFunction",sl),dn("StyleExpression",Ic,{omit:["_evaluator"]}),dn("ZoomDependentExpression",ol),dn("ZoomConstantExpression",Jl),dn("CompoundExpression",Ga,{omit:["_evaluate"]}),Iu)Iu[Ja]._classRegistryKey||dn("Expression_"+Ja,Iu[Ja]);function fl(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Fl(t){return Dl&&t instanceof Dl}function fa(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(fl(t)||Fl(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof cl)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],g=0,x=t;g<x.length;g+=1)p.push(fa(x[g],o));return p}if(typeof t=="object"){var S=t.constructor,P=S._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var L=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var N in t)if(t.hasOwnProperty(N)&&!(_o[P].omit.indexOf(N)>=0)){var Z=t[N];L[N]=_o[P].shallow.indexOf(N)>=0?Z:fa(Z,o)}t instanceof Error&&(L.message=t.message)}if(L.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(L.$name=P),L}throw new Error("can't serialize object of type "+typeof t)}function xs(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||fl(t)||Fl(t)||ArrayBuffer.isView(t)||t instanceof cl)return t;if(Array.isArray(t))return t.map(xs);if(typeof t=="object"){var o=t.$name||"Object",u=_o[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var p=Object.create(u.prototype),g=0,x=Object.keys(t);g<x.length;g+=1){var S=x[g];if(S!=="$name"){var P=t[S];p[S]=_o[o].shallow.indexOf(S)>=0?P:xs(P)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var hf=function(){this.first=!0};hf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var qr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Bl(t){for(var o=0,u=t;o<u.length;o+=1)if(nc(u[o].charCodeAt(0)))return!0;return!1}function nc(t){return!(t!==746&&t!==747&&(t<4352||!(qr["Bopomofo Extended"](t)||qr.Bopomofo(t)||qr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||qr["CJK Compatibility Ideographs"](t)||qr["CJK Compatibility"](t)||qr["CJK Radicals Supplement"](t)||qr["CJK Strokes"](t)||!(!qr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||qr["CJK Unified Ideographs Extension A"](t)||qr["CJK Unified Ideographs"](t)||qr["Enclosed CJK Letters and Months"](t)||qr["Hangul Compatibility Jamo"](t)||qr["Hangul Jamo Extended-A"](t)||qr["Hangul Jamo Extended-B"](t)||qr["Hangul Jamo"](t)||qr["Hangul Syllables"](t)||qr.Hiragana(t)||qr["Ideographic Description Characters"](t)||qr.Kanbun(t)||qr["Kangxi Radicals"](t)||qr["Katakana Phonetic Extensions"](t)||qr.Katakana(t)&&t!==12540||!(!qr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!qr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||qr["Unified Canadian Aboriginal Syllabics"](t)||qr["Unified Canadian Aboriginal Syllabics Extended"](t)||qr["Vertical Forms"](t)||qr["Yijing Hexagram Symbols"](t)||qr["Yi Syllables"](t)||qr["Yi Radicals"](t))))}function hl(t){return!(nc(t)||function(o){return!!(qr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||qr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||qr["Letterlike Symbols"](o)||qr["Number Forms"](o)||qr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||qr["Control Pictures"](o)&&o!==9251||qr["Optical Character Recognition"](o)||qr["Enclosed Alphanumerics"](o)||qr["Geometric Shapes"](o)||qr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||qr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||qr["CJK Symbols and Punctuation"](o)||qr.Katakana(o)||qr["Private Use Area"](o)||qr["CJK Compatibility Forms"](o)||qr["Small Form Variants"](o)||qr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Ma(t){return t>=1424&&t<=2303||qr["Arabic Presentation Forms-A"](t)||qr["Arabic Presentation Forms-B"](t)}function ss(t,o){return!(!o&&Ma(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||qr.Khmer(t))}function ic(t){for(var o=0,u=t;o<u.length;o+=1)if(Ma(u[o].charCodeAt(0)))return!0;return!1}var Hu=null,Os="unavailable",Wu=null,mh=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Os="error"),Hu&&Hu(t)};function ac(){oc.fire(new ke("pluginStateChange",{pluginStatus:Os,pluginURL:Wu}))}var oc=new Je,Uf=function(){return Os},Fs=function(){if(Os!=="deferred"||!Wu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Os="loading",ac(),Wu&&ka({url:Wu},function(t){t?mh(t):(Os="loaded",ac())})},qs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Os==="loaded"||qs.applyArabicShaping!=null},isLoading:function(){return Os==="loading"},setState:function(t){Os=t.pluginStatus,Wu=t.pluginURL},isParsed:function(){return qs.applyArabicShaping!=null&&qs.processBidirectionalText!=null&&qs.processStyledBidirectionalText!=null},getPluginURL:function(){return Wu}},Mi=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hf,this.transition={})};Mi.prototype.isSupportedScript=function(t){return function(o,u){for(var p=0,g=o;p<g.length;p+=1)if(!ss(g[p].charCodeAt(0),u))return!1;return!0}(t,qs.isLoaded())},Mi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Mi.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Ks=function(t,o){this.property=t,this.value=o,this.expression=function(u,p){if(Jo(u))return new sl(u,p);if($l(u)){var g=Ol(u,p);if(g.result==="error")throw new Error(g.value.map(function(S){return S.key+": "+S.message}).join(", "));return g.value}var x=u;return typeof u=="string"&&p.type==="color"&&(x=Di.parse(u)),{kind:"constant",evaluate:function(){return x}}}(o===void 0?t.specification.default:o,t.specification)};Ks.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Ks.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var vu=function(t){this.property=t,this.value=new Ks(t,void 0)};vu.prototype.transitioned=function(t,o){return new pl(this.property,this.value,o,yt({},t.transition,this.transition),t.now)},vu.prototype.untransitioned=function(){return new pl(this.property,this.value,null,{},0)};var Xo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Xo.prototype.getValue=function(t){return He(this._values[t].value.value)},Xo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new vu(this._values[t].property)),this._values[t].value=new Ks(this._values[t].property,o===null?void 0:He(o))},Xo.prototype.getTransition=function(t){return He(this._values[t].transition)},Xo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new vu(this._values[t].property)),this._values[t].transition=He(o)||void 0},Xo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],g=this.getValue(p);g!==void 0&&(t[p]=g);var x=this.getTransition(p);x!==void 0&&(t[p+"-transition"]=x)}return t},Xo.prototype.transitioned=function(t,o){for(var u=new dl(this._properties),p=0,g=Object.keys(this._values);p<g.length;p+=1){var x=g[p];u._values[x]=this._values[x].transitioned(t,o._values[x])}return u},Xo.prototype.untransitioned=function(){for(var t=new dl(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];t._values[p]=this._values[p].untransitioned()}return t};var pl=function(t,o,u,p,g){this.property=t,this.value=o,this.begin=g+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};pl.prototype.possiblyEvaluate=function(t,o,u){var p=t.now||0,g=this.value.possiblyEvaluate(t,o,u),x=this.prior;if(x){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return x.possiblyEvaluate(t,o,u);var S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,o,u),g,function(P){if(P<=0)return 0;if(P>=1)return 1;var L=P*P,N=L*P;return 4*(P<.5?N:3*(P-L)+N-.75)}(S))}return g};var dl=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};dl.prototype.possiblyEvaluate=function(t,o,u){for(var p=new nu(this._properties),g=0,x=Object.keys(this._values);g<x.length;g+=1){var S=x[g];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p},dl.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var fo=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};fo.prototype.getValue=function(t){return He(this._values[t].value)},fo.prototype.setValue=function(t,o){this._values[t]=new Ks(this._values[t].property,o===null?void 0:He(o))},fo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],g=this.getValue(p);g!==void 0&&(t[p]=g)}return t},fo.prototype.possiblyEvaluate=function(t,o,u){for(var p=new nu(this._properties),g=0,x=Object.keys(this._values);g<x.length;g+=1){var S=x[g];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p};var Rs=function(t,o,u){this.property=t,this.value=o,this.parameters=u};Rs.prototype.isConstant=function(){return this.value.kind==="constant"},Rs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},Rs.prototype.evaluate=function(t,o,u,p){return this.property.evaluate(this.value,this.parameters,t,o,u,p)};var nu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};nu.prototype.get=function(t){return this._values[t]};var kn=function(t){this.specification=t};kn.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},kn.prototype.interpolate=function(t,o,u){var p=go[this.specification.type];return p?p(t,o,u):t};var Sn=function(t,o){this.specification=t,this.overrides=o};Sn.prototype.possiblyEvaluate=function(t,o,u,p){return new Rs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,p)}:t.expression,o)},Sn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new Rs(this,{kind:"constant",value:void 0},t.parameters);var p=go[this.specification.type];return p?new Rs(this,{kind:"constant",value:p(t.value.value,o.value.value,u)},t.parameters):t},Sn.prototype.evaluate=function(t,o,u,p,g,x){return t.kind==="constant"?t.value:t.evaluate(o,u,p,g,x)};var sc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,g,x){if(u.value===void 0)return new Rs(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var S=u.expression.evaluate(p,null,{},g,x),P=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,L=this._calculate(P,P,P,p);return new Rs(this,{kind:"constant",value:L},p)}if(u.expression.kind==="camera"){var N=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new Rs(this,{kind:"constant",value:N},p)}return new Rs(this,u.expression,p)},o.prototype.evaluate=function(u,p,g,x,S,P){if(u.kind==="source"){var L=u.evaluate(p,g,x,S,P);return this._calculate(L,L,L,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},g,x),u.evaluate({zoom:Math.floor(p.zoom)},g,x),u.evaluate({zoom:Math.floor(p.zoom)+1},g,x),p):u.value},o.prototype._calculate=function(u,p,g,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:g,to:p}},o.prototype.interpolate=function(u){return u},o}(Sn),us=function(t){this.specification=t};us.prototype.possiblyEvaluate=function(t,o,u,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var g=t.expression.evaluate(o,null,{},u,p);return this._calculate(g,g,g,o)}return this._calculate(t.expression.evaluate(new Mi(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Mi(Math.floor(o.zoom),o)),t.expression.evaluate(new Mi(Math.floor(o.zoom+1),o)),o)}},us.prototype._calculate=function(t,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},us.prototype.interpolate=function(t){return t};var iu=function(t){this.specification=t};iu.prototype.possiblyEvaluate=function(t,o,u,p){return!!t.expression.evaluate(o,null,{},u,p)},iu.prototype.interpolate=function(){return!1};var Yo=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new Ks(u,void 0),g=this.defaultTransitionablePropertyValues[o]=new vu(u);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};dn("DataDrivenProperty",Sn),dn("DataConstantProperty",kn),dn("CrossFadedDataDrivenProperty",sc),dn("CrossFadedProperty",us),dn("ColorRampProperty",iu);var au=function(t){function o(u,p){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new fo(p.layout)),p.paint)){for(var g in this._transitionablePaint=new Xo(p.paint),u.paint)this.setPaintProperty(g,u.paint[g],{validate:!1});for(var x in u.layout)this.setLayoutProperty(x,u.layout[x],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nu(p.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,g){g===void 0&&(g={}),p!=null&&this._validate(du,"layers."+this.id+".layout."+u,u,p,g)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return X(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,g){if(g===void 0&&(g={}),p!=null&&this._validate(rc,"layers."+this.id+".paint."+u,u,p,g))return!1;if(X(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var x=this._transitionablePaint._values[u],S=x.property.specification["property-type"]==="cross-faded-data-driven",P=x.value.isDataDriven(),L=x.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var N=this._transitionablePaint._values[u].value;return N.isDataDriven()||P||S||this._handleOverridablePaintPropertyUpdate(u,L,N)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,g){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),ft(u,function(p,g){return!(p===void 0||g==="layout"&&!Object.keys(p).length||g==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,g,x,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&ju(this,u.call(Lc,{key:p,layerType:this.type,objectKey:g,value:x,styleSpec:le,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof Rs&&Ys(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(Je),Zf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Dc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ha=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Pa(t,o){o===void 0&&(o=1);var u=0,p=0;return{members:t.map(function(g){var x=Zf[g.type].BYTES_PER_ELEMENT,S=u=vl(u,Math.max(o,x)),P=g.components||1;return p=Math.max(p,x),u+=x*P,{name:g.name,type:g.type,components:P,offset:S}}),size:vl(u,Math.max(p,o)),alignment:o}}function vl(t,o){return Math.ceil(t/o)*o}ha.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ha.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ha.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ha.prototype.clear=function(){this.length=0},ha.prototype.resize=function(t){this.reserve(t),this.length=t},ha.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ha.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var uc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var g=this.length;return this.resize(g+1),this.emplace(g,u,p)},o.prototype.emplace=function(u,p,g){var x=2*u;return this.int16[x+0]=p,this.int16[x+1]=g,u},o}(ha);uc.prototype.bytesPerElement=4,dn("StructArrayLayout2i4",uc);var $s=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,g,x)},o.prototype.emplace=function(u,p,g,x,S){var P=4*u;return this.int16[P+0]=p,this.int16[P+1]=g,this.int16[P+2]=x,this.int16[P+3]=S,u},o}(ha);$s.prototype.bytesPerElement=8,dn("StructArrayLayout4i8",$s);var ou=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,P){var L=this.length;return this.resize(L+1),this.emplace(L,u,p,g,x,S,P)},o.prototype.emplace=function(u,p,g,x,S,P,L){var N=6*u;return this.int16[N+0]=p,this.int16[N+1]=g,this.int16[N+2]=x,this.int16[N+3]=S,this.int16[N+4]=P,this.int16[N+5]=L,u},o}(ha);ou.prototype.bytesPerElement=12,dn("StructArrayLayout2i4i12",ou);var oo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,P){var L=this.length;return this.resize(L+1),this.emplace(L,u,p,g,x,S,P)},o.prototype.emplace=function(u,p,g,x,S,P,L){var N=4*u,Z=8*u;return this.int16[N+0]=p,this.int16[N+1]=g,this.uint8[Z+4]=x,this.uint8[Z+5]=S,this.uint8[Z+6]=P,this.uint8[Z+7]=L,u},o}(ha);oo.prototype.bytesPerElement=8,dn("StructArrayLayout2i4ub8",oo);var Qs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var g=this.length;return this.resize(g+1),this.emplace(g,u,p)},o.prototype.emplace=function(u,p,g){var x=2*u;return this.float32[x+0]=p,this.float32[x+1]=g,u},o}(ha);Qs.prototype.bytesPerElement=8,dn("StructArrayLayout2f8",Qs);var Bs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,P,L,N,Z,G){var Q=this.length;return this.resize(Q+1),this.emplace(Q,u,p,g,x,S,P,L,N,Z,G)},o.prototype.emplace=function(u,p,g,x,S,P,L,N,Z,G,Q){var ae=10*u;return this.uint16[ae+0]=p,this.uint16[ae+1]=g,this.uint16[ae+2]=x,this.uint16[ae+3]=S,this.uint16[ae+4]=P,this.uint16[ae+5]=L,this.uint16[ae+6]=N,this.uint16[ae+7]=Z,this.uint16[ae+8]=G,this.uint16[ae+9]=Q,u},o}(ha);Bs.prototype.bytesPerElement=20,dn("StructArrayLayout10ui20",Bs);var Ru=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,P,L,N,Z,G,Q,ae){var Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,u,p,g,x,S,P,L,N,Z,G,Q,ae)},o.prototype.emplace=function(u,p,g,x,S,P,L,N,Z,G,Q,ae,Ie){var Le=12*u;return this.int16[Le+0]=p,this.int16[Le+1]=g,this.int16[Le+2]=x,this.int16[Le+3]=S,this.uint16[Le+4]=P,this.uint16[Le+5]=L,this.uint16[Le+6]=N,this.uint16[Le+7]=Z,this.int16[Le+8]=G,this.int16[Le+9]=Q,this.int16[Le+10]=ae,this.int16[Le+11]=Ie,u},o}(ha);Ru.prototype.bytesPerElement=24,dn("StructArrayLayout4i4ui4i24",Ru);var mu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,p,g)},o.prototype.emplace=function(u,p,g,x){var S=3*u;return this.float32[S+0]=p,this.float32[S+1]=g,this.float32[S+2]=x,u},o}(ha);mu.prototype.bytesPerElement=12,dn("StructArrayLayout3f12",mu);var ks=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(ha);ks.prototype.bytesPerElement=4,dn("StructArrayLayout1ul4",ks);var pf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,P,L,N,Z){var G=this.length;return this.resize(G+1),this.emplace(G,u,p,g,x,S,P,L,N,Z)},o.prototype.emplace=function(u,p,g,x,S,P,L,N,Z,G){var Q=10*u,ae=5*u;return this.int16[Q+0]=p,this.int16[Q+1]=g,this.int16[Q+2]=x,this.int16[Q+3]=S,this.int16[Q+4]=P,this.int16[Q+5]=L,this.uint32[ae+3]=N,this.uint16[Q+8]=Z,this.uint16[Q+9]=G,u},o}(ha);pf.prototype.bytesPerElement=20,dn("StructArrayLayout6i1ul2ui20",pf);var lc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,P){var L=this.length;return this.resize(L+1),this.emplace(L,u,p,g,x,S,P)},o.prototype.emplace=function(u,p,g,x,S,P,L){var N=6*u;return this.int16[N+0]=p,this.int16[N+1]=g,this.int16[N+2]=x,this.int16[N+3]=S,this.int16[N+4]=P,this.int16[N+5]=L,u},o}(ha);lc.prototype.bytesPerElement=12,dn("StructArrayLayout2i2i2i12",lc);var Nl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S){var P=this.length;return this.resize(P+1),this.emplace(P,u,p,g,x,S)},o.prototype.emplace=function(u,p,g,x,S,P){var L=4*u,N=8*u;return this.float32[L+0]=p,this.float32[L+1]=g,this.float32[L+2]=x,this.int16[N+6]=S,this.int16[N+7]=P,u},o}(ha);Nl.prototype.bytesPerElement=16,dn("StructArrayLayout2f1f2i16",Nl);var Vf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,g,x)},o.prototype.emplace=function(u,p,g,x,S){var P=12*u,L=3*u;return this.uint8[P+0]=p,this.uint8[P+1]=g,this.float32[L+1]=x,this.float32[L+2]=S,u},o}(ha);Vf.prototype.bytesPerElement=12,dn("StructArrayLayout2ub2f12",Vf);var ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,p,g)},o.prototype.emplace=function(u,p,g,x){var S=3*u;return this.uint16[S+0]=p,this.uint16[S+1]=g,this.uint16[S+2]=x,u},o}(ha);ml.prototype.bytesPerElement=6,dn("StructArrayLayout3ui6",ml);var gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,P,L,N,Z,G,Q,ae,Ie,Le,We,Ne,nt){var bt=this.length;return this.resize(bt+1),this.emplace(bt,u,p,g,x,S,P,L,N,Z,G,Q,ae,Ie,Le,We,Ne,nt)},o.prototype.emplace=function(u,p,g,x,S,P,L,N,Z,G,Q,ae,Ie,Le,We,Ne,nt,bt){var jt=24*u,Ht=12*u,ur=48*u;return this.int16[jt+0]=p,this.int16[jt+1]=g,this.uint16[jt+2]=x,this.uint16[jt+3]=S,this.uint32[Ht+2]=P,this.uint32[Ht+3]=L,this.uint32[Ht+4]=N,this.uint16[jt+10]=Z,this.uint16[jt+11]=G,this.uint16[jt+12]=Q,this.float32[Ht+7]=ae,this.float32[Ht+8]=Ie,this.uint8[ur+36]=Le,this.uint8[ur+37]=We,this.uint8[ur+38]=Ne,this.uint32[Ht+10]=nt,this.int16[jt+22]=bt,u},o}(ha);gl.prototype.bytesPerElement=48,dn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",gl);var df=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,P,L,N,Z,G,Q,ae,Ie,Le,We,Ne,nt,bt,jt,Ht,ur,Cr,Hr,Tn,Jr,Zn,pn,Pi){var Kn=this.length;return this.resize(Kn+1),this.emplace(Kn,u,p,g,x,S,P,L,N,Z,G,Q,ae,Ie,Le,We,Ne,nt,bt,jt,Ht,ur,Cr,Hr,Tn,Jr,Zn,pn,Pi)},o.prototype.emplace=function(u,p,g,x,S,P,L,N,Z,G,Q,ae,Ie,Le,We,Ne,nt,bt,jt,Ht,ur,Cr,Hr,Tn,Jr,Zn,pn,Pi,Kn){var Mn=34*u,Ni=17*u;return this.int16[Mn+0]=p,this.int16[Mn+1]=g,this.int16[Mn+2]=x,this.int16[Mn+3]=S,this.int16[Mn+4]=P,this.int16[Mn+5]=L,this.int16[Mn+6]=N,this.int16[Mn+7]=Z,this.uint16[Mn+8]=G,this.uint16[Mn+9]=Q,this.uint16[Mn+10]=ae,this.uint16[Mn+11]=Ie,this.uint16[Mn+12]=Le,this.uint16[Mn+13]=We,this.uint16[Mn+14]=Ne,this.uint16[Mn+15]=nt,this.uint16[Mn+16]=bt,this.uint16[Mn+17]=jt,this.uint16[Mn+18]=Ht,this.uint16[Mn+19]=ur,this.uint16[Mn+20]=Cr,this.uint16[Mn+21]=Hr,this.uint16[Mn+22]=Tn,this.uint32[Ni+12]=Jr,this.float32[Ni+13]=Zn,this.float32[Ni+14]=pn,this.float32[Ni+15]=Pi,this.float32[Ni+16]=Kn,u},o}(ha);df.prototype.bytesPerElement=68,dn("StructArrayLayout8i15ui1ul4f68",df);var Xu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(ha);Xu.prototype.bytesPerElement=4,dn("StructArrayLayout1f4",Xu);var Ns=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,p,g)},o.prototype.emplace=function(u,p,g,x){var S=3*u;return this.int16[S+0]=p,this.int16[S+1]=g,this.int16[S+2]=x,u},o}(ha);Ns.prototype.bytesPerElement=6,dn("StructArrayLayout3i6",Ns);var vf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,p,g)},o.prototype.emplace=function(u,p,g,x){var S=4*u;return this.uint32[2*u+0]=p,this.uint16[S+2]=g,this.uint16[S+3]=x,u},o}(ha);vf.prototype.bytesPerElement=8,dn("StructArrayLayout1ul2ui8",vf);var cc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var g=this.length;return this.resize(g+1),this.emplace(g,u,p)},o.prototype.emplace=function(u,p,g){var x=2*u;return this.uint16[x+0]=p,this.uint16[x+1]=g,u},o}(ha);cc.prototype.bytesPerElement=4,dn("StructArrayLayout2ui4",cc);var ku=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(ha);ku.prototype.bytesPerElement=2,dn("StructArrayLayout1ui2",ku);var zl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,g,x)},o.prototype.emplace=function(u,p,g,x,S){var P=4*u;return this.float32[P+0]=p,this.float32[P+1]=g,this.float32[P+2]=x,this.float32[P+3]=S,u},o}(ha);zl.prototype.bytesPerElement=16,dn("StructArrayLayout4f16",zl);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new se(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(Dc);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(pf);dn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(Dc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(gl);dn("PlacedSymbolArray",d);var b=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(Dc);b.prototype.size=68;var C=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new b(this,u)},o}(df);dn("SymbolInstanceArray",C);var M=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(Xu);dn("GlyphOffsetArray",M);var R=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(Ns);dn("SymbolLineVertexArray",R);var z=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(Dc);z.prototype.size=8;var H=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new z(this,u)},o}(vf);dn("FeatureIndexArray",H);var ne=Pa([{name:"a_pos",components:2,type:"Int16"}],4).members,ue=function(t){t===void 0&&(t=[]),this.segments=t};function fe(t,o){return 256*(t=Jt(Math.floor(t),0,255))+Jt(Math.floor(o),0,255)}ue.prototype.prepareSegment=function(t,o,u,p){var g=this.segments[this.segments.length-1];return t>ue.MAX_VERTEX_ARRAY_LENGTH&&Qe("Max vertices per segment is "+ue.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!g||g.vertexLength+t>ue.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(g.sortKey=p),this.segments.push(g)),g},ue.prototype.get=function(){return this.segments},ue.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var p in u.vaos)u.vaos[p].destroy()}},ue.simpleSegment=function(t,o,u,p){return new ue([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},ue.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dn("SegmentVector",ue);var Ce=Pa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Pe=de(function(t){t.exports=function(o,u){var p,g,x,S,P,L,N,Z;for(g=o.length-(p=3&o.length),x=u,P=3432918353,L=461845907,Z=0;Z<g;)N=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,x=27492+(65535&(S=5*(65535&(x=(x^=N=(65535&(N=(N=(65535&N)*P+(((N>>>16)*P&65535)<<16)&4294967295)<<15|N>>>17))*L+(((N>>>16)*L&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(N=0,p){case 3:N^=(255&o.charCodeAt(Z+2))<<16;case 2:N^=(255&o.charCodeAt(Z+1))<<8;case 1:x^=N=(65535&(N=(N=(65535&(N^=255&o.charCodeAt(Z)))*P+(((N>>>16)*P&65535)<<16)&4294967295)<<15|N>>>17))*L+(((N>>>16)*L&65535)<<16)&4294967295}return x^=o.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}}),Ue=de(function(t){t.exports=function(o,u){for(var p,g=o.length,x=u^g,S=0;g>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),g-=4,++S;switch(g){case 3:x^=(255&o.charCodeAt(S+2))<<16;case 2:x^=(255&o.charCodeAt(S+1))<<8;case 1:x=1540483477*(65535&(x^=255&o.charCodeAt(S)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}}),Ae=Pe,Ze=Ue;Ae.murmur3=Pe,Ae.murmur2=Ze;var Ke=function(){this.ids=[],this.positions=[],this.indexed=!1};Ke.prototype.add=function(t,o,u,p){this.ids.push(St(t)),this.positions.push(o,u,p)},Ke.prototype.getPositions=function(t){for(var o=St(t),u=0,p=this.ids.length-1;u<p;){var g=u+p>>1;this.ids[g]>=o?p=g:u=g+1}for(var x=[];this.ids[u]===o;)x.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return x},Ke.serialize=function(t,o){var u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function g(x,S,P,L){for(;P<L;){for(var N=x[P+L>>1],Z=P-1,G=L+1;;){do Z++;while(x[Z]<N);do G--;while(x[G]>N);if(Z>=G)break;Zt(x,Z,G),Zt(S,3*Z,3*G),Zt(S,3*Z+1,3*G+1),Zt(S,3*Z+2,3*G+2)}G-P<L-G?(g(x,S,P,G),P=G+1):(g(x,S,G+1,L),L=G)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},Ke.deserialize=function(t){var o=new Ke;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var mt=Math.pow(2,53)-1;function St(t){var o=+t;return!isNaN(o)&&o<=mt?o:Ae(String(t))}function Zt(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}dn("FeaturePositionMap",Ke);var Kt=function(t,o){this.gl=t.gl,this.location=o},pr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Kt),kr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Kt),Or=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Kt),tn=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Kt),Ln=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Kt),Fn=function(t){function o(u,p){t.call(this,u,p),this.current=Di.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Kt),zn=new Float32Array(16),Ri=function(t){function o(u,p){t.call(this,u,p),this.current=zn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Kt);function sn(t){return[fe(255*t.r,255*t.g),fe(255*t.b,255*t.a)]}var ai=function(t,o,u){this.value=t,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=u};ai.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},ai.prototype.getBinding=function(t,o,u){return this.type==="color"?new Fn(t,o):new kr(t,o)};var fi=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};fi.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},fi.prototype.setUniform=function(t,o,u,p){var g=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)},fi.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Ln(t,o):new kr(t,o)};var ti=function(t,o,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(g){return{name:"a_"+g,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};ti.prototype.populatePaintArray=function(t,o,u,p,g){var x=this.paintVertexArray.length,S=this.expression.evaluate(new Mi(0),o,{},p,[],g);this.paintVertexArray.resize(t),this._setPaintValue(x,t,S)},ti.prototype.updatePaintArray=function(t,o,u,p){var g=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(t,o,g)},ti.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var p=sn(u),g=t;g<o;g++)this.paintVertexArray.emplace(g,p[0],p[1]);else{for(var x=t;x<o;x++)this.paintVertexArray.emplace(x,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},ti.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ti.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var On=function(t,o,u,p,g,x){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new x};On.prototype.populatePaintArray=function(t,o,u,p,g){var x=this.expression.evaluate(new Mi(this.zoom),o,{},p,[],g),S=this.expression.evaluate(new Mi(this.zoom+1),o,{},p,[],g),P=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(P,t,x,S)},On.prototype.updatePaintArray=function(t,o,u,p){var g=this.expression.evaluate({zoom:this.zoom},u,p),x=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(t,o,g,x)},On.prototype._setPaintValue=function(t,o,u,p){if(this.type==="color")for(var g=sn(u),x=sn(p),S=t;S<o;S++)this.paintVertexArray.emplace(S,g[0],g[1],x[0],x[1]);else{for(var P=t;P<o;P++)this.paintVertexArray.emplace(P,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},On.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},On.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},On.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=Jt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(p)},On.prototype.getBinding=function(t,o,u){return new kr(t,o)};var yi=function(t,o,u,p,g,x){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=p,this.layerId=x,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g};yi.prototype.populatePaintArray=function(t,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],u)},yi.prototype.updatePaintArray=function(t,o,u,p,g){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],g)},yi.prototype._setPaintValues=function(t,o,u,p){if(p&&u){var g=p[u.min],x=p[u.mid],S=p[u.max];if(g&&x&&S)for(var P=t;P<o;P++)this.zoomInPaintVertexArray.emplace(P,x.tl[0],x.tl[1],x.br[0],x.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],x.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,x.tl[0],x.tl[1],x.br[0],x.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],x.pixelRatio,S.pixelRatio)}},yi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ce.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ce.members,this.expression.isStateDependent))},yi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Un=function(t,o,u){this.binders={},this._buffers=[];var p=[];for(var g in t.paint._values)if(u(g)){var x=t.paint.get(g);if(x instanceof Rs&&Ys(x.property.specification)){var S=eo(g,t.type),P=x.value,L=x.property.specification.type,N=x.property.useIntegerZoom,Z=x.property.specification["property-type"],G=Z==="cross-faded"||Z==="cross-faded-data-driven";if(P.kind==="constant")this.binders[g]=G?new fi(P.value,S):new ai(P.value,S,L),p.push("/u_"+g);else if(P.kind==="source"||G){var Q=Da(g,L,"source");this.binders[g]=G?new yi(P,L,N,o,Q,t.id):new ti(P,S,L,Q),p.push("/a_"+g)}else{var ae=Da(g,L,"composite");this.binders[g]=new On(P,S,L,N,o,ae),p.push("/z_"+g)}}}this.cacheKey=p.sort().join("")};Un.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof ti||o instanceof On?o.maxValue:0},Un.prototype.populatePaintArrays=function(t,o,u,p,g){for(var x in this.binders){var S=this.binders[x];(S instanceof ti||S instanceof On||S instanceof yi)&&S.populatePaintArray(t,o,u,p,g)}},Un.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var p=this.binders[u];p instanceof fi&&p.setConstantPatternPositions(t,o)}},Un.prototype.updatePaintArrays=function(t,o,u,p,g){var x=!1;for(var S in t)for(var P=0,L=o.getPositions(S);P<L.length;P+=1){var N=L[P],Z=u.feature(N.index);for(var G in this.binders){var Q=this.binders[G];if((Q instanceof ti||Q instanceof On||Q instanceof yi)&&Q.expression.isStateDependent===!0){var ae=p.paint.get(G);Q.expression=ae.value,Q.updatePaintArray(N.start,N.end,Z,t[S],g),x=!0}}}return x},Un.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof ai||u instanceof fi)&&t.push.apply(t,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},Un.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ti||u instanceof On)for(var p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name);else if(u instanceof yi)for(var g=0;g<Ce.members.length;g++)t.push(Ce.members[g].name)}return t},Un.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ai||u instanceof fi||u instanceof On)for(var p=0,g=u.uniformNames;p<g.length;p+=1)t.push(g[p])}return t},Un.prototype.getPaintVertexBuffers=function(){return this._buffers},Un.prototype.getUniforms=function(t,o){var u=[];for(var p in this.binders){var g=this.binders[p];if(g instanceof ai||g instanceof fi||g instanceof On)for(var x=0,S=g.uniformNames;x<S.length;x+=1){var P=S[x];if(o[P]){var L=g.getBinding(t,o[P],P);u.push({name:P,property:p,binding:L})}}}return u},Un.prototype.setUniforms=function(t,o,u,p){for(var g=0,x=o;g<x.length;g+=1){var S=x[g],P=S.name,L=S.property;this.binders[L].setUniform(S.binding,p,u.get(L),P)}},Un.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof yi){var p=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof ti||u instanceof On)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Un.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof ti||u instanceof On||u instanceof yi)&&u.upload(t)}this.updatePaintBuffers()},Un.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof ti||o instanceof On||o instanceof yi)&&o.destroy()}};var jn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,g=t;p<g.length;p+=1){var x=g[p];this.programConfigurations[x.id]=new Un(x,o,u)}this.needsUpload=!1,this._featureMap=new Ke,this._bufferOffset=0};function eo(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Da(t,o,u){var p={color:{source:Qs,composite:zl},number:{source:Xu,composite:Qs}},g=function(x){return{"line-pattern":{source:Bs,composite:Bs},"fill-pattern":{source:Bs,composite:Bs},"fill-extrusion-pattern":{source:Bs,composite:Bs}}[x]}(t);return g&&g[u]||p[o][u]}jn.prototype.populatePaintArrays=function(t,o,u,p,g,x){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,p,g,x);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},jn.prototype.updatePaintArrays=function(t,o,u,p){for(var g=0,x=u;g<x.length;g+=1){var S=x[g];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,p)||this.needsUpload}},jn.prototype.get=function(t){return this.programConfigurations[t]},jn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},jn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},dn("ConstantBinder",ai),dn("CrossFadedConstantBinder",fi),dn("SourceExpressionBinder",ti),dn("CrossFadedCompositeBinder",yi),dn("CompositeExpressionBinder",On),dn("ProgramConfiguration",Un,{omit:["_buffers"]}),dn("ProgramConfigurationSet",jn);var Bo=Math.pow(2,14)-1,No=-Bo-1;function Wa(t){for(var o=8192/t.extent,u=t.loadGeometry(),p=0;p<u.length;p++)for(var g=u[p],x=0;x<g.length;x++){var S=g[x],P=Math.round(S.x*o),L=Math.round(S.y*o);S.x=Jt(P,No,Bo),S.y=Jt(L,No,Bo),(P<S.x||P>S.x+1||L<S.y||L>S.y+1)&&Qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function so(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Wa(t):[]}}function pa(t,o,u,p,g){t.emplaceBack(2*o+(p+1)/2,2*u+(g+1)/2)}var na=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new uc,this.indexArray=new ml,this.segments=new ue,this.programConfigurations=new jn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Js(t,o){for(var u=0;u<t.length;u++)if(gu(o,t[u]))return!0;for(var p=0;p<o.length;p++)if(gu(t,o[p]))return!0;return!!Fc(t,o)}function ts(t,o,u){return!!gu(t,o)||!!Yu(o,t,u)}function ls(t,o){if(t.length===1)return bs(o,t[0]);for(var u=0;u<o.length;u++)for(var p=o[u],g=0;g<p.length;g++)if(gu(t,p[g]))return!0;for(var x=0;x<t.length;x++)if(bs(o,t[x]))return!0;for(var S=0;S<o.length;S++)if(Fc(t,o[S]))return!0;return!1}function su(t,o,u){if(t.length>1){if(Fc(t,o))return!0;for(var p=0;p<o.length;p++)if(Yu(o[p],t,u))return!0}for(var g=0;g<t.length;g++)if(Yu(t[g],o,u))return!0;return!1}function Fc(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var p=t[u],g=t[u+1],x=0;x<o.length-1;x++)if(fc(p,g,o[x],o[x+1]))return!0;return!1}function fc(t,o,u,p){return Ut(t,u,p)!==Ut(o,u,p)&&Ut(t,o,u)!==Ut(t,o,p)}function Yu(t,o,u){var p=u*u;if(o.length===1)return t.distSqr(o[0])<p;for(var g=1;g<o.length;g++)if(yl(t,o[g-1],o[g])<p)return!0;return!1}function yl(t,o,u){var p=o.distSqr(u);if(p===0)return t.distSqr(o);var g=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/p;return t.distSqr(g<0?o:g>1?u:u.sub(o)._mult(g)._add(o))}function bs(t,o){for(var u,p,g,x=!1,S=0;S<t.length;S++)for(var P=0,L=(u=t[S]).length-1;P<u.length;L=P++)(p=u[P]).y>o.y!=(g=u[L]).y>o.y&&o.x<(g.x-p.x)*(o.y-p.y)/(g.y-p.y)+p.x&&(x=!x);return x}function gu(t,o){for(var u=!1,p=0,g=t.length-1;p<t.length;g=p++){var x=t[p],S=t[g];x.y>o.y!=S.y>o.y&&o.x<(S.x-x.x)*(o.y-x.y)/(S.y-x.y)+x.x&&(u=!u)}return u}function hc(t,o,u){var p=u[0],g=u[2];if(t.x<p.x&&o.x<p.x||t.x>g.x&&o.x>g.x||t.y<p.y&&o.y<p.y||t.y>g.y&&o.y>g.y)return!1;var x=Ut(t,o,u[0]);return x!==Ut(t,o,u[1])||x!==Ut(t,o,u[2])||x!==Ut(t,o,u[3])}function Lu(t,o,u){var p=o.paint.get(t).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(t)}function Na(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function uu(t,o,u,p,g){if(!o[0]&&!o[1])return t;var x=se.convert(o)._mult(g);u==="viewport"&&x._rotate(-p);for(var S=[],P=0;P<t.length;P++)S.push(t[P].sub(x));return S}na.prototype.populate=function(t,o,u){var p=this.layers[0],g=[],x=null;p.type==="circle"&&(x=p.layout.get("circle-sort-key"));for(var S=0,P=t;S<P.length;S+=1){var L=P[S],N=L.feature,Z=L.id,G=L.index,Q=L.sourceLayerIndex,ae=this.layers[0]._featureFilter.needGeometry,Ie=so(N,ae);if(this.layers[0]._featureFilter.filter(new Mi(this.zoom),Ie,u)){var Le=x?x.evaluate(Ie,{},u):void 0,We={id:Z,properties:N.properties,type:N.type,sourceLayerIndex:Q,index:G,geometry:ae?Ie.geometry:Wa(N),patterns:{},sortKey:Le};g.push(We)}}x&&g.sort(function(Hr,Tn){return Hr.sortKey-Tn.sortKey});for(var Ne=0,nt=g;Ne<nt.length;Ne+=1){var bt=nt[Ne],jt=bt.geometry,Ht=bt.index,ur=bt.sourceLayerIndex,Cr=t[Ht].feature;this.addFeature(bt,jt,Ht,u),o.featureIndex.insert(Cr,jt,Ht,ur,this.index)}},na.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},na.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},na.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},na.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ne),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},na.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},na.prototype.addFeature=function(t,o,u,p){for(var g=0,x=o;g<x.length;g+=1)for(var S=0,P=x[g];S<P.length;S+=1){var L=P[S],N=L.x,Z=L.y;if(!(N<0||N>=8192||Z<0||Z>=8192)){var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),Q=G.vertexLength;pa(this.layoutVertexArray,N,Z,-1,-1),pa(this.layoutVertexArray,N,Z,1,-1),pa(this.layoutVertexArray,N,Z,1,1),pa(this.layoutVertexArray,N,Z,-1,1),this.indexArray.emplaceBack(Q,Q+1,Q+2),this.indexArray.emplaceBack(Q,Q+3,Q+2),G.vertexLength+=4,G.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p)},dn("CircleBucket",na,{omit:["layers"]});var lu=new Yo({"circle-sort-key":new Sn(le.layout_circle["circle-sort-key"])}),Du={paint:new Yo({"circle-radius":new Sn(le.paint_circle["circle-radius"]),"circle-color":new Sn(le.paint_circle["circle-color"]),"circle-blur":new Sn(le.paint_circle["circle-blur"]),"circle-opacity":new Sn(le.paint_circle["circle-opacity"]),"circle-translate":new kn(le.paint_circle["circle-translate"]),"circle-translate-anchor":new kn(le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kn(le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kn(le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Sn(le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Sn(le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Sn(le.paint_circle["circle-stroke-opacity"])}),layout:lu},Qi=typeof Float32Array!="undefined"?Float32Array:Array;function cs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zo(t,o,u){var p=o[0],g=o[1],x=o[2],S=o[3],P=o[4],L=o[5],N=o[6],Z=o[7],G=o[8],Q=o[9],ae=o[10],Ie=o[11],Le=o[12],We=o[13],Ne=o[14],nt=o[15],bt=u[0],jt=u[1],Ht=u[2],ur=u[3];return t[0]=bt*p+jt*P+Ht*G+ur*Le,t[1]=bt*g+jt*L+Ht*Q+ur*We,t[2]=bt*x+jt*N+Ht*ae+ur*Ne,t[3]=bt*S+jt*Z+Ht*Ie+ur*nt,t[4]=(bt=u[4])*p+(jt=u[5])*P+(Ht=u[6])*G+(ur=u[7])*Le,t[5]=bt*g+jt*L+Ht*Q+ur*We,t[6]=bt*x+jt*N+Ht*ae+ur*Ne,t[7]=bt*S+jt*Z+Ht*Ie+ur*nt,t[8]=(bt=u[8])*p+(jt=u[9])*P+(Ht=u[10])*G+(ur=u[11])*Le,t[9]=bt*g+jt*L+Ht*Q+ur*We,t[10]=bt*x+jt*N+Ht*ae+ur*Ne,t[11]=bt*S+jt*Z+Ht*Ie+ur*nt,t[12]=(bt=u[12])*p+(jt=u[13])*P+(Ht=u[14])*G+(ur=u[15])*Le,t[13]=bt*g+jt*L+Ht*Q+ur*We,t[14]=bt*x+jt*N+Ht*ae+ur*Ne,t[15]=bt*S+jt*Z+Ht*Ie+ur*nt,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var Fu,pc=zo;function Ul(t,o,u){var p=o[0],g=o[1],x=o[2],S=o[3];return t[0]=u[0]*p+u[4]*g+u[8]*x+u[12]*S,t[1]=u[1]*p+u[5]*g+u[9]*x+u[13]*S,t[2]=u[2]*p+u[6]*g+u[10]*x+u[14]*S,t[3]=u[3]*p+u[7]*g+u[11]*x+u[15]*S,t}Fu=new Qi(3),Qi!=Float32Array&&(Fu[0]=0,Fu[1]=0,Fu[2]=0),function(){var t=new Qi(4);Qi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Bc=(function(){var t=new Qi(2);Qi!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,Du)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new na(u)},o.prototype.queryRadius=function(u){var p=u;return Lu("circle-radius",this,p)+Lu("circle-stroke-width",this,p)+Na(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,g,x,S,P,L,N){for(var Z=uu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,L),G=this.paint.get("circle-radius").evaluate(p,g)+this.paint.get("circle-stroke-width").evaluate(p,g),Q=this.paint.get("circle-pitch-alignment")==="map",ae=Q?Z:function(Cr,Hr){return Cr.map(function(Tn){return eu(Tn,Hr)})}(Z,N),Ie=Q?G*L:G,Le=0,We=x;Le<We.length;Le+=1)for(var Ne=0,nt=We[Le];Ne<nt.length;Ne+=1){var bt=nt[Ne],jt=Q?bt:eu(bt,N),Ht=Ie,ur=Ul([],[bt.x,bt.y,0,1],N);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ht*=ur[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ht*=P.cameraToCenterDistance/ur[3]),ts(ae,jt,Ht))return!0}return!1},o}(au));function eu(t,o){var u=Ul([],[t.x,t.y,0,1],o);return new se(u[0]/u[3],u[1]/u[3])}var Zl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(na);function Mo(t,o,u,p){var g=o.width,x=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==g*x*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(g*x*u);return t.width=g,t.height=x,t.data=p,t}function qu(t,o,u){var p=o.width,g=o.height;if(p!==t.width||g!==t.height){var x=Mo({},{width:p,height:g},u);Nc(t,x,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,g)},u),t.width=p,t.height=g,t.data=x.data}}function Nc(t,o,u,p,g,x){if(g.width===0||g.height===0)return o;if(g.width>t.width||g.height>t.height||u.x>t.width-g.width||u.y>t.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||p.x>o.width-g.width||p.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,P=o.data,L=0;L<g.height;L++)for(var N=((u.y+L)*t.width+u.x)*x,Z=((p.y+L)*o.width+p.x)*x,G=0;G<g.width*x;G++)P[Z+G]=S[N+G];return o}dn("HeatmapBucket",Zl,{omit:["layers"]});var yu=function(t,o){Mo(this,t,1,o)};yu.prototype.resize=function(t){qu(this,t,1)},yu.prototype.clone=function(){return new yu({width:this.width,height:this.height},new Uint8Array(this.data))},yu.copy=function(t,o,u,p,g){Nc(t,o,u,p,g,1)};var Uo=function(t,o){Mo(this,t,4,o)};Uo.prototype.resize=function(t){qu(this,t,4)},Uo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Uo.prototype.clone=function(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))},Uo.copy=function(t,o,u,p,g){Nc(t,o,u,p,g,4)},dn("AlphaImage",yu),dn("RGBAImage",Uo);var zc={paint:new Yo({"heatmap-radius":new Sn(le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Sn(le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kn(le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new iu(le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kn(le.paint_heatmap["heatmap-opacity"])})};function jf(t){var o={},u=t.resolution||256,p=t.clips?t.clips.length:1,g=t.image||new Uo({width:u,height:p}),x=function(Ie,Le,We){o[t.evaluationKey]=We;var Ne=t.expression.evaluate(o);g.data[Ie+Le+0]=Math.floor(255*Ne.r/Ne.a),g.data[Ie+Le+1]=Math.floor(255*Ne.g/Ne.a),g.data[Ie+Le+2]=Math.floor(255*Ne.b/Ne.a),g.data[Ie+Le+3]=Math.floor(255*Ne.a)};if(t.clips)for(var S=0,P=0;S<p;++S,P+=4*u)for(var L=0,N=0;L<u;L++,N+=4){var Z=L/(u-1),G=t.clips[S];x(P,N,G.start*(1-Z)+G.end*Z)}else for(var Q=0,ae=0;Q<u;Q++,ae+=4)x(0,ae,Q/(u-1));return g}var gh=function(t){function o(u){t.call(this,u,zc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Zl(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=jf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(au),Uc={paint:new Yo({"hillshade-illumination-direction":new kn(le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kn(le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kn(le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kn(le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kn(le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kn(le.paint_hillshade["hillshade-accent-color"])})},_u=function(t){function o(u){t.call(this,u,Uc)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(au),ip=Pa([{name:"a_pos",components:2,type:"Int16"}],4).members,dc=Gf,Zc=Gf;function Gf(t,o,u){u=u||2;var p,g,x,S,P,L,N,Z=o&&o.length,G=Z?o[0]*u:t.length,Q=ap(t,0,G,u,!0),ae=[];if(!Q||Q.next===Q.prev)return ae;if(Z&&(Q=function(Le,We,Ne,nt){var bt,jt,Ht,ur=[];for(bt=0,jt=We.length;bt<jt;bt++)(Ht=ap(Le,We[bt]*nt,bt<jt-1?We[bt+1]*nt:Le.length,nt,!1))===Ht.next&&(Ht.steiner=!0),ur.push(Sd(Ht));for(ur.sort(bd),bt=0;bt<ur.length;bt++)Ed(ur[bt],Ne),Ne=_l(Ne,Ne.next);return Ne}(t,o,Q,u)),t.length>80*u){p=x=t[0],g=S=t[1];for(var Ie=u;Ie<G;Ie+=u)(P=t[Ie])<p&&(p=P),(L=t[Ie+1])<g&&(g=L),P>x&&(x=P),L>S&&(S=L);N=(N=Math.max(x-p,S-g))!==0?1/N:0}return mf(Q,ae,u,p,g,N),ae}function ap(t,o,u,p,g){var x,S;if(g===Xf(t,o,u,p)>0)for(x=o;x<u;x+=p)S=Wf(x,t[x],t[x+1],S);else for(x=u-p;x>=o;x-=p)S=Wf(x,t[x],t[x+1],S);return S&&_h(S,S.next)&&(vc(S),S=S.next),S}function _l(t,o){if(!t)return t;o||(o=t);var u,p=t;do if(u=!1,p.steiner||!_h(p,p.next)&&Po(p.prev,p,p.next)!==0)p=p.next;else{if(vc(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function mf(t,o,u,p,g,x,S){if(t){!S&&x&&function(Z,G,Q,ae){var Ie=Z;do Ie.z===null&&(Ie.z=yh(Ie.x,Ie.y,G,Q,ae)),Ie.prevZ=Ie.prev,Ie.nextZ=Ie.next,Ie=Ie.next;while(Ie!==Z);Ie.prevZ.nextZ=null,Ie.prevZ=null,function(Le){var We,Ne,nt,bt,jt,Ht,ur,Cr,Hr=1;do{for(Ne=Le,Le=null,jt=null,Ht=0;Ne;){for(Ht++,nt=Ne,ur=0,We=0;We<Hr&&(ur++,nt=nt.nextZ);We++);for(Cr=Hr;ur>0||Cr>0&&nt;)ur!==0&&(Cr===0||!nt||Ne.z<=nt.z)?(bt=Ne,Ne=Ne.nextZ,ur--):(bt=nt,nt=nt.nextZ,Cr--),jt?jt.nextZ=bt:Le=bt,bt.prevZ=jt,jt=bt;Ne=nt}jt.nextZ=null,Hr*=2}while(Ht>1)}(Ie)}(t,p,g,x);for(var P,L,N=t;t.prev!==t.next;)if(P=t.prev,L=t.next,x?xd(t,p,g,x):Vp(t))o.push(P.i/u),o.push(t.i/u),o.push(L.i/u),vc(t),t=L.next,N=L.next;else if((t=L)===N){S?S===1?mf(t=Vc(_l(t),o,u),o,u,p,g,x,2):S===2&&op(t,o,u,p,g,x):mf(_l(t),o,u,p,g,x,1);break}}}function Vp(t){var o=t.prev,u=t,p=t.next;if(Po(o,u,p)>=0)return!1;for(var g=t.next.next;g!==t.prev;){if(gf(o.x,o.y,u.x,u.y,p.x,p.y,g.x,g.y)&&Po(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function xd(t,o,u,p){var g=t.prev,x=t,S=t.next;if(Po(g,x,S)>=0)return!1;for(var P=g.x>x.x?g.x>S.x?g.x:S.x:x.x>S.x?x.x:S.x,L=g.y>x.y?g.y>S.y?g.y:S.y:x.y>S.y?x.y:S.y,N=yh(g.x<x.x?g.x<S.x?g.x:S.x:x.x<S.x?x.x:S.x,g.y<x.y?g.y<S.y?g.y:S.y:x.y<S.y?x.y:S.y,o,u,p),Z=yh(P,L,o,u,p),G=t.prevZ,Q=t.nextZ;G&&G.z>=N&&Q&&Q.z<=Z;){if(G!==t.prev&&G!==t.next&&gf(g.x,g.y,x.x,x.y,S.x,S.y,G.x,G.y)&&Po(G.prev,G,G.next)>=0||(G=G.prevZ,Q!==t.prev&&Q!==t.next&&gf(g.x,g.y,x.x,x.y,S.x,S.y,Q.x,Q.y)&&Po(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;G&&G.z>=N;){if(G!==t.prev&&G!==t.next&&gf(g.x,g.y,x.x,x.y,S.x,S.y,G.x,G.y)&&Po(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;Q&&Q.z<=Z;){if(Q!==t.prev&&Q!==t.next&&gf(g.x,g.y,x.x,x.y,S.x,S.y,Q.x,Q.y)&&Po(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function Vc(t,o,u){var p=t;do{var g=p.prev,x=p.next.next;!_h(g,x)&&up(g,p,p.next,x)&&jc(g,x)&&jc(x,g)&&(o.push(g.i/u),o.push(p.i/u),o.push(x.i/u),vc(p),vc(p.next),p=t=x),p=p.next}while(p!==t);return _l(p)}function op(t,o,u,p,g,x){var S=t;do{for(var P=S.next.next;P!==S.prev;){if(S.i!==P.i&&Cd(S,P)){var L=bh(S,P);return S=_l(S,S.next),L=_l(L,L.next),mf(S,o,u,p,g,x),void mf(L,o,u,p,g,x)}P=P.next}S=S.next}while(S!==t)}function bd(t,o){return t.x-o.x}function Ed(t,o){if(o=function(p,g){var x,S=g,P=p.x,L=p.y,N=-1/0;do{if(L<=S.y&&L>=S.next.y&&S.next.y!==S.y){var Z=S.x+(L-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=P&&Z>N){if(N=Z,Z===P){if(L===S.y)return S;if(L===S.next.y)return S.next}x=S.x<S.next.x?S:S.next}}S=S.next}while(S!==g);if(!x)return null;if(P===N)return x;var G,Q=x,ae=x.x,Ie=x.y,Le=1/0;S=x;do P>=S.x&&S.x>=ae&&P!==S.x&&gf(L<Ie?P:N,L,ae,Ie,L<Ie?N:P,L,S.x,S.y)&&(G=Math.abs(L-S.y)/(P-S.x),jc(S,p)&&(G<Le||G===Le&&(S.x>x.x||S.x===x.x&&sp(x,S)))&&(x=S,Le=G)),S=S.next;while(S!==Q);return x}(t,o)){var u=bh(o,t);_l(o,o.next),_l(u,u.next)}}function sp(t,o){return Po(t.prev,t,o.prev)<0&&Po(o.next,t,t.next)<0}function yh(t,o,u,p,g){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*g)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*g)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Sd(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function gf(t,o,u,p,g,x,S,P){return(g-S)*(o-P)-(t-S)*(x-P)>=0&&(t-S)*(p-P)-(u-S)*(o-P)>=0&&(u-S)*(x-P)-(g-S)*(p-P)>=0}function Cd(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,p){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==p.i&&g.next.i!==p.i&&up(g,g.next,u,p))return!0;g=g.next}while(g!==u);return!1}(t,o)&&(jc(t,o)&&jc(o,t)&&function(u,p){var g=u,x=!1,S=(u.x+p.x)/2,P=(u.y+p.y)/2;do g.y>P!=g.next.y>P&&g.next.y!==g.y&&S<(g.next.x-g.x)*(P-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==u);return x}(t,o)&&(Po(t.prev,t,o.prev)||Po(t,o.prev,o))||_h(t,o)&&Po(t.prev,t,t.next)>0&&Po(o.prev,o,o.next)>0)}function Po(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function _h(t,o){return t.x===o.x&&t.y===o.y}function up(t,o,u,p){var g=Hf(Po(t,o,u)),x=Hf(Po(t,o,p)),S=Hf(Po(u,p,t)),P=Hf(Po(u,p,o));return g!==x&&S!==P||!(g!==0||!xh(t,u,o))||!(x!==0||!xh(t,p,o))||!(S!==0||!xh(u,t,p))||!(P!==0||!xh(u,o,p))}function xh(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function Hf(t){return t>0?1:t<0?-1:0}function jc(t,o){return Po(t.prev,t,t.next)<0?Po(t,o,t.next)>=0&&Po(t,t.prev,o)>=0:Po(t,o,t.prev)<0||Po(t,t.next,o)<0}function bh(t,o){var u=new yf(t.i,t.x,t.y),p=new yf(o.i,o.x,o.y),g=t.next,x=o.prev;return t.next=o,o.prev=t,u.next=g,g.prev=u,p.next=u,u.prev=p,x.next=p,p.prev=x,p}function Wf(t,o,u,p){var g=new yf(t,o,u);return p?(g.next=p.next,g.prev=p,p.next.prev=g,p.next=g):(g.prev=g,g.next=g),g}function vc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function yf(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xf(t,o,u,p){for(var g=0,x=o,S=u-p;x<u;x+=p)g+=(t[S]-t[x])*(t[x+1]+t[S+1]),S=x;return g}function Eh(t,o,u,p,g){(function x(S,P,L,N,Z){for(;N>L;){if(N-L>600){var G=N-L+1,Q=P-L+1,ae=Math.log(G),Ie=.5*Math.exp(2*ae/3),Le=.5*Math.sqrt(ae*Ie*(G-Ie)/G)*(Q-G/2<0?-1:1);x(S,P,Math.max(L,Math.floor(P-Q*Ie/G+Le)),Math.min(N,Math.floor(P+(G-Q)*Ie/G+Le)),Z)}var We=S[P],Ne=L,nt=N;for(xu(S,L,P),Z(S[N],We)>0&&xu(S,L,N);Ne<nt;){for(xu(S,Ne,nt),Ne++,nt--;Z(S[Ne],We)<0;)Ne++;for(;Z(S[nt],We)>0;)nt--}Z(S[L],We)===0?xu(S,L,nt):xu(S,++nt,N),nt<=P&&(L=nt+1),P<=nt&&(N=nt-1)}})(t,o,u||0,p||t.length-1,g||Sh)}function xu(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}function Sh(t,o){return t<o?-1:t>o?1:0}function Yf(t,o){var u=t.length;if(u<=1)return[t];for(var p,g,x=[],S=0;S<u;S++){var P=xr(t[S]);P!==0&&(t[S].area=Math.abs(P),g===void 0&&(g=P<0),g===P<0?(p&&x.push(p),p=[t[S]]):p.push(t[S]))}if(p&&x.push(p),o>1)for(var L=0;L<x.length;L++)x[L].length<=o||(Eh(x[L],o,1,x[L].length-1,Ch),x[L]=x[L].slice(0,o));return x}function Ch(t,o){return o.area-t.area}function _f(t,o,u){for(var p=u.patternDependencies,g=!1,x=0,S=o;x<S.length;x+=1){var P=S[x].paint.get(t+"-pattern");P.isConstant()||(g=!0);var L=P.constantOr(null);L&&(g=!0,p[L.to]=!0,p[L.from]=!0)}return g}function Gc(t,o,u,p,g){for(var x=g.patternDependencies,S=0,P=o;S<P.length;S+=1){var L=P[S],N=L.paint.get(t+"-pattern").value;if(N.kind!=="constant"){var Z=N.evaluate({zoom:p-1},u,{},g.availableImages),G=N.evaluate({zoom:p},u,{},g.availableImages),Q=N.evaluate({zoom:p+1},u,{},g.availableImages);G=G&&G.name?G.name:G,Q=Q&&Q.name?Q.name:Q,x[Z=Z&&Z.name?Z.name:Z]=!0,x[G]=!0,x[Q]=!0,u.patterns[L.id]={min:Z,mid:G,max:Q}}}return u}Gf.deviation=function(t,o,u,p){var g=o&&o.length,x=Math.abs(Xf(t,0,g?o[0]*u:t.length,u));if(g)for(var S=0,P=o.length;S<P;S++)x-=Math.abs(Xf(t,o[S]*u,S<P-1?o[S+1]*u:t.length,u));var L=0;for(S=0;S<p.length;S+=3){var N=p[S]*u,Z=p[S+1]*u,G=p[S+2]*u;L+=Math.abs((t[N]-t[G])*(t[Z+1]-t[N+1])-(t[N]-t[Z])*(t[G+1]-t[N+1]))}return x===0&&L===0?0:Math.abs((L-x)/x)},Gf.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,g=0;g<t.length;g++){for(var x=0;x<t[g].length;x++)for(var S=0;S<o;S++)u.vertices.push(t[g][x][S]);g>0&&u.holes.push(p+=t[g-1].length)}return u},dc.default=Zc;var zs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new uc,this.indexArray=new ml,this.indexArray2=new cc,this.programConfigurations=new jn(t.layers,t.zoom),this.segments=new ue,this.segments2=new ue,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};zs.prototype.populate=function(t,o,u){this.hasPattern=_f("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),g=[],x=0,S=t;x<S.length;x+=1){var P=S[x],L=P.feature,N=P.id,Z=P.index,G=P.sourceLayerIndex,Q=this.layers[0]._featureFilter.needGeometry,ae=so(L,Q);if(this.layers[0]._featureFilter.filter(new Mi(this.zoom),ae,u)){var Ie=p?p.evaluate(ae,{},u,o.availableImages):void 0,Le={id:N,properties:L.properties,type:L.type,sourceLayerIndex:G,index:Z,geometry:Q?ae.geometry:Wa(L),patterns:{},sortKey:Ie};g.push(Le)}}p&&g.sort(function(Cr,Hr){return Cr.sortKey-Hr.sortKey});for(var We=0,Ne=g;We<Ne.length;We+=1){var nt=Ne[We],bt=nt.geometry,jt=nt.index,Ht=nt.sourceLayerIndex;if(this.hasPattern){var ur=Gc("fill",this.layers,nt,this.zoom,o);this.patternFeatures.push(ur)}else this.addFeature(nt,bt,jt,u,{});o.featureIndex.insert(t[jt].feature,bt,jt,Ht,this.index)}},zs.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},zs.prototype.addFeatures=function(t,o,u){for(var p=0,g=this.patternFeatures;p<g.length;p+=1){var x=g[p];this.addFeature(x,x.geometry,x.index,o,u)}},zs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ip),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},zs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},zs.prototype.addFeature=function(t,o,u,p,g){for(var x=0,S=Yf(o,500);x<S.length;x+=1){for(var P=S[x],L=0,N=0,Z=P;N<Z.length;N+=1)L+=Z[N].length;for(var G=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),Q=G.vertexLength,ae=[],Ie=[],Le=0,We=P;Le<We.length;Le+=1){var Ne=We[Le];if(Ne.length!==0){Ne!==P[0]&&Ie.push(ae.length/2);var nt=this.segments2.prepareSegment(Ne.length,this.layoutVertexArray,this.indexArray2),bt=nt.vertexLength;this.layoutVertexArray.emplaceBack(Ne[0].x,Ne[0].y),this.indexArray2.emplaceBack(bt+Ne.length-1,bt),ae.push(Ne[0].x),ae.push(Ne[0].y);for(var jt=1;jt<Ne.length;jt++)this.layoutVertexArray.emplaceBack(Ne[jt].x,Ne[jt].y),this.indexArray2.emplaceBack(bt+jt-1,bt+jt),ae.push(Ne[jt].x),ae.push(Ne[jt].y);nt.vertexLength+=Ne.length,nt.primitiveLength+=Ne.length}}for(var Ht=dc(ae,Ie),ur=0;ur<Ht.length;ur+=3)this.indexArray.emplaceBack(Q+Ht[ur],Q+Ht[ur+1],Q+Ht[ur+2]);G.vertexLength+=L,G.primitiveLength+=Ht.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,p)},dn("FillBucket",zs,{omit:["layers","patternFeatures"]});var qf=new Yo({"fill-sort-key":new Sn(le.layout_fill["fill-sort-key"])}),Kf={paint:new Yo({"fill-antialias":new kn(le.paint_fill["fill-antialias"]),"fill-opacity":new Sn(le.paint_fill["fill-opacity"]),"fill-color":new Sn(le.paint_fill["fill-color"]),"fill-outline-color":new Sn(le.paint_fill["fill-outline-color"]),"fill-translate":new kn(le.paint_fill["fill-translate"]),"fill-translate-anchor":new kn(le.paint_fill["fill-translate-anchor"]),"fill-pattern":new sc(le.paint_fill["fill-pattern"])}),layout:qf},xf=function(t){function o(u){t.call(this,u,Kf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p);var g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new zs(u)},o.prototype.queryRadius=function(){return Na(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,g,x,S,P,L){return ls(uu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,L),x)},o.prototype.isTileClipped=function(){return!0},o}(au),bf=Pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,wh=xl;function xl(t,o,u,p,g){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=g,t.readFields(Hc,this,o)}function Hc(t,o,u){t==1?o.id=u.readVarint():t==2?function(p,g){for(var x=p.readVarint()+p.pos;p.pos<x;){var S=g._keys[p.readVarint()],P=g._values[p.readVarint()];g.properties[S]=P}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function jp(t){for(var o,u,p=0,g=0,x=t.length,S=x-1;g<x;S=g++)p+=((u=t[S]).x-(o=t[g]).x)*(o.y+u.y);return p}xl.types=["Unknown","Point","LineString","Polygon"],xl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,p=1,g=0,x=0,S=0,P=[];t.pos<u;){if(g<=0){var L=t.readVarint();p=7&L,g=L>>3}if(g--,p===1||p===2)x+=t.readSVarint(),S+=t.readSVarint(),p===1&&(o&&P.push(o),o=[]),o.push(new se(x,S));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&P.push(o),P},xl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,p=0,g=0,x=0,S=1/0,P=-1/0,L=1/0,N=-1/0;t.pos<o;){if(p<=0){var Z=t.readVarint();u=7&Z,p=Z>>3}if(p--,u===1||u===2)(g+=t.readSVarint())<S&&(S=g),g>P&&(P=g),(x+=t.readSVarint())<L&&(L=x),x>N&&(N=x);else if(u!==7)throw new Error("unknown command "+u)}return[S,L,P,N]},xl.prototype.toGeoJSON=function(t,o,u){var p,g,x=this.extent*Math.pow(2,u),S=this.extent*t,P=this.extent*o,L=this.loadGeometry(),N=xl.types[this.type];function Z(ae){for(var Ie=0;Ie<ae.length;Ie++){var Le=ae[Ie];ae[Ie]=[360*(Le.x+S)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Le.y+P)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(p=0;p<L.length;p++)G[p]=L[p][0];Z(L=G);break;case 2:for(p=0;p<L.length;p++)Z(L[p]);break;case 3:for(L=function(ae){var Ie=ae.length;if(Ie<=1)return[ae];for(var Le,We,Ne=[],nt=0;nt<Ie;nt++){var bt=jp(ae[nt]);bt!==0&&(We===void 0&&(We=bt<0),We===bt<0?(Le&&Ne.push(Le),Le=[ae[nt]]):Le.push(ae[nt]))}return Le&&Ne.push(Le),Ne}(L),p=0;p<L.length;p++)for(g=0;g<L[p].length;g++)Z(L[p][g])}L.length===1?L=L[0]:N="Multi"+N;var Q={type:"Feature",geometry:{type:N,coordinates:L},properties:this.properties};return"id"in this&&(Q.id=this.id),Q};var Ah=wd;function wd(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields($r,this,o),this.length=this._features.length}function $r(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(p){for(var g=null,x=p.readVarint()+p.pos;p.pos<x;){var S=p.readVarint()>>3;g=S===1?p.readString():S===2?p.readFloat():S===3?p.readDouble():S===4?p.readVarint64():S===5?p.readVarint():S===6?p.readSVarint():S===7?p.readBoolean():null}return g}(u))}function Ad(t,o,u){if(t===3){var p=new Ah(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}wd.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new wh(this._pbf,o,this.extent,this._keys,this._values)};var Nt={VectorTile:function(t,o){this.layers=t.readFields(Ad,{},o)},VectorTileFeature:wh,VectorTileLayer:Ah},Gp=Nt.VectorTileFeature.types,Th=Math.pow(2,13);function Wc(t,o,u,p,g,x,S,P){t.emplaceBack(o,u,2*Math.floor(p*Th)+S,g*Th*2,x*Th*2,Math.round(P))}var Bu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ou,this.indexArray=new ml,this.programConfigurations=new jn(t.layers,t.zoom),this.segments=new ue,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function lp(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}Bu.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=_f("fill-extrusion",this.layers,o);for(var p=0,g=t;p<g.length;p+=1){var x=g[p],S=x.feature,P=x.id,L=x.index,N=x.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,G=so(S,Z);if(this.layers[0]._featureFilter.filter(new Mi(this.zoom),G,u)){var Q={id:P,sourceLayerIndex:N,index:L,geometry:Z?G.geometry:Wa(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Gc("fill-extrusion",this.layers,Q,this.zoom,o)):this.addFeature(Q,Q.geometry,L,u,{}),o.featureIndex.insert(S,Q.geometry,L,N,this.index,!0)}}},Bu.prototype.addFeatures=function(t,o,u){for(var p=0,g=this.features;p<g.length;p+=1){var x=g[p];this.addFeature(x,x.geometry,x.index,o,u)}},Bu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Bu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Bu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Bu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Bu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Bu.prototype.addFeature=function(t,o,u,p,g){for(var x=0,S=Yf(o,500);x<S.length;x+=1){for(var P=S[x],L=0,N=0,Z=P;N<Z.length;N+=1)L+=Z[N].length;for(var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),Q=0,ae=P;Q<ae.length;Q+=1){var Ie=ae[Q];if(Ie.length!==0&&!((Ni=Ie).every(function(wi){return wi.x<0})||Ni.every(function(wi){return wi.x>8192})||Ni.every(function(wi){return wi.y<0})||Ni.every(function(wi){return wi.y>8192})))for(var Le=0,We=0;We<Ie.length;We++){var Ne=Ie[We];if(We>=1){var nt=Ie[We-1];if(!lp(Ne,nt)){G.vertexLength+4>ue.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var bt=Ne.sub(nt)._perp()._unit(),jt=nt.dist(Ne);Le+jt>32768&&(Le=0),Wc(this.layoutVertexArray,Ne.x,Ne.y,bt.x,bt.y,0,0,Le),Wc(this.layoutVertexArray,Ne.x,Ne.y,bt.x,bt.y,0,1,Le),Wc(this.layoutVertexArray,nt.x,nt.y,bt.x,bt.y,0,0,Le+=jt),Wc(this.layoutVertexArray,nt.x,nt.y,bt.x,bt.y,0,1,Le);var Ht=G.vertexLength;this.indexArray.emplaceBack(Ht,Ht+2,Ht+1),this.indexArray.emplaceBack(Ht+1,Ht+2,Ht+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+L>ue.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),Gp[t.type]==="Polygon"){for(var ur=[],Cr=[],Hr=G.vertexLength,Tn=0,Jr=P;Tn<Jr.length;Tn+=1){var Zn=Jr[Tn];if(Zn.length!==0){Zn!==P[0]&&Cr.push(ur.length/2);for(var pn=0;pn<Zn.length;pn++){var Pi=Zn[pn];Wc(this.layoutVertexArray,Pi.x,Pi.y,0,0,1,1,0),ur.push(Pi.x),ur.push(Pi.y)}}}for(var Kn=dc(ur,Cr),Mn=0;Mn<Kn.length;Mn+=3)this.indexArray.emplaceBack(Hr+Kn[Mn],Hr+Kn[Mn+2],Hr+Kn[Mn+1]);G.primitiveLength+=Kn.length/3,G.vertexLength+=L}}var Ni;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,p)},dn("FillExtrusionBucket",Bu,{omit:["layers","features"]});var Td={paint:new Yo({"fill-extrusion-opacity":new kn(le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Sn(le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kn(le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kn(le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sc(le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Sn(le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Sn(le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new kn(le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ku=function(t){function o(u){t.call(this,u,Td)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Bu(u)},o.prototype.queryRadius=function(){return Na(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,g,x,S,P,L,N){var Z=uu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,L),G=this.paint.get("fill-extrusion-height").evaluate(p,g),Q=this.paint.get("fill-extrusion-base").evaluate(p,g),ae=function(Le,We,Ne,nt){for(var bt=[],jt=0,Ht=Le;jt<Ht.length;jt+=1){var ur=Ht[jt],Cr=[ur.x,ur.y,0,1];Ul(Cr,Cr,We),bt.push(new se(Cr[0]/Cr[3],Cr[1]/Cr[3]))}return bt}(Z,N),Ie=function(Le,We,Ne,nt){for(var bt=[],jt=[],Ht=nt[8]*We,ur=nt[9]*We,Cr=nt[10]*We,Hr=nt[11]*We,Tn=nt[8]*Ne,Jr=nt[9]*Ne,Zn=nt[10]*Ne,pn=nt[11]*Ne,Pi=0,Kn=Le;Pi<Kn.length;Pi+=1){for(var Mn=[],Ni=[],wi=0,Ji=Kn[Pi];wi<Ji.length;wi+=1){var Dn=Ji[wi],xi=Dn.x,Ya=Dn.y,ho=nt[0]*xi+nt[4]*Ya+nt[12],lo=nt[1]*xi+nt[5]*Ya+nt[13],Ua=nt[2]*xi+nt[6]*Ya+nt[14],po=nt[3]*xi+nt[7]*Ya+nt[15],as=Ua+Cr,os=po+Hr,Zs=ho+Tn,fs=lo+Jr,ro=Ua+Zn,Io=po+pn,Hi=new se((ho+Ht)/os,(lo+ur)/os);Hi.z=as/os,Mn.push(Hi);var Gi=new se(Zs/Io,fs/Io);Gi.z=ro/Io,Ni.push(Gi)}bt.push(Mn),jt.push(Ni)}return[bt,jt]}(x,Q,G,N);return function(Le,We,Ne){var nt=1/0;ls(Ne,We)&&(nt=Xc(Ne,We[0]));for(var bt=0;bt<We.length;bt++)for(var jt=We[bt],Ht=Le[bt],ur=0;ur<jt.length-1;ur++){var Cr=jt[ur],Hr=[Cr,jt[ur+1],Ht[ur+1],Ht[ur],Cr];Js(Ne,Hr)&&(nt=Math.min(nt,Xc(Ne,Hr)))}return nt!==1/0&&nt}(Ie[0],Ie[1],ae)},o}(au);function bl(t,o){return t.x*o.x+t.y*o.y}function Xc(t,o){if(t.length===1){for(var u,p=0,g=o[p++];!u||g.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var x=o[p],S=t[0],P=u.sub(g),L=x.sub(g),N=S.sub(g),Z=bl(P,P),G=bl(P,L),Q=bl(L,L),ae=bl(N,P),Ie=bl(N,L),Le=Z*Q-G*G,We=(Q*ae-G*Ie)/Le,Ne=(Z*Ie-G*ae)/Le,nt=g.z*(1-We-Ne)+u.z*We+x.z*Ne;if(isFinite(nt))return nt}return 1/0}for(var bt=1/0,jt=0,Ht=o;jt<Ht.length;jt+=1)bt=Math.min(bt,Ht[jt].z);return bt}var mc=Pa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,cp=Pa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Mh=Nt.VectorTileFeature.types,$f=Math.cos(Math.PI/180*37.5),Ph=Math.pow(2,14)/.5,oa=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new oo,this.layoutVertexArray2=new Qs,this.indexArray=new ml,this.programConfigurations=new jn(t.layers,t.zoom),this.segments=new ue,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};oa.prototype.populate=function(t,o,u){this.hasPattern=_f("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),g=[],x=0,S=t;x<S.length;x+=1){var P=S[x],L=P.feature,N=P.id,Z=P.index,G=P.sourceLayerIndex,Q=this.layers[0]._featureFilter.needGeometry,ae=so(L,Q);if(this.layers[0]._featureFilter.filter(new Mi(this.zoom),ae,u)){var Ie=p?p.evaluate(ae,{},u):void 0,Le={id:N,properties:L.properties,type:L.type,sourceLayerIndex:G,index:Z,geometry:Q?ae.geometry:Wa(L),patterns:{},sortKey:Ie};g.push(Le)}}p&&g.sort(function(Cr,Hr){return Cr.sortKey-Hr.sortKey});for(var We=0,Ne=g;We<Ne.length;We+=1){var nt=Ne[We],bt=nt.geometry,jt=nt.index,Ht=nt.sourceLayerIndex;if(this.hasPattern){var ur=Gc("line",this.layers,nt,this.zoom,o);this.patternFeatures.push(ur)}else this.addFeature(nt,bt,jt,u,{});o.featureIndex.insert(t[jt].feature,bt,jt,Ht,this.index)}},oa.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},oa.prototype.addFeatures=function(t,o,u){for(var p=0,g=this.patternFeatures;p<g.length;p+=1){var x=g[p];this.addFeature(x,x.geometry,x.index,o,u)}},oa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},oa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},oa.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,cp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},oa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},oa.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},oa.prototype.addFeature=function(t,o,u,p,g){var x=this.layers[0].layout,S=x.get("line-join").evaluate(t,{}),P=x.get("line-cap"),L=x.get("line-miter-limit"),N=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,G=o;Z<G.length;Z+=1)this.addLine(G[Z],t,S,P,L,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,p)},oa.prototype.addLine=function(t,o,u,p,g,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=Mh[o.type]==="Polygon",L=t.length;L>=2&&t[L-1].equals(t[L-2]);)L--;for(var N=0;N<L-1&&t[N].equals(t[N+1]);)N++;if(!(L<(P?3:2))){u==="bevel"&&(g=1.05);var Z,G=this.overscaling<=16?122880/(512*this.overscaling):0,Q=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray),ae=void 0,Ie=void 0,Le=void 0,We=void 0;this.e1=this.e2=-1,P&&(We=t[N].sub(Z=t[L-2])._unit()._perp());for(var Ne=N;Ne<L;Ne++)if(!(Ie=Ne===L-1?P?t[N+1]:void 0:t[Ne+1])||!t[Ne].equals(Ie)){We&&(Le=We),Z&&(ae=Z),Z=t[Ne],We=Ie?Ie.sub(Z)._unit()._perp():Le;var nt=(Le=Le||We).add(We);nt.x===0&&nt.y===0||nt._unit();var bt=Le.x*We.x+Le.y*We.y,jt=nt.x*We.x+nt.y*We.y,Ht=jt!==0?1/jt:1/0,ur=2*Math.sqrt(2-2*jt),Cr=jt<$f&&ae&&Ie,Hr=Le.x*We.y-Le.y*We.x>0;if(Cr&&Ne>N){var Tn=Z.dist(ae);if(Tn>2*G){var Jr=Z.sub(Z.sub(ae)._mult(G/Tn)._round());this.updateDistance(ae,Jr),this.addCurrentVertex(Jr,Le,0,0,Q),ae=Jr}}var Zn=ae&&Ie,pn=Zn?u:P?"butt":p;if(Zn&&pn==="round"&&(Ht<x?pn="miter":Ht<=2&&(pn="fakeround")),pn==="miter"&&Ht>g&&(pn="bevel"),pn==="bevel"&&(Ht>2&&(pn="flipbevel"),Ht<g&&(pn="miter")),ae&&this.updateDistance(ae,Z),pn==="miter")nt._mult(Ht),this.addCurrentVertex(Z,nt,0,0,Q);else if(pn==="flipbevel"){if(Ht>100)nt=We.mult(-1);else{var Pi=Ht*Le.add(We).mag()/Le.sub(We).mag();nt._perp()._mult(Pi*(Hr?-1:1))}this.addCurrentVertex(Z,nt,0,0,Q),this.addCurrentVertex(Z,nt.mult(-1),0,0,Q)}else if(pn==="bevel"||pn==="fakeround"){var Kn=-Math.sqrt(Ht*Ht-1),Mn=Hr?Kn:0,Ni=Hr?0:Kn;if(ae&&this.addCurrentVertex(Z,Le,Mn,Ni,Q),pn==="fakeround")for(var wi=Math.round(180*ur/Math.PI/20),Ji=1;Ji<wi;Ji++){var Dn=Ji/wi;if(Dn!==.5){var xi=Dn-.5;Dn+=Dn*xi*(Dn-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*xi*xi+(.848013+bt*(.215638*bt-1.06021)))}var Ya=We.sub(Le)._mult(Dn)._add(Le)._unit()._mult(Hr?-1:1);this.addHalfVertex(Z,Ya.x,Ya.y,!1,Hr,0,Q)}Ie&&this.addCurrentVertex(Z,We,-Mn,-Ni,Q)}else if(pn==="butt")this.addCurrentVertex(Z,nt,0,0,Q);else if(pn==="square"){var ho=ae?1:-1;this.addCurrentVertex(Z,nt,ho,ho,Q)}else pn==="round"&&(ae&&(this.addCurrentVertex(Z,Le,0,0,Q),this.addCurrentVertex(Z,Le,1,1,Q,!0)),Ie&&(this.addCurrentVertex(Z,We,-1,-1,Q,!0),this.addCurrentVertex(Z,We,0,0,Q)));if(Cr&&Ne<L-1){var lo=Z.dist(Ie);if(lo>2*G){var Ua=Z.add(Ie.sub(Z)._mult(G/lo)._round());this.updateDistance(Z,Ua),this.addCurrentVertex(Ua,We,0,0,Q),Z=Ua}}}}},oa.prototype.addCurrentVertex=function(t,o,u,p,g,x){x===void 0&&(x=!1);var S=o.y*p-o.x,P=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,x,!1,u,g),this.addHalfVertex(t,S,P,x,!0,-p,g),this.distance>Ph/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,p,g,x))},oa.prototype.addHalfVertex=function(t,o,u,p,g,x,S){var P=.5*(this.lineClips?this.scaledDistance*(Ph-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var L=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),S.primitiveLength++),g?this.e2=L:this.e1=L},oa.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},oa.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},dn("LineBucket",oa,{omit:["layers","patternFeatures"]});var gc=new Yo({"line-cap":new kn(le.layout_line["line-cap"]),"line-join":new Sn(le.layout_line["line-join"]),"line-miter-limit":new kn(le.layout_line["line-miter-limit"]),"line-round-limit":new kn(le.layout_line["line-round-limit"]),"line-sort-key":new Sn(le.layout_line["line-sort-key"])}),xo={paint:new Yo({"line-opacity":new Sn(le.paint_line["line-opacity"]),"line-color":new Sn(le.paint_line["line-color"]),"line-translate":new kn(le.paint_line["line-translate"]),"line-translate-anchor":new kn(le.paint_line["line-translate-anchor"]),"line-width":new Sn(le.paint_line["line-width"]),"line-gap-width":new Sn(le.paint_line["line-gap-width"]),"line-offset":new Sn(le.paint_line["line-offset"]),"line-blur":new Sn(le.paint_line["line-blur"]),"line-dasharray":new us(le.paint_line["line-dasharray"]),"line-pattern":new sc(le.paint_line["line-pattern"]),"line-gradient":new iu(le.paint_line["line-gradient"])}),layout:gc},Us=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new Mi(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,g,x){return p=yt({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,u,p,g,x)},o}(Sn))(xo.paint.properties["line-width"].specification);Us.useIntegerZoom=!0;var Ih=function(t){function o(u){t.call(this,u,xo),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ms,this.gradientVersion=(this.gradientVersion+1)%$e)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=Us.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new oa(u)},o.prototype.queryRadius=function(u){var p=u,g=Hp(Lu("line-width",this,p),Lu("line-gap-width",this,p)),x=Lu("line-offset",this,p);return g/2+Math.abs(x)+Na(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,g,x,S,P,L){var N=uu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,L),Z=L/2*Hp(this.paint.get("line-width").evaluate(p,g),this.paint.get("line-gap-width").evaluate(p,g)),G=this.paint.get("line-offset").evaluate(p,g);return G&&(x=function(Q,ae){for(var Ie=[],Le=new se(0,0),We=0;We<Q.length;We++){for(var Ne=Q[We],nt=[],bt=0;bt<Ne.length;bt++){var jt=Ne[bt],Ht=Ne[bt+1],ur=bt===0?Le:jt.sub(Ne[bt-1])._unit()._perp(),Cr=bt===Ne.length-1?Le:Ht.sub(jt)._unit()._perp(),Hr=ur._add(Cr)._unit();Hr._mult(1/(Hr.x*Cr.x+Hr.y*Cr.y)),nt.push(Hr._mult(ae)._add(jt))}Ie.push(nt)}return Ie}(x,G*L)),function(Q,ae,Ie){for(var Le=0;Le<ae.length;Le++){var We=ae[Le];if(Q.length>=3){for(var Ne=0;Ne<We.length;Ne++)if(gu(Q,We[Ne]))return!0}if(su(Q,We,Ie))return!0}return!1}(N,x,Z)},o.prototype.isTileClipped=function(){return!0},o}(au);function Hp(t,o){return o>0?o+2*t:t}var Md=Pa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Pd=Pa([{name:"a_projected_pos",components:3,type:"Float32"}],4),Id=(Pa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Pa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),fp=(Pa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Od=Pa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Rd(t,o,u){return t.sections.forEach(function(p){p.text=function(g,x,S){var P=x.layout.get("text-transform").evaluate(S,{});return P==="uppercase"?g=g.toLocaleUpperCase():P==="lowercase"&&(g=g.toLocaleLowerCase()),qs.applyArabicShaping&&(g=qs.applyArabicShaping(g)),g}(p.text,o,u)}),t}Pa([{name:"triangle",components:3,type:"Uint16"}]),Pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Pa([{type:"Float32",name:"offsetX"}]),Pa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ef={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Wp=function(t,o,u,p,g){var x,S,P=8*g-p-1,L=(1<<P)-1,N=L>>1,Z=-7,G=u?g-1:0,Q=u?-1:1,ae=t[o+G];for(G+=Q,x=ae&(1<<-Z)-1,ae>>=-Z,Z+=P;Z>0;x=256*x+t[o+G],G+=Q,Z-=8);for(S=x&(1<<-Z)-1,x>>=-Z,Z+=p;Z>0;S=256*S+t[o+G],G+=Q,Z-=8);if(x===0)x=1-N;else{if(x===L)return S?NaN:1/0*(ae?-1:1);S+=Math.pow(2,p),x-=N}return(ae?-1:1)*S*Math.pow(2,x-p)},hp=function(t,o,u,p,g,x){var S,P,L,N=8*x-g-1,Z=(1<<N)-1,G=Z>>1,Q=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,ae=p?0:x-1,Ie=p?1:-1,Le=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(P=isNaN(o)?1:0,S=Z):(S=Math.floor(Math.log(o)/Math.LN2),o*(L=Math.pow(2,-S))<1&&(S--,L*=2),(o+=S+G>=1?Q/L:Q*Math.pow(2,1-G))*L>=2&&(S++,L/=2),S+G>=Z?(P=0,S=Z):S+G>=1?(P=(o*L-1)*Math.pow(2,g),S+=G):(P=o*Math.pow(2,G-1)*Math.pow(2,g),S=0));g>=8;t[u+ae]=255&P,ae+=Ie,P/=256,g-=8);for(S=S<<g|P,N+=g;N>0;t[u+ae]=255&S,ae+=Ie,S/=256,N-=8);t[u+ae-Ie]|=128*Le},Qf=Ia;function Ia(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ia.Varint=0,Ia.Fixed64=1,Ia.Bytes=2,Ia.Fixed32=5;var pp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function El(t){return t.type===Ia.Bytes?t.readVarint()+t.pos:t.pos+1}function Yc(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function dp(t,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var g=u.pos-1;g>=t;g--)u.buf[g+p]=u.buf[g]}function Xp(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function B(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ve(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Be(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Ot(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function sr(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Tt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function er(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function $t(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function or(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function yr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Tr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Mr(t,o,u){t===1&&u.readMessage(jr,o)}function jr(t,o,u){if(t===3){var p=u.readMessage(br,{}),g=p.width,x=p.height,S=p.left,P=p.top,L=p.advance;o.push({id:p.id,bitmap:new yu({width:g+6,height:x+6},p.bitmap),metrics:{width:g,height:x,left:S,top:P,advance:L}})}}function br(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function gr(t){for(var o=0,u=0,p=0,g=t;p<g.length;p+=1){var x=g[p];o+=x.w*x.h,u=Math.max(u,x.w)}t.sort(function(Le,We){return We.h-Le.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],P=0,L=0,N=0,Z=t;N<Z.length;N+=1)for(var G=Z[N],Q=S.length-1;Q>=0;Q--){var ae=S[Q];if(!(G.w>ae.w||G.h>ae.h)){if(G.x=ae.x,G.y=ae.y,L=Math.max(L,G.y+G.h),P=Math.max(P,G.x+G.w),G.w===ae.w&&G.h===ae.h){var Ie=S.pop();Q<S.length&&(S[Q]=Ie)}else G.h===ae.h?(ae.x+=G.w,ae.w-=G.w):G.w===ae.w?(ae.y+=G.h,ae.h-=G.h):(S.push({x:ae.x+G.w,y:ae.y,w:ae.w-G.w,h:G.h}),ae.y+=G.h,ae.h-=G.h);break}}return{w:P,h:L,fill:o/(P*L)||0}}Ia.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),g=p>>3,x=this.pos;this.type=7&p,t(g,o,this),this.pos===x&&this.skip(p)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=or(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Tr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=or(this.buf,this.pos)+4294967296*or(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=or(this.buf,this.pos)+4294967296*Tr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Wp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Wp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(g,x,S){var P,L,N=S.buf;if(P=(112&(L=N[S.pos++]))>>4,L<128||(P|=(127&(L=N[S.pos++]))<<3,L<128)||(P|=(127&(L=N[S.pos++]))<<10,L<128)||(P|=(127&(L=N[S.pos++]))<<17,L<128)||(P|=(127&(L=N[S.pos++]))<<24,L<128)||(P|=(1&(L=N[S.pos++]))<<31,L<128))return Yc(g,P,x);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&pp?function(u,p,g){return pp.decode(u.subarray(p,g))}(this.buf,o,t):function(u,p,g){for(var x="",S=p;S<g;){var P,L,N,Z=u[S],G=null,Q=Z>239?4:Z>223?3:Z>191?2:1;if(S+Q>g)break;Q===1?Z<128&&(G=Z):Q===2?(192&(P=u[S+1]))==128&&(G=(31&Z)<<6|63&P)<=127&&(G=null):Q===3?(L=u[S+2],(192&(P=u[S+1]))==128&&(192&L)==128&&((G=(15&Z)<<12|(63&P)<<6|63&L)<=2047||G>=55296&&G<=57343)&&(G=null)):Q===4&&(L=u[S+2],N=u[S+3],(192&(P=u[S+1]))==128&&(192&L)==128&&(192&N)==128&&((G=(15&Z)<<18|(63&P)<<12|(63&L)<<6|63&N)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,Q=1):G>65535&&(G-=65536,x+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),x+=String.fromCharCode(G),S+=Q}return x}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Ia.Bytes)return t.push(this.readVarint(o));var u=El(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Ia.Bytes)return t.push(this.readSVarint());var o=El(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ia.Bytes)return t.push(this.readBoolean());var o=El(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ia.Bytes)return t.push(this.readFloat());var o=El(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ia.Bytes)return t.push(this.readDouble());var o=El(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ia.Bytes)return t.push(this.readFixed32());var o=El(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ia.Bytes)return t.push(this.readSFixed32());var o=El(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ia.Bytes)return t.push(this.readFixed64());var o=El(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ia.Bytes)return t.push(this.readSFixed64());var o=El(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Ia.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ia.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ia.Fixed32)this.pos+=4;else{if(o!==Ia.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),yr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),yr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),yr(this.buf,-1&t,this.pos),yr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),yr(this.buf,-1&t,this.pos),yr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var p,g;if(o>=0?(p=o%4294967296|0,g=o/4294967296|0):(g=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,g=g+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(x,S,P){P.buf[P.pos++]=127&x|128,x>>>=7,P.buf[P.pos++]=127&x|128,x>>>=7,P.buf[P.pos++]=127&x|128,x>>>=7,P.buf[P.pos++]=127&x|128,P.buf[P.pos]=127&(x>>>=7)}(p,0,u),function(x,S){var P=(7&x)<<4;S.buf[S.pos++]|=P|((x>>>=3)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x)))))}(g,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(p,g,x){for(var S,P,L=0;L<g.length;L++){if((S=g.charCodeAt(L))>55295&&S<57344){if(!P){S>56319||L+1===g.length?(p[x++]=239,p[x++]=191,p[x++]=189):P=S;continue}if(S<56320){p[x++]=239,p[x++]=191,p[x++]=189,P=S;continue}S=P-55296<<10|S-56320|65536,P=null}else P&&(p[x++]=239,p[x++]=191,p[x++]=189,P=null);S<128?p[x++]=S:(S<2048?p[x++]=S>>6|192:(S<65536?p[x++]=S>>12|224:(p[x++]=S>>18|240,p[x++]=S>>12&63|128),p[x++]=S>>6&63|128),p[x++]=63&S|128)}return x}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&dp(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),hp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),hp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var p=this.pos-u;p>=128&&dp(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,o,u){this.writeTag(t,Ia.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Xp,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,B,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Ot,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ve,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Be,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,sr,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Tt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,er,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,$t,o)},writeBytesField:function(t,o){this.writeTag(t,Ia.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Ia.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Ia.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Ia.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Ia.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Ia.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Ia.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Ia.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Ia.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Ia.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var it=function(t,o){var u=o.pixelRatio,p=o.version,g=o.stretchX,x=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=g,this.stretchY=x,this.content=S,this.version=p},Gt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Gt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Gt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Gt.tlbr.get=function(){return this.tl.concat(this.br)},Gt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(it.prototype,Gt);var _r=function(t,o){var u={},p={};this.haveRenderCallbacks=[];var g=[];this.addImages(t,u,g),this.addImages(o,p,g);var x=gr(g),S=new Uo({width:x.w||1,height:x.h||1});for(var P in t){var L=t[P],N=u[P].paddedRect;Uo.copy(L.data,S,{x:0,y:0},{x:N.x+1,y:N.y+1},L.data)}for(var Z in o){var G=o[Z],Q=p[Z].paddedRect,ae=Q.x+1,Ie=Q.y+1,Le=G.data.width,We=G.data.height;Uo.copy(G.data,S,{x:0,y:0},{x:ae,y:Ie},G.data),Uo.copy(G.data,S,{x:0,y:We-1},{x:ae,y:Ie-1},{width:Le,height:1}),Uo.copy(G.data,S,{x:0,y:0},{x:ae,y:Ie+We},{width:Le,height:1}),Uo.copy(G.data,S,{x:Le-1,y:0},{x:ae-1,y:Ie},{width:1,height:We}),Uo.copy(G.data,S,{x:0,y:0},{x:ae+Le,y:Ie},{width:1,height:We})}this.image=S,this.iconPositions=u,this.patternPositions=p};_r.prototype.addImages=function(t,o,u){for(var p in t){var g=t[p],x={x:0,y:0,w:g.data.width+2,h:g.data.height+2};u.push(x),o[p]=new it(x,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},_r.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},_r.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var p=t.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},dn("ImagePosition",it),dn("ImageAtlas",_r);var Br={horizontal:1,vertical:2,horizontalOnly:3},cr=function(){this.scale=1,this.fontStack="",this.imageName=null};cr.forText=function(t,o){var u=new cr;return u.scale=t||1,u.fontStack=o,u},cr.forImage=function(t){var o=new cr;return o.imageName=t,o};var Ir=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Gr(t,o,u,p,g,x,S,P,L,N,Z,G,Q,ae,Ie,Le){var We,Ne=Ir.fromFeature(t,g);G===Br.vertical&&Ne.verticalizePunctuation();var nt=qs.processBidirectionalText,bt=qs.processStyledBidirectionalText;if(nt&&Ne.sections.length===1){We=[];for(var jt=0,Ht=nt(Ne.toString(),Ur(Ne,N,x,o,p,ae,Ie));jt<Ht.length;jt+=1){var ur=Ht[jt],Cr=new Ir;Cr.text=ur,Cr.sections=Ne.sections;for(var Hr=0;Hr<ur.length;Hr++)Cr.sectionIndex.push(0);We.push(Cr)}}else if(bt){We=[];for(var Tn=0,Jr=bt(Ne.text,Ne.sectionIndex,Ur(Ne,N,x,o,p,ae,Ie));Tn<Jr.length;Tn+=1){var Zn=Jr[Tn],pn=new Ir;pn.text=Zn[0],pn.sectionIndex=Zn[1],pn.sections=Ne.sections,We.push(pn)}}else We=function(Mn,Ni){for(var wi=[],Ji=Mn.text,Dn=0,xi=0,Ya=Ni;xi<Ya.length;xi+=1){var ho=Ya[xi];wi.push(Mn.substring(Dn,ho)),Dn=ho}return Dn<Ji.length&&wi.push(Mn.substring(Dn,Ji.length)),wi}(Ne,Ur(Ne,N,x,o,p,ae,Ie));var Pi=[],Kn={positionedLines:Pi,text:Ne.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(Mn,Ni,wi,Ji,Dn,xi,Ya,ho,lo,Ua,po,as){for(var os=0,Zs=-17,fs=0,ro=0,Io=ho==="right"?1:ho==="left"?0:.5,Hi=0,Gi=0,Ra=Dn;Gi<Ra.length;Gi+=1){var Ea=Ra[Gi];Ea.trim();var q=Ea.getMaxScale(),Vs=24*(q-1),Ss={positionedGlyphs:[],lineOffset:0};Mn.positionedLines[Hi]=Ss;var Za=Ss.positionedGlyphs,Oo=0;if(Ea.length()){for(var Cs=0;Cs<Ea.length();Cs++){var ia=Ea.getSection(Cs),Eu=Ea.getSectionIndex(Cs),Su=Ea.getCharCode(Cs),Vl=0,So=null,jl=null,$u=null,Kc=24,eh=!(lo===Br.horizontal||!po&&!nc(Su)||po&&(Bn[Su]||(_c=Su,qr.Arabic(_c)||qr["Arabic Supplement"](_c)||qr["Arabic Extended-A"](_c)||qr["Arabic Presentation Forms-A"](_c)||qr["Arabic Presentation Forms-B"](_c))));if(ia.imageName){var Rh=Ji[ia.imageName];if(!Rh)continue;$u=ia.imageName,Mn.iconsInText=Mn.iconsInText||!0,jl=Rh.paddedRect;var yc=Rh.displaySize;ia.scale=24*ia.scale/as,Vl=Vs+(24-yc[1]*ia.scale),Kc=(So={width:yc[0],height:yc[1],left:1,top:-3,advance:eh?yc[1]:yc[0]}).advance;var th=eh?yc[0]*ia.scale-24*q:yc[1]*ia.scale-24*q;th>0&&th>Oo&&(Oo=th)}else{var mp=wi[ia.fontStack],rh=mp&&mp[Su];if(rh&&rh.rect)jl=rh.rect,So=rh.metrics;else{var kh=Ni[ia.fontStack],wf=kh&&kh[Su];if(!wf)continue;So=wf.metrics}Vl=24*(q-ia.scale)}eh?(Mn.verticalizable=!0,Za.push({glyph:Su,imageName:$u,x:os,y:Zs+Vl,vertical:eh,scale:ia.scale,fontStack:ia.fontStack,sectionIndex:Eu,metrics:So,rect:jl}),os+=Kc*ia.scale+Ua):(Za.push({glyph:Su,imageName:$u,x:os,y:Zs+Vl,vertical:eh,scale:ia.scale,fontStack:ia.fontStack,sectionIndex:Eu,metrics:So,rect:jl}),os+=So.advance*ia.scale+Ua)}Za.length!==0&&(fs=Math.max(os-Ua,fs),mi(Za,0,Za.length-1,Io,Oo)),os=0;var gp=xi*q+Oo;Ss.lineOffset=Math.max(Oo,Vs),Zs+=gp,ro=Math.max(gp,ro),++Hi}else Zs+=xi,++Hi}var _c,Lh=Zs- -17,Dh=Xr(Ya),wl=Dh.horizontalAlign,Fh=Dh.verticalAlign;(function($c,Kp,yp,Qc,_p,Bh,Nh,nh,xp){var ih,zh=(Kp-yp)*_p;ih=Bh!==Nh?-nh*Qc- -17:(-Qc*xp+.5)*Nh;for(var bp=0,Ep=$c;bp<Ep.length;bp+=1)for(var ah=0,Uh=Ep[bp].positionedGlyphs;ah<Uh.length;ah+=1){var Zh=Uh[ah];Zh.x+=zh,Zh.y+=ih}})(Mn.positionedLines,Io,wl,Fh,fs,ro,xi,Lh,Dn.length),Mn.top+=-Fh*Lh,Mn.bottom=Mn.top+Lh,Mn.left+=-wl*fs,Mn.right=Mn.left+fs}(Kn,o,u,p,We,S,P,L,G,N,Q,Le),!function(Mn){for(var Ni=0,wi=Mn;Ni<wi.length;Ni+=1)if(wi[Ni].positionedGlyphs.length!==0)return!1;return!0}(Pi)&&Kn}Ir.fromFeature=function(t,o){for(var u=new Ir,p=0;p<t.sections.length;p++){var g=t.sections[p];g.image?u.addImageSection(g):u.addTextSection(g,o)}return u},Ir.prototype.length=function(){return this.text.length},Ir.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Ir.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Ir.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Ir.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var p=t.charCodeAt(u+1)||null,g=t.charCodeAt(u-1)||null;o+=p&&hl(p)&&!Ef[t[u+1]]||g&&hl(g)&&!Ef[t[u-1]]||!Ef[t[u]]?t[u]:Ef[t[u]]}return o}(this.text)},Ir.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Bn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=t&&Bn[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Ir.prototype.substring=function(t,o){var u=new Ir;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Ir.prototype.toString=function(){return this.text},Ir.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Ir.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(cr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(u)},Ir.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(cr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Qe("Reached maximum number of images 6401")}else Qe("Can't add FormattedSection with an empty image.")},Ir.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Bn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tr={};function rr(t,o,u,p,g,x){if(o.imageName){var S=p[o.imageName];return S?S.displaySize[0]*o.scale*24/x+g:0}var P=u[o.fontStack],L=P&&P[t];return L?L.metrics.advance*o.scale+g:0}function fn(t,o,u,p){var g=Math.pow(t-o,2);return p?t<o?g/2:2*g:g+Math.abs(u)*u}function Nr(t,o,u){var p=0;return t===10&&(p-=1e4),u&&(p+=150),t!==40&&t!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function Er(t,o,u,p,g,x){for(var S=null,P=fn(o,u,g,x),L=0,N=p;L<N.length;L+=1){var Z=N[L],G=fn(o-Z.x,u,g,x)+Z.badness;G<=P&&(S=Z,P=G)}return{index:t,x:o,priorBreak:S,badness:P}}function Ur(t,o,u,p,g,x,S){if(x!=="point")return[];if(!t)return[];for(var P,L=[],N=function(We,Ne,nt,bt,jt,Ht){for(var ur=0,Cr=0;Cr<We.length();Cr++){var Hr=We.getSection(Cr);ur+=rr(We.getCharCode(Cr),Hr,bt,jt,Ne,Ht)}return ur/Math.max(1,Math.ceil(ur/nt))}(t,o,u,p,g,S),Z=t.text.indexOf("\u200B")>=0,G=0,Q=0;Q<t.length();Q++){var ae=t.getSection(Q),Ie=t.getCharCode(Q);if(Bn[Ie]||(G+=rr(Ie,ae,p,g,o,S)),Q<t.length()-1){var Le=!((P=Ie)<11904||!(qr["Bopomofo Extended"](P)||qr.Bopomofo(P)||qr["CJK Compatibility Forms"](P)||qr["CJK Compatibility Ideographs"](P)||qr["CJK Compatibility"](P)||qr["CJK Radicals Supplement"](P)||qr["CJK Strokes"](P)||qr["CJK Symbols and Punctuation"](P)||qr["CJK Unified Ideographs Extension A"](P)||qr["CJK Unified Ideographs"](P)||qr["Enclosed CJK Letters and Months"](P)||qr["Halfwidth and Fullwidth Forms"](P)||qr.Hiragana(P)||qr["Ideographic Description Characters"](P)||qr["Kangxi Radicals"](P)||qr["Katakana Phonetic Extensions"](P)||qr.Katakana(P)||qr["Vertical Forms"](P)||qr["Yi Radicals"](P)||qr["Yi Syllables"](P)));(tr[Ie]||Le||ae.imageName)&&L.push(Er(Q+1,G,N,L,Nr(Ie,t.getCharCode(Q+1),Le&&Z),!1))}}return function We(Ne){return Ne?We(Ne.priorBreak).concat(Ne.index):[]}(Er(t.length(),G,N,L,0,!0))}function Xr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function mi(t,o,u,p,g){if(p||g)for(var x=t[u],S=(t[u].x+x.metrics.advance*x.scale)*p,P=o;P<=u;P++)t[P].x-=S,t[P].y+=g}function ri(t,o,u,p,g,x){var S,P=t.image;if(P.content){var L=P.content,N=P.pixelRatio||1;S=[L[0]/N,L[1]/N,P.displaySize[0]-L[2]/N,P.displaySize[1]-L[3]/N]}var Z,G,Q,ae,Ie=o.left*x,Le=o.right*x;u==="width"||u==="both"?(ae=g[0]+Ie-p[3],G=g[0]+Le+p[1]):G=(ae=g[0]+(Ie+Le-P.displaySize[0])/2)+P.displaySize[0];var We=o.top*x,Ne=o.bottom*x;return u==="height"||u==="both"?(Z=g[1]+We-p[0],Q=g[1]+Ne+p[2]):Q=(Z=g[1]+(We+Ne-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:Z,right:G,bottom:Q,left:ae,collisionPadding:S}}tr[10]=!0,tr[32]=!0,tr[38]=!0,tr[40]=!0,tr[41]=!0,tr[43]=!0,tr[45]=!0,tr[47]=!0,tr[173]=!0,tr[183]=!0,tr[8203]=!0,tr[8208]=!0,tr[8211]=!0,tr[8231]=!0;var Yr=function(t){function o(u,p,g,x){t.call(this,u,p),this.angle=g,x!==void 0&&(this.segment=x)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(se);function rn(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Mi(t+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,g=u.interpolationType,x=0;x<p.length&&p[x]<=t;)x++;for(var S=x=Math.max(0,x-1);S<p.length&&p[S]<t+1;)S++;S=Math.min(p.length-1,S);var P=p[x],L=p[S];return u.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:L,interpolationType:g}:{kind:"camera",minZoom:P,maxZoom:L,minSize:u.evaluate(new Mi(P)),maxSize:u.evaluate(new Mi(L)),interpolationType:g}}function Yn(t,o,u){var p=o.uSize,g=u.lowerSize;return t.kind==="source"?g/128:t.kind==="composite"?va(g/128,u.upperSize/128,o.uSizeT):p}function hi(t,o){var u=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var g=t.interpolationType,x=g?Jt(me.interpolationFactor(g,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=va(t.minSize,t.maxSize,x):u=x}return{uSizeT:u,uSize:p}}dn("Anchor",Yr);var Fi=Object.freeze({__proto__:null,getSizeData:rn,evaluateSizeForFeature:Yn,evaluateSizeForZoom:hi,SIZE_PACK_FACTOR:128});function Xa(t,o,u,p,g){if(o.segment===void 0)return!0;for(var x=o,S=o.segment+1,P=0;P>-u/2;){if(--S<0)return!1;P-=t[S].dist(x),x=t[S]}P+=t[S].dist(t[S+1]),S++;for(var L=[],N=0;P<u/2;){var Z=t[S],G=t[S+1];if(!G)return!1;var Q=t[S-1].angleTo(Z)-Z.angleTo(G);for(Q=Math.abs((Q+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:P,angleDelta:Q}),N+=Q;P-L[0].distance>p;)N-=L.shift().angleDelta;if(N>g)return!1;S++,P+=Z.dist(G)}return!0}function uo(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function ki(t,o,u){return t?.6*o*u:0}function qo(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function za(t,o,u,p,g,x){for(var S=ki(u,g,x),P=qo(u,p)*x,L=0,N=uo(t)/2,Z=0;Z<t.length-1;Z++){var G=t[Z],Q=t[Z+1],ae=G.dist(Q);if(L+ae>N){var Ie=(N-L)/ae,Le=va(G.x,Q.x,Ie),We=va(G.y,Q.y,Ie),Ne=new Yr(Le,We,Q.angleTo(G),Z);return Ne._round(),!S||Xa(t,Ne,P,S,o)?Ne:void 0}L+=ae}}function Ko(t,o,u,p,g,x,S,P,L){var N=ki(p,x,S),Z=qo(p,g),G=Z*S,Q=t[0].x===0||t[0].x===L||t[0].y===0||t[0].y===L;return o-G<o/4&&(o=G+o/4),function ae(Ie,Le,We,Ne,nt,bt,jt,Ht,ur){for(var Cr=bt/2,Hr=uo(Ie),Tn=0,Jr=Le-We,Zn=[],pn=0;pn<Ie.length-1;pn++){for(var Pi=Ie[pn],Kn=Ie[pn+1],Mn=Pi.dist(Kn),Ni=Kn.angleTo(Pi);Jr+We<Tn+Mn;){var wi=((Jr+=We)-Tn)/Mn,Ji=va(Pi.x,Kn.x,wi),Dn=va(Pi.y,Kn.y,wi);if(Ji>=0&&Ji<ur&&Dn>=0&&Dn<ur&&Jr-Cr>=0&&Jr+Cr<=Hr){var xi=new Yr(Ji,Dn,Ni,pn);xi._round(),Ne&&!Xa(Ie,xi,bt,Ne,nt)||Zn.push(xi)}}Tn+=Mn}return Ht||Zn.length||jt||(Zn=ae(Ie,Tn/2,We,Ne,nt,bt,jt,!0,ur)),Zn}(t,Q?o/2*P%o:(Z/2+2*x)*S*P%o,o,N,u,G,Q,!1,L)}function bo(t,o,u,p,g){for(var x=[],S=0;S<t.length;S++)for(var P=t[S],L=void 0,N=0;N<P.length-1;N++){var Z=P[N],G=P[N+1];Z.x<o&&G.x<o||(Z.x<o?Z=new se(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x<o&&(G=new se(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y<u&&G.y<u||(Z.y<u?Z=new se(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round():G.y<u&&(G=new se(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round()),Z.x>=p&&G.x>=p||(Z.x>=p?Z=new se(p,Z.y+(p-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x>=p&&(G=new se(p,Z.y+(p-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y>=g&&G.y>=g||(Z.y>=g?Z=new se(Z.x+(g-Z.y)/(G.y-Z.y)*(G.x-Z.x),g)._round():G.y>=g&&(G=new se(Z.x+(g-Z.y)/(G.y-Z.y)*(G.x-Z.x),g)._round()),L&&Z.equals(L[L.length-1])||x.push(L=[Z]),L.push(G)))))}return x}function $o(t,o,u,p){var g=[],x=t.image,S=x.pixelRatio,P=x.paddedRect.w-2,L=x.paddedRect.h-2,N=t.right-t.left,Z=t.bottom-t.top,G=x.stretchX||[[0,P]],Q=x.stretchY||[[0,L]],ae=function(Ji,Dn){return Ji+Dn[1]-Dn[0]},Ie=G.reduce(ae,0),Le=Q.reduce(ae,0),We=P-Ie,Ne=L-Le,nt=0,bt=Ie,jt=0,Ht=Le,ur=0,Cr=We,Hr=0,Tn=Ne;if(x.content&&p){var Jr=x.content;nt=Zo(G,0,Jr[0]),jt=Zo(Q,0,Jr[1]),bt=Zo(G,Jr[0],Jr[2]),Ht=Zo(Q,Jr[1],Jr[3]),ur=Jr[0]-nt,Hr=Jr[1]-jt,Cr=Jr[2]-Jr[0]-bt,Tn=Jr[3]-Jr[1]-Ht}var Zn=function(Ji,Dn,xi,Ya){var ho=to(Ji.stretch-nt,bt,N,t.left),lo=_i(Ji.fixed-ur,Cr,Ji.stretch,Ie),Ua=to(Dn.stretch-jt,Ht,Z,t.top),po=_i(Dn.fixed-Hr,Tn,Dn.stretch,Le),as=to(xi.stretch-nt,bt,N,t.left),os=_i(xi.fixed-ur,Cr,xi.stretch,Ie),Zs=to(Ya.stretch-jt,Ht,Z,t.top),fs=_i(Ya.fixed-Hr,Tn,Ya.stretch,Le),ro=new se(ho,Ua),Io=new se(as,Ua),Hi=new se(as,Zs),Gi=new se(ho,Zs),Ra=new se(lo/S,po/S),Ea=new se(os/S,fs/S),q=o*Math.PI/180;if(q){var Vs=Math.sin(q),Ss=Math.cos(q),Za=[Ss,-Vs,Vs,Ss];ro._matMult(Za),Io._matMult(Za),Gi._matMult(Za),Hi._matMult(Za)}var Oo=Ji.stretch+Ji.fixed,Cs=Dn.stretch+Dn.fixed;return{tl:ro,tr:Io,bl:Gi,br:Hi,tex:{x:x.paddedRect.x+1+Oo,y:x.paddedRect.y+1+Cs,w:xi.stretch+xi.fixed-Oo,h:Ya.stretch+Ya.fixed-Cs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ra,pixelOffsetBR:Ea,minFontScaleX:Cr/S/N,minFontScaleY:Tn/S/Z,isSDF:u}};if(p&&(x.stretchX||x.stretchY))for(var pn=rs(G,We,Ie),Pi=rs(Q,Ne,Le),Kn=0;Kn<pn.length-1;Kn++)for(var Mn=pn[Kn],Ni=pn[Kn+1],wi=0;wi<Pi.length-1;wi++)g.push(Zn(Mn,Pi[wi],Ni,Pi[wi+1]));else g.push(Zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:L+1}));return g}function Zo(t,o,u){for(var p=0,g=0,x=t;g<x.length;g+=1){var S=x[g];p+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return p}function rs(t,o,u){for(var p=[{fixed:-1,stretch:0}],g=0,x=t;g<x.length;g+=1){var S=x[g],P=S[0],L=S[1],N=p[p.length-1];p.push({fixed:P-N.stretch,stretch:N.stretch}),p.push({fixed:P-N.stretch,stretch:N.stretch+(L-P)})}return p.push({fixed:o+1,stretch:u}),p}function to(t,o,u,p){return t/o*u+p}function _i(t,o,u,p){return t-o*u/p}var Vo=function(t,o,u,p,g,x,S,P,L,N){if(this.boxStartIndex=t.length,L){var Z=x.top,G=x.bottom,Q=x.collisionPadding;Q&&(Z-=Q[1],G+=Q[3]);var ae=G-Z;ae>0&&(ae=Math.max(10,ae),this.circleDiameter=ae)}else{var Ie=x.top*S-P,Le=x.bottom*S+P,We=x.left*S-P,Ne=x.right*S+P,nt=x.collisionPadding;if(nt&&(We-=nt[0]*S,Ie-=nt[1]*S,Ne+=nt[2]*S,Le+=nt[3]*S),N){var bt=new se(We,Ie),jt=new se(Ne,Ie),Ht=new se(We,Le),ur=new se(Ne,Le),Cr=N*Math.PI/180;bt._rotate(Cr),jt._rotate(Cr),Ht._rotate(Cr),ur._rotate(Cr),We=Math.min(bt.x,jt.x,Ht.x,ur.x),Ne=Math.max(bt.x,jt.x,Ht.x,ur.x),Ie=Math.min(bt.y,jt.y,Ht.y,ur.y),Le=Math.max(bt.y,jt.y,Ht.y,ur.y)}t.emplaceBack(o.x,o.y,We,Ie,Ne,Le,u,p,g)}this.boxEndIndex=t.length},Yi=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=ns),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function ns(t,o){return t<o?-1:t>o?1:0}function ni(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,g=1/0,x=-1/0,S=-1/0,P=t[0],L=0;L<P.length;L++){var N=P[L];(!L||N.x<p)&&(p=N.x),(!L||N.y<g)&&(g=N.y),(!L||N.x>x)&&(x=N.x),(!L||N.y>S)&&(S=N.y)}var Z=Math.min(x-p,S-g),G=Z/2,Q=new Yi([],Li);if(Z===0)return new se(p,g);for(var ae=p;ae<x;ae+=Z)for(var Ie=g;Ie<S;Ie+=Z)Q.push(new sa(ae+G,Ie+G,G,t));for(var Le=function(nt){for(var bt=0,jt=0,Ht=0,ur=nt[0],Cr=0,Hr=ur.length,Tn=Hr-1;Cr<Hr;Tn=Cr++){var Jr=ur[Cr],Zn=ur[Tn],pn=Jr.x*Zn.y-Zn.x*Jr.y;jt+=(Jr.x+Zn.x)*pn,Ht+=(Jr.y+Zn.y)*pn,bt+=3*pn}return new sa(jt/bt,Ht/bt,0,nt)}(t),We=Q.length;Q.length;){var Ne=Q.pop();(Ne.d>Le.d||!Le.d)&&(Le=Ne,u&&console.log("found best %d after %d probes",Math.round(1e4*Ne.d)/1e4,We)),Ne.max-Le.d<=o||(Q.push(new sa(Ne.p.x-(G=Ne.h/2),Ne.p.y-G,G,t)),Q.push(new sa(Ne.p.x+G,Ne.p.y-G,G,t)),Q.push(new sa(Ne.p.x-G,Ne.p.y+G,G,t)),Q.push(new sa(Ne.p.x+G,Ne.p.y+G,G,t)),We+=4)}return u&&(console.log("num probes: "+We),console.log("best distance: "+Le.d)),Le.p}function Li(t,o){return o.max-t.max}function sa(t,o,u,p){this.p=new se(t,o),this.h=u,this.d=function(g,x){for(var S=!1,P=1/0,L=0;L<x.length;L++)for(var N=x[L],Z=0,G=N.length,Q=G-1;Z<G;Q=Z++){var ae=N[Z],Ie=N[Q];ae.y>g.y!=Ie.y>g.y&&g.x<(Ie.x-ae.x)*(g.y-ae.y)/(Ie.y-ae.y)+ae.x&&(S=!S),P=Math.min(P,yl(g,ae,Ie))}return(S?1:-1)*Math.sqrt(P)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}Yi.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Yi.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},Yi.prototype.peek=function(){return this.data[0]},Yi.prototype._up=function(t){for(var o=this.data,u=this.compare,p=o[t];t>0;){var g=t-1>>1,x=o[g];if(u(p,x)>=0)break;o[t]=x,t=g}o[t]=p},Yi.prototype._down=function(t){for(var o=this.data,u=this.compare,p=this.length>>1,g=o[t];t<p;){var x=1+(t<<1),S=o[x],P=x+1;if(P<this.length&&u(o[P],S)<0&&(x=P,S=o[P]),u(S,g)>=0)break;o[t]=S,t=x}o[t]=g};var Eo=Number.POSITIVE_INFINITY;function Sl(t,o){return o[1]!==Eo?function(u,p,g){var x=0,S=0;switch(p=Math.abs(p),g=Math.abs(g),u){case"top-right":case"top-left":case"top":S=g-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-g}switch(u){case"top-right":case"bottom-right":case"right":x=-p;break;case"top-left":case"bottom-left":case"left":x=p}return[x,S]}(t,o[0],o[1]):function(u,p){var g=0,x=0;p<0&&(p=0);var S=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":x=S-7;break;case"bottom-right":case"bottom-left":x=7-S;break;case"bottom":x=7-p;break;case"top":x=p-7}switch(u){case"top-right":case"bottom-right":g=-S;break;case"top-left":case"bottom-left":g=S;break;case"left":g=p;break;case"right":g=-p}return[g,x]}(t,o[0])}function Te(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dt(t,o,u,p,g,x,S,P,L,N,Z,G,Q,ae,Ie){var Le=function(jt,Ht,ur,Cr,Hr,Tn,Jr,Zn){for(var pn=Cr.layout.get("text-rotate").evaluate(Tn,{})*Math.PI/180,Pi=[],Kn=0,Mn=Ht.positionedLines;Kn<Mn.length;Kn+=1)for(var Ni=Mn[Kn],wi=0,Ji=Ni.positionedGlyphs;wi<Ji.length;wi+=1){var Dn=Ji[wi];if(Dn.rect){var xi=Dn.rect||{},Ya=4,ho=!0,lo=1,Ua=0,po=(Hr||Zn)&&Dn.vertical,as=Dn.metrics.advance*Dn.scale/2;if(Zn&&Ht.verticalizable&&(Ua=Ni.lineOffset/2-(Dn.imageName?-(24-Dn.metrics.width*Dn.scale)/2:24*(Dn.scale-1))),Dn.imageName){var os=Jr[Dn.imageName];ho=os.sdf,Ya=1/(lo=os.pixelRatio)}var Zs=Hr?[Dn.x+as,Dn.y]:[0,0],fs=Hr?[0,0]:[Dn.x+as+ur[0],Dn.y+ur[1]-Ua],ro=[0,0];po&&(ro=fs,fs=[0,0]);var Io=(Dn.metrics.left-Ya)*Dn.scale-as+fs[0],Hi=(-Dn.metrics.top-Ya)*Dn.scale+fs[1],Gi=Io+xi.w*Dn.scale/lo,Ra=Hi+xi.h*Dn.scale/lo,Ea=new se(Io,Hi),q=new se(Gi,Hi),Vs=new se(Io,Ra),Ss=new se(Gi,Ra);if(po){var Za=new se(-as,as- -17),Oo=-Math.PI/2,Cs=12-as,ia=new se(22-Cs,-(Dn.imageName?Cs:0)),Eu=new(Function.prototype.bind.apply(se,[null].concat(ro)));Ea._rotateAround(Oo,Za)._add(ia)._add(Eu),q._rotateAround(Oo,Za)._add(ia)._add(Eu),Vs._rotateAround(Oo,Za)._add(ia)._add(Eu),Ss._rotateAround(Oo,Za)._add(ia)._add(Eu)}if(pn){var Su=Math.sin(pn),Vl=Math.cos(pn),So=[Vl,-Su,Su,Vl];Ea._matMult(So),q._matMult(So),Vs._matMult(So),Ss._matMult(So)}var jl=new se(0,0),$u=new se(0,0);Pi.push({tl:Ea,tr:q,bl:Vs,br:Ss,tex:xi,writingMode:Ht.writingMode,glyphOffset:Zs,sectionIndex:Dn.sectionIndex,isSDF:ho,pixelOffsetTL:jl,pixelOffsetBR:$u,minFontScaleX:0,minFontScaleY:0})}}return Pi}(0,u,P,g,x,S,p,t.allowVerticalPlacement),We=t.textSizeData,Ne=null;We.kind==="source"?(Ne=[128*g.layout.get("text-size").evaluate(S,{})])[0]>32640&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):We.kind==="composite"&&((Ne=[128*ae.compositeTextSizes[0].evaluate(S,{},Ie),128*ae.compositeTextSizes[1].evaluate(S,{},Ie)])[0]>32640||Ne[1]>32640)&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Le,Ne,P,x,S,N,o,L.lineStartIndex,L.lineLength,Q,Ie);for(var nt=0,bt=Z;nt<bt.length;nt+=1)G[bt[nt]]=t.text.placedSymbolArray.length-1;return 4*Le.length}function xt(t){for(var o in t)return t[o];return null}function vn(t,o,u,p){var g=t.compareText;if(o in g){for(var x=g[o],S=x.length-1;S>=0;S--)if(p.dist(x[S])<u)return!0}else g[o]=[];return g[o].push(p),!1}var Bi=Nt.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function oe(t,o,u,p,g,x,S,P,L,N,Z,G,Q){var ae=P?Math.min(32640,Math.round(P[0])):0,Ie=P?Math.min(32640,Math.round(P[1])):0;t.emplaceBack(o,u,Math.round(32*p),Math.round(32*g),x,S,(ae<<1)+(L?1:0),Ie,16*N,16*Z,256*G,256*Q)}function Ve(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function at(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(ic(u[o].text))return!0;return!1}var Mt=function(t){this.layoutVertexArray=new Ru,this.indexArray=new ml,this.programConfigurations=t,this.segments=new ue,this.dynamicLayoutVertexArray=new mu,this.opacityVertexArray=new ks,this.placedSymbolArray=new d};Mt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Mt.prototype.upload=function(t,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Md.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Pd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))},Mt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},dn("SymbolBuffers",Mt);var Ye=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new ue,this.collisionVertexArray=new Vf};Ye.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Id.members,!0)},Ye.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},dn("CollisionBuffers",Ye);var Fe=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(x){return x.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=cs([]),this.placementViewportMatrix=cs([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rn(this.zoom,o["text-size"]),this.iconSizeData=rn(this.zoom,o["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(x){return Br[x]})),this.stateDependentLayerIds=this.layers.filter(function(x){return x.isStateDependent()}).map(function(x){return x.id}),this.sourceID=t.sourceID};Fe.prototype.createArrays=function(){this.text=new Mt(new jn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Mt(new jn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new M,this.lineVertexArray=new R,this.symbolInstances=new C},Fe.prototype.calculateGlyphDependencies=function(t,o,u,p,g){for(var x=0;x<t.length;x++)if(o[t.charCodeAt(x)]=!0,(u||p)&&g){var S=Ef[t.charAt(x)];S&&(o[S.charCodeAt(0)]=!0)}},Fe.prototype.populate=function(t,o,u){var p=this.layers[0],g=p.layout,x=g.get("text-font"),S=g.get("text-field"),P=g.get("icon-image"),L=(S.value.kind!=="constant"||S.value.value instanceof Wr&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),N=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,Z=g.get("symbol-sort-key");if(this.features=[],L||N){for(var G=o.iconDependencies,Q=o.glyphDependencies,ae=o.availableImages,Ie=new Mi(this.zoom),Le=0,We=t;Le<We.length;Le+=1){var Ne=We[Le],nt=Ne.feature,bt=Ne.id,jt=Ne.index,Ht=Ne.sourceLayerIndex,ur=p._featureFilter.needGeometry,Cr=so(nt,ur);if(p._featureFilter.filter(Ie,Cr,u)){ur||(Cr.geometry=Wa(nt));var Hr=void 0;if(L){var Tn=p.getValueAndResolveTokens("text-field",Cr,u,ae),Jr=Wr.factory(Tn);at(Jr)&&(this.hasRTLText=!0),(!this.hasRTLText||Uf()==="unavailable"||this.hasRTLText&&qs.isParsed())&&(Hr=Rd(Jr,p,Cr))}var Zn=void 0;if(N){var pn=p.getValueAndResolveTokens("icon-image",Cr,u,ae);Zn=pn instanceof At?pn:At.fromString(pn)}if(Hr||Zn){var Pi=this.sortFeaturesByKey?Z.evaluate(Cr,{},u):void 0;if(this.features.push({id:bt,text:Hr,icon:Zn,index:jt,sourceLayerIndex:Ht,geometry:Cr.geometry,properties:nt.properties,type:Bi[nt.type],sortKey:Pi}),Zn&&(G[Zn.name]=!0),Hr){var Kn=x.evaluate(Cr,{},u).join(","),Mn=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Br.vertical)>=0;for(var Ni=0,wi=Hr.sections;Ni<wi.length;Ni+=1){var Ji=wi[Ni];if(Ji.image)G[Ji.image.name]=!0;else{var Dn=Bl(Hr.toString()),xi=Ji.fontStack||Kn,Ya=Q[xi]=Q[xi]||{};this.calculateGlyphDependencies(Ji.text,Ya,Mn,this.allowVerticalPlacement,Dn)}}}}}}g.get("symbol-placement")==="line"&&(this.features=function(ho){var lo={},Ua={},po=[],as=0;function os(Za){po.push(ho[Za]),as++}function Zs(Za,Oo,Cs){var ia=Ua[Za];return delete Ua[Za],Ua[Oo]=ia,po[ia].geometry[0].pop(),po[ia].geometry[0]=po[ia].geometry[0].concat(Cs[0]),ia}function fs(Za,Oo,Cs){var ia=lo[Oo];return delete lo[Oo],lo[Za]=ia,po[ia].geometry[0].shift(),po[ia].geometry[0]=Cs[0].concat(po[ia].geometry[0]),ia}function ro(Za,Oo,Cs){var ia=Cs?Oo[0][Oo[0].length-1]:Oo[0][0];return Za+":"+ia.x+":"+ia.y}for(var Io=0;Io<ho.length;Io++){var Hi=ho[Io],Gi=Hi.geometry,Ra=Hi.text?Hi.text.toString():null;if(Ra){var Ea=ro(Ra,Gi),q=ro(Ra,Gi,!0);if(Ea in Ua&&q in lo&&Ua[Ea]!==lo[q]){var Vs=fs(Ea,q,Gi),Ss=Zs(Ea,q,po[Vs].geometry);delete lo[Ea],delete Ua[q],Ua[ro(Ra,po[Ss].geometry,!0)]=Ss,po[Vs].geometry=null}else Ea in Ua?Zs(Ea,q,Gi):q in lo?fs(Ea,q,Gi):(os(Io),lo[Ea]=as-1,Ua[q]=as-1)}else os(Io)}return po.filter(function(Za){return Za.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(ho,lo){return ho.sortKey-lo.sortKey})}},Fe.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Fe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Fe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Fe.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Fe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Fe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Fe.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(o[t.segment+1]),g=t.dist(o[t.segment]),x={},S=t.segment+1;S<o.length;S++)x[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:p},S<o.length-1&&(p+=o[S+1].dist(o[S]));for(var P=t.segment||0;P>=0;P--)x[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:g},P>0&&(g+=o[P-1].dist(o[P]));for(var L=0;L<o.length;L++){var N=x[L];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Fe.prototype.addSymbols=function(t,o,u,p,g,x,S,P,L,N,Z,G){for(var Q=t.indexArray,ae=t.layoutVertexArray,Ie=t.segments.prepareSegment(4*o.length,ae,Q,this.canOverlap?x.sortKey:void 0),Le=this.glyphOffsetArray.length,We=Ie.vertexLength,Ne=this.allowVerticalPlacement&&S===Br.vertical?Math.PI/2:0,nt=x.text&&x.text.sections,bt=0;bt<o.length;bt++){var jt=o[bt],Ht=jt.tl,ur=jt.tr,Cr=jt.bl,Hr=jt.br,Tn=jt.tex,Jr=jt.pixelOffsetTL,Zn=jt.pixelOffsetBR,pn=jt.minFontScaleX,Pi=jt.minFontScaleY,Kn=jt.glyphOffset,Mn=jt.isSDF,Ni=jt.sectionIndex,wi=Ie.vertexLength,Ji=Kn[1];oe(ae,P.x,P.y,Ht.x,Ji+Ht.y,Tn.x,Tn.y,u,Mn,Jr.x,Jr.y,pn,Pi),oe(ae,P.x,P.y,ur.x,Ji+ur.y,Tn.x+Tn.w,Tn.y,u,Mn,Zn.x,Jr.y,pn,Pi),oe(ae,P.x,P.y,Cr.x,Ji+Cr.y,Tn.x,Tn.y+Tn.h,u,Mn,Jr.x,Zn.y,pn,Pi),oe(ae,P.x,P.y,Hr.x,Ji+Hr.y,Tn.x+Tn.w,Tn.y+Tn.h,u,Mn,Zn.x,Zn.y,pn,Pi),Ve(t.dynamicLayoutVertexArray,P,Ne),Q.emplaceBack(wi,wi+1,wi+2),Q.emplaceBack(wi+1,wi+2,wi+3),Ie.vertexLength+=4,Ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Kn[0]),bt!==o.length-1&&Ni===o[bt+1].sectionIndex||t.programConfigurations.populatePaintArrays(ae.length,x,x.index,{},G,nt&&nt[Ni])}t.placedSymbolArray.emplaceBack(P.x,P.y,Le,this.glyphOffsetArray.length-Le,We,L,N,P.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],S,0,!1,0,Z)},Fe.prototype._addCollisionDebugVertex=function(t,o,u,p,g,x){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,p,g,Math.round(x.x),Math.round(x.y))},Fe.prototype.addCollisionDebugVertices=function(t,o,u,p,g,x,S){var P=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),L=P.vertexLength,N=g.layoutVertexArray,Z=g.collisionVertexArray,G=S.anchorX,Q=S.anchorY;this._addCollisionDebugVertex(N,Z,x,G,Q,new se(t,o)),this._addCollisionDebugVertex(N,Z,x,G,Q,new se(u,o)),this._addCollisionDebugVertex(N,Z,x,G,Q,new se(u,p)),this._addCollisionDebugVertex(N,Z,x,G,Q,new se(t,p)),P.vertexLength+=4;var ae=g.indexArray;ae.emplaceBack(L,L+1),ae.emplaceBack(L+1,L+2),ae.emplaceBack(L+2,L+3),ae.emplaceBack(L+3,L),P.primitiveLength+=4},Fe.prototype.addDebugCollisionBoxes=function(t,o,u,p){for(var g=t;g<o;g++){var x=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,p?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,u)}},Fe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ye(lc,fp.members,cc),this.iconCollisionBox=new Ye(lc,fp.members,cc);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Fe.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,p,g,x,S,P,L){for(var N={},Z=o;Z<u;Z++){var G=t.get(Z);N.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.textFeatureIndex=G.featureIndex;break}for(var Q=p;Q<g;Q++){var ae=t.get(Q);N.verticalTextBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},N.verticalTextFeatureIndex=ae.featureIndex;break}for(var Ie=x;Ie<S;Ie++){var Le=t.get(Ie);N.iconBox={x1:Le.x1,y1:Le.y1,x2:Le.x2,y2:Le.y2,anchorPointX:Le.anchorPointX,anchorPointY:Le.anchorPointY},N.iconFeatureIndex=Le.featureIndex;break}for(var We=P;We<L;We++){var Ne=t.get(We);N.verticalIconBox={x1:Ne.x1,y1:Ne.y1,x2:Ne.x2,y2:Ne.y2,anchorPointX:Ne.anchorPointX,anchorPointY:Ne.anchorPointY},N.verticalIconFeatureIndex=Ne.featureIndex;break}return N},Fe.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Fe.prototype.hasTextData=function(){return this.text.segments.get().length>0},Fe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Fe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Fe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Fe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Fe.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,g=u.vertexStartIndex;g<p;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)},Fe.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),p=[],g=[],x=[],S=0;S<this.symbolInstances.length;++S){x.push(S);var P=this.symbolInstances.get(S);p.push(0|Math.round(o*P.anchorX+u*P.anchorY)),g.push(P.featureIndex)}return x.sort(function(L,N){return p[L]-p[N]||g[N]-g[L]}),x},Fe.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Fe.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var g=this.symbolInstances.get(p[u]);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach(function(x,S,P){x>=0&&P.indexOf(x)===S&&o.addIndicesForPlacedSymbol(o.text,x)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},dn("SymbolBucket",Fe,{omit:["layers","collisionBoxArray","features","compareText"]}),Fe.MAX_GLYPHS=65535,Fe.addDynamicAttributes=Ve;var et=new Yo({"symbol-placement":new kn(le.layout_symbol["symbol-placement"]),"symbol-spacing":new kn(le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kn(le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Sn(le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kn(le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new kn(le.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new kn(le.layout_symbol["icon-ignore-placement"]),"icon-optional":new kn(le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kn(le.layout_symbol["icon-rotation-alignment"]),"icon-size":new Sn(le.layout_symbol["icon-size"]),"icon-text-fit":new kn(le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kn(le.layout_symbol["icon-text-fit-padding"]),"icon-image":new Sn(le.layout_symbol["icon-image"]),"icon-rotate":new Sn(le.layout_symbol["icon-rotate"]),"icon-padding":new kn(le.layout_symbol["icon-padding"]),"icon-keep-upright":new kn(le.layout_symbol["icon-keep-upright"]),"icon-offset":new Sn(le.layout_symbol["icon-offset"]),"icon-anchor":new Sn(le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kn(le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kn(le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kn(le.layout_symbol["text-rotation-alignment"]),"text-field":new Sn(le.layout_symbol["text-field"]),"text-font":new Sn(le.layout_symbol["text-font"]),"text-size":new Sn(le.layout_symbol["text-size"]),"text-max-width":new Sn(le.layout_symbol["text-max-width"]),"text-line-height":new kn(le.layout_symbol["text-line-height"]),"text-letter-spacing":new Sn(le.layout_symbol["text-letter-spacing"]),"text-justify":new Sn(le.layout_symbol["text-justify"]),"text-radial-offset":new Sn(le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kn(le.layout_symbol["text-variable-anchor"]),"text-anchor":new Sn(le.layout_symbol["text-anchor"]),"text-max-angle":new kn(le.layout_symbol["text-max-angle"]),"text-writing-mode":new kn(le.layout_symbol["text-writing-mode"]),"text-rotate":new Sn(le.layout_symbol["text-rotate"]),"text-padding":new kn(le.layout_symbol["text-padding"]),"text-keep-upright":new kn(le.layout_symbol["text-keep-upright"]),"text-transform":new Sn(le.layout_symbol["text-transform"]),"text-offset":new Sn(le.layout_symbol["text-offset"]),"text-allow-overlap":new kn(le.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new kn(le.layout_symbol["text-ignore-placement"]),"text-optional":new kn(le.layout_symbol["text-optional"])}),xe={paint:new Yo({"icon-opacity":new Sn(le.paint_symbol["icon-opacity"]),"icon-color":new Sn(le.paint_symbol["icon-color"]),"icon-halo-color":new Sn(le.paint_symbol["icon-halo-color"]),"icon-halo-width":new Sn(le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Sn(le.paint_symbol["icon-halo-blur"]),"icon-translate":new kn(le.paint_symbol["icon-translate"]),"icon-translate-anchor":new kn(le.paint_symbol["icon-translate-anchor"]),"text-opacity":new Sn(le.paint_symbol["text-opacity"]),"text-color":new Sn(le.paint_symbol["text-color"],{runtimeType:Vr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Sn(le.paint_symbol["text-halo-color"]),"text-halo-width":new Sn(le.paint_symbol["text-halo-width"]),"text-halo-blur":new Sn(le.paint_symbol["text-halo-blur"]),"text-translate":new kn(le.paint_symbol["text-translate"]),"text-translate-anchor":new kn(le.paint_symbol["text-translate-anchor"])}),layout:et},ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ln,this.defaultValue=t};ze.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},ze.prototype.outputDefined=function(){return!1},ze.prototype.serialize=function(){return null},dn("FormatSectionOverride",ze,{omit:["defaultValue"]});var we=function(t){function o(u){t.call(this,u,xe)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(t.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var g=this.layout.get("text-writing-mode");if(g){for(var x=[],S=0,P=g;S<P.length;S+=1){var L=P[S];x.indexOf(L)<0&&x.push(L)}this.layout._values["text-writing-mode"]=x}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,g,x){var S=this.layout.get(u).evaluate(p,{},g,x),P=this._unevaluatedLayout._values[u];return P.isDataDriven()||$l(P.value)||!S?S:function(L,N){return N.replace(/{([^{}]+)}/g,function(Z,G){return G in L?String(L[G]):""})}(p.properties,S)},o.prototype.createBucket=function(u){return new Fe(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=xe.paint.overridableProperties;u<p.length;u+=1){var g=p[u];if(o.hasPaintOverride(this.layout,g)){var x,S=this.paint.get(g),P=new ze(S),L=new Ic(P,S.property.specification);x=S.value.kind==="constant"||S.value.kind==="source"?new Jl("source",L):new ol("composite",L,S.value.zoomStops,S.value._interpolationType),this.paint._values[g]=new Rs(S.property,x,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,g){return!(!this.layout||p.isDataDriven()||g.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var g=u.get("text-field"),x=xe.paint.properties[p],S=!1,P=function(Z){for(var G=0,Q=Z;G<Q.length;G+=1)if(x.overrides&&x.overrides.hasOverride(Q[G]))return void(S=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Wr)P(g.value.value.sections);else if(g.value.kind==="source"){var L=function(Z){S||(Z instanceof $a&&$i(Z.value)===Vn?P(Z.value.sections):Z instanceof ko?P(Z.sections):Z.eachChild(L))},N=g.value;N._styleExpression&&L(N._styleExpression.expression)}return S},o}(au),ot={paint:new Yo({"background-color":new kn(le.paint_background["background-color"]),"background-pattern":new us(le.paint_background["background-pattern"]),"background-opacity":new kn(le.paint_background["background-opacity"])})},_t=function(t){function o(u){t.call(this,u,ot)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(au),hr={paint:new Yo({"raster-opacity":new kn(le.paint_raster["raster-opacity"]),"raster-hue-rotate":new kn(le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kn(le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kn(le.paint_raster["raster-brightness-max"]),"raster-saturation":new kn(le.paint_raster["raster-saturation"]),"raster-contrast":new kn(le.paint_raster["raster-contrast"]),"raster-resampling":new kn(le.paint_raster["raster-resampling"]),"raster-fade-duration":new kn(le.paint_raster["raster-fade-duration"])})},zr=function(t){function o(u){t.call(this,u,hr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(au),Lr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(au),Qr={circle:Bc,heatmap:gh,hillshade:_u,fill:xf,"fill-extrusion":Ku,line:Ih,symbol:we,background:_t,raster:zr},Rr=he.HTMLImageElement,Cn=he.HTMLCanvasElement,an=he.HTMLVideoElement,xn=he.ImageData,_n=he.ImageBitmap,hn=function(t,o,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,p)};hn.prototype.update=function(t,o,u){var p=t.width,g=t.height,x=!(this.size&&this.size[0]===p&&this.size[1]===g||u),S=this.context,P=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[p,g],t instanceof Rr||t instanceof Cn||t instanceof an||t instanceof xn||_n&&t instanceof _n?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,t):P.texImage2D(P.TEXTURE_2D,0,this.format,p,g,0,this.format,P.UNSIGNED_BYTE,t.data);else{var L=u||{x:0,y:0},N=L.x,Z=L.y;t instanceof Rr||t instanceof Cn||t instanceof an||t instanceof xn||_n&&t instanceof _n?P.texSubImage2D(P.TEXTURE_2D,0,N,Z,P.RGBA,P.UNSIGNED_BYTE,t):P.texSubImage2D(P.TEXTURE_2D,0,N,Z,p,g,P.RGBA,P.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},hn.prototype.bind=function(t,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},hn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},hn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Gn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Gn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Gn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var da=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Wt(["receive","process"],this),this.invoker=new Gn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Dr()?t:he};function jo(t,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[t*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}da.prototype.send=function(t,o,u,p,g){var x=this;g===void 0&&(g=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var P=A(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:p,mustQueue:g,sourceMapId:this.mapId,data:fa(o,P)},P),{cancel:function(){u&&delete x.callbacks[S],x.target.postMessage({id:S,type:"<cancel>",targetMapId:p,sourceMapId:x.mapId})}}},da.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else Dr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},da.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},da.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(o.error?p(xs(o.error)):p(null,xs(o.data)))}else{var g=!1,x=A(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,G){g=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?fa(Z):null,data:fa(G,x)},x)}:function(Z){g=!0},P=null,L=xs(o.data);if(this.parent[o.type])P=this.parent[o.type](o.sourceMapId,L,S);else if(this.parent.getWorkerSource){var N=o.type.split(".");P=this.parent.getWorkerSource(o.sourceMapId,N[0],L.source)[N[1]](L,S)}else S(new Error("Could not find function "+o.type));!g&&P&&P.cancel&&(this.cancelCallbacks[t]=P.cancel)}},da.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Oa=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Oa.prototype.setNorthEast=function(t){return this._ne=t instanceof ua?new ua(t.lng,t.lat):ua.convert(t),this},Oa.prototype.setSouthWest=function(t){return this._sw=t instanceof ua?new ua(t.lng,t.lat):ua.convert(t),this},Oa.prototype.extend=function(t){var o,u,p=this._sw,g=this._ne;if(t instanceof ua)o=t,u=t;else{if(!(t instanceof Oa))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Oa.convert(t)):this.extend(ua.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return p||g?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),g.lng=Math.max(u.lng,g.lng),g.lat=Math.max(u.lat,g.lat)):(this._sw=new ua(o.lng,o.lat),this._ne=new ua(u.lng,u.lat)),this},Oa.prototype.getCenter=function(){return new ua((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Oa.prototype.getSouthWest=function(){return this._sw},Oa.prototype.getNorthEast=function(){return this._ne},Oa.prototype.getNorthWest=function(){return new ua(this.getWest(),this.getNorth())},Oa.prototype.getSouthEast=function(){return new ua(this.getEast(),this.getSouth())},Oa.prototype.getWest=function(){return this._sw.lng},Oa.prototype.getSouth=function(){return this._sw.lat},Oa.prototype.getEast=function(){return this._ne.lng},Oa.prototype.getNorth=function(){return this._ne.lat},Oa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Oa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Oa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Oa.prototype.contains=function(t){var o=ua.convert(t),u=o.lng,p=o.lat,g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g},Oa.convert=function(t){return!t||t instanceof Oa?t:new Oa(t)};var ua=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ua.prototype.wrap=function(){return new ua(ir(this.lng,-180,180),this.lat)},ua.prototype.toArray=function(){return[this.lng,this.lat]},ua.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ua.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,p=t.lat*o,g=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(g,1))},ua.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Oa(new ua(this.lng-u,this.lat-o),new ua(this.lng+u,this.lat+o))},ua.convert=function(t){if(t instanceof ua)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ua(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ua(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Cl=2*Math.PI*63710088e-1;function qn(t){return Cl*Math.cos(t*Math.PI/180)}function ci(t){return(180+t)/360}function cu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Yp(t,o){return t/qn(o)}function bu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var qc=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};qc.fromLngLat=function(t,o){o===void 0&&(o=0);var u=ua.convert(t);return new qc(ci(u.lng),cu(u.lat),Yp(o,u.lat))},qc.prototype.toLngLat=function(){return new ua(360*this.x-180,bu(this.y))},qc.prototype.toAltitude=function(){return this.z*qn(bu(this.y))},qc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Cl*(t=bu(this.y),1/Math.cos(t*Math.PI/180));var t};var Oh=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=qp(0,t,t,o,u)};Oh.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Oh.prototype.url=function(t,o){var u,p,g,x,S,P=(p=this.y,g=this.z,x=jo(256*(u=this.x),256*(p=Math.pow(2,g)-p-1),g),S=jo(256*(u+1),256*(p+1),g),x[0]+","+x[1]+","+S[0]+","+S[1]),L=function(N,Z,G){for(var Q,ae="",Ie=N;Ie>0;Ie--)ae+=(Z&(Q=1<<Ie-1)?1:0)+(G&Q?2:0);return ae}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",L).replace("{bbox-epsg-3857}",P)},Oh.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new se(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Oh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var C0=function(t,o){this.wrap=t,this.canonical=o,this.key=qp(t,o.z,o.z,o.x,o.y)},is=function(t,o,u,p,g){this.overscaledZ=t,this.wrap=o,this.canonical=new Oh(u,+p,+g),this.key=qp(o,t,u,p,g)};function qp(t,o,u,p,g){(t*=2)<0&&(t=-1*t-1);var x=1<<u;return(x*x*t+x*g+p).toString(36)+u.toString(36)+o.toString(36)}is.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},is.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new is(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new is(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},is.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?qp(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):qp(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},is.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},is.prototype.children=function(t){if(this.overscaledZ>=t)return[new is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new is(o,this.wrap,o,u,p),new is(o,this.wrap,o,u+1,p),new is(o,this.wrap,o,u,p+1),new is(o,this.wrap,o,u+1,p+1)]},is.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},is.prototype.wrapped=function(){return new is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},is.prototype.unwrapTo=function(t){return new is(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},is.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},is.prototype.toUnwrapped=function(){return new C0(this.wrap,this.canonical)},is.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},is.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new qc(t.x-this.wrap,t.y))},dn("CanonicalTileID",Oh),dn("OverscaledTileID",is,{omit:["posMatrix"]});var Sf=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Qe('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var g=0;g<p;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(p,g)]=this.data[this._idx(p-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,p)]=this.data[this._idx(g,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Sf.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},Sf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Sf.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},Sf.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},Sf.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},Sf.prototype.getPixels=function(){return new Uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Sf.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,g=o*this.dim+this.dim,x=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:p=g-1;break;case 1:g=p+1}switch(u){case-1:x=S-1;break;case 1:S=x+1}for(var P=-o*this.dim,L=-u*this.dim,N=x;N<S;N++)for(var Z=p;Z<g;Z++)this.data[this._idx(Z,N)]=t.data[this._idx(Z+P,N+L)]},dn("DEMData",Sf);var kd=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};kd.prototype.encode=function(t){return this._stringToNumber[t]},kd.prototype.decode=function(t){return this._numberToString[t]};var Ld=function(t,o,u,p,g){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=p,this.properties=t.properties,this.id=g},Sv={geometry:{configurable:!0}};Sv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Sv.geometry.set=function(t){this._geometry=t},Ld.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(Ld.prototype,Sv);var vp=function(){this.state={},this.stateChanges={},this.deletedStates={}};vp.prototype.updateState=function(t,o,u){var p=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},yt(this.stateChanges[t][p],u),this.deletedStates[t]===null)for(var g in this.deletedStates[t]={},this.state[t])g!==p&&(this.deletedStates[t][g]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var x in this.deletedStates[t][p]={},this.state[t][p])u[x]||(this.deletedStates[t][p][x]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][S]===null&&delete this.deletedStates[t][p][S]},vp.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var p=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},vp.prototype.getState=function(t,o){var u=String(o),p=yt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var g=this.deletedStates[t][o];if(g===null)return{};for(var x in g)delete p[x]}return p},vp.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},vp.prototype.coalesceChanges=function(t,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var g={};for(var x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),yt(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];u[p]=g}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var P={};if(this.deletedStates[S]===null)for(var L in this.state[S])P[L]={},this.state[S][L]={};else for(var N in this.deletedStates[S]){if(this.deletedStates[S][N]===null)this.state[S][N]={};else for(var Z=0,G=Object.keys(this.deletedStates[S][N]);Z<G.length;Z+=1)delete this.state[S][N][G[Z]];P[N]=this.state[S][N]}u[S]=u[S]||{},yt(u[S],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var Q in t)t[Q].setFeatureState(u,o)};var Cf=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Gu(8192,16,0),this.grid3D=new Gu(8192,16,0),this.featureIndexArray=new H,this.promoteId=o};function Cv(t,o,u,p,g){return Xt(t,function(x,S){var P=o instanceof nu?o.get(S):null;return P&&P.evaluate?P.evaluate(u,p,g):P})}function w0(t){for(var o=1/0,u=1/0,p=-1/0,g=-1/0,x=0,S=t;x<S.length;x+=1){var P=S[x];o=Math.min(o,P.x),u=Math.min(u,P.y),p=Math.max(p,P.x),g=Math.max(g,P.y)}return{minX:o,minY:u,maxX:p,maxY:g}}function wm(t,o){return o-t}Cf.prototype.insert=function(t,o,u,p,g,x){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,g);for(var P=x?this.grid3D:this.grid,L=0;L<o.length;L++){for(var N=o[L],Z=[1/0,1/0,-1/0,-1/0],G=0;G<N.length;G++){var Q=N[G];Z[0]=Math.min(Z[0],Q.x),Z[1]=Math.min(Z[1],Q.y),Z[2]=Math.max(Z[2],Q.x),Z[3]=Math.max(Z[3],Q.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&P.insert(S,Z[0],Z[1],Z[2],Z[3])}},Cf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Nt.VectorTile(new Qf(this.rawTileData)).layers,this.sourceLayerCoder=new kd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Cf.prototype.query=function(t,o,u,p){var g=this;this.loadVTLayers();for(var x=t.params||{},S=8192/t.tileSize/t.scale,P=Rc(x.filter),L=t.queryGeometry,N=t.queryPadding*S,Z=w0(L),G=this.grid.query(Z.minX-N,Z.minY-N,Z.maxX+N,Z.maxY+N),Q=w0(t.cameraQueryGeometry),ae=this.grid3D.query(Q.minX-N,Q.minY-N,Q.maxX+N,Q.maxY+N,function(jt,Ht,ur,Cr){return function(Hr,Tn,Jr,Zn,pn){for(var Pi=0,Kn=Hr;Pi<Kn.length;Pi+=1){var Mn=Kn[Pi];if(Tn<=Mn.x&&Jr<=Mn.y&&Zn>=Mn.x&&pn>=Mn.y)return!0}var Ni=[new se(Tn,Jr),new se(Tn,pn),new se(Zn,pn),new se(Zn,Jr)];if(Hr.length>2){for(var wi=0,Ji=Ni;wi<Ji.length;wi+=1)if(gu(Hr,Ji[wi]))return!0}for(var Dn=0;Dn<Hr.length-1;Dn++)if(hc(Hr[Dn],Hr[Dn+1],Ni))return!0;return!1}(t.cameraQueryGeometry,jt-N,Ht-N,ur+N,Cr+N)}),Ie=0,Le=ae;Ie<Le.length;Ie+=1)G.push(Le[Ie]);G.sort(wm);for(var We,Ne={},nt=function(jt){var Ht=G[jt];if(Ht!==We){We=Ht;var ur=g.featureIndexArray.get(Ht),Cr=null;g.loadMatchingFeature(Ne,ur.bucketIndex,ur.sourceLayerIndex,ur.featureIndex,P,x.layers,x.availableImages,o,u,p,function(Hr,Tn,Jr){return Cr||(Cr=Wa(Hr)),Tn.queryIntersectsFeature(L,Hr,Jr,Cr,g.z,t.transform,S,t.pixelPosMatrix)})}},bt=0;bt<G.length;bt++)nt(bt);return Ne},Cf.prototype.loadMatchingFeature=function(t,o,u,p,g,x,S,P,L,N,Z){var G=this.bucketLayerIDs[o];if(!x||function(Hr,Tn){for(var Jr=0;Jr<Hr.length;Jr++)if(Tn.indexOf(Hr[Jr])>=0)return!0;return!1}(x,G)){var Q=this.sourceLayerCoder.decode(u),ae=this.vtLayers[Q].feature(p);if(g.needGeometry){var Ie=so(ae,!0);if(!g.filter(new Mi(this.tileID.overscaledZ),Ie,this.tileID.canonical))return}else if(!g.filter(new Mi(this.tileID.overscaledZ),ae))return;for(var Le=this.getId(ae,Q),We=0;We<G.length;We++){var Ne=G[We];if(!(x&&x.indexOf(Ne)<0)){var nt=P[Ne];if(nt){var bt={};Le!==void 0&&N&&(bt=N.getState(nt.sourceLayer||"_geojsonTileLayer",Le));var jt=yt({},L[Ne]);jt.paint=Cv(jt.paint,nt.paint,ae,bt,S),jt.layout=Cv(jt.layout,nt.layout,ae,bt,S);var Ht=!Z||Z(ae,nt,bt);if(Ht){var ur=new Ld(ae,this.z,this.x,this.y,Le);ur.layer=jt;var Cr=t[Ne];Cr===void 0&&(Cr=t[Ne]=[]),Cr.push({featureIndex:p,feature:ur,intersectionZ:Ht})}}}}}},Cf.prototype.lookupSymbolFeatures=function(t,o,u,p,g,x,S,P){var L={};this.loadVTLayers();for(var N=Rc(g),Z=0,G=t;Z<G.length;Z+=1)this.loadMatchingFeature(L,u,p,G[Z],N,x,S,P,o);return L},Cf.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,g=u[o];p<g.length;p+=1)if(t===g[p])return!0;return!1},Cf.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},dn("FeatureIndex",Cf,{omit:["rawTileData","sourceLayerCoder"]});var Es=function(t,o){this.tileID=t,this.uid=Ct(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Es.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<ea.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},Es.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Es.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(N,Z){var G={};if(!Z)return G;for(var Q=function(){var Le=Ie[ae],We=Le.layerIds.map(function(bt){return Z.getLayer(bt)}).filter(Boolean);if(We.length!==0){Le.layers=We,Le.stateDependentLayerIds&&(Le.stateDependentLayers=Le.stateDependentLayerIds.map(function(bt){return We.filter(function(jt){return jt.id===bt})[0]}));for(var Ne=0,nt=We;Ne<nt.length;Ne+=1)G[nt[Ne].id]=Le}},ae=0,Ie=N;ae<Ie.length;ae+=1)Q();return G}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var g=this.buckets[p];if(g instanceof Fe){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var x in this.buckets){var S=this.buckets[x];if(S instanceof Fe&&S.hasRTLText){this.hasRTLText=!0,qs.isLoading()||qs.isLoaded()||Uf()!=="deferred"||Fs();break}}for(var P in this.queryPadding=0,this.buckets){var L=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(P).queryRadius(L))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},Es.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Es.prototype.getBucket=function(t){return this.buckets[t.id]},Es.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hn(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hn(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},Es.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Es.prototype.queryRenderedFeatures=function(t,o,u,p,g,x,S,P,L,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:N,transform:P,params:S,queryPadding:this.queryPadding*L},t,o,u):{}},Es.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),g=o?o.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(x)for(var S=Rc(o&&o.filter),P=this.tileID.canonical,L=P.z,N=P.x,Z=P.y,G={z:L,x:N,y:Z},Q=0;Q<x.length;Q++){var ae=x.feature(Q);if(S.needGeometry){var Ie=so(ae,!0);if(!S.filter(new Mi(this.tileID.overscaledZ),Ie,this.tileID.canonical))continue}else if(!S.filter(new Mi(this.tileID.overscaledZ),ae))continue;var Le=u.getId(ae,g),We=new Ld(ae,L,N,Z,Le);We.tile=G,t.push(We)}}},Es.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Es.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Es.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=Kr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),g=!1;if(this.expirationTime>p)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{var x=this.expirationTime-o;x?this.expirationTime=p+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Es.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Es.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],P=t[x];if(S&&P&&Object.keys(P).length!==0){g.update(P,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var L=o&&o.style&&o.style.getLayer(p);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(g)))}}}},Es.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Es.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ea.now()},Es.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Es.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=ea.now()+t},Es.prototype.setDependencies=function(t,o){for(var u={},p=0,g=o;p<g.length;p+=1)u[g[p]]=!0;this.dependencies[t]=u},Es.prototype.hasDependency=function(t,o){for(var u=0,p=t;u<p.length;u+=1){var g=this.dependencies[p[u]];if(g){for(var x=0,S=o;x<S.length;x+=1)if(g[S[x]])return!0}}return!1};var Jf=he.performance,A0=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Jf.mark(this._marks.start)};A0.prototype.finish=function(){Jf.mark(this._marks.end);var t=Jf.getEntriesByName(this._marks.measure);return t.length===0&&(Jf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Jf.getEntriesByName(this._marks.measure),Jf.clearMarks(this._marks.start),Jf.clearMarks(this._marks.end),Jf.clearMeasures(this._marks.measure)),t},v.Actor=da,v.AlphaImage=yu,v.CanonicalTileID=Oh,v.CollisionBoxArray=f,v.Color=Di,v.DEMData=Sf,v.DataConstantProperty=kn,v.DictionaryCoder=kd,v.EXTENT=8192,v.ErrorEvent=je,v.EvaluationParameters=Mi,v.Event=ke,v.Evented=Je,v.FeatureIndex=Cf,v.FillBucket=zs,v.FillExtrusionBucket=Bu,v.ImageAtlas=_r,v.ImagePosition=it,v.LineBucket=oa,v.LngLat=ua,v.LngLatBounds=Oa,v.MercatorCoordinate=qc,v.ONE_EM=24,v.OverscaledTileID=is,v.Point=se,v.Point$1=se,v.Properties=Yo,v.Protobuf=Qf,v.RGBAImage=Uo,v.RequestManager=zi,v.RequestPerformance=A0,v.ResourceType=En,v.SegmentVector=ue,v.SourceFeatureState=vp,v.StructArrayLayout1ui2=ku,v.StructArrayLayout2f1f2i16=Nl,v.StructArrayLayout2i4=uc,v.StructArrayLayout3ui6=ml,v.StructArrayLayout4i8=$s,v.SymbolBucket=Fe,v.Texture=hn,v.Tile=Es,v.Transitionable=Xo,v.Uniform1f=kr,v.Uniform1i=pr,v.Uniform2f=Or,v.Uniform3f=tn,v.Uniform4f=Ln,v.UniformColor=Fn,v.UniformMatrix4f=Ri,v.UnwrappedTileID=C0,v.ValidationError=De,v.WritingMode=Br,v.ZoomHistory=hf,v.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},v.addDynamicAttributes=Ve,v.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var p=t.length,g=new Array(t.length),x=null;t.forEach(function(S,P){o(S,function(L,N){L&&(x=L),g[P]=N,--p==0&&u(x,g)})})},v.bezier=tt,v.bindAll=Wt,v.browser=ea,v.cacheEntryPossiblyAdded=function(t){++bi>Ar&&(t.getActor().send("enforceCacheSizeLimit",ar),bi=0)},v.clamp=Jt,v.clearTileCache=function(t){var o=he.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},v.clipLine=bo,v.clone=function(t){var o=new Qi(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},v.clone$1=He,v.clone$2=function(t){var o=new Qi(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},v.collisionCircleLayout=Od,v.config=wn,v.create=function(){var t=new Qi(16);return Qi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new Qi(9);return Qi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new Qi(4);return Qi!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=de,v.createExpression=Ql,v.createLayout=Pa,v.createStyleLayer=function(t){return t.type==="custom"?new Lr(t):new Qr[t.type](t)},v.cross=function(t,o,u){var p=o[0],g=o[1],x=o[2],S=u[0],P=u[1],L=u[2];return t[0]=g*L-x*P,t[1]=x*S-p*L,t[2]=p*P-g*S,t},v.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!t(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var g in o)if(!t(o[g],u[g]))return!1;return!0}return o===u},v.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},v.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},v.ease=gt,v.emitValidationErrors=ju,v.endsWith=X,v.enforceCacheSizeLimit=function(t){on(),qi&&qi.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-t;p++)o.delete(u[p])})})},v.evaluateSizeForFeature=Yn,v.evaluateSizeForZoom=hi,v.evaluateVariableOffset=Sl,v.evented=oc,v.extend=yt,v.featureFilter=Rc,v.filterObject=ft,v.fromRotation=function(t,o){var u=Math.sin(o),p=Math.cos(o);return t[0]=p,t[1]=u,t[2]=0,t[3]=-u,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=Xr,v.getAnchorJustification=Te,v.getArrayBuffer=ka,v.getImage=K,v.getJSON=function(t,o){return Ho(yt(t,{type:"json"}),o)},v.getRTLTextPluginStatus=Uf,v.getReferrer=Ii,v.getVideo=function(t,o){var u,p,g=he.document.createElement("video");g.muted=!0,g.onloadstart=function(){o(null,g)};for(var x=0;x<t.length;x++){var S=he.document.createElement("source");u=t[x],p=void 0,(p=he.document.createElement("a")).href=u,(p.protocol!==he.document.location.protocol||p.host!==he.document.location.host)&&(g.crossOrigin="Anonymous"),S.src=t[x],g.appendChild(S)}return{cancel:function(){}}},v.identity=cs,v.invert=function(t,o){var u=o[0],p=o[1],g=o[2],x=o[3],S=o[4],P=o[5],L=o[6],N=o[7],Z=o[8],G=o[9],Q=o[10],ae=o[11],Ie=o[12],Le=o[13],We=o[14],Ne=o[15],nt=u*P-p*S,bt=u*L-g*S,jt=u*N-x*S,Ht=p*L-g*P,ur=p*N-x*P,Cr=g*N-x*L,Hr=Z*Le-G*Ie,Tn=Z*We-Q*Ie,Jr=Z*Ne-ae*Ie,Zn=G*We-Q*Le,pn=G*Ne-ae*Le,Pi=Q*Ne-ae*We,Kn=nt*Pi-bt*pn+jt*Zn+Ht*Jr-ur*Tn+Cr*Hr;return Kn?(t[0]=(P*Pi-L*pn+N*Zn)*(Kn=1/Kn),t[1]=(g*pn-p*Pi-x*Zn)*Kn,t[2]=(Le*Cr-We*ur+Ne*Ht)*Kn,t[3]=(Q*ur-G*Cr-ae*Ht)*Kn,t[4]=(L*Jr-S*Pi-N*Tn)*Kn,t[5]=(u*Pi-g*Jr+x*Tn)*Kn,t[6]=(We*jt-Ie*Cr-Ne*bt)*Kn,t[7]=(Z*Cr-Q*jt+ae*bt)*Kn,t[8]=(S*pn-P*Jr+N*Hr)*Kn,t[9]=(p*Jr-u*pn-x*Hr)*Kn,t[10]=(Ie*ur-Le*jt+Ne*nt)*Kn,t[11]=(G*jt-Z*ur-ae*nt)*Kn,t[12]=(P*Tn-S*Zn-L*Hr)*Kn,t[13]=(u*Zn-p*Tn+g*Hr)*Kn,t[14]=(Le*bt-Ie*Ht-We*nt)*Kn,t[15]=(Z*Ht-G*bt+Q*nt)*Kn,t):null},v.isChar=qr,v.isMapboxURL=ji,v.keysDifference=function(t,o){var u=[];for(var p in t)p in o||u.push(p);return u},v.makeRequest=Ho,v.mapObject=Xt,v.mercatorXfromLng=ci,v.mercatorYfromLat=cu,v.mercatorZfromAltitude=Yp,v.mul=pc,v.multiply=zo,v.mvt=Nt,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,o){var u=o[0],p=o[1],g=o[2],x=u*u+p*p+g*g;return x>0&&(x=1/Math.sqrt(x)),t[0]=o[0]*x,t[1]=o[1]*x,t[2]=o[2]*x,t},v.number=va,v.offscreenCanvasSupported=gi,v.ortho=function(t,o,u,p,g,x,S){var P=1/(o-u),L=1/(p-g),N=1/(x-S);return t[0]=-2*P,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*L,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*N,t[11]=0,t[12]=(o+u)*P,t[13]=(g+p)*L,t[14]=(S+x)*N,t[15]=1,t},v.parseGlyphPBF=function(t){return new Qf(t).readFields(Mr,[])},v.pbf=Qf,v.performSymbolLayout=function(t,o,u,p,g,x,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var P=t.layers[0].layout,L=t.layers[0]._unevaluatedLayout._values,N={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,G=Z.maxZoom;N.compositeTextSizes=[L["text-size"].possiblyEvaluate(new Mi(Z.minZoom),S),L["text-size"].possiblyEvaluate(new Mi(G),S)]}if(t.iconSizeData.kind==="composite"){var Q=t.iconSizeData,ae=Q.maxZoom;N.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new Mi(Q.minZoom),S),L["icon-size"].possiblyEvaluate(new Mi(ae),S)]}N.layoutTextSize=L["text-size"].possiblyEvaluate(new Mi(t.zoom+1),S),N.layoutIconSize=L["icon-size"].possiblyEvaluate(new Mi(t.zoom+1),S),N.textMaxSize=L["text-size"].possiblyEvaluate(new Mi(18));for(var Ie=24*P.get("text-line-height"),Le=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",We=P.get("text-keep-upright"),Ne=P.get("text-size"),nt=function(){var Ht=jt[bt],ur=P.get("text-font").evaluate(Ht,{},S).join(","),Cr=Ne.evaluate(Ht,{},S),Hr=N.layoutTextSize.evaluate(Ht,{},S),Tn=N.layoutIconSize.evaluate(Ht,{},S),Jr={horizontal:{},vertical:void 0},Zn=Ht.text,pn=[0,0];if(Zn){var Pi=Zn.toString(),Kn=24*P.get("text-letter-spacing").evaluate(Ht,{},S),Mn=function(Gi){for(var Ra=0,Ea=Gi;Ra<Ea.length;Ra+=1)if(q=Ea[Ra].charCodeAt(0),qr.Arabic(q)||qr["Arabic Supplement"](q)||qr["Arabic Extended-A"](q)||qr["Arabic Presentation Forms-A"](q)||qr["Arabic Presentation Forms-B"](q))return!1;var q;return!0}(Pi)?Kn:0,Ni=P.get("text-anchor").evaluate(Ht,{},S),wi=P.get("text-variable-anchor");if(!wi){var Ji=P.get("text-radial-offset").evaluate(Ht,{},S);pn=Ji?Sl(Ni,[24*Ji,Eo]):P.get("text-offset").evaluate(Ht,{},S).map(function(Gi){return 24*Gi})}var Dn=Le?"center":P.get("text-justify").evaluate(Ht,{},S),xi=P.get("symbol-placement"),Ya=xi==="point"?24*P.get("text-max-width").evaluate(Ht,{},S):0,ho=function(){t.allowVerticalPlacement&&Bl(Pi)&&(Jr.vertical=Gr(Zn,o,u,g,ur,Ya,Ie,Ni,"left",Mn,pn,Br.vertical,!0,xi,Hr,Cr))};if(!Le&&wi){for(var lo=Dn==="auto"?wi.map(function(Gi){return Te(Gi)}):[Dn],Ua=!1,po=0;po<lo.length;po++){var as=lo[po];if(!Jr.horizontal[as])if(Ua)Jr.horizontal[as]=Jr.horizontal[0];else{var os=Gr(Zn,o,u,g,ur,Ya,Ie,"center",as,Mn,pn,Br.horizontal,!1,xi,Hr,Cr);os&&(Jr.horizontal[as]=os,Ua=os.positionedLines.length===1)}}ho()}else{Dn==="auto"&&(Dn=Te(Ni));var Zs=Gr(Zn,o,u,g,ur,Ya,Ie,Ni,Dn,Mn,pn,Br.horizontal,!1,xi,Hr,Cr);Zs&&(Jr.horizontal[Dn]=Zs),ho(),Bl(Pi)&&Le&&We&&(Jr.vertical=Gr(Zn,o,u,g,ur,Ya,Ie,Ni,Dn,Mn,pn,Br.vertical,!1,xi,Hr,Cr))}}var fs=void 0,ro=!1;if(Ht.icon&&Ht.icon.name){var Io=p[Ht.icon.name];Io&&(fs=function(Gi,Ra,Ea){var q=Xr(Ea),Vs=Ra[0]-Gi.displaySize[0]*q.horizontalAlign,Ss=Ra[1]-Gi.displaySize[1]*q.verticalAlign;return{image:Gi,top:Ss,bottom:Ss+Gi.displaySize[1],left:Vs,right:Vs+Gi.displaySize[0]}}(g[Ht.icon.name],P.get("icon-offset").evaluate(Ht,{},S),P.get("icon-anchor").evaluate(Ht,{},S)),ro=Io.sdf,t.sdfIcons===void 0?t.sdfIcons=Io.sdf:t.sdfIcons!==Io.sdf&&Qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Io.pixelRatio!==t.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var Hi=xt(Jr.horizontal)||Jr.vertical;t.iconsInText=!!Hi&&Hi.iconsInText,(Hi||fs)&&function(Gi,Ra,Ea,q,Vs,Ss,Za,Oo,Cs,ia,Eu){var Su=Ss.textMaxSize.evaluate(Ra,{});Su===void 0&&(Su=Za);var Vl,So=Gi.layers[0].layout,jl=So.get("icon-offset").evaluate(Ra,{},Eu),$u=xt(Ea.horizontal),Kc=Za/24,eh=Gi.tilePixelRatio*Kc,Rh=Gi.tilePixelRatio*Su/24,yc=Gi.tilePixelRatio*Oo,th=Gi.tilePixelRatio*So.get("symbol-spacing"),mp=So.get("text-padding")*Gi.tilePixelRatio,rh=So.get("icon-padding")*Gi.tilePixelRatio,kh=So.get("text-max-angle")/180*Math.PI,wf=So.get("text-rotation-alignment")==="map"&&So.get("symbol-placement")!=="point",gp=So.get("icon-rotation-alignment")==="map"&&So.get("symbol-placement")!=="point",_c=So.get("symbol-placement"),Lh=th/2,Dh=So.get("icon-text-fit");q&&Dh!=="none"&&(Gi.allowVerticalPlacement&&Ea.vertical&&(Vl=ri(q,Ea.vertical,Dh,So.get("icon-text-fit-padding"),jl,Kc)),$u&&(q=ri(q,$u,Dh,So.get("icon-text-fit-padding"),jl,Kc)));var wl=function(wv,Vh){Vh.x<0||Vh.x>=8192||Vh.y<0||Vh.y>=8192||function(Co,Al,Av,Jc,ed,Bd,Sp,Gl,Cp,jh,ws,wp,td,Nd,Gh,zd,Ud,Zd,Vd,jd,Cu,Ap,Gd,Hl,Tv){var Hd,oh,Hh,Wh,Xh,sh=Co.addToLineVertexArray(Al,Av),Mv=0,Pv=0,Wd=0,Xd=0,rd=-1,nd=-1,Qu={},Yd=Ae(""),qd=0,Kd=0;if(Gl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(qd=(Hd=Gl.layout.get("text-offset").evaluate(Cu,{},Hl).map(function(Yh){return 24*Yh}))[0],Kd=Hd[1]):(qd=24*Gl.layout.get("text-radial-offset").evaluate(Cu,{},Hl),Kd=Eo),Co.allowVerticalPlacement&&Jc.vertical){var Iv=Gl.layout.get("text-rotate").evaluate(Cu,{},Hl)+90;Wh=new Vo(Cp,Al,jh,ws,wp,Jc.vertical,td,Nd,Gh,Iv),Sp&&(Xh=new Vo(Cp,Al,jh,ws,wp,Sp,Ud,Zd,Gh,Iv))}if(ed){var $d=Gl.layout.get("icon-rotate").evaluate(Cu,{}),Ov=Gl.layout.get("icon-text-fit")!=="none",Rv=$o(ed,$d,Gd,Ov),Qd=Sp?$o(Sp,$d,Gd,Ov):void 0;Hh=new Vo(Cp,Al,jh,ws,wp,ed,Ud,Zd,!1,$d),Mv=4*Rv.length;var kv=Co.iconSizeData,Tp=null;kv.kind==="source"?(Tp=[128*Gl.layout.get("icon-size").evaluate(Cu,{})])[0]>32640&&Qe(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):kv.kind==="composite"&&((Tp=[128*Ap.compositeIconSizes[0].evaluate(Cu,{},Hl),128*Ap.compositeIconSizes[1].evaluate(Cu,{},Hl)])[0]>32640||Tp[1]>32640)&&Qe(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Co.addSymbols(Co.icon,Rv,Tp,jd,Vd,Cu,!1,Al,sh.lineStartIndex,sh.lineLength,-1,Hl),rd=Co.icon.placedSymbolArray.length-1,Qd&&(Pv=4*Qd.length,Co.addSymbols(Co.icon,Qd,Tp,jd,Vd,Cu,Br.vertical,Al,sh.lineStartIndex,sh.lineLength,-1,Hl),nd=Co.icon.placedSymbolArray.length-1)}for(var Lv in Jc.horizontal){var id=Jc.horizontal[Lv];if(!oh){Yd=Ae(id.text);var T0=Gl.layout.get("text-rotate").evaluate(Cu,{},Hl);oh=new Vo(Cp,Al,jh,ws,wp,id,td,Nd,Gh,T0)}var Dv=id.positionedLines.length===1;if(Wd+=Dt(Co,Al,id,Bd,Gl,Gh,Cu,zd,sh,Jc.vertical?Br.horizontal:Br.horizontalOnly,Dv?Object.keys(Jc.horizontal):[Lv],Qu,rd,Ap,Hl),Dv)break}Jc.vertical&&(Xd+=Dt(Co,Al,Jc.vertical,Bd,Gl,Gh,Cu,zd,sh,Br.vertical,["vertical"],Qu,nd,Ap,Hl));var M0=oh?oh.boxStartIndex:Co.collisionBoxArray.length,P0=oh?oh.boxEndIndex:Co.collisionBoxArray.length,I0=Wh?Wh.boxStartIndex:Co.collisionBoxArray.length,O0=Wh?Wh.boxEndIndex:Co.collisionBoxArray.length,R0=Hh?Hh.boxStartIndex:Co.collisionBoxArray.length,uh=Hh?Hh.boxEndIndex:Co.collisionBoxArray.length,Af=Xh?Xh.boxStartIndex:Co.collisionBoxArray.length,Fv=Xh?Xh.boxEndIndex:Co.collisionBoxArray.length,Wl=-1,lh=function(Yh,Bv){return Yh&&Yh.circleDiameter?Math.max(Yh.circleDiameter,Bv):Bv};Wl=lh(oh,Wl),Wl=lh(Wh,Wl),Wl=lh(Hh,Wl);var Jd=(Wl=lh(Xh,Wl))>-1?1:0;Jd&&(Wl*=Tv/24),Co.glyphOffsetArray.length>=Fe.MAX_GLYPHS&&Qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Cu.sortKey!==void 0&&Co.addToSortKeyRanges(Co.symbolInstances.length,Cu.sortKey),Co.symbolInstances.emplaceBack(Al.x,Al.y,Qu.right>=0?Qu.right:-1,Qu.center>=0?Qu.center:-1,Qu.left>=0?Qu.left:-1,Qu.vertical||-1,rd,nd,Yd,M0,P0,I0,O0,R0,uh,Af,Fv,jh,Wd,Xd,Mv,Pv,Jd,0,td,qd,Kd,Wl)}(Gi,Vh,wv,Ea,q,Vs,Vl,Gi.layers[0],Gi.collisionBoxArray,Ra.index,Ra.sourceLayerIndex,Gi.index,eh,mp,wf,Cs,yc,rh,gp,jl,Ra,Ss,ia,Eu,Za)};if(_c==="line")for(var Fh=0,$c=bo(Ra.geometry,0,0,8192,8192);Fh<$c.length;Fh+=1)for(var Kp=$c[Fh],yp=0,Qc=Ko(Kp,th,kh,Ea.vertical||$u,q,24,Rh,Gi.overscaling,8192);yp<Qc.length;yp+=1){var _p=Qc[yp];$u&&vn(Gi,$u.text,Lh,_p)||wl(Kp,_p)}else if(_c==="line-center")for(var Bh=0,Nh=Ra.geometry;Bh<Nh.length;Bh+=1){var nh=Nh[Bh];if(nh.length>1){var xp=za(nh,kh,Ea.vertical||$u,q,24,Rh);xp&&wl(nh,xp)}}else if(Ra.type==="Polygon")for(var ih=0,zh=Yf(Ra.geometry,0);ih<zh.length;ih+=1){var bp=zh[ih],Ep=ni(bp,16);wl(bp[0],new Yr(Ep.x,Ep.y,0))}else if(Ra.type==="LineString")for(var ah=0,Uh=Ra.geometry;ah<Uh.length;ah+=1){var Zh=Uh[ah];wl(Zh,new Yr(Zh[0].x,Zh[0].y,0))}else if(Ra.type==="Point")for(var $p=0,Dd=Ra.geometry;$p<Dd.length;$p+=1)for(var Qp=0,Fd=Dd[$p];Qp<Fd.length;Qp+=1){var Jp=Fd[Qp];wl([Jp],new Yr(Jp.x,Jp.y,0))}}(t,Ht,Jr,fs,p,N,Hr,Tn,pn,ro,S)},bt=0,jt=t.features;bt<jt.length;bt+=1)nt();x&&t.generateCollisionDebugBuffers()},v.perspective=function(t,o,u,p,g){var x,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,g!=null&&g!==1/0?(t[10]=(g+p)*(x=1/(p-g)),t[14]=2*g*p*x):(t[10]=-1,t[14]=-2*p),t},v.pick=function(t,o){for(var u={},p=0;p<o.length;p++){var g=o[p];g in t&&(u[g]=t[g])}return u},v.plugin=qs,v.polygonIntersectsPolygon=Js,v.postMapLoadEvent=Vt,v.postTurnstileEvent=no,v.potpack=gr,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=dn,v.registerForPluginStateChange=function(t){return t({pluginStatus:Os,pluginURL:Wu}),oc.on("pluginStateChange",t),t},v.renderColorRamp=jf,v.rotate=function(t,o,u){var p=o[0],g=o[1],x=o[2],S=o[3],P=Math.sin(u),L=Math.cos(u);return t[0]=p*L+x*P,t[1]=g*L+S*P,t[2]=p*-P+x*L,t[3]=g*-P+S*L,t},v.rotateX=function(t,o,u){var p=Math.sin(u),g=Math.cos(u),x=o[4],S=o[5],P=o[6],L=o[7],N=o[8],Z=o[9],G=o[10],Q=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=x*g+N*p,t[5]=S*g+Z*p,t[6]=P*g+G*p,t[7]=L*g+Q*p,t[8]=N*g-x*p,t[9]=Z*g-S*p,t[10]=G*g-P*p,t[11]=Q*g-L*p,t},v.rotateZ=function(t,o,u){var p=Math.sin(u),g=Math.cos(u),x=o[0],S=o[1],P=o[2],L=o[3],N=o[4],Z=o[5],G=o[6],Q=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=x*g+N*p,t[1]=S*g+Z*p,t[2]=P*g+G*p,t[3]=L*g+Q*p,t[4]=N*g-x*p,t[5]=Z*g-S*p,t[6]=G*g-P*p,t[7]=Q*g-L*p,t},v.scale=function(t,o,u){var p=u[0],g=u[1],x=u[2];return t[0]=o[0]*p,t[1]=o[1]*p,t[2]=o[2]*p,t[3]=o[3]*p,t[4]=o[4]*g,t[5]=o[5]*g,t[6]=o[6]*g,t[7]=o[7]*g,t[8]=o[8]*x,t[9]=o[9]*x,t[10]=o[10]*x,t[11]=o[11]*x,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},v.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},v.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},v.setCacheLimits=function(t,o){ar=t,Ar=o},v.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Os==="deferred"||Os==="loading"||Os==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Wu=ea.resolveURL(t),Os="deferred",Hu=o,ac(),u||Fs()},v.sphericalToCartesian=function(t){var o=t[0],u=t[1],p=t[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},v.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},v.styleSpec=le,v.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},v.symbolSize=Fi,v.transformMat3=function(t,o,u){var p=o[0],g=o[1],x=o[2];return t[0]=p*u[0]+g*u[3]+x*u[6],t[1]=p*u[1]+g*u[4]+x*u[7],t[2]=p*u[2]+g*u[5]+x*u[8],t},v.transformMat4=Ul,v.translate=function(t,o,u){var p,g,x,S,P,L,N,Z,G,Q,ae,Ie,Le=u[0],We=u[1],Ne=u[2];return o===t?(t[12]=o[0]*Le+o[4]*We+o[8]*Ne+o[12],t[13]=o[1]*Le+o[5]*We+o[9]*Ne+o[13],t[14]=o[2]*Le+o[6]*We+o[10]*Ne+o[14],t[15]=o[3]*Le+o[7]*We+o[11]*Ne+o[15]):(g=o[1],x=o[2],S=o[3],P=o[4],L=o[5],N=o[6],Z=o[7],G=o[8],Q=o[9],ae=o[10],Ie=o[11],t[0]=p=o[0],t[1]=g,t[2]=x,t[3]=S,t[4]=P,t[5]=L,t[6]=N,t[7]=Z,t[8]=G,t[9]=Q,t[10]=ae,t[11]=Ie,t[12]=p*Le+P*We+G*Ne+o[12],t[13]=g*Le+L*We+Q*Ne+o[13],t[14]=x*Le+N*We+ae*Ne+o[14],t[15]=S*Le+Z*We+Ie*Ne+o[15]),t},v.triggerPluginCompletionEvent=mh,v.uniqueId=Ct,v.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},v.validateLight=ao,v.validateStyle=Lc,v.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},v.vectorTile=Nt,v.version="1.13.2",v.warnOnce=Qe,v.webpSupported=ii,v.window=he,v.wrap=ir}),pe(["./shared"],function(v){"use strict";function de(j){var K=typeof j;if(K==="number"||K==="boolean"||K==="string"||j==null)return JSON.stringify(j);if(Array.isArray(j)){for(var re="[",ye=0,ke=j;ye<ke.length;ye+=1)re+=de(ke[ye])+",";return re+"]"}for(var je=Object.keys(j).sort(),Je="{",le=0;le<je.length;le++)Je+=JSON.stringify(je[le])+":"+de(j[je[le]])+",";return Je+"}"}function U(j){for(var K="",re=0,ye=v.refProperties;re<ye.length;re+=1)K+="/"+de(j[ye[re]]);return K}var te=function(j){this.keyCache={},j&&this.replace(j)};te.prototype.replace=function(j){this._layerConfigs={},this._layers={},this.update(j,[])},te.prototype.update=function(j,K){for(var re=this,ye=0,ke=j;ye<ke.length;ye+=1){var je=ke[ye];this._layerConfigs[je.id]=je;var Je=this._layers[je.id]=v.createStyleLayer(je);Je._featureFilter=v.featureFilter(Je.filter),this.keyCache[je.id]&&delete this.keyCache[je.id]}for(var le=0,De=K;le<De.length;le+=1){var vt=De[le];delete this.keyCache[vt],delete this._layerConfigs[vt],delete this._layers[vt]}this.familiesBySource={};for(var fr=0,Rt=function(Fr,Vr){for(var di={},en=0;en<Fr.length;en++){var Ai=Vr&&Vr[Fr[en].id]||U(Fr[en]);Vr&&(Vr[Fr[en].id]=Ai);var Vn=di[Ai];Vn||(Vn=di[Ai]=[]),Vn.push(Fr[en])}var li=[];for(var Ci in di)li.push(di[Ci]);return li}(v.values(this._layerConfigs),this.keyCache);fr<Rt.length;fr+=1){var Lt=Rt[fr].map(function(Fr){return re._layers[Fr.id]}),vr=Lt[0];if(vr.visibility!=="none"){var yn=vr.source||"",ln=this.familiesBySource[yn];ln||(ln=this.familiesBySource[yn]={});var wt=vr.sourceLayer||"_geojsonTileLayer",nn=ln[wt];nn||(nn=ln[wt]=[]),nn.push(Lt)}}};var se=function(j){var K={},re=[];for(var ye in j){var ke=j[ye],je=K[ye]={};for(var Je in ke){var le=ke[+Je];if(le&&le.bitmap.width!==0&&le.bitmap.height!==0){var De={x:0,y:0,w:le.bitmap.width+2,h:le.bitmap.height+2};re.push(De),je[Je]={rect:De,metrics:le.metrics}}}}var vt=v.potpack(re),fr=new v.AlphaImage({width:vt.w||1,height:vt.h||1});for(var Rt in j){var Lt=j[Rt];for(var vr in Lt){var yn=Lt[+vr];if(yn&&yn.bitmap.width!==0&&yn.bitmap.height!==0){var ln=K[Rt][vr].rect;v.AlphaImage.copy(yn.bitmap,fr,{x:0,y:0},{x:ln.x+1,y:ln.y+1},yn.bitmap)}}}this.image=fr,this.positions=K};v.register("GlyphAtlas",se);var Re=function(j){this.tileID=new v.OverscaledTileID(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId};function he(j,K,re){for(var ye=new v.EvaluationParameters(K),ke=0,je=j;ke<je.length;ke+=1)je[ke].recalculate(ye,re)}function $e(j,K){var re=v.getArrayBuffer(j.request,function(ye,ke,je,Je){ye?K(ye):ke&&K(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(ke)),rawData:ke,cacheControl:je,expires:Je})});return function(){re.cancel(),K()}}Re.prototype.parse=function(j,K,re,ye,ke){var je=this;this.status="parsing",this.data=j,this.collisionBoxArray=new v.CollisionBoxArray;var Je=new v.DictionaryCoder(Object.keys(j.layers).sort()),le=new v.FeatureIndex(this.tileID,this.promoteId);le.bucketLayerIDs=[];var De,vt,fr,Rt,Lt={},vr={featureIndex:le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},yn=K.familiesBySource[this.source];for(var ln in yn){var wt=j.layers[ln];if(wt){wt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+ln+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var nn=Je.encode(ln),Fr=[],Vr=0;Vr<wt.length;Vr++){var di=wt.feature(Vr),en=le.getId(di,ln);Fr.push({feature:di,id:en,index:Vr,sourceLayerIndex:nn})}for(var Ai=0,Vn=yn[ln];Ai<Vn.length;Ai+=1){var li=Vn[Ai],Ci=li[0];Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility!=="none"&&(he(li,this.zoom,re),(Lt[Ci.id]=Ci.createBucket({index:le.bucketLayerIDs.length,layers:li,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nn,sourceID:this.source})).populate(Fr,vr,this.tileID.canonical),le.bucketLayerIDs.push(li.map(function(Ki){return Ki.id})))}}}var Ei=v.mapObject(vr.glyphDependencies,function(Ki){return Object.keys(Ki).map(Number)});Object.keys(Ei).length?ye.send("getGlyphs",{uid:this.uid,stacks:Ei},function(Ki,Jn){De||(De=Ki,vt=Jn,Yt.call(je))}):vt={};var Xn=Object.keys(vr.iconDependencies);Xn.length?ye.send("getImages",{icons:Xn,source:this.source,tileID:this.tileID,type:"icons"},function(Ki,Jn){De||(De=Ki,fr=Jn,Yt.call(je))}):fr={};var Bt=Object.keys(vr.patternDependencies);function Yt(){if(De)return ke(De);if(vt&&fr&&Rt){var Ki=new se(vt),Jn=new v.ImageAtlas(fr,Rt);for(var Di in Lt){var Sa=Lt[Di];Sa instanceof v.SymbolBucket?(he(Sa.layers,this.zoom,re),v.performSymbolLayout(Sa,vt,Ki.positions,fr,Jn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Sa.hasPattern&&(Sa instanceof v.LineBucket||Sa instanceof v.FillBucket||Sa instanceof v.FillExtrusionBucket)&&(he(Sa.layers,this.zoom,re),Sa.addFeatures(vr,this.tileID.canonical,Jn.patternPositions))}this.status="done",ke(null,{buckets:v.values(Lt).filter(function(bn){return!bn.isEmpty()}),featureIndex:le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ki.image,imageAtlas:Jn,glyphMap:this.returnDependencies?vt:null,iconMap:this.returnDependencies?fr:null,glyphPositions:this.returnDependencies?Ki.positions:null})}}Bt.length?ye.send("getImages",{icons:Bt,source:this.source,tileID:this.tileID,type:"patterns"},function(Ki,Jn){De||(De=Ki,Rt=Jn,Yt.call(je))}):Rt={},Yt.call(this)};var tt=function(j,K,re,ye){this.actor=j,this.layerIndex=K,this.availableImages=re,this.loadVectorData=ye||$e,this.loading={},this.loaded={}};tt.prototype.loadTile=function(j,K){var re=this,ye=j.uid;this.loading||(this.loading={});var ke=!!(j&&j.request&&j.request.collectResourceTiming)&&new v.RequestPerformance(j.request),je=this.loading[ye]=new Re(j);je.abort=this.loadVectorData(j,function(Je,le){if(delete re.loading[ye],Je||!le)return je.status="done",re.loaded[ye]=je,K(Je);var De=le.rawData,vt={};le.expires&&(vt.expires=le.expires),le.cacheControl&&(vt.cacheControl=le.cacheControl);var fr={};if(ke){var Rt=ke.finish();Rt&&(fr.resourceTiming=JSON.parse(JSON.stringify(Rt)))}je.vectorTile=le.vectorTile,je.parse(le.vectorTile,re.layerIndex,re.availableImages,re.actor,function(Lt,vr){if(Lt||!vr)return K(Lt);K(null,v.extend({rawTileData:De.slice(0)},vr,vt,fr))}),re.loaded=re.loaded||{},re.loaded[ye]=je})},tt.prototype.reloadTile=function(j,K){var re=this,ye=this.loaded,ke=j.uid,je=this;if(ye&&ye[ke]){var Je=ye[ke];Je.showCollisionBoxes=j.showCollisionBoxes;var le=function(De,vt){var fr=Je.reloadCallback;fr&&(delete Je.reloadCallback,Je.parse(Je.vectorTile,je.layerIndex,re.availableImages,je.actor,fr)),K(De,vt)};Je.status==="parsing"?Je.reloadCallback=le:Je.status==="done"&&(Je.vectorTile?Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,le):le())}},tt.prototype.abortTile=function(j,K){var re=this.loading,ye=j.uid;re&&re[ye]&&re[ye].abort&&(re[ye].abort(),delete re[ye]),K()},tt.prototype.removeTile=function(j,K){var re=this.loaded,ye=j.uid;re&&re[ye]&&delete re[ye],K()};var gt=v.window.ImageBitmap,Jt=function(){this.loaded={}};function ir(j,K){if(j.length!==0){yt(j[0],K);for(var re=1;re<j.length;re++)yt(j[re],!K)}}function yt(j,K){for(var re=0,ye=0,ke=j.length,je=ke-1;ye<ke;je=ye++)re+=(j[ye][0]-j[je][0])*(j[je][1]+j[ye][1]);re>=0!=!!K&&j.reverse()}Jt.prototype.loadTile=function(j,K){var re=j.uid,ye=j.encoding,ke=j.rawImageData,je=gt&&ke instanceof gt?this.getImageData(ke):ke,Je=new v.DEMData(re,je,ye);this.loaded=this.loaded||{},this.loaded[re]=Je,K(null,Je)},Jt.prototype.getImageData=function(j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(j.width,j.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=j.width,this.offscreenCanvas.height=j.height,this.offscreenCanvasContext.drawImage(j,0,0,j.width,j.height);var K=this.offscreenCanvasContext.getImageData(-1,-1,j.width+2,j.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:K.width,height:K.height},K.data)},Jt.prototype.removeTile=function(j){var K=this.loaded,re=j.uid;K&&K[re]&&delete K[re]};var Qt=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ct=function(j){this._feature=j,this.extent=v.EXTENT,this.type=j.type,this.properties=j.tags,"id"in j&&!isNaN(j.id)&&(this.id=parseInt(j.id,10))};Ct.prototype.loadGeometry=function(){if(this._feature.type===1){for(var j=[],K=0,re=this._feature.geometry;K<re.length;K+=1){var ye=re[K];j.push([new v.Point$1(ye[0],ye[1])])}return j}for(var ke=[],je=0,Je=this._feature.geometry;je<Je.length;je+=1){for(var le=[],De=0,vt=Je[je];De<vt.length;De+=1){var fr=vt[De];le.push(new v.Point$1(fr[0],fr[1]))}ke.push(le)}return ke},Ct.prototype.toGeoJSON=function(j,K,re){return Qt.call(this,j,K,re)};var st=function(j){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=j.length,this._features=j};st.prototype.feature=function(j){return new Ct(this._features[j])};var ht=v.vectorTile.VectorTileFeature,Wt=X;function X(j,K){this.options=K||{},this.features=j,this.length=j.length}function Xt(j,K){this.id=typeof j.id=="number"?j.id:void 0,this.type=j.type,this.rawGeometry=j.type===1?[j.geometry]:j.geometry,this.properties=j.tags,this.extent=K||4096}X.prototype.feature=function(j){return new Xt(this.features[j],this.options.extent)},Xt.prototype.loadGeometry=function(){var j=this.rawGeometry;this.geometry=[];for(var K=0;K<j.length;K++){for(var re=j[K],ye=[],ke=0;ke<re.length;ke++)ye.push(new v.Point$1(re[ke][0],re[ke][1]));this.geometry.push(ye)}return this.geometry},Xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var j=this.geometry,K=1/0,re=-1/0,ye=1/0,ke=-1/0,je=0;je<j.length;je++)for(var Je=j[je],le=0;le<Je.length;le++){var De=Je[le];K=Math.min(K,De.x),re=Math.max(re,De.x),ye=Math.min(ye,De.y),ke=Math.max(ke,De.y)}return[K,ye,re,ke]},Xt.prototype.toGeoJSON=ht.prototype.toGeoJSON;var ft=lt,He=Wt;function lt(j){var K=new v.pbf;return function(re,ye){for(var ke in re.layers)ye.writeMessage(3,Qe,re.layers[ke])}(j,K),K.finish()}function Qe(j,K){var re;K.writeVarintField(15,j.version||1),K.writeStringField(1,j.name||""),K.writeVarintField(5,j.extent||4096);var ye={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<j.length;re++)ye.feature=j.feature(re),K.writeMessage(2,Ut,ye);var ke=ye.keys;for(re=0;re<ke.length;re++)K.writeStringField(3,ke[re]);var je=ye.values;for(re=0;re<je.length;re++)K.writeMessage(4,A,je[re])}function Ut(j,K){var re=j.feature;re.id!==void 0&&K.writeVarintField(1,re.id),K.writeMessage(2,xr,j),K.writeVarintField(3,re.type),K.writeMessage(4,Me,re)}function xr(j,K){var re=j.feature,ye=j.keys,ke=j.values,je=j.keycache,Je=j.valuecache;for(var le in re.properties){var De=je[le];De===void 0&&(ye.push(le),je[le]=De=ye.length-1),K.writeVarint(De);var vt=re.properties[le],fr=typeof vt;fr!=="string"&&fr!=="boolean"&&fr!=="number"&&(vt=JSON.stringify(vt));var Rt=fr+":"+vt,Lt=Je[Rt];Lt===void 0&&(ke.push(vt),Je[Rt]=Lt=ke.length-1),K.writeVarint(Lt)}}function Dr(j,K){return(K<<3)+(7&j)}function Kr(j){return j<<1^j>>31}function Me(j,K){for(var re=j.loadGeometry(),ye=j.type,ke=0,je=0,Je=re.length,le=0;le<Je;le++){var De=re[le],vt=1;ye===1&&(vt=De.length),K.writeVarint(Dr(1,vt));for(var fr=ye===3?De.length-1:De.length,Rt=0;Rt<fr;Rt++){Rt===1&&ye!==1&&K.writeVarint(Dr(2,fr-1));var Lt=De[Rt].x-ke,vr=De[Rt].y-je;K.writeVarint(Kr(Lt)),K.writeVarint(Kr(vr)),ke+=Lt,je+=vr}ye===3&&K.writeVarint(Dr(7,1))}}function A(j,K){var re=typeof j;re==="string"?K.writeStringField(1,j):re==="boolean"?K.writeBooleanField(7,j):re==="number"&&(j%1!=0?K.writeDoubleField(3,j):j<0?K.writeSVarintField(6,j):K.writeVarintField(5,j))}function _e(j,K,re,ye){Et(j,re,ye),Et(K,2*re,2*ye),Et(K,2*re+1,2*ye+1)}function Et(j,K,re){var ye=j[K];j[K]=j[re],j[re]=ye}function dt(j,K,re,ye){var ke=j-re,je=K-ye;return ke*ke+je*je}ft.fromVectorTileJs=lt,ft.fromGeojsonVt=function(j,K){K=K||{};var re={};for(var ye in j)re[ye]=new Wt(j[ye].features,K),re[ye].name=ye,re[ye].version=K.version,re[ye].extent=K.extent;return lt({layers:re})},ft.GeoJSONWrapper=He;var Ft=function(j){return j[0]},qt=function(j){return j[1]},Sr=function(j,K,re,ye,ke){K===void 0&&(K=Ft),re===void 0&&(re=qt),ye===void 0&&(ye=64),ke===void 0&&(ke=Float64Array),this.nodeSize=ye,this.points=j;for(var je=j.length<65536?Uint16Array:Uint32Array,Je=this.ids=new je(j.length),le=this.coords=new ke(2*j.length),De=0;De<j.length;De++)Je[De]=De,le[2*De]=K(j[De]),le[2*De+1]=re(j[De]);(function vt(fr,Rt,Lt,vr,yn,ln){if(!(yn-vr<=Lt)){var wt=vr+yn>>1;(function nn(Fr,Vr,di,en,Ai,Vn){for(;Ai>en;){if(Ai-en>600){var li=Ai-en+1,Ci=di-en+1,Ei=Math.log(li),Xn=.5*Math.exp(2*Ei/3),Bt=.5*Math.sqrt(Ei*Xn*(li-Xn)/li)*(Ci-li/2<0?-1:1);nn(Fr,Vr,di,Math.max(en,Math.floor(di-Ci*Xn/li+Bt)),Math.min(Ai,Math.floor(di+(li-Ci)*Xn/li+Bt)),Vn)}var Yt=Vr[2*di+Vn],Ki=en,Jn=Ai;for(_e(Fr,Vr,en,di),Vr[2*Ai+Vn]>Yt&&_e(Fr,Vr,en,Ai);Ki<Jn;){for(_e(Fr,Vr,Ki,Jn),Ki++,Jn--;Vr[2*Ki+Vn]<Yt;)Ki++;for(;Vr[2*Jn+Vn]>Yt;)Jn--}Vr[2*en+Vn]===Yt?_e(Fr,Vr,en,Jn):_e(Fr,Vr,++Jn,Ai),Jn<=di&&(en=Jn+1),di<=Jn&&(Ai=Jn-1)}})(fr,Rt,wt,vr,yn,ln%2),vt(fr,Rt,Lt,vr,wt-1,ln+1),vt(fr,Rt,Lt,wt+1,yn,ln+1)}})(Je,le,ye,0,Je.length-1,0)};Sr.prototype.range=function(j,K,re,ye){return function(ke,je,Je,le,De,vt,fr){for(var Rt,Lt,vr=[0,ke.length-1,0],yn=[];vr.length;){var ln=vr.pop(),wt=vr.pop(),nn=vr.pop();if(wt-nn<=fr)for(var Fr=nn;Fr<=wt;Fr++)Lt=je[2*Fr+1],(Rt=je[2*Fr])>=Je&&Rt<=De&&Lt>=le&&Lt<=vt&&yn.push(ke[Fr]);else{var Vr=Math.floor((nn+wt)/2);Lt=je[2*Vr+1],(Rt=je[2*Vr])>=Je&&Rt<=De&&Lt>=le&&Lt<=vt&&yn.push(ke[Vr]);var di=(ln+1)%2;(ln===0?Je<=Rt:le<=Lt)&&(vr.push(nn),vr.push(Vr-1),vr.push(di)),(ln===0?De>=Rt:vt>=Lt)&&(vr.push(Vr+1),vr.push(wt),vr.push(di))}}return yn}(this.ids,this.coords,j,K,re,ye,this.nodeSize)},Sr.prototype.within=function(j,K,re){return function(ye,ke,je,Je,le,De){for(var vt=[0,ye.length-1,0],fr=[],Rt=le*le;vt.length;){var Lt=vt.pop(),vr=vt.pop(),yn=vt.pop();if(vr-yn<=De)for(var ln=yn;ln<=vr;ln++)dt(ke[2*ln],ke[2*ln+1],je,Je)<=Rt&&fr.push(ye[ln]);else{var wt=Math.floor((yn+vr)/2),nn=ke[2*wt],Fr=ke[2*wt+1];dt(nn,Fr,je,Je)<=Rt&&fr.push(ye[wt]);var Vr=(Lt+1)%2;(Lt===0?je-le<=nn:Je-le<=Fr)&&(vt.push(yn),vt.push(wt-1),vt.push(Vr)),(Lt===0?je+le>=nn:Je+le>=Fr)&&(vt.push(wt+1),vt.push(vr),vt.push(Vr))}}return fr}(this.ids,this.coords,j,K,re,this.nodeSize)};var Qn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(j){return j}},gn=function(j){this.options=ma(Object.create(Qn),j),this.trees=new Array(this.options.maxZoom+1)};function ea(j,K,re,ye,ke){return{x:j,y:K,zoom:1/0,id:re,parentId:-1,numPoints:ye,properties:ke}}function wn(j,K){var re=j.geometry.coordinates,ye=re[1];return{x:si(re[0]),y:Wn(ye),zoom:1/0,index:K,parentId:-1}}function ii(j){return{type:"Feature",id:j.id,properties:Si(j),geometry:{type:"Point",coordinates:[(ye=j.x,360*(ye-.5)),(K=j.y,re=(180-360*K)*Math.PI/180,360*Math.atan(Math.exp(re))/Math.PI-90)]}};var K,re,ye}function Si(j){var K=j.numPoints,re=K>=1e4?Math.round(K/1e3)+"k":K>=1e3?Math.round(K/100)/10+"k":K;return ma(ma({},j.properties),{cluster:!0,cluster_id:j.id,point_count:K,point_count_abbreviated:re})}function si(j){return j/360+.5}function Wn(j){var K=Math.sin(j*Math.PI/180),re=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return re<0?0:re>1?1:re}function ma(j,K){for(var re in K)j[re]=K[re];return j}function zi(j){return j.x}function ji(j){return j.y}function Wi(j,K,re,ye,ke,je){var Je=ke-re,le=je-ye;if(Je!==0||le!==0){var De=((j-re)*Je+(K-ye)*le)/(Je*Je+le*le);De>1?(re=ke,ye=je):De>0&&(re+=Je*De,ye+=le*De)}return(Je=j-re)*Je+(le=K-ye)*le}function ga(j,K,re,ye){var ke={id:j===void 0?null:j,type:K,geometry:re,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(je){var Je=je.geometry,le=je.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")vo(je,Je);else if(le==="Polygon"||le==="MultiLineString")for(var De=0;De<Je.length;De++)vo(je,Je[De]);else if(le==="MultiPolygon")for(De=0;De<Je.length;De++)for(var vt=0;vt<Je[De].length;vt++)vo(je,Je[De][vt])}(ke),ke}function vo(j,K){for(var re=0;re<K.length;re+=3)j.minX=Math.min(j.minX,K[re]),j.minY=Math.min(j.minY,K[re+1]),j.maxX=Math.max(j.maxX,K[re]),j.maxY=Math.max(j.maxY,K[re+1])}function Va(j,K,re,ye){if(K.geometry){var ke=K.geometry.coordinates,je=K.geometry.type,Je=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),le=[],De=K.id;if(re.promoteId?De=K.properties[re.promoteId]:re.generateId&&(De=ye||0),je==="Point")la(ke,le);else if(je==="MultiPoint")for(var vt=0;vt<ke.length;vt++)la(ke[vt],le);else if(je==="LineString")Ui(ke,le,Je,!1);else if(je==="MultiLineString"){if(re.lineMetrics){for(vt=0;vt<ke.length;vt++)Ui(ke[vt],le=[],Je,!1),j.push(ga(De,"LineString",le,K.properties));return}ra(ke,le,Je,!1)}else if(je==="Polygon")ra(ke,le,Je,!0);else{if(je!=="MultiPolygon"){if(je==="GeometryCollection"){for(vt=0;vt<K.geometry.geometries.length;vt++)Va(j,{id:De,geometry:K.geometry.geometries[vt],properties:K.properties},re,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(vt=0;vt<ke.length;vt++){var fr=[];ra(ke[vt],fr,Je,!0),le.push(fr)}}j.push(ga(De,je,le,K.properties))}}function la(j,K){K.push(qi(j[0])),K.push(Ts(j[1])),K.push(0)}function Ui(j,K,re,ye){for(var ke,je,Je=0,le=0;le<j.length;le++){var De=qi(j[le][0]),vt=Ts(j[le][1]);K.push(De),K.push(vt),K.push(0),le>0&&(Je+=ye?(ke*vt-De*je)/2:Math.sqrt(Math.pow(De-ke,2)+Math.pow(vt-je,2))),ke=De,je=vt}var fr=K.length-3;K[2]=1,function Rt(Lt,vr,yn,ln){for(var wt,nn=ln,Fr=yn-vr>>1,Vr=yn-vr,di=Lt[vr],en=Lt[vr+1],Ai=Lt[yn],Vn=Lt[yn+1],li=vr+3;li<yn;li+=3){var Ci=Wi(Lt[li],Lt[li+1],di,en,Ai,Vn);if(Ci>nn)wt=li,nn=Ci;else if(Ci===nn){var Ei=Math.abs(li-Fr);Ei<Vr&&(wt=li,Vr=Ei)}}nn>ln&&(wt-vr>3&&Rt(Lt,vr,wt,ln),Lt[wt+2]=nn,yn-wt>3&&Rt(Lt,wt,yn,ln))}(K,0,fr,re),K[fr+2]=1,K.size=Math.abs(Je),K.start=0,K.end=K.size}function ra(j,K,re,ye){for(var ke=0;ke<j.length;ke++){var je=[];Ui(j[ke],je,re,ye),K.push(je)}}function qi(j){return j/360+.5}function Ts(j){var K=Math.sin(j*Math.PI/180),re=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return re<0?0:re>1?1:re}function ge(j,K,re,ye,ke,je,Je,le){if(ye/=K,je>=(re/=K)&&Je<ye)return j;if(Je<re||je>=ye)return null;for(var De=[],vt=0;vt<j.length;vt++){var fr=j[vt],Rt=fr.geometry,Lt=fr.type,vr=ke===0?fr.minX:fr.minY,yn=ke===0?fr.maxX:fr.maxY;if(vr>=re&&yn<ye)De.push(fr);else if(!(yn<re||vr>=ye)){var ln=[];if(Lt==="Point"||Lt==="MultiPoint")ui(Rt,ln,re,ye,ke);else if(Lt==="LineString")no(Rt,ln,re,ye,ke,!1,le.lineMetrics);else if(Lt==="MultiLineString")Vt(Rt,ln,re,ye,ke,!1);else if(Lt==="Polygon")Vt(Rt,ln,re,ye,ke,!0);else if(Lt==="MultiPolygon")for(var wt=0;wt<Rt.length;wt++){var nn=[];Vt(Rt[wt],nn,re,ye,ke,!0),nn.length&&ln.push(nn)}if(ln.length){if(le.lineMetrics&&Lt==="LineString"){for(wt=0;wt<ln.length;wt++)De.push(ga(fr.id,Lt,ln[wt],fr.tags));continue}Lt!=="LineString"&&Lt!=="MultiLineString"||(ln.length===1?(Lt="LineString",ln=ln[0]):Lt="MultiLineString"),Lt!=="Point"&&Lt!=="MultiPoint"||(Lt=ln.length===3?"Point":"MultiPoint"),De.push(ga(fr.id,Lt,ln,fr.tags))}}}return De.length?De:null}function ui(j,K,re,ye,ke){for(var je=0;je<j.length;je+=3){var Je=j[je+ke];Je>=re&&Je<=ye&&(K.push(j[je]),K.push(j[je+1]),K.push(j[je+2]))}}function no(j,K,re,ye,ke,je,Je){for(var le,De,vt=ru(j),fr=ke===0?Ar:on,Rt=j.start,Lt=0;Lt<j.length-3;Lt+=3){var vr=j[Lt],yn=j[Lt+1],ln=j[Lt+2],wt=j[Lt+3],nn=j[Lt+4],Fr=ke===0?vr:yn,Vr=ke===0?wt:nn,di=!1;Je&&(le=Math.sqrt(Math.pow(vr-wt,2)+Math.pow(yn-nn,2))),Fr<re?Vr>re&&(De=fr(vt,vr,yn,wt,nn,re),Je&&(vt.start=Rt+le*De)):Fr>ye?Vr<ye&&(De=fr(vt,vr,yn,wt,nn,ye),Je&&(vt.start=Rt+le*De)):ar(vt,vr,yn,ln),Vr<re&&Fr>=re&&(De=fr(vt,vr,yn,wt,nn,re),di=!0),Vr>ye&&Fr<=ye&&(De=fr(vt,vr,yn,wt,nn,ye),di=!0),!je&&di&&(Je&&(vt.end=Rt+le*De),K.push(vt),vt=ru(j)),Je&&(Rt+=le)}var en=j.length-3;vr=j[en],yn=j[en+1],ln=j[en+2],(Fr=ke===0?vr:yn)>=re&&Fr<=ye&&ar(vt,vr,yn,ln),en=vt.length-3,je&&en>=3&&(vt[en]!==vt[0]||vt[en+1]!==vt[1])&&ar(vt,vt[0],vt[1],vt[2]),vt.length&&K.push(vt)}function ru(j){var K=[];return K.size=j.size,K.start=j.start,K.end=j.end,K}function Vt(j,K,re,ye,ke,je){for(var Je=0;Je<j.length;Je++)no(j[Je],K,re,ye,ke,je,!1)}function ar(j,K,re,ye){j.push(K),j.push(re),j.push(ye)}function Ar(j,K,re,ye,ke,je){var Je=(je-K)/(ye-K);return j.push(je),j.push(re+(ke-re)*Je),j.push(1),Je}function on(j,K,re,ye,ke,je){var Je=(je-re)/(ke-re);return j.push(K+(ye-K)*Je),j.push(je),j.push(1),Je}function In(j,K){for(var re=[],ye=0;ye<j.length;ye++){var ke,je=j[ye],Je=je.type;if(Je==="Point"||Je==="MultiPoint"||Je==="LineString")ke=Rn(je.geometry,K);else if(Je==="MultiLineString"||Je==="Polygon"){ke=[];for(var le=0;le<je.geometry.length;le++)ke.push(Rn(je.geometry[le],K))}else if(Je==="MultiPolygon")for(ke=[],le=0;le<je.geometry.length;le++){for(var De=[],vt=0;vt<je.geometry[le].length;vt++)De.push(Rn(je.geometry[le][vt],K));ke.push(De)}re.push(ga(je.id,Je,ke,je.tags))}return re}function Rn(j,K){var re=[];re.size=j.size,j.start!==void 0&&(re.start=j.start,re.end=j.end);for(var ye=0;ye<j.length;ye+=3)re.push(j[ye]+K,j[ye+1],j[ye+2]);return re}function bi(j,K){if(j.transformed)return j;var re,ye,ke,je=1<<j.z,Je=j.x,le=j.y;for(re=0;re<j.features.length;re++){var De=j.features[re],vt=De.geometry,fr=De.type;if(De.geometry=[],fr===1)for(ye=0;ye<vt.length;ye+=2)De.geometry.push(gi(vt[ye],vt[ye+1],K,je,Je,le));else for(ye=0;ye<vt.length;ye++){var Rt=[];for(ke=0;ke<vt[ye].length;ke+=2)Rt.push(gi(vt[ye][ke],vt[ye][ke+1],K,je,Je,le));De.geometry.push(Rt)}}return j.transformed=!0,j}function gi(j,K,re,ye,ke,je){return[Math.round(re*(j*ye-ke)),Math.round(re*(K*ye-je))]}function En(j,K,re,ye,ke){for(var je=K===ke.maxZoom?0:ke.tolerance/((1<<K)*ke.extent),Je={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:ye,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},le=0;le<j.length;le++){Je.numFeatures++,Oi(Je,j[le],je,ke);var De=j[le].minX,vt=j[le].minY,fr=j[le].maxX,Rt=j[le].maxY;De<Je.minX&&(Je.minX=De),vt<Je.minY&&(Je.minY=vt),fr>Je.maxX&&(Je.maxX=fr),Rt>Je.maxY&&(Je.maxY=Rt)}return Je}function Oi(j,K,re,ye){var ke=K.geometry,je=K.type,Je=[];if(je==="Point"||je==="MultiPoint")for(var le=0;le<ke.length;le+=3)Je.push(ke[le]),Je.push(ke[le+1]),j.numPoints++,j.numSimplified++;else if(je==="LineString")Ii(Je,ke,j,re,!1,!1);else if(je==="MultiLineString"||je==="Polygon")for(le=0;le<ke.length;le++)Ii(Je,ke[le],j,re,je==="Polygon",le===0);else if(je==="MultiPolygon")for(var De=0;De<ke.length;De++){var vt=ke[De];for(le=0;le<vt.length;le++)Ii(Je,vt[le],j,re,!0,le===0)}if(Je.length){var fr=K.tags||null;if(je==="LineString"&&ye.lineMetrics){for(var Rt in fr={},K.tags)fr[Rt]=K.tags[Rt];fr.mapbox_clip_start=ke.start/ke.size,fr.mapbox_clip_end=ke.end/ke.size}var Lt={geometry:Je,type:je==="Polygon"||je==="MultiPolygon"?3:je==="LineString"||je==="MultiLineString"?2:1,tags:fr};K.id!==null&&(Lt.id=K.id),j.features.push(Lt)}}function Ii(j,K,re,ye,ke,je){var Je=ye*ye;if(ye>0&&K.size<(ke?Je:ye))re.numPoints+=K.length/3;else{for(var le=[],De=0;De<K.length;De+=3)(ye===0||K[De+2]>Je)&&(re.numSimplified++,le.push(K[De]),le.push(K[De+1])),re.numPoints++;ke&&function(vt,fr){for(var Rt=0,Lt=0,vr=vt.length,yn=vr-2;Lt<vr;yn=Lt,Lt+=2)Rt+=(vt[Lt]-vt[yn])*(vt[Lt+1]+vt[yn+1]);if(Rt>0===fr)for(Lt=0,vr=vt.length;Lt<vr/2;Lt+=2){var ln=vt[Lt],wt=vt[Lt+1];vt[Lt]=vt[vr-2-Lt],vt[Lt+1]=vt[vr-1-Lt],vt[vr-2-Lt]=ln,vt[vr-1-Lt]=wt}}(le,je),j.push(le)}}function ja(j,K){var re=(K=this.options=function(ke,je){for(var Je in je)ke[Je]=je[Je];return ke}(Object.create(this.options),K)).debug;if(re&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye=function(ke,je){var Je=[];if(ke.type==="FeatureCollection")for(var le=0;le<ke.features.length;le++)Va(Je,ke.features[le],je,le);else Va(Je,ke.type==="Feature"?ke:{geometry:ke},je);return Je}(j,K);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ye=function(ke,je){var Je=je.buffer/je.extent,le=ke,De=ge(ke,1,-1-Je,Je,0,-1,2,je),vt=ge(ke,1,1-Je,2+Je,0,-1,2,je);return(De||vt)&&(le=ge(ke,1,-Je,1+Je,0,-1,2,je)||[],De&&(le=In(De,1).concat(le)),vt&&(le=le.concat(In(vt,-1)))),le}(ye,K)).length&&this.splitTile(ye,0,0,0),re&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ps(j,K,re){return 32*((1<<j)*re+K)+j}function Ho(j,K){var re=j.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);var ye=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!ye)return K(null,null);var ke=new st(ye.features),je=ft(ke);je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),K(null,{vectorTile:ke,rawData:je.buffer})}gn.prototype.load=function(j){var K=this.options,re=K.log,ye=K.minZoom,ke=K.maxZoom,je=K.nodeSize;re&&console.time("total time");var Je="prepare "+j.length+" points";re&&console.time(Je),this.points=j;for(var le=[],De=0;De<j.length;De++)j[De].geometry&&le.push(wn(j[De],De));this.trees[ke+1]=new Sr(le,zi,ji,je,Float32Array),re&&console.timeEnd(Je);for(var vt=ke;vt>=ye;vt--){var fr=+Date.now();le=this._cluster(le,vt),this.trees[vt]=new Sr(le,zi,ji,je,Float32Array),re&&console.log("z%d: %d clusters in %dms",vt,le.length,+Date.now()-fr)}return re&&console.timeEnd("total time"),this},gn.prototype.getClusters=function(j,K){var re=((j[0]+180)%360+360)%360-180,ye=Math.max(-90,Math.min(90,j[1])),ke=j[2]===180?180:((j[2]+180)%360+360)%360-180,je=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)re=-180,ke=180;else if(re>ke){var Je=this.getClusters([re,ye,180,je],K),le=this.getClusters([-180,ye,ke,je],K);return Je.concat(le)}for(var De=this.trees[this._limitZoom(K)],vt=[],fr=0,Rt=De.range(si(re),Wn(je),si(ke),Wn(ye));fr<Rt.length;fr+=1){var Lt=De.points[Rt[fr]];vt.push(Lt.numPoints?ii(Lt):this.points[Lt.index])}return vt},gn.prototype.getChildren=function(j){var K=this._getOriginId(j),re=this._getOriginZoom(j),ye="No cluster with the specified id.",ke=this.trees[re];if(!ke)throw new Error(ye);var je=ke.points[K];if(!je)throw new Error(ye);for(var Je=this.options.radius/(this.options.extent*Math.pow(2,re-1)),le=[],De=0,vt=ke.within(je.x,je.y,Je);De<vt.length;De+=1){var fr=ke.points[vt[De]];fr.parentId===j&&le.push(fr.numPoints?ii(fr):this.points[fr.index])}if(le.length===0)throw new Error(ye);return le},gn.prototype.getLeaves=function(j,K,re){var ye=[];return this._appendLeaves(ye,j,K=K||10,re=re||0,0),ye},gn.prototype.getTile=function(j,K,re){var ye=this.trees[this._limitZoom(j)],ke=Math.pow(2,j),je=this.options,Je=je.radius/je.extent,le=(re-Je)/ke,De=(re+1+Je)/ke,vt={features:[]};return this._addTileFeatures(ye.range((K-Je)/ke,le,(K+1+Je)/ke,De),ye.points,K,re,ke,vt),K===0&&this._addTileFeatures(ye.range(1-Je/ke,le,1,De),ye.points,ke,re,ke,vt),K===ke-1&&this._addTileFeatures(ye.range(0,le,Je/ke,De),ye.points,-1,re,ke,vt),vt.features.length?vt:null},gn.prototype.getClusterExpansionZoom=function(j){for(var K=this._getOriginZoom(j)-1;K<=this.options.maxZoom;){var re=this.getChildren(j);if(K++,re.length!==1)break;j=re[0].properties.cluster_id}return K},gn.prototype._appendLeaves=function(j,K,re,ye,ke){for(var je=0,Je=this.getChildren(K);je<Je.length;je+=1){var le=Je[je],De=le.properties;if(De&&De.cluster?ke+De.point_count<=ye?ke+=De.point_count:ke=this._appendLeaves(j,De.cluster_id,re,ye,ke):ke<ye?ke++:j.push(le),j.length===re)break}return ke},gn.prototype._addTileFeatures=function(j,K,re,ye,ke,je){for(var Je=0,le=j;Je<le.length;Je+=1){var De=K[le[Je]],vt=De.numPoints,fr={type:1,geometry:[[Math.round(this.options.extent*(De.x*ke-re)),Math.round(this.options.extent*(De.y*ke-ye))]],tags:vt?Si(De):this.points[De.index].properties},Rt=void 0;vt?Rt=De.id:this.options.generateId?Rt=De.index:this.points[De.index].id&&(Rt=this.points[De.index].id),Rt!==void 0&&(fr.id=Rt),je.features.push(fr)}},gn.prototype._limitZoom=function(j){return Math.max(this.options.minZoom,Math.min(+j,this.options.maxZoom+1))},gn.prototype._cluster=function(j,K){for(var re=[],ye=this.options,ke=ye.reduce,je=ye.minPoints,Je=ye.radius/(ye.extent*Math.pow(2,K)),le=0;le<j.length;le++){var De=j[le];if(!(De.zoom<=K)){De.zoom=K;for(var vt=this.trees[K+1],fr=vt.within(De.x,De.y,Je),Rt=De.numPoints||1,Lt=Rt,vr=0,yn=fr;vr<yn.length;vr+=1){var ln=vt.points[yn[vr]];ln.zoom>K&&(Lt+=ln.numPoints||1)}if(Lt>=je){for(var wt=De.x*Rt,nn=De.y*Rt,Fr=ke&&Rt>1?this._map(De,!0):null,Vr=(le<<5)+(K+1)+this.points.length,di=0,en=fr;di<en.length;di+=1){var Ai=vt.points[en[di]];if(!(Ai.zoom<=K)){Ai.zoom=K;var Vn=Ai.numPoints||1;wt+=Ai.x*Vn,nn+=Ai.y*Vn,Ai.parentId=Vr,ke&&(Fr||(Fr=this._map(De,!0)),ke(Fr,this._map(Ai)))}}De.parentId=Vr,re.push(ea(wt/Lt,nn/Lt,Vr,Lt,Fr))}else if(re.push(De),Lt>1)for(var li=0,Ci=fr;li<Ci.length;li+=1){var Ei=vt.points[Ci[li]];Ei.zoom<=K||(Ei.zoom=K,re.push(Ei))}}}return re},gn.prototype._getOriginId=function(j){return j-this.points.length>>5},gn.prototype._getOriginZoom=function(j){return(j-this.points.length)%32},gn.prototype._map=function(j,K){if(j.numPoints)return K?ma({},j.properties):j.properties;var re=this.points[j.index].properties,ye=this.options.map(re);return K&&ye===re?ma({},ye):ye},ja.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ja.prototype.splitTile=function(j,K,re,ye,ke,je,Je){for(var le=[j,K,re,ye],De=this.options,vt=De.debug;le.length;){ye=le.pop(),re=le.pop(),K=le.pop(),j=le.pop();var fr=1<<K,Rt=ps(K,re,ye),Lt=this.tiles[Rt];if(!Lt&&(vt>1&&console.time("creation"),Lt=this.tiles[Rt]=En(j,K,re,ye,De),this.tileCoords.push({z:K,x:re,y:ye}),vt)){vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,re,ye,Lt.numFeatures,Lt.numPoints,Lt.numSimplified),console.timeEnd("creation"));var vr="z"+K;this.stats[vr]=(this.stats[vr]||0)+1,this.total++}if(Lt.source=j,ke){if(K===De.maxZoom||K===ke)continue;var yn=1<<ke-K;if(re!==Math.floor(je/yn)||ye!==Math.floor(Je/yn))continue}else if(K===De.indexMaxZoom||Lt.numPoints<=De.indexMaxPoints)continue;if(Lt.source=null,j.length!==0){vt>1&&console.time("clipping");var ln,wt,nn,Fr,Vr,di,en=.5*De.buffer/De.extent,Ai=.5-en,Vn=.5+en,li=1+en;ln=wt=nn=Fr=null,Vr=ge(j,fr,re-en,re+Vn,0,Lt.minX,Lt.maxX,De),di=ge(j,fr,re+Ai,re+li,0,Lt.minX,Lt.maxX,De),j=null,Vr&&(ln=ge(Vr,fr,ye-en,ye+Vn,1,Lt.minY,Lt.maxY,De),wt=ge(Vr,fr,ye+Ai,ye+li,1,Lt.minY,Lt.maxY,De),Vr=null),di&&(nn=ge(di,fr,ye-en,ye+Vn,1,Lt.minY,Lt.maxY,De),Fr=ge(di,fr,ye+Ai,ye+li,1,Lt.minY,Lt.maxY,De),di=null),vt>1&&console.timeEnd("clipping"),le.push(ln||[],K+1,2*re,2*ye),le.push(wt||[],K+1,2*re,2*ye+1),le.push(nn||[],K+1,2*re+1,2*ye),le.push(Fr||[],K+1,2*re+1,2*ye+1)}}},ja.prototype.getTile=function(j,K,re){var ye=this.options,ke=ye.extent,je=ye.debug;if(j<0||j>24)return null;var Je=1<<j,le=ps(j,K=(K%Je+Je)%Je,re);if(this.tiles[le])return bi(this.tiles[le],ke);je>1&&console.log("drilling down to z%d-%d-%d",j,K,re);for(var De,vt=j,fr=K,Rt=re;!De&&vt>0;)vt--,fr=Math.floor(fr/2),Rt=Math.floor(Rt/2),De=this.tiles[ps(vt,fr,Rt)];return De&&De.source?(je>1&&console.log("found parent tile z%d-%d-%d",vt,fr,Rt),je>1&&console.time("drilling down"),this.splitTile(De.source,vt,fr,Rt,j,K,re),je>1&&console.timeEnd("drilling down"),this.tiles[le]?bi(this.tiles[le],ke):null):null};var ka=function(j){function K(re,ye,ke,je){j.call(this,re,ye,ke,Ho),je&&(this.loadGeoJSON=je)}return j&&(K.__proto__=j),(K.prototype=Object.create(j&&j.prototype)).constructor=K,K.prototype.loadData=function(re,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ye,this._pendingLoadDataParams=re,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},K.prototype._loadData=function(){var re=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ye=this._pendingCallback,ke=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var je=!!(ke&&ke.request&&ke.request.collectResourceTiming)&&new v.RequestPerformance(ke.request);this.loadGeoJSON(ke,function(Je,le){if(Je||!le)return ye(Je);if(typeof le!="object")return ye(new Error("Input data given to '"+ke.source+"' is not a valid GeoJSON object."));(function Lt(vr,yn){var ln,wt=vr&&vr.type;if(wt==="FeatureCollection")for(ln=0;ln<vr.features.length;ln++)Lt(vr.features[ln],yn);else if(wt==="GeometryCollection")for(ln=0;ln<vr.geometries.length;ln++)Lt(vr.geometries[ln],yn);else if(wt==="Feature")Lt(vr.geometry,yn);else if(wt==="Polygon")ir(vr.coordinates,yn);else if(wt==="MultiPolygon")for(ln=0;ln<vr.coordinates.length;ln++)ir(vr.coordinates[ln],yn);return vr})(le,!0);try{if(ke.filter){var De=v.createExpression(ke.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(function(Lt){return Lt.key+": "+Lt.message}).join(", "));var vt=le.features.filter(function(Lt){return De.value.evaluate({zoom:0},Lt)});le={type:"FeatureCollection",features:vt}}re._geoJSONIndex=ke.cluster?new gn(function(Lt){var vr=Lt.superclusterOptions,yn=Lt.clusterProperties;if(!yn||!vr)return vr;for(var ln={},wt={},nn={accumulated:null,zoom:0},Fr={properties:null},Vr=Object.keys(yn),di=0,en=Vr;di<en.length;di+=1){var Ai=en[di],Vn=yn[Ai],li=Vn[0],Ci=v.createExpression(Vn[1]),Ei=v.createExpression(typeof li=="string"?[li,["accumulated"],["get",Ai]]:li);ln[Ai]=Ci.value,wt[Ai]=Ei.value}return vr.map=function(Xn){Fr.properties=Xn;for(var Bt={},Yt=0,Ki=Vr;Yt<Ki.length;Yt+=1){var Jn=Ki[Yt];Bt[Jn]=ln[Jn].evaluate(nn,Fr)}return Bt},vr.reduce=function(Xn,Bt){Fr.properties=Bt;for(var Yt=0,Ki=Vr;Yt<Ki.length;Yt+=1){var Jn=Ki[Yt];nn.accumulated=Xn[Jn],Xn[Jn]=wt[Jn].evaluate(nn,Fr)}},vr}(ke)).load(le.features):function(Lt,vr){return new ja(Lt,vr)}(le,ke.geojsonVtOptions)}catch(Lt){return ye(Lt)}re.loaded={};var fr={};if(je){var Rt=je.finish();Rt&&(fr.resourceTiming={},fr.resourceTiming[ke.source]=JSON.parse(JSON.stringify(Rt)))}ye(null,fr)})}},K.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},K.prototype.reloadTile=function(re,ye){var ke=this.loaded;return ke&&ke[re.uid]?j.prototype.reloadTile.call(this,re,ye):this.loadTile(re,ye)},K.prototype.loadGeoJSON=function(re,ye){if(re.request)v.getJSON(re.request,ye);else{if(typeof re.data!="string")return ye(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));try{return ye(null,JSON.parse(re.data))}catch(ke){return ye(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."))}}},K.prototype.removeSource=function(re,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ye()},K.prototype.getClusterExpansionZoom=function(re,ye){try{ye(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(ke){ye(ke)}},K.prototype.getClusterChildren=function(re,ye){try{ye(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(ke){ye(ke)}},K.prototype.getClusterLeaves=function(re,ye){try{ye(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(ke){ye(ke)}},K}(tt),ya=function(j){var K=this;this.self=j,this.actor=new v.Actor(j,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:tt,geojson:ka},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(re,ye){if(K.workerSourceTypes[re])throw new Error('Worker source with name "'+re+'" already registered.');K.workerSourceTypes[re]=ye},this.self.registerRTLTextPlugin=function(re){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=re.applyArabicShaping,v.plugin.processBidirectionalText=re.processBidirectionalText,v.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}};return ya.prototype.setReferrer=function(j,K){this.referrer=K},ya.prototype.setImages=function(j,K,re){for(var ye in this.availableImages[j]=K,this.workerSources[j]){var ke=this.workerSources[j][ye];for(var je in ke)ke[je].availableImages=K}re()},ya.prototype.setLayers=function(j,K,re){this.getLayerIndex(j).replace(K),re()},ya.prototype.updateLayers=function(j,K,re){this.getLayerIndex(j).update(K.layers,K.removedIds),re()},ya.prototype.loadTile=function(j,K,re){this.getWorkerSource(j,K.type,K.source).loadTile(K,re)},ya.prototype.loadDEMTile=function(j,K,re){this.getDEMWorkerSource(j,K.source).loadTile(K,re)},ya.prototype.reloadTile=function(j,K,re){this.getWorkerSource(j,K.type,K.source).reloadTile(K,re)},ya.prototype.abortTile=function(j,K,re){this.getWorkerSource(j,K.type,K.source).abortTile(K,re)},ya.prototype.removeTile=function(j,K,re){this.getWorkerSource(j,K.type,K.source).removeTile(K,re)},ya.prototype.removeDEMTile=function(j,K){this.getDEMWorkerSource(j,K.source).removeTile(K)},ya.prototype.removeSource=function(j,K,re){if(this.workerSources[j]&&this.workerSources[j][K.type]&&this.workerSources[j][K.type][K.source]){var ye=this.workerSources[j][K.type][K.source];delete this.workerSources[j][K.type][K.source],ye.removeSource!==void 0?ye.removeSource(K,re):re()}},ya.prototype.loadWorkerSource=function(j,K,re){try{this.self.importScripts(K.url),re()}catch(ye){re(ye.toString())}},ya.prototype.syncRTLPluginState=function(j,K,re){try{v.plugin.setState(K);var ye=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);var ke=v.plugin.isParsed();re(ke?void 0:new Error("RTL Text Plugin failed to import scripts from "+ye),ke)}}catch(je){re(je.toString())}},ya.prototype.getAvailableImages=function(j){var K=this.availableImages[j];return K||(K=[]),K},ya.prototype.getLayerIndex=function(j){var K=this.layerIndexes[j];return K||(K=this.layerIndexes[j]=new te),K},ya.prototype.getWorkerSource=function(j,K,re){var ye=this;return this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][K]||(this.workerSources[j][K]={}),this.workerSources[j][K][re]||(this.workerSources[j][K][re]=new this.workerSourceTypes[K]({send:function(ke,je,Je){ye.actor.send(ke,je,Je,j)}},this.getLayerIndex(j),this.getAvailableImages(j))),this.workerSources[j][K][re]},ya.prototype.getDEMWorkerSource=function(j,K){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][K]||(this.demWorkerSources[j][K]=new Jt),this.demWorkerSources[j][K]},ya.prototype.enforceCacheSizeLimit=function(j,K){v.enforceCacheSizeLimit(K)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ya(self)),ya}),pe(["./shared"],function(v){"use strict";var de=v.createCommonjsModule(function(l){function f(b){return!c(b)}function c(b){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,R,z=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(z);try{R=new Worker(H),M=!0}catch(ne){M=!1}return R&&R.terminate(),URL.revokeObjectURL(H),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var R=M.getContext("2d");if(!R)return!1;var z=R.getImageData(0,0,1,1);return z&&z.width===M.width}()?(d[C=b&&b.failIfMajorPerformanceCaveat]===void 0&&(d[C]=function(M){var R=function(H){var ne=document.createElement("canvas"),ue=Object.create(f.webGLContextAttributes);return ue.failIfMajorPerformanceCaveat=H,ne.probablySupportsContext?ne.probablySupportsContext("webgl",ue)||ne.probablySupportsContext("experimental-webgl",ue):ne.supportsContext?ne.supportsContext("webgl",ue)||ne.supportsContext("experimental-webgl",ue):ne.getContext("webgl",ue)||ne.getContext("experimental-webgl",ue)}(M);if(!R)return!1;var z=R.createShader(R.VERTEX_SHADER);return!(!z||R.isContextLost())&&(R.shaderSource(z,"void main() {}"),R.compileShader(z),R.getShaderParameter(z,R.COMPILE_STATUS)===!0)}(C)),d[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),U={create:function(l,f,c){var d=v.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return v.window.document.createElementNS(l,f)}},te=v.window.document&&v.window.document.documentElement.style;function se(l){if(!te)return l[0];for(var f=0;f<l.length;f++)if(l[f]in te)return l[f];return l[0]}var Re,he=se(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);U.disableDrag=function(){te&&he&&(Re=te[he],te[he]="none")},U.enableDrag=function(){te&&he&&(te[he]=Re)};var $e=se(["transform","WebkitTransform"]);U.setTransform=function(l,f){l.style[$e]=f};var tt=!1;try{var gt=Object.defineProperty({},"passive",{get:function(){tt=!0}});v.window.addEventListener("test",gt,gt),v.window.removeEventListener("test",gt,gt)}catch(l){tt=!1}U.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&tt?d:d.capture)},U.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&tt?d:d.capture)};var Jt=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",Jt,!0)};function ir(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}U.suppressClick=function(){v.window.addEventListener("click",Jt,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",Jt,!0)},0)},U.mousePos=function(l,f){var c=l.getBoundingClientRect();return new v.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},U.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],b=0;b<f.length;b++)d.push(new v.Point(f[b].clientX-c.left-l.clientLeft,f[b].clientY-c.top-l.clientTop));return d},U.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},U.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var yt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,b=this.requestors;d<b.length;d+=1){var C=b[d];this._notify(C.ids,C.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var b=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),b=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),b=!1),this._validateContent(d.content,d)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),b=!1),b},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var b=0,C=0,M=c;C<M.length;C+=1){var R=M[C];if(R[0]<b||R[1]<R[0]||d<R[1])return!1;b=R[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var b=!0;if(!this.isLoaded())for(var C=0,M=c;C<M.length;C+=1)this.images[M[C]]||(b=!1);this.isLoaded()||b?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var b={},C=0,M=c;C<M.length;C+=1){var R=M[C];this.images[R]||this.fire(new v.Event("styleimagemissing",{id:R}));var z=this.images[R];z?b[R]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:Boolean(z.userImage&&z.userImage.render)}:v.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,b)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],b=this.getImage(c);if(!b)return null;if(d&&d.position.version===b.version)return d.position;if(d)d.position.version=b.version;else{var C={w:b.data.width+2,h:b.data.height+2,x:0,y:0},M=new v.ImagePosition(C,b);this.patterns[c]={bin:C,position:M}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var b=v.potpack(c),C=b.w,M=b.h,R=this.atlasImage;for(var z in R.resize({width:C||1,height:M||1}),this.patterns){var H=this.patterns[z].bin,ne=H.x+1,ue=H.y+1,fe=this.images[z].data,Ce=fe.width,Pe=fe.height;v.RGBAImage.copy(fe,R,{x:0,y:0},{x:ne,y:ue},{width:Ce,height:Pe}),v.RGBAImage.copy(fe,R,{x:0,y:Pe-1},{x:ne,y:ue-1},{width:Ce,height:1}),v.RGBAImage.copy(fe,R,{x:0,y:0},{x:ne,y:ue+Pe},{width:Ce,height:1}),v.RGBAImage.copy(fe,R,{x:Ce-1,y:0},{x:ne-1,y:ue},{width:1,height:Pe}),v.RGBAImage.copy(fe,R,{x:0,y:0},{x:ne+Ce,y:ue},{width:1,height:Pe})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,b=c;d<b.length;d+=1){var C=b[d];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var M=this.images[C];ir(M)&&this.updateImage(C,M)}}},f}(v.Evented),Qt=ht,Ct=ht,st=1e20;function ht(l,f,c,d,b,C){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=b||"sans-serif",this.fontWeight=C||"normal",this.radius=c||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Wt(l,f,c,d,b,C,M){for(var R=0;R<f;R++){for(var z=0;z<c;z++)d[z]=l[z*f+R];for(X(d,b,C,M,c),z=0;z<c;z++)l[z*f+R]=b[z]}for(z=0;z<c;z++){for(R=0;R<f;R++)d[R]=l[z*f+R];for(X(d,b,C,M,f),R=0;R<f;R++)l[z*f+R]=Math.sqrt(b[R])}}function X(l,f,c,d,b){c[0]=0,d[0]=-st,d[1]=+st;for(var C=1,M=0;C<b;C++){for(var R=(l[C]+C*C-(l[c[M]]+c[M]*c[M]))/(2*C-2*c[M]);R<=d[M];)M--,R=(l[C]+C*C-(l[c[M]]+c[M]*c[M]))/(2*C-2*c[M]);c[++M]=C,d[M]=R,d[M+1]=+st}for(C=0,M=0;C<b;C++){for(;d[M+1]<C;)M++;f[C]=(C-c[M])*(C-c[M])+l[c[M]]}}ht.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var b=f.data[4*d+3]/255;this.gridOuter[d]=b===1?0:b===0?st:Math.pow(Math.max(0,.5-b),2),this.gridInner[d]=b===1?st:b===0?0:Math.pow(Math.max(0,b-.5),2)}for(Wt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Wt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Qt.default=Ct;var Xt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Xt.prototype.setURL=function(l){this.url=l},Xt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var b in l)for(var C=0,M=l[b];C<M.length;C+=1)d.push({stack:b,id:M[C]});v.asyncAll(d,function(R,z){var H=R.stack,ne=R.id,ue=c.entries[H];ue||(ue=c.entries[H]={glyphs:{},requests:{},ranges:{}});var fe=ue.glyphs[ne];if(fe===void 0){if(fe=c._tinySDF(ue,H,ne))return ue.glyphs[ne]=fe,void z(null,{stack:H,id:ne,glyph:fe});var Ce=Math.floor(ne/256);if(256*Ce>65535)z(new Error("glyphs > 65535 not supported"));else if(ue.ranges[Ce])z(null,{stack:H,id:ne,glyph:fe});else{var Pe=ue.requests[Ce];Pe||(Pe=ue.requests[Ce]=[],Xt.loadGlyphRange(H,Ce,c.url,c.requestManager,function(Ue,Ae){if(Ae){for(var Ze in Ae)c._doesCharSupportLocalGlyph(+Ze)||(ue.glyphs[+Ze]=Ae[+Ze]);ue.ranges[Ce]=!0}for(var Ke=0,mt=Pe;Ke<mt.length;Ke+=1)(0,mt[Ke])(Ue,Ae);delete ue.requests[Ce]})),Pe.push(function(Ue,Ae){Ue?z(Ue):Ae&&z(null,{stack:H,id:ne,glyph:Ae[ne]||null})})}}else z(null,{stack:H,id:ne,glyph:fe})},function(R,z){if(R)f(R);else if(z){for(var H={},ne=0,ue=z;ne<ue.length;ne+=1){var fe=ue[ne],Ce=fe.stack,Pe=fe.id,Ue=fe.glyph;(H[Ce]||(H[Ce]={}))[Pe]=Ue&&{id:Ue.id,bitmap:Ue.bitmap.clone(),metrics:Ue.metrics}}f(null,H)}})},Xt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},Xt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var b=l.tinySDF;if(!b){var C="400";/bold/i.test(f)?C="900":/medium/i.test(f)?C="500":/light/i.test(f)&&(C="200"),b=l.tinySDF=new Xt.TinySDF(24,3,8,.25,d,C)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},b.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Xt.loadGlyphRange=function(l,f,c,d,b){var C=256*f,M=C+255,R=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",C+"-"+M),v.ResourceType.Glyphs);v.getArrayBuffer(R,function(z,H){if(z)b(z);else if(H){for(var ne={},ue=0,fe=v.parseGlyphPBF(H);ue<fe.length;ue+=1){var Ce=fe[ue];ne[Ce.id]=Ce}b(null,ne)}})},Xt.TinySDF=Qt;var ft=function(){this.specification=v.styleSpec.light.position};ft.prototype.possiblyEvaluate=function(l,f){return v.sphericalToCartesian(l.expression.evaluate(f))},ft.prototype.interpolate=function(l,f,c){return{x:v.number(l.x,f.x,c),y:v.number(l.y,f.y,c),z:v.number(l.z,f.z,c)}};var He=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new ft,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),lt=function(l){function f(c){l.call(this),this._transitionable=new v.Transitionable(He),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(v.validateLight,c,d))for(var b in c){var C=c[b];v.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-"-transition".length),C):this._transitionable.setValue(b,C)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,b){return(!b||b.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),Qe=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Qe.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},Qe.prototype.getDashRanges=function(l,f,c){var d=[],b=l.length%2==1?-l[l.length-1]*c:0,C=l[0]*c,M=!0;d.push({left:b,right:C,isDash:M,zeroLength:l[0]===0});for(var R=l[0],z=1;z<l.length;z++){var H=l[z];d.push({left:b=R*c,right:C=(R+=H)*c,isDash:M=!M,zeroLength:H===0})}return d},Qe.prototype.addRoundDash=function(l,f,c){for(var d=f/2,b=-c;b<=c;b++)for(var C=this.width*(this.nextRow+c+b),M=0,R=l[M],z=0;z<this.width;z++){z/R.right>1&&(R=l[++M]);var H=Math.abs(z-R.left),ne=Math.abs(z-R.right),ue=Math.min(H,ne),fe=void 0,Ce=b/c*(d+1);if(R.isDash){var Pe=d-Math.abs(Ce);fe=Math.sqrt(ue*ue+Pe*Pe)}else fe=d-Math.sqrt(ue*ue+Ce*Ce);this.data[C+z]=Math.max(0,Math.min(255,fe+128))}},Qe.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var b=l[0],C=l[l.length-1];b.isDash===C.isDash&&(b.left=C.left-this.width,C.right=b.right+this.width);for(var M=this.width*this.nextRow,R=0,z=l[R],H=0;H<this.width;H++){H/z.right>1&&(z=l[++R]);var ne=Math.abs(H-z.left),ue=Math.abs(H-z.right),fe=Math.min(ne,ue);this.data[M+H]=Math.max(0,Math.min(255,(z.isDash?fe:-fe)+128))}},Qe.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var b=0,C=0;C<l.length;C++)b+=l[C];if(b!==0){var M=this.width/b,R=this.getDashRanges(l,this.width,M);f?this.addRoundDash(R,M,c):this.addRegularDash(R)}var z={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:b};return this.nextRow+=d,this.dirty=!0,z},Qe.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Ut=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var d=this.workerPool.acquire(this.id),b=0;b<d.length;b++){var C=new l.Actor(d[b],c,this.id);C.name="Worker "+b,this.actors.push(C)}};function xr(l,f,c){var d=function(b,C){if(b)return c(b);if(C){var M=v.pick(v.extend(C,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(M.vectorLayers=C.vector_layers,M.vectorLayerIds=M.vectorLayers.map(function(R){return R.id})),M.tiles=f.canonicalizeTileset(M,l.url),c(null,M)}};return l.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),v.ResourceType.Source),d):v.browser.frame(function(){return d(null,l)})}Ut.prototype.broadcast=function(l,f,c){v.asyncAll(this.actors,function(d,b){d.send(l,f,b)},c=c||function(){})},Ut.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ut.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Ut.Actor=v.Actor;var Dr=function(l,f,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Dr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Dr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),b=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),C=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<b&&l.y>=d&&l.y<C};var Kr=function(l){function f(c,d,b,C){if(l.call(this),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(d,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(d,b){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Dr(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(c,d){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(b,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(R,z){return delete c.request,c.aborted?d(null):R&&R.status!==404?d(R):(z&&z.resourceTiming&&(c.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&c.setExpiryData(z),c.loadVectorData(z,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",C,M.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",C,M.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Me=function(l){function f(c,d,b,C){l.call(this),this.id=c,this.dispatcher=b,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},d),v.extend(this,v.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(d,b){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Dr(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var b=this,C=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(C,v.ResourceType.Tile),function(M,R){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(R){b.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var z=b.map.painter.context,H=z.gl;c.texture=b.map.painter.getTileTexture(R.width),c.texture?c.texture.update(R,{useMipmap:!0}):(c.texture=new v.Texture(z,R,H.RGBA,{useMipmap:!0}),c.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),z.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(b.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),A=function(l){function f(c,d,b,C){l.call(this,c,d,b,C),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(M,R){M&&(c.state="errored",d(M)),R&&(c.dem=R,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=v.getImage(this.map._requestManager.transformRequest(b,v.ResourceType.Tile),function(M,R){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(R){this.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var z=v.window.ImageBitmap&&R instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?R:v.browser.getImageData(R,1),H={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:z,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",H,C.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,b=Math.pow(2,d.z),C=(d.x-1+b)%b,M=d.x===0?c.wrap-1:c.wrap,R=(d.x+1+b)%b,z=d.x+1===b?c.wrap+1:c.wrap,H={};return H[new v.OverscaledTileID(c.overscaledZ,M,d.z,C,d.y).key]={backfilled:!1},H[new v.OverscaledTileID(c.overscaledZ,z,d.z,R,d.y).key]={backfilled:!1},d.y>0&&(H[new v.OverscaledTileID(c.overscaledZ,M,d.z,C,d.y-1).key]={backfilled:!1},H[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},H[new v.OverscaledTileID(c.overscaledZ,z,d.z,R,d.y-1).key]={backfilled:!1}),d.y+1<b&&(H[new v.OverscaledTileID(c.overscaledZ,M,d.z,C,d.y+1).key]={backfilled:!1},H[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},H[new v.OverscaledTileID(c.overscaledZ,z,d.z,R,d.y+1).key]={backfilled:!1}),H},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(Me),_e=function(l){function f(c,d,b,C){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=b.getActor(),this.setEventedParent(C),this._data=d.data,this._options=v.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var M=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*M,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*M,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:v.EXTENT,radius:(d.clusterRadius||50)*M,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new v.ErrorEvent(d));else{var b={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(b.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",b))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(b){if(b)d.fire(new v.ErrorEvent(b));else{var C={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(C.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new v.Event("data",C))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,b,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:b},C),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var b=v.extend({},this.workerOptions),C=this._data;typeof C=="string"?(b.request=this.map._requestManager.transformRequest(v.browser.resolveURL(C),v.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(C),this.actor.send(this.type+".loadData",b,function(M,R){d._removed||R&&R.abandoned||(d._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[d.id]&&(d._resourceTiming=R.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:b.source},null),c(M))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var b=this,C=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(C,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,R){return delete c.request,c.unloadVectorData(),c.aborted?d(null):M?d(M):(c.loadVectorData(R,b.map.painter,C==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Et=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),dt=function(l){function f(c,d,b,C){l.call(this),this.id=c,this.dispatcher=b,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var b=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(C,M){b._loaded=!0,C?b.fire(new v.ErrorEvent(C)):M&&(b.image=M,c&&(b.coordinates=c),d&&d(),b._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var b=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var R=1/0,z=1/0,H=-1/0,ne=-1/0,ue=0,fe=M;ue<fe.length;ue+=1){var Ce=fe[ue];R=Math.min(R,Ce.x),z=Math.min(z,Ce.y),H=Math.max(H,Ce.x),ne=Math.max(ne,Ce.y)}var Pe=Math.max(H-R,ne-z),Ue=Math.max(0,Math.floor(-Math.log(Pe)/Math.LN2)),Ae=Math.pow(2,Ue);return new v.CanonicalTileID(Ue,Math.floor((R+H)/2*Ae),Math.floor((z+ne)/2*Ae))}(b),this.minzoom=this.maxzoom=this.tileID.z;var C=b.map(function(M){return d.tileID.getTilePoint(M)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[b];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ft=function(l){function f(c,d,b,C){l.call(this,c,d,b,C),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var b=0,C=d.urls;b<C.length;b+=1)this.urls.push(this.map._requestManager.transformRequest(C[b],v.ResourceType.Source).url);v.getVideo(this.urls,function(M,R){c._loaded=!0,M?c.fire(new v.ErrorEvent(M)):R&&(c.video=R,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[b];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(dt),qt=function(l){function f(c,d,b,C){l.call(this,c,d,b,C),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(R){return typeof R!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,b=d.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(d,this.canvas,b.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[C];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var b=d[c];if(isNaN(b)||b<=0)return!0}return!1},f}(dt),Sr={vector:Kr,raster:Me,"raster-dem":A,geojson:_e,video:Ft,image:dt,canvas:qt};function Qn(l,f){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function gn(l,f,c,d,b,C){var M=function(Ue,Ae,Ze){if(Ue)for(var Ke=0,mt=Ue;Ke<mt.length;Ke+=1){var St=Ae[mt[Ke]];if(St&&St.source===Ze&&St.type==="fill-extrusion")return!0}else for(var Zt in Ae){var Kt=Ae[Zt];if(Kt.source===Ze&&Kt.type==="fill-extrusion")return!0}return!1}(b&&b.layers,f,l.id),R=C.maxPitchScaleFactor(),z=l.tilesIn(d,R,M);z.sort(ea);for(var H=[],ne=0,ue=z;ne<ue.length;ne+=1){var fe=ue[ne];H.push({wrappedTileID:fe.tileID.wrapped().key,queryResults:fe.tile.queryRenderedFeatures(f,c,l._state,fe.queryGeometry,fe.cameraQueryGeometry,fe.scale,b,C,R,Qn(l.transform,fe.tileID))})}var Ce=function(Ue){for(var Ae={},Ze={},Ke=0,mt=Ue;Ke<mt.length;Ke+=1){var St=mt[Ke],Zt=St.queryResults,Kt=St.wrappedTileID,pr=Ze[Kt]=Ze[Kt]||{};for(var kr in Zt)for(var Or=Zt[kr],tn=pr[kr]=pr[kr]||{},Ln=Ae[kr]=Ae[kr]||[],Fn=0,zn=Or;Fn<zn.length;Fn+=1){var Ri=zn[Fn];tn[Ri.featureIndex]||(tn[Ri.featureIndex]=!0,Ln.push(Ri))}}return Ae}(H);for(var Pe in Ce)Ce[Pe].forEach(function(Ue){var Ae=Ue.feature,Ze=l.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=Ze});return Ce}function ea(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var wn=function(l,f){this.max=l,this.onRemove=f,this.reset()};wn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},wn.prototype.add=function(l,f,c){var d=this,b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);var C={value:f,timeout:void 0};if(c!==void 0&&(C.timeout=setTimeout(function(){d.remove(l,C)},c)),this.data[b].push(C),this.order.push(b),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},wn.prototype.has=function(l){return l.wrapped().key in this.data},wn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},wn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},wn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},wn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},wn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),b=this.data[c][d];return this.data[c].splice(d,1),b.timeout&&clearTimeout(b.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(b.value),this.order.splice(this.order.indexOf(c),1),this},wn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},wn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,b=this.data[c];d<b.length;d+=1){var C=b[d];l(C.value)||f.push(C)}for(var M=0,R=f;M<R.length;M+=1){var z=R[M];this.remove(z.value.tileID,z)}};var ii=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ii.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ii.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ii.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Si={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},si=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var b=l.gl;this.buffer=b.createBuffer(),l.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};si.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},si.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},si.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},si.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var b=this.attributes[d],C=f.attributes[b.name];C!==void 0&&l.vertexAttribPointer(C,b.components,l[Si[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}},si.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Wn=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Wn.prototype.get=function(){return this.current},Wn.prototype.set=function(l){},Wn.prototype.getDefault=function(){return this.default},Wn.prototype.setDefault=function(){this.set(this.default)};var ma=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(Wn),zi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(Wn),ji=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(Wn),Wi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(Wn),ga=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(Wn),vo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(Wn),Va=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(Wn),la=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(Wn),Ui=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(Wn),ra=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(Wn),qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(Wn),Ts=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(Wn),ge=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(Wn),ui=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(Wn),no=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(Wn),ru=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(Wn),Vt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(Wn),ar=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(Wn),Ar=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(Wn),on=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(Wn),In=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(Wn),Rn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(Wn),bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(Wn),gi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(Wn),En=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(Wn),Oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(Wn),Ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(Wn),ja=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(Wn),ps=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(Wn),Ho=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(Wn),ka=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(Wn),ya=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(Wn),j=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(ya),K=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(ya),re=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var b=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new j(l,b),d&&(this.depthAttachment=new K(l,b))};re.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ye=function(l,f,c){this.func=l,this.mask=f,this.range=c};ye.ReadOnly=!1,ye.ReadWrite=!0,ye.disabled=new ye(519,ye.ReadOnly,[0,1]);var ke=function(l,f,c,d,b,C){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=b,this.pass=C};ke.disabled=new ke({func:519,mask:0},0,0,7680,7680,7680);var je=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};je.disabled=new je(je.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),je.unblended=new je(je.Replace,v.Color.transparent,[!0,!0,!0,!0]),je.alphaBlended=new je([1,771],v.Color.transparent,[!0,!0,!0,!0]);var Je=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};Je.disabled=new Je(!1,1029,2305),Je.backCCW=new Je(!0,1029,2305);var le=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ma(this),this.clearDepth=new zi(this),this.clearStencil=new ji(this),this.colorMask=new Wi(this),this.depthMask=new ga(this),this.stencilMask=new vo(this),this.stencilFunc=new Va(this),this.stencilOp=new la(this),this.stencilTest=new Ui(this),this.depthRange=new ra(this),this.depthTest=new qi(this),this.depthFunc=new Ts(this),this.blend=new ge(this),this.blendFunc=new ui(this),this.blendColor=new no(this),this.blendEquation=new ru(this),this.cullFace=new Vt(this),this.cullFaceSide=new ar(this),this.frontFace=new Ar(this),this.program=new on(this),this.activeTexture=new In(this),this.viewport=new Rn(this),this.bindFramebuffer=new bi(this),this.bindRenderbuffer=new gi(this),this.bindTexture=new En(this),this.bindVertexBuffer=new Oi(this),this.bindElementBuffer=new Ii(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ja(this),this.pixelStoreUnpack=new ps(this),this.pixelStoreUnpackPremultiplyAlpha=new Ho(this),this.pixelStoreUnpackFlipY=new ka(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};le.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},le.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},le.prototype.createIndexBuffer=function(l,f){return new ii(this,l,f)},le.prototype.createVertexBuffer=function(l,f,c){return new si(this,l,f,c)},le.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,b=d.createRenderbuffer();return this.bindRenderbuffer.set(b),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),b},le.prototype.createFramebuffer=function(l,f,c){return new re(this,l,f,c)},le.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,b=0;f&&(b|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(b)},le.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},le.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},le.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},le.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,je.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},le.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var De=function(l){function f(c,d,b){var C=this;l.call(this),this.id=c,this.dispatcher=b,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(M,R,z,H){var ne=new Sr[R.type](M,R,z,H);if(ne.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+ne.id);return v.bindAll(["load","abort","unload","serialize","prepare"],ne),ne}(c,d,b,this),this._tiles={},this._cache=new wn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var b=this._tiles[d];b.upload(c),b.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(vt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,b=[];for(var C in this._tiles)this._isIdRenderable(C,c)&&b.push(this._tiles[C]);return c?b.sort(function(M,R){var z=M.tileID,H=R.tileID,ne=new v.Point(z.canonical.x,z.canonical.y)._rotate(d.transform.angle),ue=new v.Point(H.canonical.x,H.canonical.y)._rotate(d.transform.angle);return z.overscaledZ-H.overscaledZ||ue.y-ne.y||ue.x-ne.x}).map(function(M){return M.tileID.key}):b.map(function(M){return M.tileID}).sort(vt).map(function(M){return M.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=d),this._loadTile(b,this._tileLoaded.bind(this,b,c,d)))},f.prototype._tileLoaded=function(c,d,b,C){if(C)return c.state="errored",void(C.status!==404?this._source.fire(new v.ErrorEvent(C,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),b=0;b<d.length;b++){var C=d[b];if(c.neighboringTiles&&c.neighboringTiles[C]){var M=this.getTileByID(C);R(c,M),R(M,c)}}function R(z,H){z.needsHillshadePrepare=!0;var ne=H.tileID.canonical.x-z.tileID.canonical.x,ue=H.tileID.canonical.y-z.tileID.canonical.y,fe=Math.pow(2,z.tileID.canonical.z),Ce=H.tileID.key;ne===0&&ue===0||Math.abs(ue)>1||(Math.abs(ne)>1&&(Math.abs(ne+fe)===1?ne+=fe:Math.abs(ne-fe)===1&&(ne-=fe)),H.dem&&z.dem&&(z.dem.backfillBorder(H.dem,ne,ue),z.neighboringTiles&&z.neighboringTiles[Ce]&&(z.neighboringTiles[Ce].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,b,C){for(var M in this._tiles){var R=this._tiles[M];if(!(C[M]||!R.hasData()||R.tileID.overscaledZ<=d||R.tileID.overscaledZ>b)){for(var z=R.tileID;R&&R.tileID.overscaledZ>d+1;){var H=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[H.key])&&R.hasData()&&(z=H)}for(var ne=z;ne.overscaledZ>d;)if(c[(ne=ne.scaledTo(ne.overscaledZ-1)).key]){C[z.key]=z;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=d?b:null}for(var C=c.overscaledZ-1;C>=d;C--){var M=c.scaledTo(C),R=this._getLoadedTile(M);if(R)return R}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,b=Math.ceil(c.height/this._source.tileSize)+1,C=Math.floor(d*b*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(M)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var b={};for(var C in this._tiles){var M=this._tiles[C];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),b[M.tileID.key]=M}for(var R in this._tiles=b,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var z in this._tiles)this._setTileReloadTimer(z,this._tiles[z])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var b;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?b=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(pr){return new v.OverscaledTileID(pr.canonical.z,pr.wrap,pr.canonical.z,pr.canonical.x,pr.canonical.y)}):(b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(b=b.filter(function(pr){return d._source.hasTile(pr)}))):b=[];var C=c.coveringZoomLevel(this._source),M=Math.max(C-f.maxOverzooming,this._source.minzoom),R=Math.max(C+f.maxUnderzooming,this._source.minzoom),z=this._updateRetainedTiles(b,C);if(fr(this._source.type)){for(var H={},ne={},ue=0,fe=Object.keys(z);ue<fe.length;ue+=1){var Ce=fe[ue],Pe=z[Ce],Ue=this._tiles[Ce];if(Ue&&!(Ue.fadeEndTime&&Ue.fadeEndTime<=v.browser.now())){var Ae=this.findLoadedParent(Pe,M);Ae&&(this._addTile(Ae.tileID),H[Ae.tileID.key]=Ae.tileID),ne[Ce]=Pe}}for(var Ze in this._retainLoadedChildren(ne,C,R,z),H)z[Ze]||(this._coveredTiles[Ze]=!0,z[Ze]=H[Ze])}for(var Ke in z)this._tiles[Ke].clearFadeHold();for(var mt=0,St=v.keysDifference(this._tiles,z);mt<St.length;mt+=1){var Zt=St[mt],Kt=this._tiles[Zt];Kt.hasSymbolBuckets&&!Kt.holdingForFade()?Kt.setHoldDuration(this.map._fadeDuration):Kt.hasSymbolBuckets&&!Kt.symbolFadeFinished()||this._removeTile(Zt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var b={},C={},M=Math.max(d-f.maxOverzooming,this._source.minzoom),R=Math.max(d+f.maxUnderzooming,this._source.minzoom),z={},H=0,ne=c;H<ne.length;H+=1){var ue=ne[H],fe=this._addTile(ue);b[ue.key]=ue,fe.hasData()||d<this._source.maxzoom&&(z[ue.key]=ue)}this._retainLoadedChildren(z,d,R,b);for(var Ce=0,Pe=c;Ce<Pe.length;Ce+=1){var Ue=Pe[Ce],Ae=this._tiles[Ue.key];if(!Ae.hasData()){if(d+1>this._source.maxzoom){var Ze=Ue.children(this._source.maxzoom)[0],Ke=this.getTile(Ze);if(Ke&&Ke.hasData()){b[Ze.key]=Ze;continue}}else{var mt=Ue.children(this._source.maxzoom);if(b[mt[0].key]&&b[mt[1].key]&&b[mt[2].key]&&b[mt[3].key])continue}for(var St=Ae.wasRequested(),Zt=Ue.overscaledZ-1;Zt>=M;--Zt){var Kt=Ue.scaledTo(Zt);if(C[Kt.key]||(C[Kt.key]=!0,!(Ae=this.getTile(Kt))&&St&&(Ae=this._addTile(Kt)),Ae&&(b[Kt.key]=Kt,St=Ae.wasRequested(),Ae.hasData())))break}}}return b},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],b=void 0,C=this._tiles[c].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){b=this._loadedParentTiles[C.key];break}d.push(C.key);var M=C.scaledTo(C.overscaledZ-1);if(b=this._getLoadedTile(M))break;C=M}for(var R=0,z=d;R<z.length;R+=1)this._loadedParentTiles[z[R]]=b}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var b=Boolean(d);return b||(d=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,b||this._source.fire(new v.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var b=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var C=d.getExpiryTimeout();C&&(this._timers[c]=setTimeout(function(){b._reloadTile(c,"expired"),delete b._timers[c]},C))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,b){var C=this,M=[],R=this.transform;if(!R)return M;for(var z=b?R.getCameraQueryGeometry(c):c,H=c.map(function(Zt){return R.pointCoordinate(Zt)}),ne=z.map(function(Zt){return R.pointCoordinate(Zt)}),ue=this.getIds(),fe=1/0,Ce=1/0,Pe=-1/0,Ue=-1/0,Ae=0,Ze=ne;Ae<Ze.length;Ae+=1){var Ke=Ze[Ae];fe=Math.min(fe,Ke.x),Ce=Math.min(Ce,Ke.y),Pe=Math.max(Pe,Ke.x),Ue=Math.max(Ue,Ke.y)}for(var mt=function(Zt){var Kt=C._tiles[ue[Zt]];if(!Kt.holdingForFade()){var pr=Kt.tileID,kr=Math.pow(2,R.zoom-Kt.tileID.overscaledZ),Or=d*Kt.queryPadding*v.EXTENT/Kt.tileSize/kr,tn=[pr.getTilePoint(new v.MercatorCoordinate(fe,Ce)),pr.getTilePoint(new v.MercatorCoordinate(Pe,Ue))];if(tn[0].x-Or<v.EXTENT&&tn[0].y-Or<v.EXTENT&&tn[1].x+Or>=0&&tn[1].y+Or>=0){var Ln=H.map(function(zn){return pr.getTilePoint(zn)}),Fn=ne.map(function(zn){return pr.getTilePoint(zn)});M.push({tile:Kt,tileID:pr,queryGeometry:Ln,cameraQueryGeometry:Fn,scale:kr})}}},St=0;St<ue.length;St++)mt(St);return M},f.prototype.getVisibleCoordinates=function(c){for(var d=this,b=this.getRenderableIds(c).map(function(z){return d._tiles[z].tileID}),C=0,M=b;C<M.length;C+=1){var R=M[C];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return b},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(fr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,b){this._state.updateState(c=c||"_geojsonTileLayer",d,b)},f.prototype.removeFeatureState=function(c,d,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,b)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,b){var C=this._tiles[c];C&&C.setDependencies(d,b)},f.prototype.reloadTilesForDependencies=function(c,d){for(var b in this._tiles)this._tiles[b].hasDependency(c,d)&&this._reloadTile(b,"reloading");this._cache.filter(function(C){return!C.hasDependency(c,d)})},f}(v.Evented);function vt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function fr(l){return l==="raster"||l==="image"||l==="video"}function Rt(){return new v.window.Worker(zl.workerUrl)}De.maxOverzooming=10,De.maxUnderzooming=3;var Lt="mapboxgl_preloaded_worker_pool",vr=function(){this.active={}};vr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<vr.workerCount;)this.workers.push(new Rt);return this.active[l]=!0,this.workers.slice()},vr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},vr.prototype.isPreloaded=function(){return!!this.active[Lt]},vr.prototype.numActive=function(){return Object.keys(this.active).length};var yn,ln=Math.floor(v.browser.hardwareConcurrency/2);function wt(){return yn||(yn=new vr),yn}function nn(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return v.refProperties.forEach(function(b){b in f&&(c[b]=f[b])}),c}function Fr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=nn(l[d],f[l[d].ref]));return l}vr.workerCount=Math.max(Math.min(ln,6),1);var Vr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function di(l,f,c){c.push({command:Vr.addSource,args:[l,f[l]]})}function en(l,f,c){f.push({command:Vr.removeSource,args:[l]}),c[l]=!0}function Ai(l,f,c,d){en(l,c,d),di(l,f,c)}function Vn(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;return!0}function li(l,f,c,d,b,C){var M;for(M in f=f||{},l=l||{})l.hasOwnProperty(M)&&(v.deepEqual(l[M],f[M])||c.push({command:C,args:[d,M,f[M],b]}));for(M in f)f.hasOwnProperty(M)&&!l.hasOwnProperty(M)&&(v.deepEqual(l[M],f[M])||c.push({command:C,args:[d,M,f[M],b]}))}function Ci(l){return l.id}function Ei(l,f){return l[f.id]=f,l}var Xn=function(l,f){this.reset(l,f)};Xn.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Xn.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var b=f-1,C=this._distances[b],M=c-C,R=M>0?(d-C)/M:0;return this.points[b].mult(1-R).add(this.points[f].mult(R))};var Bt=function(l,f,c){var d=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var C=0;C<this.xCellCount*this.yCellCount;C++)d.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Yt(l,f,c,d,b){var C=v.create();return f?(v.scale(C,C,[1/b,1/b,1]),c||v.rotateZ(C,C,d.angle)):v.multiply(C,d.labelPlaneMatrix,l),C}function Ki(l,f,c,d,b){if(f){var C=v.clone(l);return v.scale(C,C,[b,b,1]),c||v.rotateZ(C,C,-d.angle),C}return d.glCoordMatrix}function Jn(l,f){var c=[l.x,l.y,0,1];_a(c,c,f);var d=c[3];return{point:new v.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Di(l,f){return .5+l/f*.5}function Sa(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function bn(l,f,c,d,b,C,M,R){var z=d?l.textSizeData:l.iconSizeData,H=v.evaluateSizeForZoom(z,c.transform.zoom),ne=[256/c.width*2+1,256/c.height*2+1],ue=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;ue.clear();for(var fe=l.lineVertexArray,Ce=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Pe=c.transform.width/c.transform.height,Ue=!1,Ae=0;Ae<Ce.length;Ae++){var Ze=Ce.get(Ae);if(Ze.hidden||Ze.writingMode===v.WritingMode.vertical&&!Ue)$a(Ze.numGlyphs,ue);else{Ue=!1;var Ke=[Ze.anchorX,Ze.anchorY,0,1];if(v.transformMat4(Ke,Ke,f),Sa(Ke,ne)){var mt=Di(c.transform.cameraToCenterDistance,Ke[3]),St=v.evaluateSizeForFeature(z,H,Ze),Zt=M?St/mt:St*mt,Kt=new v.Point(Ze.anchorX,Ze.anchorY),pr=Jn(Kt,b).point,kr={},Or=Ro(Ze,Zt,!1,R,f,b,C,l.glyphOffsetArray,fe,ue,pr,Kt,kr,Pe);Ue=Or.useVertical,(Or.notEnoughRoom||Ue||Or.needsFlipping&&Ro(Ze,Zt,!0,R,f,b,C,l.glyphOffsetArray,fe,ue,pr,Kt,kr,Pe).notEnoughRoom)&&$a(Ze.numGlyphs,ue)}else $a(Ze.numGlyphs,ue)}}d?l.text.dynamicLayoutVertexBuffer.updateData(ue):l.icon.dynamicLayoutVertexBuffer.updateData(ue)}function Wr(l,f,c,d,b,C,M,R,z,H,ne){var ue=R.glyphStartIndex+R.numGlyphs,fe=R.lineStartIndex,Ce=R.lineStartIndex+R.lineLength,Pe=f.getoffsetX(R.glyphStartIndex),Ue=f.getoffsetX(ue-1),Ae=$i(l*Pe,c,d,b,C,M,R.segment,fe,Ce,z,H,ne);if(!Ae)return null;var Ze=$i(l*Ue,c,d,b,C,M,R.segment,fe,Ce,z,H,ne);return Ze?{first:Ae,last:Ze}:null}function At(l,f,c,d){return l===v.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===v.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function Ro(l,f,c,d,b,C,M,R,z,H,ne,ue,fe,Ce){var Pe,Ue=f/24,Ae=l.lineOffsetX*Ue,Ze=l.lineOffsetY*Ue;if(l.numGlyphs>1){var Ke=l.glyphStartIndex+l.numGlyphs,mt=l.lineStartIndex,St=l.lineStartIndex+l.lineLength,Zt=Wr(Ue,R,Ae,Ze,c,ne,ue,l,z,C,fe);if(!Zt)return{notEnoughRoom:!0};var Kt=Jn(Zt.first.point,M).point,pr=Jn(Zt.last.point,M).point;if(d&&!c){var kr=At(l.writingMode,Kt,pr,Ce);if(kr)return kr}Pe=[Zt.first];for(var Or=l.glyphStartIndex+1;Or<Ke-1;Or++)Pe.push($i(Ue*R.getoffsetX(Or),Ae,Ze,c,ne,ue,l.segment,mt,St,z,C,fe));Pe.push(Zt.last)}else{if(d&&!c){var tn=Jn(ue,b).point,Ln=l.lineStartIndex+l.segment+1,Fn=new v.Point(z.getx(Ln),z.gety(Ln)),zn=Jn(Fn,b),Ri=zn.signedDistanceFromCamera>0?zn.point:be(ue,Fn,tn,1,b),sn=At(l.writingMode,tn,Ri,Ce);if(sn)return sn}var ai=$i(Ue*R.getoffsetX(l.glyphStartIndex),Ae,Ze,c,ne,ue,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,z,C,fe);if(!ai)return{notEnoughRoom:!0};Pe=[ai]}for(var fi=0,ti=Pe;fi<ti.length;fi+=1){var On=ti[fi];v.addDynamicAttributes(H,On.point,On.angle)}return{}}function be(l,f,c,d,b){var C=Jn(l.add(l.sub(f)._unit()),b).point,M=c.sub(C);return c.add(M._mult(d/M.mag()))}function $i(l,f,c,d,b,C,M,R,z,H,ne,ue){var fe=d?l-f:l+f,Ce=fe>0?1:-1,Pe=0;d&&(Ce*=-1,Pe=Math.PI),Ce<0&&(Pe+=Math.PI);for(var Ue=Ce>0?R+M:R+M+1,Ae=b,Ze=b,Ke=0,mt=0,St=Math.abs(fe),Zt=[];Ke+mt<=St;){if((Ue+=Ce)<R||Ue>=z)return null;if(Ze=Ae,Zt.push(Ae),(Ae=ue[Ue])===void 0){var Kt=new v.Point(H.getx(Ue),H.gety(Ue)),pr=Jn(Kt,ne);if(pr.signedDistanceFromCamera>0)Ae=ue[Ue]=pr.point;else{var kr=Ue-Ce;Ae=be(Ke===0?C:new v.Point(H.getx(kr),H.gety(kr)),Kt,Ze,St-Ke+1,ne)}}Ke+=mt,mt=Ze.dist(Ae)}var Or=(St-Ke)/mt,tn=Ae.sub(Ze),Ln=tn.mult(Or)._add(Ze);Ln._add(tn._unit()._perp()._mult(c*Ce));var Fn=Pe+Math.atan2(Ae.y-Ze.y,Ae.x-Ze.x);return Zt.push(Ln),{point:Ln,angle:Fn,path:Zt}}Bt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Bt.prototype.insert=function(l,f,c,d,b){this._forEachCell(f,c,d,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(b)},Bt.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},Bt.prototype._insertBoxCell=function(l,f,c,d,b,C){this.boxCells[b].push(C)},Bt.prototype._insertCircleCell=function(l,f,c,d,b,C){this.circleCells[b].push(C)},Bt.prototype._query=function(l,f,c,d,b,C){if(c<0||l>this.width||d<0||f>this.height)return!b&&[];var M=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(b)return!0;for(var R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var z=0;z<this.circleKeys.length;z++){var H=this.circles[3*z],ne=this.circles[3*z+1],ue=this.circles[3*z+2];M.push({key:this.circleKeys[z],x1:H-ue,y1:ne-ue,x2:H+ue,y2:ne+ue})}return C?M.filter(C):M}return this._forEachCell(l,f,c,d,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},C),b?M.length>0:M},Bt.prototype._queryCircle=function(l,f,c,d,b){var C=l-c,M=l+c,R=f-c,z=f+c;if(M<0||C>this.width||z<0||R>this.height)return!d&&[];var H=[];return this._forEachCell(C,R,M,z,this._queryCellCircle,H,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},b),d?H.length>0:H},Bt.prototype.query=function(l,f,c,d,b){return this._query(l,f,c,d,!1,b)},Bt.prototype.hitTest=function(l,f,c,d,b){return this._query(l,f,c,d,!0,b)},Bt.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},Bt.prototype._queryCell=function(l,f,c,d,b,C,M,R){var z=M.seenUids,H=this.boxCells[b];if(H!==null)for(var ne=this.bboxes,ue=0,fe=H;ue<fe.length;ue+=1){var Ce=fe[ue];if(!z.box[Ce]){z.box[Ce]=!0;var Pe=4*Ce;if(l<=ne[Pe+2]&&f<=ne[Pe+3]&&c>=ne[Pe+0]&&d>=ne[Pe+1]&&(!R||R(this.boxKeys[Ce]))){if(M.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Ce],x1:ne[Pe],y1:ne[Pe+1],x2:ne[Pe+2],y2:ne[Pe+3]})}}}var Ue=this.circleCells[b];if(Ue!==null)for(var Ae=this.circles,Ze=0,Ke=Ue;Ze<Ke.length;Ze+=1){var mt=Ke[Ze];if(!z.circle[mt]){z.circle[mt]=!0;var St=3*mt;if(this._circleAndRectCollide(Ae[St],Ae[St+1],Ae[St+2],l,f,c,d)&&(!R||R(this.circleKeys[mt]))){if(M.hitTest)return C.push(!0),!0;var Zt=Ae[St],Kt=Ae[St+1],pr=Ae[St+2];C.push({key:this.circleKeys[mt],x1:Zt-pr,y1:Kt-pr,x2:Zt+pr,y2:Kt+pr})}}}},Bt.prototype._queryCellCircle=function(l,f,c,d,b,C,M,R){var z=M.circle,H=M.seenUids,ne=this.boxCells[b];if(ne!==null)for(var ue=this.bboxes,fe=0,Ce=ne;fe<Ce.length;fe+=1){var Pe=Ce[fe];if(!H.box[Pe]){H.box[Pe]=!0;var Ue=4*Pe;if(this._circleAndRectCollide(z.x,z.y,z.radius,ue[Ue+0],ue[Ue+1],ue[Ue+2],ue[Ue+3])&&(!R||R(this.boxKeys[Pe])))return C.push(!0),!0}}var Ae=this.circleCells[b];if(Ae!==null)for(var Ze=this.circles,Ke=0,mt=Ae;Ke<mt.length;Ke+=1){var St=mt[Ke];if(!H.circle[St]){H.circle[St]=!0;var Zt=3*St;if(this._circlesCollide(Ze[Zt],Ze[Zt+1],Ze[Zt+2],z.x,z.y,z.radius)&&(!R||R(this.circleKeys[St])))return C.push(!0),!0}}},Bt.prototype._forEachCell=function(l,f,c,d,b,C,M,R){for(var z=this._convertToXCellCoord(l),H=this._convertToYCellCoord(f),ne=this._convertToXCellCoord(c),ue=this._convertToYCellCoord(d),fe=z;fe<=ne;fe++)for(var Ce=H;Ce<=ue;Ce++)if(b.call(this,l,f,c,d,this.xCellCount*Ce+fe,C,M,R))return},Bt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Bt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Bt.prototype._circlesCollide=function(l,f,c,d,b,C){var M=d-l,R=b-f,z=c+C;return z*z>M*M+R*R},Bt.prototype._circleAndRectCollide=function(l,f,c,d,b,C,M){var R=(C-d)/2,z=Math.abs(l-(d+R));if(z>R+c)return!1;var H=(M-b)/2,ne=Math.abs(f-(b+H));if(ne>H+c)return!1;if(z<=R||ne<=H)return!0;var ue=z-R,fe=ne-H;return ue*ue+fe*fe<=c*c};var Au=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $a(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(Au,3*d)}}function _a(l,f,c){var d=f[0],b=f[1];return l[0]=c[0]*d+c[4]*b+c[12],l[1]=c[1]*d+c[5]*b+c[13],l[3]=c[3]*d+c[7]*b+c[15],l}var La=function(l,f,c){f===void 0&&(f=new Bt(l.width+200,l.height+200,25)),c===void 0&&(c=new Bt(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ta(l,f,c){return f*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}La.prototype.placeCollisionBox=function(l,f,c,d,b){var C=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),M=c*C.perspectiveRatio,R=l.x1*M+C.point.x,z=l.y1*M+C.point.y,H=l.x2*M+C.point.x,ne=l.y2*M+C.point.y;return!this.isInsideGrid(R,z,H,ne)||!f&&this.grid.hitTest(R,z,H,ne,b)?{box:[],offscreen:!1}:{box:[R,z,H,ne],offscreen:this.isOffscreen(R,z,H,ne)}},La.prototype.placeCollisionCircles=function(l,f,c,d,b,C,M,R,z,H,ne,ue,fe){var Ce=[],Pe=new v.Point(f.anchorX,f.anchorY),Ue=Jn(Pe,C),Ae=Di(this.transform.cameraToCenterDistance,Ue.signedDistanceFromCamera),Ze=(H?b/Ae:b*Ae)/v.ONE_EM,Ke=Jn(Pe,M).point,mt=Wr(Ze,d,f.lineOffsetX*Ze,f.lineOffsetY*Ze,!1,Ke,Pe,f,c,M,{}),St=!1,Zt=!1,Kt=!0;if(mt){for(var pr=.5*ue*Ae+fe,kr=new v.Point(-100,-100),Or=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),tn=new Xn,Ln=mt.first,Fn=mt.last,zn=[],Ri=Ln.path.length-1;Ri>=1;Ri--)zn.push(Ln.path[Ri]);for(var sn=1;sn<Fn.path.length;sn++)zn.push(Fn.path[sn]);var ai=2.5*pr;if(R){var fi=zn.map(function(su){return Jn(su,R)});zn=fi.some(function(su){return su.signedDistanceFromCamera<=0})?[]:fi.map(function(su){return su.point})}var ti=[];if(zn.length>0){for(var On=zn[0].clone(),yi=zn[0].clone(),Un=1;Un<zn.length;Un++)On.x=Math.min(On.x,zn[Un].x),On.y=Math.min(On.y,zn[Un].y),yi.x=Math.max(yi.x,zn[Un].x),yi.y=Math.max(yi.y,zn[Un].y);ti=On.x>=kr.x&&yi.x<=Or.x&&On.y>=kr.y&&yi.y<=Or.y?[zn]:yi.x<kr.x||On.x>Or.x||yi.y<kr.y||On.y>Or.y?[]:v.clipLine([zn],kr.x,kr.y,Or.x,Or.y)}for(var jn=0,eo=ti;jn<eo.length;jn+=1){var Da;tn.reset(eo[jn],.25*pr),Da=tn.length<=.5*pr?1:Math.ceil(tn.paddedLength/ai)+1;for(var Bo=0;Bo<Da;Bo++){var No=Bo/Math.max(Da-1,1),Wa=tn.lerp(No),so=Wa.x+100,pa=Wa.y+100;Ce.push(so,pa,pr,0);var na=so-pr,Js=pa-pr,ts=so+pr,ls=pa+pr;if(Kt=Kt&&this.isOffscreen(na,Js,ts,ls),Zt=Zt||this.isInsideGrid(na,Js,ts,ls),!l&&this.grid.hitTestCircle(so,pa,pr,ne)&&(St=!0,!z))return{circles:[],offscreen:!1,collisionDetected:St}}}}return{circles:!z&&St||!Zt?[]:Ce,offscreen:Kt,collisionDetected:St}},La.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,b=-1/0,C=-1/0,M=0,R=l;M<R.length;M+=1){var z=R[M],H=new v.Point(z.x+100,z.y+100);c=Math.min(c,H.x),d=Math.min(d,H.y),b=Math.max(b,H.x),C=Math.max(C,H.y),f.push(H)}for(var ne={},ue={},fe=0,Ce=this.grid.query(c,d,b,C).concat(this.ignoredGrid.query(c,d,b,C));fe<Ce.length;fe+=1){var Pe=Ce[fe],Ue=Pe.key;if(ne[Ue.bucketInstanceId]===void 0&&(ne[Ue.bucketInstanceId]={}),!ne[Ue.bucketInstanceId][Ue.featureIndex]){var Ae=[new v.Point(Pe.x1,Pe.y1),new v.Point(Pe.x2,Pe.y1),new v.Point(Pe.x2,Pe.y2),new v.Point(Pe.x1,Pe.y2)];v.polygonIntersectsPolygon(f,Ae)&&(ne[Ue.bucketInstanceId][Ue.featureIndex]=!0,ue[Ue.bucketInstanceId]===void 0&&(ue[Ue.bucketInstanceId]=[]),ue[Ue.bucketInstanceId].push(Ue.featureIndex))}}return ue},La.prototype.insertCollisionBox=function(l,f,c,d,b){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:b},l[0],l[1],l[2],l[3])},La.prototype.insertCollisionCircles=function(l,f,c,d,b){for(var C=f?this.ignoredGrid:this.grid,M={bucketInstanceId:c,featureIndex:d,collisionGroupID:b},R=0;R<l.length;R+=4)C.insertCircle(M,l[R],l[R+1],l[R+2])},La.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return _a(d,d,l),{point:new v.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},La.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},La.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},La.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var ko=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};ko.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Lo=function(l,f,c,d,b){this.text=new ko(l?l.text:null,f,c,b),this.icon=new ko(l?l.icon:null,f,d,b)};Lo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Tu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},mo=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},wo=function(l,f,c,d,b){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=b},aa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Ga(l,f,c,d,b){var C=v.getAnchorAlignment(l),M=-(C.horizontalAlign-.5)*f,R=-(C.verticalAlign-.5)*c,z=v.evaluateVariableOffset(l,d);return new v.Point(M+z[0]*b,R+z[1]*b)}function Do(l,f,c,d,b,C){var M=l.x1,R=l.x2,z=l.y1,H=l.y2,ne=l.anchorPointX,ue=l.anchorPointY,fe=new v.Point(f,c);return d&&fe._rotate(b?C:-C),{x1:M+fe.x,y1:z+fe.y,x2:R+fe.x,y2:H+fe.y,anchorPointX:ne,anchorPointY:ue}}aa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var Ha=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new La(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new aa(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function Ls(l,f,c,d,b){l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0)}Ha.prototype.getBucketParts=function(l,f,c,d){var b=c.getBucket(f),C=c.latestFeatureIndex;if(b&&C&&f.id===b.layerIds[0]){var M=c.collisionBoxArray,R=b.layers[0].layout,z=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),H=c.tileSize/v.EXTENT,ne=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),ue=R.get("text-pitch-alignment")==="map",fe=R.get("text-rotation-alignment")==="map",Ce=ta(c,1,this.transform.zoom),Pe=Yt(ne,ue,fe,this.transform,Ce),Ue=null;if(ue){var Ae=Ki(ne,ue,fe,this.transform,Ce);Ue=v.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[b.bucketInstanceId]=new wo(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,c.tileID);var Ze={bucket:b,layout:R,posMatrix:ne,textLabelPlaneMatrix:Pe,labelToScreenMatrix:Ue,scale:z,textPixelRatio:H,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(d)for(var Ke=0,mt=b.sortKeyRanges;Ke<mt.length;Ke+=1){var St=mt[Ke];l.push({sortKey:St.sortKey,symbolInstanceStart:St.symbolInstanceStart,symbolInstanceEnd:St.symbolInstanceEnd,parameters:Ze})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ze})}},Ha.prototype.attemptAnchorPlacement=function(l,f,c,d,b,C,M,R,z,H,ne,ue,fe,Ce,Pe){var Ue,Ae=[ue.textOffset0,ue.textOffset1],Ze=Ga(l,c,d,Ae,b),Ke=this.collisionIndex.placeCollisionBox(Do(f,Ze.x,Ze.y,C,M,this.transform.angle),ne,R,z,H.predicate);if(!Pe||this.collisionIndex.placeCollisionBox(Do(Pe,Ze.x,Ze.y,C,M,this.transform.angle),ne,R,z,H.predicate).box.length!==0)return Ke.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID].text&&(Ue=this.prevPlacement.variableOffsets[ue.crossTileID].anchor),this.variableOffsets[ue.crossTileID]={textOffset:Ae,width:c,height:d,anchor:l,textBoxScale:b,prevAnchor:Ue},this.markUsedJustification(fe,l,ue,Ce),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,Ce,ue),this.placedOrientations[ue.crossTileID]=Ce),{shift:Ze,placedGlyphBoxes:Ke}):void 0},Ha.prototype.placeLayerBucketPart=function(l,f,c){var d=this,b=l.parameters,C=b.bucket,M=b.layout,R=b.posMatrix,z=b.textLabelPlaneMatrix,H=b.labelToScreenMatrix,ne=b.textPixelRatio,ue=b.holdingForFade,fe=b.collisionBoxArray,Ce=b.partiallyEvaluatedTextSize,Pe=b.collisionGroup,Ue=M.get("text-optional"),Ae=M.get("icon-optional"),Ze=M.get("text-allow-overlap"),Ke=M.get("icon-allow-overlap"),mt=M.get("text-rotation-alignment")==="map",St=M.get("text-pitch-alignment")==="map",Zt=M.get("icon-text-fit")!=="none",Kt=M.get("symbol-z-order")==="viewport-y",pr=Ze&&(Ke||!C.hasIconData()||Ae),kr=Ke&&(Ze||!C.hasTextData()||Ue);!C.collisionArrays&&fe&&C.deserializeCollisionBoxes(fe);var Or=function(sn,ai){if(!f[sn.crossTileID])if(ue)d.placements[sn.crossTileID]=new Tu(!1,!1,!1);else{var fi,ti=!1,On=!1,yi=!0,Un=null,jn={box:null,offscreen:null},eo={box:null,offscreen:null},Da=null,Bo=null,No=0,Wa=0,so=0;ai.textFeatureIndex?No=ai.textFeatureIndex:sn.useRuntimeCollisionCircles&&(No=sn.featureIndex),ai.verticalTextFeatureIndex&&(Wa=ai.verticalTextFeatureIndex);var pa=ai.textBox;if(pa){var na=function(Qi){var cs=v.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Qi&&d.prevPlacement){var zo=d.prevPlacement.placedOrientations[sn.crossTileID];zo&&(d.placedOrientations[sn.crossTileID]=zo,d.markUsedOrientation(C,cs=zo,sn))}return cs},Js=function(Qi,cs){if(C.allowVerticalPlacement&&sn.numVerticalGlyphVertices>0&&ai.verticalTextBox)for(var zo=0,Fu=C.writingModes;zo<Fu.length&&(Fu[zo]===v.WritingMode.vertical?(jn=cs(),eo=jn):jn=Qi(),!(jn&&jn.box&&jn.box.length));zo+=1);else jn=Qi()};if(M.get("text-variable-anchor")){var ts=M.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[sn.crossTileID]){var ls=d.prevPlacement.variableOffsets[sn.crossTileID];ts.indexOf(ls.anchor)>0&&(ts=ts.filter(function(Qi){return Qi!==ls.anchor})).unshift(ls.anchor)}var su=function(Qi,cs,zo){for(var Fu=Qi.x2-Qi.x1,pc=Qi.y2-Qi.y1,Ul=sn.textBoxScale,Bc=Zt&&!Ke?cs:null,eu={box:[],offscreen:!1},Zl=Ze?2*ts.length:ts.length,Mo=0;Mo<Zl;++Mo){var qu=d.attemptAnchorPlacement(ts[Mo%ts.length],Qi,Fu,pc,Ul,mt,St,ne,R,Pe,Mo>=ts.length,sn,C,zo,Bc);if(qu&&(eu=qu.placedGlyphBoxes)&&eu.box&&eu.box.length){ti=!0,Un=qu.shift;break}}return eu};Js(function(){return su(pa,ai.iconBox,v.WritingMode.horizontal)},function(){var Qi=ai.verticalTextBox;return C.allowVerticalPlacement&&!(jn&&jn.box&&jn.box.length)&&sn.numVerticalGlyphVertices>0&&Qi?su(Qi,ai.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),jn&&(ti=jn.box,yi=jn.offscreen);var Fc=na(jn&&jn.box);if(!ti&&d.prevPlacement){var fc=d.prevPlacement.variableOffsets[sn.crossTileID];fc&&(d.variableOffsets[sn.crossTileID]=fc,d.markUsedJustification(C,fc.anchor,sn,Fc))}}else{var Yu=function(Qi,cs){var zo=d.collisionIndex.placeCollisionBox(Qi,Ze,ne,R,Pe.predicate);return zo&&zo.box&&zo.box.length&&(d.markUsedOrientation(C,cs,sn),d.placedOrientations[sn.crossTileID]=cs),zo};Js(function(){return Yu(pa,v.WritingMode.horizontal)},function(){var Qi=ai.verticalTextBox;return C.allowVerticalPlacement&&sn.numVerticalGlyphVertices>0&&Qi?Yu(Qi,v.WritingMode.vertical):{box:null,offscreen:null}}),na(jn&&jn.box&&jn.box.length)}}if(ti=(fi=jn)&&fi.box&&fi.box.length>0,yi=fi&&fi.offscreen,sn.useRuntimeCollisionCircles){var yl=C.text.placedSymbolArray.get(sn.centerJustifiedTextSymbolIndex),bs=v.evaluateSizeForFeature(C.textSizeData,Ce,yl),gu=M.get("text-padding");Da=d.collisionIndex.placeCollisionCircles(Ze,yl,C.lineVertexArray,C.glyphOffsetArray,bs,R,z,H,c,St,Pe.predicate,sn.collisionCircleDiameter,gu),ti=Ze||Da.circles.length>0&&!Da.collisionDetected,yi=yi&&Da.offscreen}if(ai.iconFeatureIndex&&(so=ai.iconFeatureIndex),ai.iconBox){var hc=function(Qi){var cs=Zt&&Un?Do(Qi,Un.x,Un.y,mt,St,d.transform.angle):Qi;return d.collisionIndex.placeCollisionBox(cs,Ke,ne,R,Pe.predicate)};On=eo&&eo.box&&eo.box.length&&ai.verticalIconBox?(Bo=hc(ai.verticalIconBox)).box.length>0:(Bo=hc(ai.iconBox)).box.length>0,yi=yi&&Bo.offscreen}var Lu=Ue||sn.numHorizontalGlyphVertices===0&&sn.numVerticalGlyphVertices===0,Na=Ae||sn.numIconVertices===0;if(Lu||Na?Na?Lu||(On=On&&ti):ti=On&&ti:On=ti=On&&ti,ti&&fi&&fi.box&&d.collisionIndex.insertCollisionBox(fi.box,M.get("text-ignore-placement"),C.bucketInstanceId,eo&&eo.box&&Wa?Wa:No,Pe.ID),On&&Bo&&d.collisionIndex.insertCollisionBox(Bo.box,M.get("icon-ignore-placement"),C.bucketInstanceId,so,Pe.ID),Da&&(ti&&d.collisionIndex.insertCollisionCircles(Da.circles,M.get("text-ignore-placement"),C.bucketInstanceId,No,Pe.ID),c)){var uu=C.bucketInstanceId,lu=d.collisionCircleArrays[uu];lu===void 0&&(lu=d.collisionCircleArrays[uu]=new mo);for(var Du=0;Du<Da.circles.length;Du+=4)lu.circles.push(Da.circles[Du+0]),lu.circles.push(Da.circles[Du+1]),lu.circles.push(Da.circles[Du+2]),lu.circles.push(Da.collisionDetected?1:0)}d.placements[sn.crossTileID]=new Tu(ti||pr,On||kr,yi||C.justReloaded),f[sn.crossTileID]=!0}};if(Kt)for(var tn=C.getSortedSymbolIndexes(this.transform.angle),Ln=tn.length-1;Ln>=0;--Ln){var Fn=tn[Ln];Or(C.symbolInstances.get(Fn),C.collisionArrays[Fn])}else for(var zn=l.symbolInstanceStart;zn<l.symbolInstanceEnd;zn++)Or(C.symbolInstances.get(zn),C.collisionArrays[zn]);if(c&&C.bucketInstanceId in this.collisionCircleArrays){var Ri=this.collisionCircleArrays[C.bucketInstanceId];v.invert(Ri.invProjMatrix,R),Ri.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},Ha.prototype.markUsedJustification=function(l,f,c,d){var b;b=d===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var C=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];C<M.length;C+=1){var R=M[C];R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=b>=0&&R!==b?0:c.crossTileID)}},Ha.prototype.markUsedOrientation=function(l,f,c){for(var d=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,b=f===v.WritingMode.vertical?f:0,C=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];C<M.length;C+=1)l.text.placedSymbolArray.get(M[C]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)},Ha.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,b=f?f.opacities:{},C=f?f.variableOffsets:{},M=f?f.placedOrientations:{};for(var R in this.placements){var z=this.placements[R],H=b[R];H?(this.opacities[R]=new Lo(H,d,z.text,z.icon),c=c||z.text!==H.text.placed||z.icon!==H.icon.placed):(this.opacities[R]=new Lo(null,d,z.text,z.icon,z.skipFade),c=c||z.text||z.icon)}for(var ne in b){var ue=b[ne];if(!this.opacities[ne]){var fe=new Lo(ue,d,!1,!1);fe.isHidden()||(this.opacities[ne]=fe,c=c||ue.text.placed||ue.icon.placed)}}for(var Ce in C)this.variableOffsets[Ce]||!this.opacities[Ce]||this.opacities[Ce].isHidden()||(this.variableOffsets[Ce]=C[Ce]);for(var Pe in M)this.placedOrientations[Pe]||!this.opacities[Pe]||this.opacities[Pe].isHidden()||(this.placedOrientations[Pe]=M[Pe]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},Ha.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,b=f;d<b.length;d+=1){var C=b[d],M=C.getBucket(l);M&&C.latestFeatureIndex&&l.id===M.layerIds[0]&&this.updateBucketOpacities(M,c,C.collisionBoxArray)}},Ha.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var b=l.layers[0].layout,C=new Lo(null,0,!1,!1,!0),M=b.get("text-allow-overlap"),R=b.get("icon-allow-overlap"),z=b.get("text-variable-anchor"),H=b.get("text-rotation-alignment")==="map",ne=b.get("text-pitch-alignment")==="map",ue=b.get("icon-text-fit")!=="none",fe=new Lo(null,0,M&&(R||!l.hasIconData()||b.get("icon-optional")),R&&(M||!l.hasTextData()||b.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Ce=function(Ze,Ke,mt){for(var St=0;St<Ke/4;St++)Ze.opacityVertexArray.emplaceBack(mt)},Pe=function(Ze){var Ke=l.symbolInstances.get(Ze),mt=Ke.numHorizontalGlyphVertices,St=Ke.numVerticalGlyphVertices,Zt=Ke.crossTileID,Kt=d.opacities[Zt];f[Zt]?Kt=C:Kt||(d.opacities[Zt]=Kt=fe),f[Zt]=!0;var pr=Ke.numIconVertices>0,kr=d.placedOrientations[Ke.crossTileID],Or=kr===v.WritingMode.vertical,tn=kr===v.WritingMode.horizontal||kr===v.WritingMode.horizontalOnly;if(mt>0||St>0){var Ln=An(Kt.text);Ce(l.text,mt,Or?Ti:Ln),Ce(l.text,St,tn?Ti:Ln);var Fn=Kt.text.isHidden();[Ke.rightJustifiedTextSymbolIndex,Ke.centerJustifiedTextSymbolIndex,Ke.leftJustifiedTextSymbolIndex].forEach(function(jn){jn>=0&&(l.text.placedSymbolArray.get(jn).hidden=Fn||Or?1:0)}),Ke.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Ke.verticalPlacedTextSymbolIndex).hidden=Fn||tn?1:0);var zn=d.variableOffsets[Ke.crossTileID];zn&&d.markUsedJustification(l,zn.anchor,Ke,kr);var Ri=d.placedOrientations[Ke.crossTileID];Ri&&(d.markUsedJustification(l,"left",Ke,Ri),d.markUsedOrientation(l,Ri,Ke))}if(pr){var sn=An(Kt.icon),ai=!(ue&&Ke.verticalPlacedIconSymbolIndex&&Or);Ke.placedIconSymbolIndex>=0&&(Ce(l.icon,Ke.numIconVertices,ai?sn:Ti),l.icon.placedSymbolArray.get(Ke.placedIconSymbolIndex).hidden=Kt.icon.isHidden()),Ke.verticalPlacedIconSymbolIndex>=0&&(Ce(l.icon,Ke.numVerticalIconVertices,ai?Ti:sn),l.icon.placedSymbolArray.get(Ke.verticalPlacedIconSymbolIndex).hidden=Kt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var fi=l.collisionArrays[Ze];if(fi){var ti=new v.Point(0,0);if(fi.textBox||fi.verticalTextBox){var On=!0;if(z){var yi=d.variableOffsets[Zt];yi?(ti=Ga(yi.anchor,yi.width,yi.height,yi.textOffset,yi.textBoxScale),H&&ti._rotate(ne?d.transform.angle:-d.transform.angle)):On=!1}fi.textBox&&Ls(l.textCollisionBox.collisionVertexArray,Kt.text.placed,!On||Or,ti.x,ti.y),fi.verticalTextBox&&Ls(l.textCollisionBox.collisionVertexArray,Kt.text.placed,!On||tn,ti.x,ti.y)}var Un=Boolean(!tn&&fi.verticalIconBox);fi.iconBox&&Ls(l.iconCollisionBox.collisionVertexArray,Kt.icon.placed,Un,ue?ti.x:0,ue?ti.y:0),fi.verticalIconBox&&Ls(l.iconCollisionBox.collisionVertexArray,Kt.icon.placed,!Un,ue?ti.x:0,ue?ti.y:0)}}},Ue=0;Ue<l.symbolInstances.length;Ue++)Pe(Ue);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ae=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ae.invProjMatrix,l.placementViewportMatrix=Ae.viewportMatrix,l.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Ha.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ha.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Ha.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Ha.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},Ha.prototype.setStale=function(){this.stale=!0};var Uu=Math.pow(2,25),ds=Math.pow(2,24),ee=Math.pow(2,17),Ee=Math.pow(2,16),Xe=Math.pow(2,9),Pt=Math.pow(2,8),Pr=Math.pow(2,1);function An(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Uu+f*ds+c*ee+f*Ee+c*Xe+f*Pt+c*Pr+f}var Ti=0,Qa=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Qa.prototype.continuePlacement=function(l,f,c,d,b){for(var C=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(C,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(M,R){return M.sortKey-R.sortKey}));this._currentPartIndex<C.length;)if(f.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1};var Aa=function(l,f,c,d,b,C,M){this.placement=new Ha(l,b,C,M),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Aa.prototype.isDone=function(){return this._done},Aa.prototype.continuePlacement=function(l,f,c){for(var d=this,b=v.browser.now(),C=function(){var z=v.browser.now()-b;return!d._forceFullPlacement&&z>2};this._currentPlacementIndex>=0;){var M=f[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=R)&&(!M.maxzoom||M.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Qa(M)),this._inProgressLayer.continuePlacement(c[M.source],this.placement,this._showCollisionBoxes,M,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Aa.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Fa=512/v.EXTENT/2,Fo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var b=f.get(d),C=b.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,l)})}};Fo.prototype.getScaledCoordinates=function(l,f){var c=Fa/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*v.EXTENT+l.anchorY)*c)}},Fo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),b=0;b<l.length;b++){var C=l.get(b);if(!C.crossTileID){var M=this.indexedSymbolInstances[C.key];if(M)for(var R=this.getScaledCoordinates(C,f),z=0,H=M;z<H.length;z+=1){var ne=H[z];if(Math.abs(ne.coord.x-R.x)<=d&&Math.abs(ne.coord.y-R.y)<=d&&!c[ne.crossTileID]){c[ne.crossTileID]=!0,C.crossTileID=ne.crossTileID;break}}}}};var vs=function(){this.maxCrossTileID=0};vs.prototype.generate=function(){return++this.maxCrossTileID};var Wo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Wo.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],b={};for(var C in d){var M=d[C];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+f),b[M.tileID.key]=M}this.indexes[c]=b}this.lng=l},Wo.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var b=this.usedCrossTileIDs[l.overscaledZ];for(var C in this.indexes){var M=this.indexes[C];if(Number(C)>l.overscaledZ)for(var R in M){var z=M[R];z.tileID.isChildOf(l)&&z.findMatches(f.symbolInstances,l,b)}else{var H=M[l.scaledTo(Number(C)).key];H&&H.findMatches(f.symbolInstances,l,b)}}for(var ne=0;ne<f.symbolInstances.length;ne++){var ue=f.symbolInstances.get(ne);ue.crossTileID||(ue.crossTileID=c.generate(),b[ue.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Fo(l,f.symbolInstances,f.bucketInstanceId),!0},Wo.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,b=f.indexedSymbolInstances[c];d<b.length;d+=1)delete this.usedCrossTileIDs[l][b[d].crossTileID]},Wo.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var b in d)l[d[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[b]),delete d[b],f=!0)}return f};var Ao=function(){this.layerIndexes={},this.crossTileIDs=new vs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ao.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new Wo);var b=!1,C={};d.handleWrapJump(c);for(var M=0,R=f;M<R.length;M+=1){var z=R[M],H=z.getBucket(l);H&&l.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(z.tileID,H,this.crossTileIDs)&&(b=!0),C[H.bucketInstanceId]=!0)}return d.removeStaleBuckets(C)&&(b=!0),b},Ao.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var To=function(l,f){return v.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},Ms=v.pick(Vr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Hs=v.pick(Vr,["setCenter","setZoom","setBearing","setPitch"]),Ws=function(){var l={},f=v.styleSpec.$version;for(var c in v.styleSpec.$root){var d,b=v.styleSpec.$root[c];b.required&&(d=c==="version"?f:b.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),ms=function(l){function f(c,d){var b=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Ut(wt(),this),this.imageManager=new yt,this.imageManager.setEventedParent(this),this.glyphManager=new Xt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Qe(256,512),this.crossTileSymbolIndex=new Ao,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var C=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(M){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(R,z){if(v.triggerPluginCompletionEvent(R),z&&z.every(function(ne){return ne}))for(var H in C.sourceCaches)C.sourceCaches[H].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var R=b.sourceCaches[M.sourceId];if(R){var z=R.getSource();if(z&&z.vectorLayerIds)for(var H in b._layers){var ne=b._layers[H];ne.source===z.id&&b._validateLayer(ne)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var b=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var C=typeof d.validate=="boolean"?d.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var M=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(M,function(R,z){b._request=null,R?b.fire(new v.ErrorEvent(R)):z&&b._load(z,C)})},f.prototype.loadJSON=function(c,d){var b=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){b._request=null,b._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(Ws,!1)},f.prototype._load=function(c,d){if(!d||!To(this,v.validateStyle(c))){for(var b in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(b,c.sources[b],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var C=Fr(this.stylesheet.layers);this._order=C.map(function(H){return H.id}),this._layers={},this._serializedLayers={};for(var M=0,R=C;M<R.length;M+=1){var z=R[M];(z=v.createStyleLayer(z)).setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new lt(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(b,C,M){var R,z,H,ne=v.browser.devicePixelRatio>1?"@2x":"",ue=v.getJSON(C.transformRequest(C.normalizeSpriteURL(b,ne,".json"),v.ResourceType.SpriteJSON),function(Pe,Ue){ue=null,H||(H=Pe,R=Ue,Ce())}),fe=v.getImage(C.transformRequest(C.normalizeSpriteURL(b,ne,".png"),v.ResourceType.SpriteImage),function(Pe,Ue){fe=null,H||(H=Pe,z=Ue,Ce())});function Ce(){if(H)M(H);else if(R&&z){var Pe=v.browser.getImageData(z),Ue={};for(var Ae in R){var Ze=R[Ae],Ke=Ze.width,mt=Ze.height,St=Ze.x,Zt=Ze.y,Kt=Ze.sdf,pr=Ze.pixelRatio,kr=Ze.stretchX,Or=Ze.stretchY,tn=Ze.content,Ln=new v.RGBAImage({width:Ke,height:mt});v.RGBAImage.copy(Pe,Ln,{x:St,y:Zt},{x:0,y:0},{width:Ke,height:mt}),Ue[Ae]={data:Ln,pixelRatio:pr,sdf:Kt,stretchX:kr,stretchY:Or,content:tn}}M(null,Ue)}}return{cancel:function(){ue&&(ue.cancel(),ue=null),fe&&(fe.cancel(),fe=null)}}}(c,this.map._requestManager,function(b,C){if(d._spriteRequest=null,b)d.fire(new v.ErrorEvent(b));else if(C)for(var M in C)d.imageManager.addImage(M,C[M]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var b=c.sourceLayer;if(b){var C=d.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(b)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+b+'" does not exist on source "'+C.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],b=0,C=c;b<C.length;b+=1){var M=this._layers[C[b]];M.type!=="custom"&&d.push(M.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var b=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var M in(b.length||C.length)&&this._updateWorkerLayers(b,C),this._updatedSources){var R=this._updatedSources[M];R==="reload"?this._reloadSource(M):R==="clear"&&this._clearSource(M)}for(var z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[z].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var H={};for(var ne in this.sourceCaches){var ue=this.sourceCaches[ne];H[ne]=ue.used,ue.used=!1}for(var fe=0,Ce=this._order;fe<Ce.length;fe+=1){var Pe=this._layers[Ce[fe]];Pe.recalculate(c,this._availableImages),!Pe.isHidden(c.zoom)&&Pe.source&&(this.sourceCaches[Pe.source].used=!0)}for(var Ue in H){var Ae=this.sourceCaches[Ue];H[Ue]!==Ae.used&&Ae.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ue}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),To(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=Fr(c.layers);var b=function(M,R){if(!M)return[{command:Vr.setStyle,args:[R]}];var z=[];try{if(!v.deepEqual(M.version,R.version))return[{command:Vr.setStyle,args:[R]}];v.deepEqual(M.center,R.center)||z.push({command:Vr.setCenter,args:[R.center]}),v.deepEqual(M.zoom,R.zoom)||z.push({command:Vr.setZoom,args:[R.zoom]}),v.deepEqual(M.bearing,R.bearing)||z.push({command:Vr.setBearing,args:[R.bearing]}),v.deepEqual(M.pitch,R.pitch)||z.push({command:Vr.setPitch,args:[R.pitch]}),v.deepEqual(M.sprite,R.sprite)||z.push({command:Vr.setSprite,args:[R.sprite]}),v.deepEqual(M.glyphs,R.glyphs)||z.push({command:Vr.setGlyphs,args:[R.glyphs]}),v.deepEqual(M.transition,R.transition)||z.push({command:Vr.setTransition,args:[R.transition]}),v.deepEqual(M.light,R.light)||z.push({command:Vr.setLight,args:[R.light]});var H={},ne=[];(function(fe,Ce,Pe,Ue){var Ae;for(Ae in Ce=Ce||{},fe=fe||{})fe.hasOwnProperty(Ae)&&(Ce.hasOwnProperty(Ae)||en(Ae,Pe,Ue));for(Ae in Ce)Ce.hasOwnProperty(Ae)&&(fe.hasOwnProperty(Ae)?v.deepEqual(fe[Ae],Ce[Ae])||(fe[Ae].type==="geojson"&&Ce[Ae].type==="geojson"&&Vn(fe,Ce,Ae)?Pe.push({command:Vr.setGeoJSONSourceData,args:[Ae,Ce[Ae].data]}):Ai(Ae,Ce,Pe,Ue)):di(Ae,Ce,Pe))})(M.sources,R.sources,ne,H);var ue=[];M.layers&&M.layers.forEach(function(fe){H[fe.source]?z.push({command:Vr.removeLayer,args:[fe.id]}):ue.push(fe)}),z=z.concat(ne),function(fe,Ce,Pe){Ce=Ce||[];var Ue,Ae,Ze,Ke,mt,St,Zt,Kt=(fe=fe||[]).map(Ci),pr=Ce.map(Ci),kr=fe.reduce(Ei,{}),Or=Ce.reduce(Ei,{}),tn=Kt.slice(),Ln=Object.create(null);for(Ue=0,Ae=0;Ue<Kt.length;Ue++)Or.hasOwnProperty(Ze=Kt[Ue])?Ae++:(Pe.push({command:Vr.removeLayer,args:[Ze]}),tn.splice(tn.indexOf(Ze,Ae),1));for(Ue=0,Ae=0;Ue<pr.length;Ue++)tn[tn.length-1-Ue]!==(Ze=pr[pr.length-1-Ue])&&(kr.hasOwnProperty(Ze)?(Pe.push({command:Vr.removeLayer,args:[Ze]}),tn.splice(tn.lastIndexOf(Ze,tn.length-Ae),1)):Ae++,Pe.push({command:Vr.addLayer,args:[Or[Ze],St=tn[tn.length-Ue]]}),tn.splice(tn.length-Ue,0,Ze),Ln[Ze]=!0);for(Ue=0;Ue<pr.length;Ue++)if(Ke=kr[Ze=pr[Ue]],mt=Or[Ze],!Ln[Ze]&&!v.deepEqual(Ke,mt))if(v.deepEqual(Ke.source,mt.source)&&v.deepEqual(Ke["source-layer"],mt["source-layer"])&&v.deepEqual(Ke.type,mt.type)){for(Zt in li(Ke.layout,mt.layout,Pe,Ze,null,Vr.setLayoutProperty),li(Ke.paint,mt.paint,Pe,Ze,null,Vr.setPaintProperty),v.deepEqual(Ke.filter,mt.filter)||Pe.push({command:Vr.setFilter,args:[Ze,mt.filter]}),v.deepEqual(Ke.minzoom,mt.minzoom)&&v.deepEqual(Ke.maxzoom,mt.maxzoom)||Pe.push({command:Vr.setLayerZoomRange,args:[Ze,mt.minzoom,mt.maxzoom]}),Ke)Ke.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?li(Ke[Zt],mt[Zt],Pe,Ze,Zt.slice(6),Vr.setPaintProperty):v.deepEqual(Ke[Zt],mt[Zt])||Pe.push({command:Vr.setLayerProperty,args:[Ze,Zt,mt[Zt]]}));for(Zt in mt)mt.hasOwnProperty(Zt)&&!Ke.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?li(Ke[Zt],mt[Zt],Pe,Ze,Zt.slice(6),Vr.setPaintProperty):v.deepEqual(Ke[Zt],mt[Zt])||Pe.push({command:Vr.setLayerProperty,args:[Ze,Zt,mt[Zt]]}))}else Pe.push({command:Vr.removeLayer,args:[Ze]}),St=tn[tn.lastIndexOf(Ze)+1],Pe.push({command:Vr.addLayer,args:[mt,St]})}(ue,R.layers,z)}catch(fe){console.warn("Unable to compute style diff:",fe),z=[{command:Vr.setStyle,args:[R]}]}return z}(this.serialize(),c).filter(function(M){return!(M.command in Hs)});if(b.length===0)return!1;var C=b.filter(function(M){return!(M.command in Ms)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(M){return M.command}).join(", ")+".");return b.forEach(function(M){M.command!=="setTransition"&&d[M.command].apply(d,M.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,b){var C=this;if(b===void 0&&(b={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,d,null,b))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var M=this.sourceCaches[c]=new De(c,d,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:M.serialize(),sourceId:c}}),M.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var b=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],b.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),b.setEventedParent(null),b.clearTiles(),b.onRemove&&b.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,b){b===void 0&&(b={}),this._checkLoaded();var C=c.id;if(this.getLayer(C))this.fire(new v.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var M;if(c.type==="custom"){if(To(this,v.validateCustomStyleLayer(c)))return;M=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(C,c.source),c=v.clone$1(c),c=v.extend(c,{source:C})),this._validate(v.validateStyle.layer,"layers."+C,c,{arrayIndex:-1},b))return;M=v.createStyleLayer(c),this._validateLayer(M),M.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[M.id]=M.serialize()}var R=d?this._order.indexOf(d):this._order.length;if(d&&R===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(R,0,C),this._layerOrderChanged=!0,this._layers[C]=M,this._removedLayers[C]&&M.source&&M.type!=="custom"){var z=this._removedLayers[C];delete this._removedLayers[C],z.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var b=this._order.indexOf(c);this._order.splice(b,1);var C=d?this._order.indexOf(d):this._order.length;d&&C===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(C,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var b=this._order.indexOf(c);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,b){this._checkLoaded();var C=this.getLayer(c);C?C.minzoom===d&&C.maxzoom===b||(d!=null&&(C.minzoom=d),b!=null&&(C.maxzoom=b),this._updateLayer(C)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,b){b===void 0&&(b={}),this._checkLoaded();var C=this.getLayer(c);if(C){if(!v.deepEqual(C.filter,d))return d==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(v.validateStyle.filter,"layers."+C.id+".filter",d,null,b)||(C.filter=v.clone$1(d),this._updateLayer(C)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,b,C){C===void 0&&(C={}),this._checkLoaded();var M=this.getLayer(c);M?v.deepEqual(M.getLayoutProperty(d),b)||(M.setLayoutProperty(d,b,C),this._updateLayer(M)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var b=this.getLayer(c);if(b)return b.getLayoutProperty(d);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,b,C){C===void 0&&(C={}),this._checkLoaded();var M=this.getLayer(c);M?v.deepEqual(M.getPaintProperty(d),b)||(M.setPaintProperty(d,b,C)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var b=c.source,C=c.sourceLayer,M=this.sourceCaches[b];if(M!==void 0){var R=M.getSource().type;R==="geojson"&&C?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||C?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(C,c.id,d)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var b=c.source,C=this.sourceCaches[b];if(C!==void 0){var M=C.getSource().type,R=M==="vector"?c.sourceLayer:void 0;M!=="vector"||R?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(R,c.id,d):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,b=c.sourceLayer,C=this.sourceCaches[d];if(C!==void 0){if(C.getSource().type!=="vector"||b)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(b,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,b=function(kr){return d._layers[kr].type==="fill-extrusion"},C={},M=[],R=this._order.length-1;R>=0;R--){var z=this._order[R];if(b(z)){C[z]=R;for(var H=0,ne=c;H<ne.length;H+=1){var ue=ne[H][z];if(ue)for(var fe=0,Ce=ue;fe<Ce.length;fe+=1)M.push(Ce[fe])}}}M.sort(function(kr,Or){return Or.intersectionZ-kr.intersectionZ});for(var Pe=[],Ue=this._order.length-1;Ue>=0;Ue--){var Ae=this._order[Ue];if(b(Ae))for(var Ze=M.length-1;Ze>=0;Ze--){var Ke=M[Ze].feature;if(C[Ke.layer.id]<Ue)break;Pe.push(Ke),M.pop()}else for(var mt=0,St=c;mt<St.length;mt+=1){var Zt=St[mt][Ae];if(Zt)for(var Kt=0,pr=Zt;Kt<pr.length;Kt+=1)Pe.push(pr[Kt].feature)}}return Pe},f.prototype.queryRenderedFeatures=function(c,d,b){d&&d.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var C={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,R=d.layers;M<R.length;M+=1){var z=R[M],H=this._layers[z];if(!H)return this.fire(new v.ErrorEvent(new Error("The layer '"+z+"' does not exist in the map's style and cannot be queried for features."))),[];C[H.source]=!0}}var ne=[];for(var ue in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!C[ue]||ne.push(gn(this.sourceCaches[ue],this._layers,this._serializedLayers,c,d,b));return this.placement&&ne.push(function(fe,Ce,Pe,Ue,Ae,Ze,Ke){for(var mt={},St=Ze.queryRenderedSymbols(Ue),Zt=[],Kt=0,pr=Object.keys(St).map(Number);Kt<pr.length;Kt+=1)Zt.push(Ke[pr[Kt]]);Zt.sort(ea);for(var kr=function(){var zn=tn[Or],Ri=zn.featureIndex.lookupSymbolFeatures(St[zn.bucketInstanceId],Ce,zn.bucketIndex,zn.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,fe);for(var sn in Ri){var ai=mt[sn]=mt[sn]||[],fi=Ri[sn];fi.sort(function(yi,Un){var jn=zn.featureSortOrder;if(jn){var eo=jn.indexOf(yi.featureIndex);return jn.indexOf(Un.featureIndex)-eo}return Un.featureIndex-yi.featureIndex});for(var ti=0,On=fi;ti<On.length;ti+=1)ai.push(On[ti])}},Or=0,tn=Zt;Or<tn.length;Or+=1)kr();var Ln=function(zn){mt[zn].forEach(function(Ri){var sn=Ri.feature,ai=Pe[fe[zn].source].getFeatureState(sn.layer["source-layer"],sn.id);sn.source=sn.layer.source,sn.layer["source-layer"]&&(sn.sourceLayer=sn.layer["source-layer"]),sn.state=ai})};for(var Fn in mt)Ln(Fn);return mt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ne)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var b=this.sourceCaches[c];return b?function(C,M){for(var R=C.getRenderableIds().map(function(Ce){return C.getTileByID(Ce)}),z=[],H={},ne=0;ne<R.length;ne++){var ue=R[ne],fe=ue.tileID.canonical.key;H[fe]||(H[fe]=!0,ue.querySourceFeatures(z,M))}return z}(b,d):[]},f.prototype.addSourceType=function(c,d,b){return f.getSourceType(c)?b(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},b):b(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var b=this.light.getLight(),C=!1;for(var M in c)if(!v.deepEqual(c[M],b[M])){C=!0;break}if(C){var R={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(R)}},f.prototype._validate=function(c,d,b,C,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&To(this,c.call(v.validateStyle,v.extend({key:d,style:this.serialize(),value:b,styleSpec:v.styleSpec},C)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,b,C,M){M===void 0&&(M=!1);for(var R=!1,z=!1,H={},ne=0,ue=this._order;ne<ue.length;ne+=1){var fe=this._layers[ue[ne]];if(fe.type==="symbol"){if(!H[fe.source]){var Ce=this.sourceCaches[fe.source];H[fe.source]=Ce.getRenderableIds(!0).map(function(Ke){return Ce.getTileByID(Ke)}).sort(function(Ke,mt){return mt.tileID.overscaledZ-Ke.tileID.overscaledZ||(Ke.tileID.isLessThan(mt.tileID)?-1:1)})}var Pe=this.crossTileSymbolIndex.addLayer(fe,H[fe.source],c.center.lng);R=R||Pe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||b===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new Aa(c,this._order,M,d,b,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),z=!0),R&&this.pauseablePlacement.placement.setStale()),z||R)for(var Ue=0,Ae=this._order;Ue<Ae.length;Ue+=1){var Ze=this._layers[Ae[Ue]];Ze.type==="symbol"&&this.placement.updateLayerOpacities(Ze,H[Ze.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,b){this.imageManager.getImages(d.icons,b),this._updateTilesForChangedImages();var C=this.sourceCaches[d.source];C&&C.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,b){this.glyphManager.getGlyphs(d.stacks,b)},f.prototype.getResource=function(c,d,b){return v.makeRequest(d,b)},f}(v.Evented);ms.getSourceType=function(l){return Sr[l]},ms.setSourceType=function(l,f){Sr[l]=f},ms.registerForPluginStateChange=v.registerForPluginStateChange;var va=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),go=Zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Qo=Zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),gs=Zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Pl=Zi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),rf=Zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ps=Zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Il=Zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Xs=Zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),rl=Zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=Zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),F=Zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Y=Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),me=Zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Ge=Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ut=Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ct=Zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),lr=Zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),mr=Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),cn=Zi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ei=Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Hn=Zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),vi=Zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ca=Zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),xa=Zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Zi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),b=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=C?C.concat(b):b,R={};return{fragmentSource:l=l.replace(c,function(z,H,ne,ue,fe){return R[fe]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_`+fe+`
varying `+ne+" "+ue+" "+fe+`;
#else
uniform `+ne+" "+ue+" u_"+fe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+fe+`
    `+ne+" "+ue+" "+fe+" = u_"+fe+`;
#endif
`}),vertexSource:f=f.replace(c,function(z,H,ne,ue,fe){var Ce=ue==="float"?"vec2":"vec4",Pe=fe.match(/color/)?"color":Ce;return R[fe]?H==="define"?`
#ifndef HAS_UNIFORM_u_`+fe+`
uniform lowp float u_`+fe+`_t;
attribute `+ne+" "+Ce+" a_"+fe+`;
varying `+ne+" "+ue+" "+fe+`;
#else
uniform `+ne+" "+ue+" u_"+fe+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+fe+`
    `+fe+" = a_"+fe+`;
#else
    `+ne+" "+ue+" "+fe+" = u_"+fe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+fe+`
    `+fe+" = unpack_mix_"+Pe+"(a_"+fe+", u_"+fe+`_t);
#else
    `+ne+" "+ue+" "+fe+" = u_"+fe+`;
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_`+fe+`
uniform lowp float u_`+fe+`_t;
attribute `+ne+" "+Ce+" a_"+fe+`;
#else
uniform `+ne+" "+ue+" u_"+fe+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+fe+`
    `+ne+" "+ue+" "+fe+" = a_"+fe+`;
#else
    `+ne+" "+ue+" "+fe+" = u_"+fe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+fe+`
    `+ne+" "+ue+" "+fe+" = unpack_mix_"+Pe+"(a_"+fe+", u_"+fe+`_t);
#else
    `+ne+" "+ue+" "+fe+" = u_"+fe+`;
#endif
`}),staticAttributes:d,staticUniforms:M}}var ys=Object.freeze({__proto__:null,prelude:go,background:Qo,backgroundPattern:gs,circle:Pl,clippingMask:rf,heatmap:Ps,heatmapTexture:Il,collisionBox:Xs,collisionCircle:rl,debug:_,fill:T,fillOutline:F,fillOutlinePattern:O,fillPattern:Y,fillExtrusion:me,fillExtrusionPattern:Ge,hillshadePrepare:ut,hillshade:ct,line:lr,lineGradient:mr,linePattern:cn,lineSDF:ei,raster:Hn,symbolIcon:vi,symbolSDF:ca,symbolTextAndIcon:xa}),hu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Zu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}hu.prototype.bind=function(l,f,c,d,b,C,M,R){this.context=l;for(var z=this.boundPaintVertexBuffers.length!==d.length,H=0;!z&&H<d.length;H++)this.boundPaintVertexBuffers[H]!==d[H]&&(z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!z&&this.boundIndexBuffer===b&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===R?(l.bindVertexArrayOES.set(this.vao),M&&M.bind(),b&&b.dynamicDraw&&b.bind(),R&&R.bind()):this.freshBind(f,c,d,b,C,M,R)},hu.prototype.freshBind=function(l,f,c,d,b,C,M){var R,z=l.numAttributes,H=this.context,ne=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=M;else{R=H.currentNumAttributes||0;for(var ue=z;ue<R;ue++)ne.disableVertexAttribArray(ue)}f.enableAttributes(ne,l);for(var fe=0,Ce=c;fe<Ce.length;fe+=1)Ce[fe].enableAttributes(ne,l);C&&C.enableAttributes(ne,l),M&&M.enableAttributes(ne,l),f.bind(),f.setVertexAttribPointers(ne,l,b);for(var Pe=0,Ue=c;Pe<Ue.length;Pe+=1){var Ae=Ue[Pe];Ae.bind(),Ae.setVertexAttribPointers(ne,l,b)}C&&(C.bind(),C.setVertexAttribPointers(ne,l,b)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(ne,l,b)),H.currentNumAttributes=z},hu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Mc=function(l,f,c,d,b,C){var M=l.gl;this.program=M.createProgram();for(var R=Zu(c.staticAttributes),z=d?d.getBinderAttributes():[],H=R.concat(z),ne=c.staticUniforms?Zu(c.staticUniforms):[],ue=d?d.getBinderUniforms():[],fe=[],Ce=0,Pe=ne.concat(ue);Ce<Pe.length;Ce+=1){var Ue=Pe[Ce];fe.indexOf(Ue)<0&&fe.push(Ue)}var Ae=d?d.defines():[];C&&Ae.push("#define OVERDRAW_INSPECTOR;");var Ze=Ae.concat(go.fragmentSource,c.fragmentSource).join(`
`),Ke=Ae.concat(go.vertexSource,c.vertexSource).join(`
`),mt=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(mt,Ze),M.compileShader(mt),M.attachShader(this.program,mt);var St=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(St,Ke),M.compileShader(St),M.attachShader(this.program,St),this.attributes={};var Zt={};this.numAttributes=H.length;for(var Kt=0;Kt<this.numAttributes;Kt++)H[Kt]&&(M.bindAttribLocation(this.program,Kt,H[Kt]),this.attributes[H[Kt]]=Kt);M.linkProgram(this.program),M.deleteShader(St),M.deleteShader(mt);for(var pr=0;pr<fe.length;pr++){var kr=fe[pr];if(kr&&!Zt[kr]){var Or=M.getUniformLocation(this.program,kr);Or&&(Zt[kr]=Or)}}this.fixedUniforms=b(l,Zt),this.binderUniforms=d?d.getUniforms(l,Zt):[]}}};function nl(l,f,c){var d=1/ta(c,1,f.transform.tileZoom),b=Math.pow(2,c.tileID.overscaledZ),C=c.tileSize*Math.pow(2,f.transform.tileZoom)/b,M=C*(c.tileID.canonical.x+c.tileID.wrap*b),R=C*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[M>>16,R>>16],u_pixel_coord_lower:[65535&M,65535&R]}}Mc.prototype.draw=function(l,f,c,d,b,C,M,R,z,H,ne,ue,fe,Ce,Pe,Ue){var Ae,Ze=l.gl;if(!this.failedToCreate){for(var Ke in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(b),l.setCullFace(C),this.fixedUniforms)this.fixedUniforms[Ke].set(M[Ke]);Ce&&Ce.setUniforms(l,this.binderUniforms,ue,{zoom:fe});for(var mt=(Ae={},Ae[Ze.LINES]=2,Ae[Ze.TRIANGLES]=3,Ae[Ze.LINE_STRIP]=1,Ae)[f],St=0,Zt=ne.get();St<Zt.length;St+=1){var Kt=Zt[St],pr=Kt.vaos||(Kt.vaos={});(pr[R]||(pr[R]=new hu)).bind(l,this,z,Ce?Ce.getPaintVertexBuffers():[],H,Kt.vertexOffset,Pe,Ue),Ze.drawElements(f,Kt.primitiveLength*mt,Ze.UNSIGNED_SHORT,Kt.primitiveOffset*mt*2)}}};var Pc=function(l,f,c,d){var b=f.style.light,C=b.properties.get("position"),M=[C.x,C.y,C.z],R=v.create$1();b.properties.get("anchor")==="viewport"&&v.fromRotation(R,-f.transform.angle),v.transformMat3(M,M,R);var z=b.properties.get("color");return{u_matrix:l,u_lightpos:M,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+c,u_opacity:d}},Mu=function(l,f,c,d,b,C,M){return v.extend(Pc(l,f,c,d),nl(C,f,M),{u_height_factor:-Math.pow(2,b.overscaledZ)/M.tileSize/8})},Pu=function(l){return{u_matrix:l}},Iu=function(l,f,c,d){return v.extend(Pu(l),nl(c,f,d))},io=function(l,f){return{u_matrix:l,u_world:f}},kf=function(l,f,c,d,b){return v.extend(Iu(l,f,c,d),{u_world:b})},Lf=function(l,f,c,d){var b,C,M=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var R=ta(c,1,M.zoom);b=!0,C=[R,R]}else b=!1,C=M.pixelsToGLUnits;return{u_camera_to_center_distance:M.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:C}},_s=function(l,f,c){var d=ta(c,1,f.zoom),b=Math.pow(2,f.zoom-c.tileID.overscaledZ),C=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*b),f.pixelsToGLUnits[1]/(d*b)],u_overscale_factor:C}},Kl=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},pu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Ys=function(l){return{u_matrix:l}},Df=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:ta(f,1,c),u_intensity:d}},il=function(l,f,c){var d=l.transform;return{u_matrix:Ff(l,f,c),u_ratio:1/ta(f,1,d.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},ba=function(l,f,c,d){return v.extend(il(l,f,c),{u_image:0,u_image_height:d})},Jo=function(l,f,c,d){var b=l.transform,C=al(f,b);return{u_matrix:Ff(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/ta(f,1,b.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[C,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},ph=function(l,f,c,d,b){var C=l.lineAtlas,M=al(f,l.transform),R=c.layout.get("line-cap")==="round",z=C.getDash(d.from,R),H=C.getDash(d.to,R),ne=z.width*b.fromScale,ue=H.width*b.toScale;return v.extend(il(l,f,c),{u_patternscale_a:[M/ne,-z.height/2],u_patternscale_b:[M/ue,-H.height/2],u_sdfgamma:C.width/(256*Math.min(ne,ue)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:H.y,u_mix:b.t})};function al(l,f){return 1/ta(l,1,f.tileZoom)}function Ff(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Bf=function(l,f,c,d,b){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(M=b.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(C=b.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:nf(b.paint.get("raster-hue-rotate"))};var C,M};function nf(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var af,Ic=function(l,f,c,d,b,C,M,R,z,H){var ne=b.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ne.cameraToCenterDistance,u_pitch:ne.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ne.width/ne.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:M,u_coord_matrix:R,u_is_text:+z,u_pitch_with_map:+d,u_texsize:H,u_texture:0}},$l=function(l,f,c,d,b,C,M,R,z,H,ne){var ue=b.transform;return v.extend(Ic(l,f,c,d,b,C,M,R,z,H),{u_gamma_scale:d?Math.cos(ue._pitch)*ue.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+ne})},Ql=function(l,f,c,d,b,C,M,R,z,H){return v.extend($l(l,f,c,d,b,C,M,R,!0,z,!0),{u_texsize_icon:H,u_texture_icon:1})},Jl=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},ol=function(l,f,c,d,b,C){return v.extend(function(M,R,z,H){var ne=z.imageManager.getPattern(M.from.toString()),ue=z.imageManager.getPattern(M.to.toString()),fe=z.imageManager.getPixelSize(),Ce=fe.width,Pe=fe.height,Ue=Math.pow(2,H.tileID.overscaledZ),Ae=H.tileSize*Math.pow(2,z.transform.tileZoom)/Ue,Ze=Ae*(H.tileID.canonical.x+H.tileID.wrap*Ue),Ke=Ae*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ne.tl,u_pattern_br_a:ne.br,u_pattern_tl_b:ue.tl,u_pattern_br_b:ue.br,u_texsize:[Ce,Pe],u_mix:R.t,u_pattern_size_a:ne.displaySize,u_pattern_size_b:ue.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/ta(H,1,z.transform.tileZoom),u_pixel_coord_upper:[Ze>>16,Ke>>16],u_pixel_coord_lower:[65535&Ze,65535&Ke]}}(d,C,c,b),{u_matrix:l,u_opacity:f})},Ol={fillExtrusion:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,f.u_height_factor),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new v.UniformColor(l,f.u_color),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_overlay:new v.Uniform1i(l,f.u_overlay),u_overlay_scale:new v.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new v.Uniform1f(l,f.u_extrude_scale),u_intensity:new v.Uniform1f(l,f.u_intensity),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_color_ramp:new v.Uniform1i(l,f.u_color_ramp),u_opacity:new v.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_latrange:new v.Uniform2f(l,f.u_latrange),u_light:new v.Uniform2f(l,f.u_light),u_shadow:new v.UniformColor(l,f.u_shadow),u_highlight:new v.UniformColor(l,f.u_highlight),u_accent:new v.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_dimension:new v.Uniform2f(l,f.u_dimension),u_zoom:new v.Uniform1f(l,f.u_zoom),u_unpack:new v.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_image:new v.Uniform1i(l,f.u_image),u_image_height:new v.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_texsize:new v.Uniform2f(l,f.u_texsize),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_image:new v.Uniform1i(l,f.u_image),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,f.u_sdfgamma),u_image:new v.Uniform1i(l,f.u_image),u_tex_y_a:new v.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,f.u_tex_y_b),u_mix:new v.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new v.Uniform2f(l,f.u_tl_parent),u_scale_parent:new v.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,f.u_buffer_scale),u_fade_t:new v.Uniform1f(l,f.u_fade_t),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image0:new v.Uniform1i(l,f.u_image0),u_image1:new v.Uniform1i(l,f.u_image1),u_brightness_low:new v.Uniform1f(l,f.u_brightness_low),u_brightness_high:new v.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texsize_icon:new v.Uniform2f(l,f.u_texsize_icon),u_texture:new v.Uniform1i(l,f.u_texture),u_texture_icon:new v.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_color:new v.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image:new v.Uniform1i(l,f.u_image),u_pattern_tl_a:new v.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,f.u_pattern_br_b),u_texsize:new v.Uniform2f(l,f.u_texsize),u_mix:new v.Uniform1f(l,f.u_mix),u_pattern_size_a:new v.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,f.u_scale_a),u_scale_b:new v.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,f.u_tile_units_to_pixels)}}};function sl(l,f,c,d,b,C,M){for(var R=l.context,z=R.gl,H=l.useProgram("collisionBox"),ne=[],ue=0,fe=0,Ce=0;Ce<d.length;Ce++){var Pe=d[Ce],Ue=f.getTile(Pe),Ae=Ue.getBucket(c);if(Ae){var Ze=Pe.posMatrix;b[0]===0&&b[1]===0||(Ze=l.translatePosMatrix(Pe.posMatrix,Ue,b,C));var Ke=M?Ae.textCollisionBox:Ae.iconCollisionBox,mt=Ae.collisionCircleArray;if(mt.length>0){var St=v.create(),Zt=Ze;v.mul(St,Ae.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(St,St,Ae.placementViewportMatrix),ne.push({circleArray:mt,circleOffset:fe,transform:Zt,invTransform:St}),fe=ue+=mt.length/4}Ke&&H.draw(R,z.LINES,ye.disabled,ke.disabled,l.colorModeForRenderPass(),Je.disabled,_s(Ze,l.transform,Ue),c.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,null,l.transform.zoom,null,null,Ke.collisionVertexBuffer)}}if(M&&ne.length){var Kt=l.useProgram("collisionCircle"),pr=new v.StructArrayLayout2f1f2i16;pr.resize(4*ue),pr._trim();for(var kr=0,Or=0,tn=ne;Or<tn.length;Or+=1)for(var Ln=tn[Or],Fn=0;Fn<Ln.circleArray.length/4;Fn++){var zn=4*Fn,Ri=Ln.circleArray[zn+0],sn=Ln.circleArray[zn+1],ai=Ln.circleArray[zn+2],fi=Ln.circleArray[zn+3];pr.emplace(kr++,Ri,sn,ai,fi,0),pr.emplace(kr++,Ri,sn,ai,fi,1),pr.emplace(kr++,Ri,sn,ai,fi,2),pr.emplace(kr++,Ri,sn,ai,fi,3)}(!af||af.length<2*ue)&&(af=function(Da){var Bo=2*Da,No=new v.StructArrayLayout3ui6;No.resize(Bo),No._trim();for(var Wa=0;Wa<Bo;Wa++){var so=6*Wa;No.uint16[so+0]=4*Wa+0,No.uint16[so+1]=4*Wa+1,No.uint16[so+2]=4*Wa+2,No.uint16[so+3]=4*Wa+2,No.uint16[so+4]=4*Wa+3,No.uint16[so+5]=4*Wa+0}return No}(ue));for(var ti=R.createIndexBuffer(af,!0),On=R.createVertexBuffer(pr,v.collisionCircleLayout.members,!0),yi=0,Un=ne;yi<Un.length;yi+=1){var jn=Un[yi],eo=Kl(jn.transform,jn.invTransform,l.transform);Kt.draw(R,z.TRIANGLES,ye.disabled,ke.disabled,l.colorModeForRenderPass(),Je.disabled,eo,c.id,On,ti,v.SegmentVector.simpleSegment(0,2*jn.circleOffset,jn.circleArray.length,jn.circleArray.length/2),null,l.transform.zoom,null,null,null)}On.destroy(),ti.destroy()}}var Ds=v.identity(new Float32Array(16));function of(l,f,c,d,b,C){var M=v.getAnchorAlignment(l),R=-(M.horizontalAlign-.5)*f,z=-(M.verticalAlign-.5)*c,H=v.evaluateVariableOffset(l,d);return new v.Point((R/b+H[0])*C,(z/b+H[1])*C)}function sf(l,f,c,d,b,C,M,R,z,H,ne){var ue=l.text.placedSymbolArray,fe=l.text.dynamicLayoutVertexArray,Ce=l.icon.dynamicLayoutVertexArray,Pe={};fe.clear();for(var Ue=0;Ue<ue.length;Ue++){var Ae=ue.get(Ue),Ze=Ae.hidden||!Ae.crossTileID||l.allowVerticalPlacement&&!Ae.placedOrientation?null:d[Ae.crossTileID];if(Ze){var Ke=new v.Point(Ae.anchorX,Ae.anchorY),mt=Jn(Ke,c?R:M),St=Di(C.cameraToCenterDistance,mt.signedDistanceFromCamera),Zt=b.evaluateSizeForFeature(l.textSizeData,H,Ae)*St/v.ONE_EM;c&&(Zt*=l.tilePixelRatio/z);for(var Kt=of(Ze.anchor,Ze.width,Ze.height,Ze.textOffset,Ze.textBoxScale,Zt),pr=c?Jn(Ke.add(Kt),M).point:mt.point.add(f?Kt.rotate(-C.angle):Kt),kr=l.allowVerticalPlacement&&Ae.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Or=0;Or<Ae.numGlyphs;Or++)v.addDynamicAttributes(fe,pr,kr);ne&&Ae.associatedIconIndex>=0&&(Pe[Ae.associatedIconIndex]={shiftedAnchor:pr,angle:kr})}else $a(Ae.numGlyphs,fe)}if(ne){Ce.clear();for(var tn=l.icon.placedSymbolArray,Ln=0;Ln<tn.length;Ln++){var Fn=tn.get(Ln);if(Fn.hidden)$a(Fn.numGlyphs,Ce);else{var zn=Pe[Ln];if(zn)for(var Ri=0;Ri<Fn.numGlyphs;Ri++)v.addDynamicAttributes(Ce,zn.shiftedAnchor,zn.angle);else $a(Fn.numGlyphs,Ce)}}l.icon.dynamicLayoutVertexBuffer.updateData(Ce)}l.text.dynamicLayoutVertexBuffer.updateData(fe)}function Nf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function ul(l,f,c,d,b,C,M,R,z,H,ne,ue){for(var fe=l.context,Ce=fe.gl,Pe=l.transform,Ue=R==="map",Ae=z==="map",Ze=Ue&&c.layout.get("symbol-placement")!=="point",Ke=Ue&&!Ae&&!Ze,mt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,St=!1,Zt=l.depthModeForSublayer(0,ye.ReadOnly),Kt=c.layout.get("text-variable-anchor"),pr=[],kr=0,Or=d;kr<Or.length;kr+=1){var tn=Or[kr],Ln=f.getTile(tn),Fn=Ln.getBucket(c);if(Fn){var zn=b?Fn.text:Fn.icon;if(zn&&zn.segments.get().length){var Ri=zn.programConfigurations.get(c.id),sn=b||Fn.sdfIcons,ai=b?Fn.textSizeData:Fn.iconSizeData,fi=Ae||Pe.pitch!==0,ti=l.useProgram(Nf(sn,b,Fn),Ri),On=v.evaluateSizeForZoom(ai,Pe.zoom),yi=void 0,Un=[0,0],jn=void 0,eo=void 0,Da=null,Bo=void 0;if(b)jn=Ln.glyphAtlasTexture,eo=Ce.LINEAR,yi=Ln.glyphAtlasTexture.size,Fn.iconsInText&&(Un=Ln.imageAtlasTexture.size,Da=Ln.imageAtlasTexture,Bo=fi||l.options.rotating||l.options.zooming||ai.kind==="composite"||ai.kind==="camera"?Ce.LINEAR:Ce.NEAREST);else{var No=c.layout.get("icon-size").constantOr(0)!==1||Fn.iconsNeedLinear;jn=Ln.imageAtlasTexture,eo=sn||l.options.rotating||l.options.zooming||No||fi?Ce.LINEAR:Ce.NEAREST,yi=Ln.imageAtlasTexture.size}var Wa=ta(Ln,1,l.transform.zoom),so=Yt(tn.posMatrix,Ae,Ue,l.transform,Wa),pa=Ki(tn.posMatrix,Ae,Ue,l.transform,Wa),na=Kt&&Fn.hasTextData(),Js=c.layout.get("icon-text-fit")!=="none"&&na&&Fn.hasIconData();Ze&&bn(Fn,tn.posMatrix,l,b,so,pa,Ae,H);var ts=l.translatePosMatrix(tn.posMatrix,Ln,C,M),ls=Ze||b&&Kt||Js?Ds:so,su=l.translatePosMatrix(pa,Ln,C,M,!0),Fc=sn&&c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0,fc={program:ti,buffers:zn,uniformValues:sn?Fn.iconsInText?Ql(ai.kind,On,Ke,Ae,l,ts,ls,su,yi,Un):$l(ai.kind,On,Ke,Ae,l,ts,ls,su,b,yi,!0):Ic(ai.kind,On,Ke,Ae,l,ts,ls,su,b,yi),atlasTexture:jn,atlasTextureIcon:Da,atlasInterpolation:eo,atlasInterpolationIcon:Bo,isSDF:sn,hasHalo:Fc};if(mt&&Fn.canOverlap){St=!0;for(var Yu=0,yl=zn.segments.get();Yu<yl.length;Yu+=1){var bs=yl[Yu];pr.push({segments:new v.SegmentVector([bs]),sortKey:bs.sortKey,state:fc})}}else pr.push({segments:zn.segments,sortKey:0,state:fc})}}}St&&pr.sort(function(lu,Du){return lu.sortKey-Du.sortKey});for(var gu=0,hc=pr;gu<hc.length;gu+=1){var Lu=hc[gu],Na=Lu.state;if(fe.activeTexture.set(Ce.TEXTURE0),Na.atlasTexture.bind(Na.atlasInterpolation,Ce.CLAMP_TO_EDGE),Na.atlasTextureIcon&&(fe.activeTexture.set(Ce.TEXTURE1),Na.atlasTextureIcon&&Na.atlasTextureIcon.bind(Na.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE)),Na.isSDF){var uu=Na.uniformValues;Na.hasHalo&&(uu.u_is_halo=1,Ou(Na.buffers,Lu.segments,c,l,Na.program,Zt,ne,ue,uu)),uu.u_is_halo=0}Ou(Na.buffers,Lu.segments,c,l,Na.program,Zt,ne,ue,Na.uniformValues)}}function Ou(l,f,c,d,b,C,M,R,z){var H=d.context;b.draw(H,H.gl.TRIANGLES,C,M,R,Je.disabled,z,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Oc(l,f,c,d,b,C,M){var R,z,H,ne,ue,fe=l.context.gl,Ce=c.paint.get("fill-pattern"),Pe=Ce&&Ce.constantOr(1),Ue=c.getCrossfadeParameters();M?(z=Pe&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=fe.LINES):(z=Pe?"fillPattern":"fill",R=fe.TRIANGLES);for(var Ae=0,Ze=d;Ae<Ze.length;Ae+=1){var Ke=Ze[Ae],mt=f.getTile(Ke);if(!Pe||mt.patternsLoaded()){var St=mt.getBucket(c);if(St){var Zt=St.programConfigurations.get(c.id),Kt=l.useProgram(z,Zt);Pe&&(l.context.activeTexture.set(fe.TEXTURE0),mt.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),Zt.updatePaintBuffers(Ue));var pr=Ce.constantOr(null);if(pr&&mt.imageAtlas){var kr=mt.imageAtlas,Or=kr.patternPositions[pr.to.toString()],tn=kr.patternPositions[pr.from.toString()];Or&&tn&&Zt.setConstantPatternPositions(Or,tn)}var Ln=l.translatePosMatrix(Ke.posMatrix,mt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(M){ne=St.indexBuffer2,ue=St.segments2;var Fn=[fe.drawingBufferWidth,fe.drawingBufferHeight];H=z==="fillOutlinePattern"&&Pe?kf(Ln,l,Ue,mt,Fn):io(Ln,Fn)}else ne=St.indexBuffer,ue=St.segments,H=Pe?Iu(Ln,l,Ue,mt):Pu(Ln);Kt.draw(l.context,R,b,l.stencilModeForClipping(Ke),C,Je.disabled,H,c.id,St.layoutVertexBuffer,ne,ue,c.paint,l.transform.zoom,Zt)}}}}function uf(l,f,c,d,b,C,M){for(var R=l.context,z=R.gl,H=c.paint.get("fill-extrusion-pattern"),ne=H.constantOr(1),ue=c.getCrossfadeParameters(),fe=c.paint.get("fill-extrusion-opacity"),Ce=0,Pe=d;Ce<Pe.length;Ce+=1){var Ue=Pe[Ce],Ae=f.getTile(Ue),Ze=Ae.getBucket(c);if(Ze){var Ke=Ze.programConfigurations.get(c.id),mt=l.useProgram(ne?"fillExtrusionPattern":"fillExtrusion",Ke);ne&&(l.context.activeTexture.set(z.TEXTURE0),Ae.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ke.updatePaintBuffers(ue));var St=H.constantOr(null);if(St&&Ae.imageAtlas){var Zt=Ae.imageAtlas,Kt=Zt.patternPositions[St.to.toString()],pr=Zt.patternPositions[St.from.toString()];Kt&&pr&&Ke.setConstantPatternPositions(Kt,pr)}var kr=l.translatePosMatrix(Ue.posMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Or=c.paint.get("fill-extrusion-vertical-gradient"),tn=ne?Mu(kr,l,Or,fe,Ue,ue,Ae):Pc(kr,l,Or,fe);mt.draw(R,R.gl.TRIANGLES,b,C,M,Je.backCCW,tn,c.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,c.paint,l.transform.zoom,Ke)}}}function Rc(l,f,c,d,b,C){var M=l.context,R=M.gl,z=f.fbo;if(z){var H=l.useProgram("hillshade");M.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get());var ne=function(ue,fe,Ce){var Pe=Ce.paint.get("hillshade-shadow-color"),Ue=Ce.paint.get("hillshade-highlight-color"),Ae=Ce.paint.get("hillshade-accent-color"),Ze=Ce.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ce.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ze-=ue.transform.angle);var Ke,mt,St,Zt=!ue.options.moving;return{u_matrix:ue.transform.calculatePosMatrix(fe.tileID.toUnwrapped(),Zt),u_image:0,u_latrange:(Ke=fe.tileID,mt=Math.pow(2,Ke.canonical.z),St=Ke.canonical.y,[new v.MercatorCoordinate(0,St/mt).toLngLat().lat,new v.MercatorCoordinate(0,(St+1)/mt).toLngLat().lat]),u_light:[Ce.paint.get("hillshade-exaggeration"),Ze],u_shadow:Pe,u_highlight:Ue,u_accent:Ae}}(l,f,c);H.draw(M,R.TRIANGLES,d,b,C,Je.disabled,ne,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function lf(l,f,c,d,b,C){var M=l.context,R=M.gl,z=f.dem;if(z&&z.data){var H=z.dim,ne=z.stride,ue=z.getPixels();if(M.activeTexture.set(R.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ne),f.demTexture){var fe=f.demTexture;fe.update(ue,{premultiply:!1}),fe.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(M,ue,R.RGBA,{premultiply:!1}),f.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);M.activeTexture.set(R.TEXTURE0);var Ce=f.fbo;if(!Ce){var Pe=new v.Texture(M,{width:H,height:H,data:null},R.RGBA);Pe.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Ce=f.fbo=M.createFramebuffer(H,H,!0)).colorAttachment.set(Pe.texture)}M.bindFramebuffer.set(Ce.framebuffer),M.viewport.set([0,0,H,H]),l.useProgram("hillshadePrepare").draw(M,R.TRIANGLES,d,b,C,Je.disabled,function(Ue,Ae){var Ze=Ae.stride,Ke=v.create();return v.ortho(Ke,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(Ke,Ke,[0,-v.EXTENT,0]),{u_matrix:Ke,u_image:1,u_dimension:[Ze,Ze],u_zoom:Ue.overscaledZ,u_unpack:Ae.getUnpackVector()}}(f.tileID,z),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function cf(l,f,c,d,b){var C=d.paint.get("raster-fade-duration");if(C>0){var M=v.browser.now(),R=(M-l.timeAdded)/C,z=f?(M-f.timeAdded)/C:-1,H=c.getSource(),ne=b.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ue=!f||Math.abs(f.tileID.overscaledZ-ne)>Math.abs(l.tileID.overscaledZ-ne),fe=ue&&l.refreshedUponExpiration?1:v.clamp(ue?R:1-z,0,1);return l.refreshedUponExpiration&&R>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}var Rl=new v.Color(1,0,0,1),zf=new v.Color(0,1,0,1),ff=new v.Color(0,0,1,1),ll=new v.Color(1,0,1,1),dh=new v.Color(0,1,1,1);function kc(l,f,c,d){ec(l,0,f+c/2,l.transform.width,c,d)}function vh(l,f,c,d){ec(l,f-c/2,0,c,l.transform.height,d)}function ec(l,f,c,d,b,C){var M=l.context,R=M.gl;R.enable(R.SCISSOR_TEST),R.scissor(f*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,d*v.browser.devicePixelRatio,b*v.browser.devicePixelRatio),M.clear({color:C}),R.disable(R.SCISSOR_TEST)}function np(l,f,c){var d=l.context,b=d.gl,C=c.posMatrix,M=l.useProgram("debug"),R=ye.disabled,z=ke.disabled,H=l.colorModeForRenderPass();d.activeTexture.set(b.TEXTURE0),l.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),M.draw(d,b.LINE_STRIP,R,z,H,Je.disabled,pu(C,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ne=f.getTileByID(c.key).latestRawTileData,ue=Math.floor((ne&&ne.byteLength||0)/1024),fe=f.getTile(c).tileSize,Ce=512/Math.min(fe,512)*(c.overscaledZ/l.transform.zoom)*.5,Pe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Pe+=" => "+c.overscaledZ),function(Ue,Ae){Ue.initDebugOverlayCanvas();var Ze=Ue.debugOverlayCanvas,Ke=Ue.context.gl,mt=Ue.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,Ze.width,Ze.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(Ae,5,5),mt.strokeText(Ae,5,5),Ue.debugOverlayTexture.update(Ze),Ue.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(l,Pe+" "+ue+"kb"),M.draw(d,b.TRIANGLES,R,z,je.alphaBlended,Je.disabled,pu(C,v.Color.transparent,Ce),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var kl={symbol:function(l,f,c,d,b){if(l.renderPass==="translucent"){var C=ke.disabled,M=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(R,z,H,ne,ue,fe,Ce){for(var Pe=z.transform,Ue=ue==="map",Ae=fe==="map",Ze=0,Ke=R;Ze<Ke.length;Ze+=1){var mt=Ke[Ze],St=ne.getTile(mt),Zt=St.getBucket(H);if(Zt&&Zt.text&&Zt.text.segments.get().length){var Kt=v.evaluateSizeForZoom(Zt.textSizeData,Pe.zoom),pr=ta(St,1,z.transform.zoom),kr=Yt(mt.posMatrix,Ae,Ue,z.transform,pr),Or=H.layout.get("icon-text-fit")!=="none"&&Zt.hasIconData();if(Kt){var tn=Math.pow(2,Pe.zoom-St.tileID.overscaledZ);sf(Zt,Ue,Ae,Ce,v.symbolSize,Pe,kr,mt.posMatrix,tn,Kt,Or)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),c.paint.get("icon-opacity").constantOr(1)!==0&&ul(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),C,M),c.paint.get("text-opacity").constantOr(1)!==0&&ul(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),C,M),f.map.showCollisionBoxes&&(sl(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),sl(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var b=c.paint.get("circle-opacity"),C=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),R=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)!==0||C.constantOr(1)!==0&&M.constantOr(1)!==0){for(var z=l.context,H=z.gl,ne=l.depthModeForSublayer(0,ye.ReadOnly),ue=ke.disabled,fe=l.colorModeForRenderPass(),Ce=[],Pe=0;Pe<d.length;Pe++){var Ue=d[Pe],Ae=f.getTile(Ue),Ze=Ae.getBucket(c);if(Ze){var Ke=Ze.programConfigurations.get(c.id),mt={programConfiguration:Ke,program:l.useProgram("circle",Ke),layoutVertexBuffer:Ze.layoutVertexBuffer,indexBuffer:Ze.indexBuffer,uniformValues:Lf(l,Ue,Ae,c)};if(R)for(var St=0,Zt=Ze.segments.get();St<Zt.length;St+=1){var Kt=Zt[St];Ce.push({segments:new v.SegmentVector([Kt]),sortKey:Kt.sortKey,state:mt})}else Ce.push({segments:Ze.segments,sortKey:0,state:mt})}}R&&Ce.sort(function(Ln,Fn){return Ln.sortKey-Fn.sortKey});for(var pr=0,kr=Ce;pr<kr.length;pr+=1){var Or=kr[pr],tn=Or.state;tn.program.draw(z,H.TRIANGLES,ne,ue,fe,Je.disabled,tn.uniformValues,c.id,tn.layoutVertexBuffer,tn.indexBuffer,Or.segments,c.paint,l.transform.zoom,tn.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var b=l.context,C=b.gl,M=ke.disabled,R=new je([C.ONE,C.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Ce,Pe,Ue){var Ae=Ce.gl;Ce.activeTexture.set(Ae.TEXTURE1),Ce.viewport.set([0,0,Pe.width/4,Pe.height/4]);var Ze=Ue.heatmapFbo;if(Ze)Ae.bindTexture(Ae.TEXTURE_2D,Ze.colorAttachment.get()),Ce.bindFramebuffer.set(Ze.framebuffer);else{var Ke=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,Ke),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),Ze=Ue.heatmapFbo=Ce.createFramebuffer(Pe.width/4,Pe.height/4,!1),function(mt,St,Zt,Kt){var pr=mt.gl;pr.texImage2D(pr.TEXTURE_2D,0,pr.RGBA,St.width/4,St.height/4,0,pr.RGBA,mt.extRenderToTextureHalfFloat?mt.extTextureHalfFloat.HALF_FLOAT_OES:pr.UNSIGNED_BYTE,null),Kt.colorAttachment.set(Zt)}(Ce,Pe,Ke,Ze)}})(b,l,c),b.clear({color:v.Color.transparent});for(var z=0;z<d.length;z++){var H=d[z];if(!f.hasRenderableParent(H)){var ne=f.getTile(H),ue=ne.getBucket(c);if(ue){var fe=ue.programConfigurations.get(c.id);l.useProgram("heatmap",fe).draw(b,C.TRIANGLES,ye.disabled,M,R,Je.disabled,Df(H.posMatrix,ne,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,c.paint,l.transform.zoom,fe)}}}b.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Ce,Pe){var Ue=Ce.context,Ae=Ue.gl,Ze=Pe.heatmapFbo;if(Ze){Ue.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,Ze.colorAttachment.get()),Ue.activeTexture.set(Ae.TEXTURE1);var Ke=Pe.colorRampTexture;Ke||(Ke=Pe.colorRampTexture=new v.Texture(Ue,Pe.colorRamp,Ae.RGBA)),Ke.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Ce.useProgram("heatmapTexture").draw(Ue,Ae.TRIANGLES,ye.disabled,ke.disabled,Ce.colorModeForRenderPass(),Je.disabled,function(mt,St,Zt,Kt){var pr=v.create();v.ortho(pr,0,mt.width,mt.height,0,0,1);var kr=mt.context.gl;return{u_matrix:pr,u_world:[kr.drawingBufferWidth,kr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:St.paint.get("heatmap-opacity")}}(Ce,Pe),Pe.id,Ce.viewportBuffer,Ce.quadTriangleIndexBuffer,Ce.viewportSegments,Pe.paint,Ce.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var b=c.paint.get("line-opacity"),C=c.paint.get("line-width");if(b.constantOr(1)!==0&&C.constantOr(1)!==0)for(var M=l.depthModeForSublayer(0,ye.ReadOnly),R=l.colorModeForRenderPass(),z=c.paint.get("line-dasharray"),H=c.paint.get("line-pattern"),ne=H.constantOr(1),ue=c.paint.get("line-gradient"),fe=c.getCrossfadeParameters(),Ce=ne?"linePattern":z?"lineSDF":ue?"lineGradient":"line",Pe=l.context,Ue=Pe.gl,Ae=!0,Ze=0,Ke=d;Ze<Ke.length;Ze+=1){var mt=Ke[Ze],St=f.getTile(mt);if(!ne||St.patternsLoaded()){var Zt=St.getBucket(c);if(Zt){var Kt=Zt.programConfigurations.get(c.id),pr=l.context.program.get(),kr=l.useProgram(Ce,Kt),Or=Ae||kr.program!==pr,tn=H.constantOr(null);if(tn&&St.imageAtlas){var Ln=St.imageAtlas,Fn=Ln.patternPositions[tn.to.toString()],zn=Ln.patternPositions[tn.from.toString()];Fn&&zn&&Kt.setConstantPatternPositions(Fn,zn)}var Ri=ne?Jo(l,St,c,fe):z?ph(l,St,c,z,fe):ue?ba(l,St,c,Zt.lineClipsArray.length):il(l,St,c);if(ne)Pe.activeTexture.set(Ue.TEXTURE0),St.imageAtlasTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE),Kt.updatePaintBuffers(fe);else if(z&&(Or||l.lineAtlas.dirty))Pe.activeTexture.set(Ue.TEXTURE0),l.lineAtlas.bind(Pe);else if(ue){var sn=Zt.gradients[c.id],ai=sn.texture;if(c.gradientVersion!==sn.version){var fi=256;if(c.stepInterpolant){var ti=f.getSource().maxzoom,On=mt.canonical.z===ti?Math.ceil(1<<l.transform.maxZoom-mt.canonical.z):1;fi=v.clamp(v.nextPowerOfTwo(Zt.maxLineLength/v.EXTENT*1024*On),256,Pe.maxTextureSize)}sn.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:fi,image:sn.gradient||void 0,clips:Zt.lineClipsArray}),sn.texture?sn.texture.update(sn.gradient):sn.texture=new v.Texture(Pe,sn.gradient,Ue.RGBA),sn.version=c.gradientVersion,ai=sn.texture}Pe.activeTexture.set(Ue.TEXTURE0),ai.bind(c.stepInterpolant?Ue.NEAREST:Ue.LINEAR,Ue.CLAMP_TO_EDGE)}kr.draw(Pe,Ue.TRIANGLES,M,l.stencilModeForClipping(mt),R,Je.disabled,Ri,c.id,Zt.layoutVertexBuffer,Zt.indexBuffer,Zt.segments,c.paint,l.transform.zoom,Kt,Zt.layoutVertexBuffer2),Ae=!1}}}}},fill:function(l,f,c,d){var b=c.paint.get("fill-color"),C=c.paint.get("fill-opacity");if(C.constantOr(1)!==0){var M=l.colorModeForRenderPass(),R=c.paint.get("fill-pattern"),z=l.opaquePassEnabledForLayer()&&!R.constantOr(1)&&b.constantOr(v.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===z){var H=l.depthModeForSublayer(1,l.renderPass==="opaque"?ye.ReadWrite:ye.ReadOnly);Oc(l,f,c,d,H,M,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ne=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ye.ReadOnly);Oc(l,f,c,d,ne,M,!0)}}},"fill-extrusion":function(l,f,c,d){var b=c.paint.get("fill-extrusion-opacity");if(b!==0&&l.renderPass==="translucent"){var C=new ye(l.context.gl.LEQUAL,ye.ReadWrite,l.depthRangeFor3D);if(b!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))uf(l,f,c,d,C,ke.disabled,je.disabled),uf(l,f,c,d,C,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var M=l.colorModeForRenderPass();uf(l,f,c,d,C,ke.disabled,M)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var b=l.context,C=l.depthModeForSublayer(0,ye.ReadOnly),M=l.colorModeForRenderPass(),R=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],z=R[0],H=0,ne=R[1];H<ne.length;H+=1){var ue=ne[H],fe=f.getTile(ue);fe.needsHillshadePrepare&&l.renderPass==="offscreen"?lf(l,fe,c,C,ke.disabled,M):l.renderPass==="translucent"&&Rc(l,fe,c,C,z[ue.overscaledZ],M)}b.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var b=l.context,C=b.gl,M=f.getSource(),R=l.useProgram("raster"),z=l.colorModeForRenderPass(),H=M instanceof dt?[{},d]:l.stencilConfigForOverlap(d),ne=H[0],ue=H[1],fe=ue[ue.length-1].overscaledZ,Ce=!l.options.moving,Pe=0,Ue=ue;Pe<Ue.length;Pe+=1){var Ae=Ue[Pe],Ze=l.depthModeForSublayer(Ae.overscaledZ-fe,c.paint.get("raster-opacity")===1?ye.ReadWrite:ye.ReadOnly,C.LESS),Ke=f.getTile(Ae),mt=l.transform.calculatePosMatrix(Ae.toUnwrapped(),Ce);Ke.registerFadeDuration(c.paint.get("raster-fade-duration"));var St=f.findLoadedParent(Ae,0),Zt=cf(Ke,St,f,c,l.transform),Kt=void 0,pr=void 0,kr=c.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;b.activeTexture.set(C.TEXTURE0),Ke.texture.bind(kr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(C.TEXTURE1),St?(St.texture.bind(kr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),Kt=Math.pow(2,St.tileID.overscaledZ-Ke.tileID.overscaledZ),pr=[Ke.tileID.canonical.x*Kt%1,Ke.tileID.canonical.y*Kt%1]):Ke.texture.bind(kr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Or=Bf(mt,pr||[0,0],Kt||1,Zt,c);M instanceof dt?R.draw(b,C.TRIANGLES,Ze,ke.disabled,z,Je.disabled,Or,c.id,M.boundsBuffer,l.quadTriangleIndexBuffer,M.boundsSegments):R.draw(b,C.TRIANGLES,Ze,ne[Ae.overscaledZ],z,Je.disabled,Or,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b!==0){var C=l.context,M=C.gl,R=l.transform,z=R.tileSize,H=c.paint.get("background-pattern");if(!l.isPatternMissing(H)){var ne=!H&&d.a===1&&b===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ne){var ue=ke.disabled,fe=l.depthModeForSublayer(0,ne==="opaque"?ye.ReadWrite:ye.ReadOnly),Ce=l.colorModeForRenderPass(),Pe=l.useProgram(H?"backgroundPattern":"background"),Ue=R.coveringTiles({tileSize:z});H&&(C.activeTexture.set(M.TEXTURE0),l.imageManager.bind(l.context));for(var Ae=c.getCrossfadeParameters(),Ze=0,Ke=Ue;Ze<Ke.length;Ze+=1){var mt=Ke[Ze],St=l.transform.calculatePosMatrix(mt.toUnwrapped()),Zt=H?ol(St,b,l,H,{tileID:mt,tileSize:z},Ae):Jl(St,b,d);Pe.draw(C,M.TRIANGLES,fe,ue,Ce,Je.disabled,Zt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)np(l,f,c[d])},custom:function(l,f,c){var d=l.context,b=c.implementation;if(l.renderPass==="offscreen"){var C=b.prerender;C&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),C.call(b,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(ke.disabled);var M=b.renderingMode==="3d"?new ye(l.context.gl.LEQUAL,ye.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ye.ReadOnly);d.setDepthMode(M),b.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Ba=function(l,f){this.context=new le(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=De.maxUnderzooming+De.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ao,this.gpuTimers={}};Ba.prototype.resize=function(l,f){if(this.width=l*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Ba.prototype.setup=function(){var l=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,va.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,va.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var d=new v.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(v.EXTENT,0,v.EXTENT,0),d.emplaceBack(0,v.EXTENT,0,v.EXTENT),d.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,Et.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var b=new v.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,va.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var C=new v.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(C);var M=new v.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(M),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new ke({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},Ba.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,ye.disabled,this.stencilClearMode,je.disabled,Je.disabled,Ys(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ba.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(je.disabled),c.setDepthMode(ye.disabled);var b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,M=f;C<M.length;C+=1){var R=M[C],z=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;b.draw(c,d.TRIANGLES,ye.disabled,new ke({func:d.ALWAYS,mask:0},z,255,d.KEEP,d.KEEP,d.REPLACE),je.disabled,Je.disabled,Ys(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ba.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new ke({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Ba.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new ke({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Ba.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(z,H){return H.overscaledZ-z.overscaledZ}),b=d[d.length-1].overscaledZ,C=d[0].overscaledZ-b+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var M={},R=0;R<C;R++)M[R+b]=new ke({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=C,[M,d]}return[(f={},f[b]=ke.disabled,f),d]},Ba.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new je([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?je.unblended:je.alphaBlended},Ba.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return ye.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ye(c||this.context.gl.LEQUAL,f,[d,d])},Ba.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ba.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var d=this.style._order,b=this.style.sourceCaches;for(var C in b){var M=b[C];M.used&&M.prepare(this.context)}var R,z,H={},ne={},ue={};for(var fe in b){var Ce=b[fe];H[fe]=Ce.getVisibleCoordinates(),ne[fe]=H[fe].slice().reverse(),ue[fe]=Ce.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Pe=0;Pe<d.length;Pe++)if(this.style._layers[d[Pe]].is3D()){this.opaquePassCutoff=Pe;break}this.renderPass="offscreen";for(var Ue=0,Ae=d;Ue<Ae.length;Ue+=1){var Ze=this.style._layers[Ae[Ue]];if(Ze.hasOffscreenPass()&&!Ze.isHidden(this.transform.zoom)){var Ke=ne[Ze.source];(Ze.type==="custom"||Ke.length)&&this.renderLayer(this,b[Ze.source],Ze,Ke)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var mt=this.style._layers[d[this.currentLayer]],St=b[mt.source],Zt=H[mt.source];this._renderTileClippingMasks(mt,Zt),this.renderLayer(this,St,mt,Zt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Kt=this.style._layers[d[this.currentLayer]],pr=b[Kt.source],kr=(Kt.type==="symbol"?ue:ne)[Kt.source];this._renderTileClippingMasks(Kt,H[Kt.source]),this.renderLayer(this,pr,Kt,kr)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Or){Or.source&&!Or.isHidden(c.transform.zoom)&&(Or.source!==(z&&z.id)&&(z=c.style.sourceCaches[Or.source]),(!R||R.getSource().maxzoom<z.getSource().maxzoom)&&(R=z))}),R&&kl.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Or){var tn=Or.transform.padding;kc(Or,Or.transform.height-(tn.top||0),3,Rl),kc(Or,tn.bottom||0,3,zf),vh(Or,tn.left||0,3,ff),vh(Or,Or.transform.width-(tn.right||0),3,ll);var Ln=Or.transform.centerPoint;(function(Fn,zn,Ri,sn){ec(Fn,zn-1,Ri-10,2,20,sn),ec(Fn,zn-10,Ri-1,20,2,sn)})(Or,Ln.x,Or.transform.height-Ln.y,dh)}(this),this.context.setDefault()},Ba.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),kl[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ba.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Ba.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ba.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ba.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],b=this.context.extTimerQuery,C=b.getQueryObjectEXT(d.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(d.query),f[c]=C}return f},Ba.prototype.translatePosMatrix=function(l,f,c,d,b){if(!c[0]&&!c[1])return l;var C=b?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(C){var M=Math.sin(C),R=Math.cos(C);c=[c[0]*R-c[1]*M,c[0]*M+c[1]*R]}var z=[b?c[0]:ta(f,c[0],this.transform.zoom),b?c[1]:ta(f,c[1],this.transform.zoom),0],H=new Float32Array(16);return v.translate(H,l,z),H},Ba.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Ba.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Ba.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Ba.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new Mc(this.context,l,ys[l],f,Ol[l],this._showOverdrawInspector)),this.cache[c]},Ba.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ba.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ba.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ba.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var es=function(l,f){this.points=l,this.planes=f};es.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return v.transformMat4([],M,l)}).map(function(M){return v.scale$1([],M,1/M[3]/f*d)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var R=v.sub([],b[M[0]],b[M[1]]),z=v.sub([],b[M[2]],b[M[1]]),H=v.normalize([],v.cross([],R,z)),ne=-v.dot(H,b[M[1]]);return H.concat(ne)});return new es(b,C)};var Ll=function(l,f){this.min=l,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Ll.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=v.clone$2(this.min),d=v.clone$2(this.max),b=0;b<f.length;b++)c[b]=f[b]?this.min[b]:this.center[b],d[b]=f[b]?this.center[b]:this.max[b];return d[2]=this.max[2],new Ll(c,d)},Ll.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Ll.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Ll.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var b=l.planes[d],C=0,M=0;M<f.length;M++)C+=v.dot$1(b,f[M])>=0;if(C===0)return 0;C!==f.length&&(c=!1)}if(c)return 2;for(var R=0;R<3;R++){for(var z=Number.MAX_VALUE,H=-Number.MAX_VALUE,ne=0;ne<l.points.length;ne++){var ue=l.points[ne][R]-this.min[R];z=Math.min(z,ue),H=Math.max(H,ue)}if(H<0||z>this.max[R]-this.min[R])return 0}return 1};var Xi=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};Xi.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=v.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=v.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=v.number(l.right,f.right,c)),this},Xi.prototype.getCenter=function(l,f){var c=v.clamp((this.left+l-this.right)/2,0,l),d=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(c,d)},Xi.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Xi.prototype.clone=function(){return new Xi(this.top,this.bottom,this.left,this.right)},Xi.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Vi=function(l,f,c,d,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||b,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Xi,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ta={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Vi.prototype.clone=function(){var l=new Vi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ta.minZoom.get=function(){return this._minZoom},Ta.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ta.maxZoom.get=function(){return this._maxZoom},Ta.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ta.minPitch.get=function(){return this._minPitch},Ta.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ta.maxPitch.get=function(){return this._maxPitch},Ta.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ta.renderWorldCopies.get=function(){return this._renderWorldCopies},Ta.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ta.worldSize.get=function(){return this.tileSize*this.scale},Ta.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ta.size.get=function(){return new v.Point(this.width,this.height)},Ta.bearing.get=function(){return-this.angle/Math.PI*180},Ta.bearing.set=function(l){var f=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ta.pitch.get=function(){return this._pitch/Math.PI*180},Ta.pitch.set=function(l){var f=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Ta.fov.get=function(){return this._fov/Math.PI*180},Ta.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ta.zoom.get=function(){return this._zoom},Ta.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Ta.center.get=function(){return this._center},Ta.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ta.padding.get=function(){return this._edgeInsets.toJSON()},Ta.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ta.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Vi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Vi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Vi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Vi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),d=this.pointCoordinate(new v.Point(this.width,0)),b=this.pointCoordinate(new v.Point(this.width,this.height)),C=this.pointCoordinate(new v.Point(0,this.height)),M=Math.floor(Math.min(c.x,d.x,b.x,C.x)),R=Math.floor(Math.max(c.x,d.x,b.x,C.x)),z=M-1;z<=R+1;z++)z!==0&&f.push(new v.UnwrappedTileID(z,l));return f},Vi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=v.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,f),C=[b*d.x,b*d.y,0],M=es.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),R=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=f);var z=function(Or){return{aabb:new Ll([Or*b,0,0],[(Or+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Or,fullyVisible:!1}},H=[],ne=[],ue=f,fe=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Ce=1;Ce<=3;Ce++)H.push(z(-Ce)),H.push(z(Ce));for(H.push(z(0));H.length>0;){var Pe=H.pop(),Ue=Pe.x,Ae=Pe.y,Ze=Pe.fullyVisible;if(!Ze){var Ke=Pe.aabb.intersects(M);if(Ke===0)continue;Ze=Ke===2}var mt=Pe.aabb.distanceX(C),St=Pe.aabb.distanceY(C),Zt=Math.max(Math.abs(mt),Math.abs(St));if(Pe.zoom===ue||Zt>3+(1<<ue-Pe.zoom)-2&&Pe.zoom>=R)ne.push({tileID:new v.OverscaledTileID(Pe.zoom===ue?fe:Pe.zoom,Pe.wrap,Pe.zoom,Ue,Ae),distanceSq:v.sqrLen([C[0]-.5-Ue,C[1]-.5-Ae])});else for(var Kt=0;Kt<4;Kt++){var pr=(Ue<<1)+Kt%2,kr=(Ae<<1)+(Kt>>1);H.push({aabb:Pe.aabb.quadrant(Kt),zoom:Pe.zoom+1,x:pr,y:kr,wrap:Pe.wrap,fullyVisible:Ze})}}return ne.sort(function(Or,tn){return Or.distanceSq-tn.distanceSq}).map(function(Or){return Or.tileID})},Vi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Ta.unmodified.get=function(){return this._unmodified},Vi.prototype.zoomScale=function(l){return Math.pow(2,l)},Vi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Vi.prototype.project=function(l){var f=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},Vi.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ta.point.get=function(){return this.project(this.center)},Vi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(l),C=new v.MercatorCoordinate(b.x-(c.x-d.x),b.y-(c.y-d.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},Vi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Vi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Vi.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},Vi.prototype.coordinateLocation=function(l){return l.toLngLat()},Vi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],b=c[3],C=f[1]/d,M=c[1]/b,R=f[2]/d,z=c[2]/b,H=R===z?0:(0-R)/(z-R);return new v.MercatorCoordinate(v.number(f[0]/d,c[0]/b,H)/this.worldSize,v.number(C,M,H)/this.worldSize)},Vi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},Vi.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Vi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Vi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Vi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var b=l.canonical,C=this.worldSize/this.zoomScale(b.z),M=b.x+Math.pow(2,b.z)*l.wrap,R=v.identity(new Float64Array(16));return v.translate(R,R,[M*C,b.y*C,0]),v.scale(R,R,[C/v.EXTENT,C/v.EXTENT,1]),v.multiply(R,f?this.alignedProjMatrix:this.projMatrix,R),d[c]=new Float32Array(R),d[c]},Vi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Vi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,b=-90,C=90,M=-180,R=180,z=this.size,H=this._unmodified;if(this.latRange){var ne=this.latRange;b=v.mercatorYfromLat(ne[1])*this.worldSize,l=(C=v.mercatorYfromLat(ne[0])*this.worldSize)-b<z.y?z.y/(C-b):0}if(this.lngRange){var ue=this.lngRange;M=v.mercatorXfromLng(ue[0])*this.worldSize,f=(R=v.mercatorXfromLng(ue[1])*this.worldSize)-M<z.x?z.x/(R-M):0}var fe=this.point,Ce=Math.max(f||0,l||0);if(Ce)return this.center=this.unproject(new v.Point(f?(R+M)/2:fe.x,l?(C+b)/2:fe.y)),this.zoom+=this.scaleZoom(Ce),this._unmodified=H,void(this._constraining=!1);if(this.latRange){var Pe=fe.y,Ue=z.y/2;Pe-Ue<b&&(d=b+Ue),Pe+Ue>C&&(d=C-Ue)}if(this.lngRange){var Ae=fe.x,Ze=z.x/2;Ae-Ze<M&&(c=M+Ze),Ae+Ze>R&&(c=R-Ze)}c===void 0&&d===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:fe.x,d!==void 0?d:fe.y))),this._unmodified=H,this._constraining=!1}},Vi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-c,.01,Math.PI-.01)),b=this.point,C=b.x,M=b.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),z=this.height/50,H=new Float64Array(16);v.perspective(H,this._fov,this.width/this.height,z,R),H[8]=2*-l.x/this.width,H[9]=2*l.y/this.height,v.scale(H,H,[1,-1,1]),v.translate(H,H,[0,0,-this.cameraToCenterDistance]),v.rotateX(H,H,this._pitch),v.rotateZ(H,H,this.angle),v.translate(H,H,[-C,-M,0]),this.mercatorMatrix=v.scale([],H,[this.worldSize,this.worldSize,this.worldSize]),v.scale(H,H,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=H,this.invProjMatrix=v.invert([],this.projMatrix);var ne=this.width%2/2,ue=this.height%2/2,fe=Math.cos(this.angle),Ce=Math.sin(this.angle),Pe=C-Math.round(C)+fe*ne+Ce*ue,Ue=M-Math.round(M)+fe*ue+Ce*ne,Ae=new Float64Array(H);if(v.translate(Ae,Ae,[Pe>.5?Pe-1:Pe,Ue>.5?Ue-1:Ue,0]),this.alignedProjMatrix=Ae,H=v.create(),v.scale(H,H,[this.width/2,-this.height/2,1]),v.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=v.create(),v.scale(H,H,[1,-1,1]),v.translate(H,H,[-1,-1,0]),v.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(H=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=H,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Vi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Vi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},Vi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,b=f.x,C=f.y,M=0,R=l;M<R.length;M+=1){var z=R[M];c=Math.min(c,z.x),d=Math.min(d,z.y),b=Math.max(b,z.x),C=Math.max(C,z.y)}return[new v.Point(c,d),new v.Point(b,d),new v.Point(b,C),new v.Point(c,C),new v.Point(c,d)]},Object.defineProperties(Vi.prototype,Ta);var Is=function(l){var f,c,d,b;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,b=function(){d=null,c&&(f(),d=setTimeout(b,300),c=!1)},function(){return c=!0,d||b(),d})};Is.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Is.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Is.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,d),C=Math.round(f.lng*b)/b,M=Math.round(f.lat*b)/b,R=this._map.getBearing(),z=this._map.getPitch(),H="";if(H+=l?"/"+C+"/"+M+"/"+c:c+"/"+M+"/"+C,(R||z)&&(H+="/"+Math.round(10*R)/10),z&&(H+="/"+Math.round(z)),this._hashName){var ne=this._hashName,ue=!1,fe=v.window.location.hash.slice(1).split("&").map(function(Ce){var Pe=Ce.split("=")[0];return Pe===ne?(ue=!0,Pe+"="+H):Ce}).filter(function(Ce){return Ce});return ue||fe.push(ne+"="+H),"#"+fe.join("&")}return"#"+H},Is.prototype._getCurrentHash=function(){var l,f=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Is.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},Is.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(f){}};var tc={linearity:.3,easing:v.bezier(0,0,.3,1)},Vu=v.extend({deceleration:2500,maxSpeed:1400},tc),Lc=v.extend({deceleration:20,maxSpeed:1400},tc),ao=v.extend({deceleration:1e3,maxSpeed:360},tc),rc=v.extend({deceleration:1e3,maxSpeed:90},tc),du=function(l){this._map=l,this.clear()};function ju(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Gu(l,f,c){var d=c.maxSpeed,b=c.linearity,C=c.deceleration,M=v.clamp(l*b/(f/1e3),-d,d),R=Math.abs(M)/(C*b);return{easing:c.easing,duration:1e3*R,amount:M*(R/2)}}du.prototype.clear=function(){this._inertiaBuffer=[]},du.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},du.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=v.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},du.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var b=d[c].settings;f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(f.pan.mag()){var R=Gu(f.pan.mag(),C,v.extend({},Vu,l||{}));M.offset=f.pan.mult(R.amount/f.pan.mag()),M.center=this._map.transform.center,ju(M,R)}if(f.zoom){var z=Gu(f.zoom,C,Lc);M.zoom=this._map.transform.zoom+z.amount,ju(M,z)}if(f.bearing){var H=Gu(f.bearing,C,ao);M.bearing=this._map.transform.bearing+v.clamp(H.amount,-179,179),ju(M,H)}if(f.pitch){var ne=Gu(f.pitch,C,rc);M.pitch=this._map.transform.pitch+ne.amount,ju(M,ne)}if(M.zoom||M.bearing){var ue=f.pinchAround===void 0?f.around:f.pinchAround;M.around=ue?this._map.unproject(ue):this._map.getCenter()}return this.clear(),v.extend(M,{noMoveStart:!0})}};var yo=function(l){function f(d,b,C,M){M===void 0&&(M={});var R=U.mousePos(b.getCanvasContainer(),C),z=b.unproject(R);l.call(this,d,v.extend({point:R,lngLat:z,originalEvent:C},M)),this._defaultPrevented=!1,this.target=b}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),cl=function(l){function f(d,b,C){var M=d==="touchend"?C.changedTouches:C.touches,R=U.touchPos(b.getCanvasContainer(),M),z=R.map(function(ue){return b.unproject(ue)}),H=R.reduce(function(ue,fe,Ce,Pe){return ue.add(fe.div(Pe.length))},new v.Point(0,0)),ne=b.unproject(H);l.call(this,d,{points:R,point:H,lngLats:z,lngLat:ne,originalEvent:C}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Dl=function(l){function f(d,b,C){l.call(this,d,{originalEvent:C}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),_o=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};_o.prototype.reset=function(){delete this._mousedownPos},_o.prototype.wheel=function(l){return this._firePreventable(new Dl(l.type,this._map,l))},_o.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new yo(l.type,this._map,l))},_o.prototype.mouseup=function(l){this._map.fire(new yo(l.type,this._map,l))},_o.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new yo(l.type,this._map,l))},_o.prototype.dblclick=function(l){return this._firePreventable(new yo(l.type,this._map,l))},_o.prototype.mouseover=function(l){this._map.fire(new yo(l.type,this._map,l))},_o.prototype.mouseout=function(l){this._map.fire(new yo(l.type,this._map,l))},_o.prototype.touchstart=function(l){return this._firePreventable(new cl(l.type,this._map,l))},_o.prototype.touchmove=function(l){this._map.fire(new cl(l.type,this._map,l))},_o.prototype.touchend=function(l){this._map.fire(new cl(l.type,this._map,l))},_o.prototype.touchcancel=function(l){this._map.fire(new cl(l.type,this._map,l))},_o.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},_o.prototype.isEnabled=function(){return!0},_o.prototype.isActive=function(){return!1},_o.prototype.enable=function(){},_o.prototype.disable=function(){};var dn=function(l){this._map=l};dn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},dn.prototype.mousemove=function(l){this._map.fire(new yo(l.type,this._map,l))},dn.prototype.mousedown=function(){this._delayContextMenu=!0},dn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},dn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new yo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},dn.prototype.isEnabled=function(){return!0},dn.prototype.isActive=function(){return!1},dn.prototype.enable=function(){},dn.prototype.disable=function(){};var Ja=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function fl(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}Ja.prototype.isEnabled=function(){return!!this._enabled},Ja.prototype.isActive=function(){return!!this._active},Ja.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ja.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ja.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(U.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},Ja.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=U.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var b=Math.min(d.x,c.x),C=Math.max(d.x,c.x),M=Math.min(d.y,c.y),R=Math.max(d.y,c.y);U.setTransform(this._box,"translate("+b+"px,"+M+"px)"),this._box.style.width=C-b+"px",this._box.style.height=R-M+"px"}}},Ja.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,b=f;if(this.reset(),U.suppressClick(),d.x!==b.x||d.y!==b.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(C){return C.fitScreenCoordinates(d,b,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},Ja.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},Ja.prototype.blur=function(){this.reset()},Ja.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos},Ja.prototype._fireEvent=function(l,f){return this._map.fire(new v.Event(l,{originalEvent:f}))};var Fl=function(l){this.reset(),this.numTouches=l.numTouches};Fl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Fl.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var b=new v.Point(0,0),C=0,M=d;C<M.length;C+=1)b._add(M[C]);return b.div(d.length)}(f),this.touches=fl(c,f)))},Fl.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=fl(c,f);for(var b in this.touches){var C=d[b];(!C||C.dist(this.touches[b])>30)&&(this.aborted=!0)}}},Fl.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var fa=function(l){this.singleTap=new Fl(l),this.numTaps=l.numTaps,this.reset()};fa.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},fa.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},fa.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},fa.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var b=l.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(d)<30;if(b&&C||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var xs=function(){this._zoomIn=new fa({numTouches:1,numTaps:2}),this._zoomOut=new fa({numTouches:2,numTaps:1}),this.reset()};xs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},xs.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},xs.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},xs.prototype.touchend=function(l,f,c){var d=this,b=this._zoomIn.touchend(l,f,c),C=this._zoomOut.touchend(l,f,c);return b?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(b)},{originalEvent:l})}}):C?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(C)},{originalEvent:l})}}):void 0},xs.prototype.touchcancel=function(){this.reset()},xs.prototype.enable=function(){this._enabled=!0},xs.prototype.disable=function(){this._enabled=!1,this.reset()},xs.prototype.isEnabled=function(){return this._enabled},xs.prototype.isActive=function(){return this._active};var hf={0:1,2:2},qr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};qr.prototype.blur=function(){this.reset()},qr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qr.prototype._correctButton=function(l,f){return!1},qr.prototype._move=function(l,f){return{}},qr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=U.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},qr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,b){var C=hf[b];return d.buttons===void 0||(d.buttons&C)!==C}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},qr.prototype.mouseupWindow=function(l){this._lastPoint&&U.mouseButton(l)===this._eventButton&&(this._moved&&U.suppressClick(),this.reset())},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var Bl=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(qr),nc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var b=.8*(d.x-c.x);if(b)return this._active=!0,{bearingDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(qr),hl=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var b=-.5*(d.y-c.y);if(b)return this._active=!0,{pitchDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(qr),Ma=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ma.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},Ma.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Ma.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Ma.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Ma.prototype.touchcancel=function(){this.reset()},Ma.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=fl(c,f),b=new v.Point(0,0),C=new v.Point(0,0),M=0;for(var R in d){var z=d[R],H=this._touches[R];H&&(b._add(z),C._add(z.sub(H)),M++,d[R]=z)}if(this._touches=d,!(M<this._minTouches)&&C.mag()){var ne=C.div(M);if(this._sum._add(ne),!(this._sum.mag()<this._clickTolerance))return{around:b.div(M),panDelta:ne}}},Ma.prototype.enable=function(){this._enabled=!0},Ma.prototype.disable=function(){this._enabled=!1,this.reset()},Ma.prototype.isEnabled=function(){return this._enabled},Ma.prototype.isActive=function(){return this._active};var ss=function(){this.reset()};function ic(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Hu(l,f){return Math.log(l/f)/Math.LN2}ss.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ss.prototype._start=function(l){},ss.prototype._move=function(l,f,c){return{}},ss.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},ss.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,b=d[1],C=ic(c,f,d[0]),M=ic(c,f,b);if(C&&M){var R=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],R,l)}}},ss.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,b=d[1],C=ic(c,f,d[0]),M=ic(c,f,b);C&&M||(this._active&&U.suppressClick(),this.reset())}},ss.prototype.touchcancel=function(){this.reset()},ss.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},ss.prototype.disable=function(){this._enabled=!1,this.reset()},ss.prototype.isEnabled=function(){return this._enabled},ss.prototype.isActive=function(){return this._active};var Os=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Hu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hu(this._distance,b),pinchAround:d}},f}(ss);function Wu(l,f){return 180*l.angleWith(f)/Math.PI}var mh=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var b=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Wu(this._vector,b),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,b=Wu(c,this._startVector);return Math.abs(b)<d},f}(ss);function ac(l){return Math.abs(l.y)>Math.abs(l.x)}var oc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,ac(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,b){var C=c[0].sub(this._lastPoints[0]),M=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,M,b.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+M.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,b){if(this._valid!==void 0)return this._valid;var C=c.mag()>=2,M=d.mag()>=2;if(C||M){if(!C||!M)return this._firstMove===void 0&&(this._firstMove=b),b-this._firstMove<100&&void 0;var R=c.y>0==d.y>0;return ac(c)&&ac(d)&&R}},f}(ss),Uf={panStep:100,bearingStep:15,pitchStep:10},Fs=function(){var l=Uf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function qs(l){return l*(2-l)}Fs.prototype.blur=function(){this.reset()},Fs.prototype.reset=function(){this._active=!1},Fs.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,b=0,C=0,M=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),C=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),C=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),M=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(d=0,b=0),{cameraAnimation:function(R){var z=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:qs,zoom:c?Math.round(z)+c*(l.shiftKey?2:1):z,bearing:R.getBearing()+d*f._bearingStep,pitch:R.getPitch()+b*f._pitchStep,offset:[-C*f._panStep,-M*f._panStep],center:R.getCenter()},{originalEvent:l})}}}},Fs.prototype.enable=function(){this._enabled=!0},Fs.prototype.disable=function(){this._enabled=!1,this.reset()},Fs.prototype.isEnabled=function(){return this._enabled},Fs.prototype.isActive=function(){return this._active},Fs.prototype.disableRotation=function(){this._rotationDisabled=!0},Fs.prototype.enableRotation=function(){this._rotationDisabled=!1};var Mi=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Mi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Mi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Mi.prototype.isEnabled=function(){return!!this._enabled},Mi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Mi.prototype.isZooming=function(){return!!this._zooming},Mi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Mi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Mi.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Mi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Mi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=U.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Mi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var b=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(b*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,M=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,R=this._startZoom,z=this._easing,H=!1;if(this._type==="wheel"&&R&&z){var ne=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),ue=z(ne);C=v.number(R,M,ue),ne<1?this._frameId||(this._frameId=!0):H=!0}else C=M,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:C-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Mi.prototype._smoothOutEasing=function(l){var f=v.ease;if(this._prevEase){var c=this._prevEase,d=(v.browser.now()-c.start)/c.duration,b=c.easing(d+.01)-c.easing(d),C=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-C*C);f=v.bezier(C,M,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:f},f},Mi.prototype.blur=function(){this.reset()},Mi.prototype.reset=function(){this._active=!1};var Ks=function(l,f){this._clickZoom=l,this._tapZoom=f};Ks.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ks.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ks.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ks.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var vu=function(){this.reset()};vu.prototype.reset=function(){this._active=!1},vu.prototype.blur=function(){this.reset()},vu.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},vu.prototype.enable=function(){this._enabled=!0},vu.prototype.disable=function(){this._enabled=!1,this.reset()},vu.prototype.isEnabled=function(){return this._enabled},vu.prototype.isActive=function(){return this._active};var Xo=function(){this._tap=new fa({numTouches:1,numTaps:1}),this.reset()};Xo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Xo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Xo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],b=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(l,f,c)},Xo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Xo.prototype.touchcancel=function(){this.reset()},Xo.prototype.enable=function(){this._enabled=!0},Xo.prototype.disable=function(){this._enabled=!1,this.reset()},Xo.prototype.isEnabled=function(){return this._enabled},Xo.prototype.isActive=function(){return this._active};var pl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};pl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},pl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},pl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},pl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var dl=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};dl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},dl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},dl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},dl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var fo=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};fo.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},fo.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},fo.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},fo.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},fo.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},fo.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Rs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},nu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(v.Event);function kn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Sn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new du(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var d=0,b=this._listeners;d<b.length;d+=1){var C=b[d],M=C[0];U.addEventListener(M,C[1],M===v.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};Sn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];U.removeEventListener(d,c[1],d===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Sn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new _o(f,l));var d=f.boxZoom=new Ja(f,l);this._add("boxZoom",d);var b=new xs,C=new vu;f.doubleClickZoom=new Ks(C,b),this._add("tapZoom",b),this._add("clickZoom",C);var M=new Xo;this._add("tapDragZoom",M);var R=f.touchPitch=new oc;this._add("touchPitch",R);var z=new nc(l),H=new hl(l);f.dragRotate=new dl(l,z,H),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);var ne=new Bl(l),ue=new Ma(l);f.dragPan=new pl(c,ne,ue),this._add("mousePan",ne),this._add("touchPan",ue,["touchZoom","touchRotate"]);var fe=new mh,Ce=new Os;f.touchZoomRotate=new fo(c,Ce,fe,M),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",Ce,["touchPan","touchRotate"]);var Pe=f.scrollZoom=new Mi(f,this);this._add("scrollZoom",Pe,["mousePan"]);var Ue=f.keyboard=new Fs;this._add("keyboard",Ue),this._add("blockableMapEvent",new dn(f));for(var Ae=0,Ze=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ae<Ze.length;Ae+=1){var Ke=Ze[Ae];l.interactive&&l[Ke]&&f[Ke].enable(l[Ke])}},Sn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},Sn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Sn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},Sn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Sn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Sn.prototype.isMoving=function(){return Boolean(Rs(this._eventsInProgress))||this.isZooming()},Sn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},Sn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Sn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var b=d[c];this._el.contains(b.target)&&f.push(b)}return f},Sn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},b={},C={},M=l.touches?this._getMapTouches(l.touches):void 0,R=M?U.touchPos(this._el,M):U.mousePos(this._el,l),z=0,H=this._handlers;z<H.length;z+=1){var ne=H[z],ue=ne.handlerName,fe=ne.handler,Ce=ne.allowed;if(fe.isEnabled()){var Pe=void 0;this._blockedByActive(C,Ce,ue)?fe.reset():fe[f||l.type]&&(Pe=fe[f||l.type](l,R,M),this.mergeHandlerResult(d,b,Pe,ue,c),Pe&&Pe.needsRenderFrame&&this._triggerRenderFrame()),(Pe||fe.isActive())&&(C[ue]=fe)}}var Ue={};for(var Ae in this._previousActiveHandlers)C[Ae]||(Ue[Ae]=c);this._previousActiveHandlers=C,(Object.keys(Ue).length||kn(d))&&(this._changes.push([d,b,Ue]),this._triggerRenderFrame()),(Object.keys(C).length||kn(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ze=d.cameraAnimation;Ze&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ze(this._map))},Sn.prototype.mergeHandlerResult=function(l,f,c,d,b){if(c){v.extend(l,c);var C={handlerName:d,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(f.zoom=C),c.panDelta!==void 0&&(f.drag=C),c.pitchDelta!==void 0&&(f.pitch=C),c.bearingDelta!==void 0&&(f.rotate=C)}},Sn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,b=this._changes;d<b.length;d+=1){var C=b[d],M=C[0],R=C[1],z=C[2];M.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(l.around=M.around),M.pinchAround!==void 0&&(l.pinchAround=M.pinchAround),M.noInertia&&(l.noInertia=M.noInertia),v.extend(f,R),v.extend(c,z)}this._updateMapTransform(l,f,c),this._changes=[]},Sn.prototype._updateMapTransform=function(l,f,c){var d=this._map,b=d.transform;if(!kn(l))return this._fireEvents(f,c,!0);var C=l.panDelta,M=l.zoomDelta,R=l.bearingDelta,z=l.pitchDelta,H=l.around,ne=l.pinchAround;ne!==void 0&&(H=ne),d._stop(!0),H=H||d.transform.centerPoint;var ue=b.pointLocation(C?H.sub(C):H);R&&(b.bearing+=R),z&&(b.pitch+=z),M&&(b.zoom+=M),b.setLocationAtPoint(ue,H),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},Sn.prototype._fireEvents=function(l,f,c){var d=this,b=Rs(this._eventsInProgress),C=Rs(l),M={};for(var R in l)this._eventsInProgress[R]||(M[R+"start"]=l[R].originalEvent),this._eventsInProgress[R]=l[R];for(var z in!b&&C&&this._fireEvent("movestart",C.originalEvent),M)this._fireEvent(z,M[z]);for(var H in C&&this._fireEvent("move",C.originalEvent),l)this._fireEvent(H,l[H].originalEvent);var ne,ue={};for(var fe in this._eventsInProgress){var Ce=this._eventsInProgress[fe],Pe=Ce.handlerName,Ue=Ce.originalEvent;this._handlersById[Pe].isActive()||(delete this._eventsInProgress[fe],ue[fe+"end"]=ne=f[Pe]||Ue)}for(var Ae in ue)this._fireEvent(Ae,ue[Ae]);var Ze=Rs(this._eventsInProgress);if(c&&(b||C)&&!Ze){this._updatingCamera=!0;var Ke=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),mt=function(St){return St!==0&&-d._bearingSnap<St&&St<d._bearingSnap};Ke?(mt(Ke.bearing||this._map.getBearing())&&(Ke.bearing=0),this._map.easeTo(Ke,{originalEvent:ne})):(this._map.fire(new v.Event("moveend",{originalEvent:ne})),mt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Sn.prototype._fireEvent=function(l,f){this._map.fire(new v.Event(l,f?{originalEvent:f}:{}))},Sn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new nu("renderFrame",{timeStamp:f})),l._applyChanges()})},Sn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var sc=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,b){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},d),b)},f.prototype.panTo=function(c,d,b){return this.easeTo(v.extend({center:c},d),b)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,b){return this.easeTo(v.extend({zoom:c},d),b)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,b){return this.easeTo(v.extend({bearing:c},d),b)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,v.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=v.LngLatBounds.convert(c);var b=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),b,d)},f.prototype._cameraForBoxAndBearing=function(c,d,b,C){var M={top:0,bottom:0,right:0,left:0};if(typeof(C=v.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var R=C.padding;C.padding={top:R,bottom:R,right:R,left:R}}C.padding=v.extend(M,C.padding);var z=this.transform,H=z.padding,ne=z.project(v.LngLat.convert(c)),ue=z.project(v.LngLat.convert(d)),fe=ne.rotate(-b*Math.PI/180),Ce=ue.rotate(-b*Math.PI/180),Pe=new v.Point(Math.max(fe.x,Ce.x),Math.max(fe.y,Ce.y)),Ue=new v.Point(Math.min(fe.x,Ce.x),Math.min(fe.y,Ce.y)),Ae=Pe.sub(Ue),Ze=(z.width-(H.left+H.right+C.padding.left+C.padding.right))/Ae.x,Ke=(z.height-(H.top+H.bottom+C.padding.top+C.padding.bottom))/Ae.y;if(!(Ke<0||Ze<0)){var mt=Math.min(z.scaleZoom(z.scale*Math.min(Ze,Ke)),C.maxZoom),St=typeof C.offset.x=="number"?new v.Point(C.offset.x,C.offset.y):v.Point.convert(C.offset),Zt=new v.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(b*Math.PI/180),Kt=St.add(Zt).mult(z.scale/z.zoomScale(mt));return{center:z.unproject(ne.add(ue).div(2).sub(Kt)),zoom:mt,bearing:b}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,b){return this._fitInternal(this.cameraForBounds(c,d),d,b)},f.prototype.fitScreenCoordinates=function(c,d,b,C,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(d)),b,C),C,M)},f.prototype._fitInternal=function(c,d,b){return c?(delete(d=v.extend(c,d)).padding,d.linear?this.easeTo(d,b):this.flyTo(d,b)):this},f.prototype.jumpTo=function(c,d){this.stop();var b=this.transform,C=!1,M=!1,R=!1;return"zoom"in c&&b.zoom!==+c.zoom&&(C=!0,b.zoom=+c.zoom),c.center!==void 0&&(b.center=v.LngLat.convert(c.center)),"bearing"in c&&b.bearing!==+c.bearing&&(M=!0,b.bearing=+c.bearing),"pitch"in c&&b.pitch!==+c.pitch&&(R=!0,b.pitch=+c.pitch),c.padding==null||b.isPaddingEqual(c.padding)||(b.padding=c.padding),this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),C&&this.fire(new v.Event("zoomstart",d)).fire(new v.Event("zoom",d)).fire(new v.Event("zoomend",d)),M&&this.fire(new v.Event("rotatestart",d)).fire(new v.Event("rotate",d)).fire(new v.Event("rotateend",d)),R&&this.fire(new v.Event("pitchstart",d)).fire(new v.Event("pitch",d)).fire(new v.Event("pitchend",d)),this.fire(new v.Event("moveend",d))},f.prototype.easeTo=function(c,d){var b=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var C=this.transform,M=this.getZoom(),R=this.getBearing(),z=this.getPitch(),H=this.getPadding(),ne="zoom"in c?+c.zoom:M,ue="bearing"in c?this._normalizeBearing(c.bearing,R):R,fe="pitch"in c?+c.pitch:z,Ce="padding"in c?c.padding:C.padding,Pe=v.Point.convert(c.offset),Ue=C.centerPoint.add(Pe),Ae=C.pointLocation(Ue),Ze=v.LngLat.convert(c.center||Ae);this._normalizeCenter(Ze);var Ke,mt,St=C.project(Ae),Zt=C.project(Ze).sub(St),Kt=C.zoomScale(ne-M);c.around&&(Ke=v.LngLat.convert(c.around),mt=C.locationPoint(Ke));var pr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ne!==M,this._rotating=this._rotating||R!==ue,this._pitching=this._pitching||fe!==z,this._padding=!C.isPaddingEqual(Ce),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,pr),this._ease(function(kr){if(b._zooming&&(C.zoom=v.number(M,ne,kr)),b._rotating&&(C.bearing=v.number(R,ue,kr)),b._pitching&&(C.pitch=v.number(z,fe,kr)),b._padding&&(C.interpolatePadding(H,Ce,kr),Ue=C.centerPoint.add(Pe)),Ke)C.setLocationAtPoint(Ke,mt);else{var Or=C.zoomScale(C.zoom-M),tn=ne>M?Math.min(2,Kt):Math.max(.5,Kt),Ln=Math.pow(tn,1-kr),Fn=C.unproject(St.add(Zt.mult(kr*Ln)).mult(Or));C.setLocationAtPoint(C.renderWorldCopies?Fn.wrap():Fn,Ue)}b._fireMoveEvents(d)},function(kr){b._afterEase(d,kr)},c),this},f.prototype._prepareEase=function(c,d,b){b===void 0&&(b={}),this._moving=!0,d||b.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!b.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new v.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var b=this._zooming,C=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new v.Event("zoomend",c)),C&&this.fire(new v.Event("rotateend",c)),M&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var b=this;if(!c.essential&&v.browser.prefersReducedMotion){var C=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,d)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var M=this.transform,R=this.getZoom(),z=this.getBearing(),H=this.getPitch(),ne=this.getPadding(),ue="zoom"in c?v.clamp(+c.zoom,M.minZoom,M.maxZoom):R,fe="bearing"in c?this._normalizeBearing(c.bearing,z):z,Ce="pitch"in c?+c.pitch:H,Pe="padding"in c?c.padding:M.padding,Ue=M.zoomScale(ue-R),Ae=v.Point.convert(c.offset),Ze=M.centerPoint.add(Ae),Ke=M.pointLocation(Ze),mt=v.LngLat.convert(c.center||Ke);this._normalizeCenter(mt);var St=M.project(Ke),Zt=M.project(mt).sub(St),Kt=c.curve,pr=Math.max(M.width,M.height),kr=pr/Ue,Or=Zt.mag();if("minZoom"in c){var tn=v.clamp(Math.min(c.minZoom,R,ue),M.minZoom,M.maxZoom),Ln=pr/M.zoomScale(tn-R);Kt=Math.sqrt(Ln/Or*2)}var Fn=Kt*Kt;function zn(Un){var jn=(kr*kr-pr*pr+(Un?-1:1)*Fn*Fn*Or*Or)/(2*(Un?kr:pr)*Fn*Or);return Math.log(Math.sqrt(jn*jn+1)-jn)}function Ri(Un){return(Math.exp(Un)-Math.exp(-Un))/2}function sn(Un){return(Math.exp(Un)+Math.exp(-Un))/2}var ai=zn(0),fi=function(Un){return sn(ai)/sn(ai+Kt*Un)},ti=function(Un){return pr*((sn(ai)*(Ri(jn=ai+Kt*Un)/sn(jn))-Ri(ai))/Fn)/Or;var jn},On=(zn(1)-ai)/Kt;if(Math.abs(Or)<1e-6||!isFinite(On)){if(Math.abs(pr-kr)<1e-6)return this.easeTo(c,d);var yi=kr<pr?-1:1;On=Math.abs(Math.log(kr/pr))/Kt,ti=function(){return 0},fi=function(Un){return Math.exp(yi*Kt*Un)}}return c.duration="duration"in c?+c.duration:1e3*On/("screenSpeed"in c?+c.screenSpeed/Kt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=z!==fe,this._pitching=Ce!==H,this._padding=!M.isPaddingEqual(Pe),this._prepareEase(d,!1),this._ease(function(Un){var jn=Un*On,eo=1/fi(jn);M.zoom=Un===1?ue:R+M.scaleZoom(eo),b._rotating&&(M.bearing=v.number(z,fe,Un)),b._pitching&&(M.pitch=v.number(H,Ce,Un)),b._padding&&(M.interpolatePadding(ne,Pe,Un),Ze=M.centerPoint.add(Ae));var Da=Un===1?mt:M.unproject(St.add(Zt.mult(ti(jn))).mult(eo));M.setLocationAtPoint(M.renderWorldCopies?Da.wrap():Da,Ze),b._fireMoveEvents(d)},function(){return b._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,d)}if(!c){var C=this.handlers;C&&C.stop(!1)}return this},f.prototype._ease=function(c,d,b){b.animate===!1||b.duration===0?(c(1),d()):(this._easeStart=v.browser.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=v.wrap(c,-180,180);var b=Math.abs(c-d);return Math.abs(c-360-d)<b&&(c-=360),Math.abs(c+360-d)<b&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var b=c.lng-d.center.lng;c.lng+=b>180?-360:b<-180?360:0}},f}(v.Evented),us=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};us.prototype.getDefaultPosition=function(){return"bottom-right"},us.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},us.prototype.onRemove=function(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},us.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},us.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},us.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,b,C){return b.value&&(d+=b.key+"="+b.value+(C<f.length-1?"&":"")),d},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},us.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},us.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var b=c[d];if(b.used){var C=b.getSource();C.attribution&&l.indexOf(C.attribution)<0&&l.push(C.attribution)}}l.sort(function(R,z){return R.length-z.length});var M=(l=l.filter(function(R,z){for(var H=z+1;H<l.length;H++)if(l[H].indexOf(R)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,l.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},us.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var iu=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};iu.prototype.onAdd=function(l){this._map=l,this._container=U.create("div","mapboxgl-ctrl");var f=U.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},iu.prototype.onRemove=function(){U.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},iu.prototype.getDefaultPosition=function(){return"bottom-left"},iu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},iu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},iu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Yo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Yo.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Yo.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var b=d[c];if(b.id===l)return void(b.cancelled=!0)}},Yo.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var b=d[c];if(!b.cancelled&&(b.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Yo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var au={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Zf=v.window.HTMLImageElement,Dc=v.window.HTMLElement,ha=v.window.ImageBitmap,Pa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},vl=function(l){function f(d){var b=this;if((d=v.extend({},Pa,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new Vi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,C,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Yo,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},au,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new v.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=v.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Dc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return b._update(!1)}),this.on("moveend",function(){return b._update(!1)}),this.on("zoom",function(){return b._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Sn(this,d),this._hash=d.hash&&new Is(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,v.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new us({customAttribution:d.customAttribution})),this.addControl(new iu,d.logoPosition),this.on("style.load",function(){b.transform.unmodified&&b.jumpTo(b.style.stylesheet)}),this.on("data",function(M){b._update(M.dataType==="style"),b.fire(new v.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){b.fire(new v.Event(M.dataType+"dataloading",M))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,b){if(b===void 0&&(b=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=d.onAdd(this);this._controls.push(d);var M=this._controlPositions[b];return b.indexOf("bottom")!==-1?M.insertBefore(C,M.firstChild):M.appendChild(C),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var b=this._controls.indexOf(d);return b>-1&&this._controls.splice(b,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var b=this._containerDimensions(),C=b[0],M=b[1];if(C===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(C,M),this.transform.resize(C,M),this.painter.resize(C,M);var R=!this._moving;return R&&this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),this.fire(new v.Event("resize",d)),R&&this.fire(new v.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(v.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(v.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(v.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,b,C){var M,R=this;if(d==="mouseenter"||d==="mouseover"){var z=!1;return{layer:b,listener:C,delegates:{mousemove:function(ne){var ue=R.getLayer(b)?R.queryRenderedFeatures(ne.point,{layers:[b]}):[];ue.length?z||(z=!0,C.call(R,new yo(d,R,ne.originalEvent,{features:ue}))):z=!1},mouseout:function(){z=!1}}}}if(d==="mouseleave"||d==="mouseout"){var H=!1;return{layer:b,listener:C,delegates:{mousemove:function(ne){(R.getLayer(b)?R.queryRenderedFeatures(ne.point,{layers:[b]}):[]).length?H=!0:H&&(H=!1,C.call(R,new yo(d,R,ne.originalEvent)))},mouseout:function(ne){H&&(H=!1,C.call(R,new yo(d,R,ne.originalEvent)))}}}}return{layer:b,listener:C,delegates:(M={},M[d]=function(ne){var ue=R.getLayer(b)?R.queryRenderedFeatures(ne.point,{layers:[b]}):[];ue.length&&(ne.features=ue,C.call(R,ne),delete ne.features)},M)}},f.prototype.on=function(d,b,C){if(C===void 0)return l.prototype.on.call(this,d,b);var M=this._createDelegatedListener(d,b,C);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(M),M.delegates)this.on(R,M.delegates[R]);return this},f.prototype.once=function(d,b,C){if(C===void 0)return l.prototype.once.call(this,d,b);var M=this._createDelegatedListener(d,b,C);for(var R in M.delegates)this.once(R,M.delegates[R]);return this},f.prototype.off=function(d,b,C){var M=this;return C===void 0?l.prototype.off.call(this,d,b):(this._delegatedListeners&&this._delegatedListeners[d]&&function(R){for(var z=R[d],H=0;H<z.length;H++){var ne=z[H];if(ne.layer===b&&ne.listener===C){for(var ue in ne.delegates)M.off(ue,ne.delegates[ue]);return z.splice(H,1),M}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,b){if(!this.style)return[];var C;if(b!==void 0||d===void 0||d instanceof v.Point||Array.isArray(d)||(b=d,d=void 0),b=b||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof d[0]=="number")C=[v.Point.convert(d)];else{var M=v.Point.convert(d[0]),R=v.Point.convert(d[1]);C=[M,new v.Point(R.x,M.y),R,new v.Point(M.x,R.y),M]}return this.style.queryRenderedFeatures(C,b,this.transform)},f.prototype.querySourceFeatures=function(d,b){return this.style.querySourceFeatures(d,b)},f.prototype.setStyle=function(d,b){return(b=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},b)).diff!==!1&&b.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,b),this):(this._localIdeographFontFamily=b.localIdeographFontFamily,this._updateStyle(d,b))},f.prototype._getUIString=function(d){var b=this._locale[d];if(b==null)throw new Error("Missing UI string '"+d+"'");return b},f.prototype._updateStyle=function(d,b){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new ms(this,b||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ms(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,b){var C=this;if(typeof d=="string"){var M=this._requestManager.normalizeStyleURL(d),R=this._requestManager.transformRequest(M,v.ResourceType.Style);v.getJSON(R,function(z,H){z?C.fire(new v.ErrorEvent(z)):H&&C._updateDiff(H,b)})}else typeof d=="object"&&this._updateDiff(d,b)},f.prototype._updateDiff=function(d,b){try{this.style.setState(d)&&this._update(!0)}catch(C){v.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(d,b)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,b){return this._lazyInitEmptyStyle(),this.style.addSource(d,b),this._update(!0)},f.prototype.isSourceLoaded=function(d){var b=this.style&&this.style.sourceCaches[d];if(b!==void 0)return b.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var b in d){var C=d[b]._tiles;for(var M in C){var R=C[M];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,b,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,b,C)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,b,C){C===void 0&&(C={});var M=C.pixelRatio;M===void 0&&(M=1);var R=C.sdf;R===void 0&&(R=!1);var z=C.stretchX,H=C.stretchY,ne=C.content;if(this._lazyInitEmptyStyle(),b instanceof Zf||ha&&b instanceof ha){var ue=v.browser.getImageData(b);this.style.addImage(d,{data:new v.RGBAImage({width:ue.width,height:ue.height},ue.data),pixelRatio:M,stretchX:z,stretchY:H,content:ne,sdf:R,version:0})}else{if(b.width===void 0||b.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var fe=b;this.style.addImage(d,{data:new v.RGBAImage({width:b.width,height:b.height},new Uint8Array(b.data)),pixelRatio:M,stretchX:z,stretchY:H,content:ne,sdf:R,version:0,userImage:fe}),fe.onAdd&&fe.onAdd(this,d)}},f.prototype.updateImage=function(d,b){var C=this.style.getImage(d);if(!C)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=b instanceof Zf||ha&&b instanceof ha?v.browser.getImageData(b):b,R=M.width,z=M.height,H=M.data;return R===void 0||z===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==C.data.width||z!==C.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace(H,!(b instanceof Zf||ha&&b instanceof ha)),void this.style.updateImage(d,C))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,b){v.getImage(this._requestManager.transformRequest(d,v.ResourceType.Image),b)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,b){return this._lazyInitEmptyStyle(),this.style.addLayer(d,b),this._update(!0)},f.prototype.moveLayer=function(d,b){return this.style.moveLayer(d,b),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,b,C){return this.style.setLayerZoomRange(d,b,C),this._update(!0)},f.prototype.setFilter=function(d,b,C){return C===void 0&&(C={}),this.style.setFilter(d,b,C),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,b,C,M){return M===void 0&&(M={}),this.style.setPaintProperty(d,b,C,M),this._update(!0)},f.prototype.getPaintProperty=function(d,b){return this.style.getPaintProperty(d,b)},f.prototype.setLayoutProperty=function(d,b,C,M){return M===void 0&&(M={}),this.style.setLayoutProperty(d,b,C,M),this._update(!0)},f.prototype.getLayoutProperty=function(d,b){return this.style.getLayoutProperty(d,b)},f.prototype.setLight=function(d,b){return b===void 0&&(b={}),this._lazyInitEmptyStyle(),this.style.setLight(d,b),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,b){return this.style.setFeatureState(d,b),this._update()},f.prototype.removeFeatureState=function(d,b){return this.style.removeFeatureState(d,b),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,b=0;return this._container&&(d=this._container.clientWidth||400,b=this._container.clientHeight||300),[d,b]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=U.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var b=this._canvasContainer=U.create("div","mapboxgl-canvas-container",d);this._interactive&&b.classList.add("mapboxgl-interactive"),this._canvas=U.create("canvas","mapboxgl-canvas",b),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var M=this._controlContainer=U.create("div","mapboxgl-control-container",d),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(z){R[z]=U.create("div","mapboxgl-ctrl-"+z,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,b){var C=v.browser.devicePixelRatio||1;this._canvas.width=C*d,this._canvas.height=C*b,this._canvas.style.width=d+"px",this._canvas.style.height=b+"px"},f.prototype._setupPainter=function(){var d=v.extend({},de.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),b=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);b?(this.painter=new Ba(b,this.transform),v.webpSupported.testSupport(b)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var b,C=this,M=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(b=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,b),M=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var H=this.transform.zoom,ne=v.browser.now();this.style.zoomHistory.update(H,ne);var ue=new v.EvaluationParameters(H,{now:ne,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),fe=ue.crossFadingFactor();fe===1&&fe===this._crossFadingFactor||(z=!0,this._crossFadingFactor=fe),this.style.update(ue)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ce=v.browser.now()-M;R.endQueryEXT(R.TIME_ELAPSED_EXT,b),setTimeout(function(){var Ae=R.getQueryObjectEXT(b,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(b),C.fire(new v.Event("gpu-timing-frame",{cpuTime:Ce,gpuTime:Ae}))},50)}if(this.listens("gpu-timing-layer")){var Pe=this.painter.collectGpuTimers();setTimeout(function(){var Ae=C.painter.queryGpuTimers(Pe);C.fire(new v.Event("gpu-timing-layer",{layerTimes:Ae}))},50)}var Ue=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ue||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||Ue||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,b=this._controls;d<b.length;d+=1)b[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),uc(this._canvasContainer),uc(this._controlContainer),uc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(b){d._frame=null,d._render(b)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,b){v.setCacheLimits(d,b)},c.version.get=function(){return v.version},Object.defineProperties(f.prototype,c),f}(sc);function uc(l){l.parentNode&&l.parentNode.removeChild(l)}var $s={showCompass:!0,showZoom:!0,visualizePitch:!1},ou=function(l){var f=this;this.options=v.extend({},$s,l),this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),U.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),U.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=U.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ou.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},ou.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},ou.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new oo(this._map,this._compass,this.options.visualizePitch)),this._container},ou.prototype.onRemove=function(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ou.prototype._createButton=function(l,f){var c=U.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},ou.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var oo=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new nc({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new hl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),U.addEventListener(f,"mousedown",this.mousedown),U.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(f,"touchmove",this.touchmove),U.addEventListener(f,"touchend",this.touchend),U.addEventListener(f,"touchcancel",this.reset)};function Qs(l,f,c){if(l=new v.LngLat(l.lng,l.lat),f){var d=new v.LngLat(l.lng-360,l.lat),b=new v.LngLat(l.lng+360,l.lat),C=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<C?l=d:c.locationPoint(b).distSqr(f)<C&&(l=b)}for(;Math.abs(l.lng-c.center.lng)>180;){var M=c.locationPoint(l);if(M.x>=0&&M.y>=0&&M.x<=c.width&&M.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}oo.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),U.disableDrag()},oo.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var b=this.mousePitch.mousemoveWindow(l,f);b&&b.pitchDelta&&c.setPitch(c.getPitch()+b.pitchDelta)}},oo.prototype.off=function(){var l=this.element;U.removeEventListener(l,"mousedown",this.mousedown),U.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(l,"touchmove",this.touchmove),U.removeEventListener(l,"touchend",this.touchend),U.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},oo.prototype.offTemp=function(){U.enableDrag(),U.removeEventListener(v.window,"mousemove",this.mousemove),U.removeEventListener(v.window,"mouseup",this.mouseup)},oo.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),U.mousePos(this.element,l)),U.addEventListener(v.window,"mousemove",this.mousemove),U.addEventListener(v.window,"mouseup",this.mouseup)},oo.prototype.mousemove=function(l){this.move(l,U.mousePos(this.element,l))},oo.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},oo.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},oo.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},oo.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},oo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Bs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ru(l,f,c){var d=l.classList;for(var b in Bs)d.remove("mapboxgl-"+c+"-anchor-"+b);d.add("mapboxgl-"+c+"-anchor-"+f)}var mu,ks=function(l){function f(c,d){if(l.call(this),(c instanceof v.window.HTMLElement||d)&&(c=v.extend({element:c},d)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div"),this._element.setAttribute("aria-label","Map marker");var b=U.createNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","41px"),b.setAttributeNS(null,"width","27px"),b.setAttributeNS(null,"viewBox","0 0 27 41");var C=U.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var M=U.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var R=U.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var z=0,H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];z<H.length;z+=1){var ne=H[z],ue=U.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",ne.rx),ue.setAttributeNS(null,"ry",ne.ry),R.appendChild(ue)}var fe=U.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"fill",this._color);var Ce=U.createNS("http://www.w3.org/2000/svg","path");Ce.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),fe.appendChild(Ce);var Pe=U.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"opacity","0.25"),Pe.setAttributeNS(null,"fill","#000000");var Ue=U.createNS("http://www.w3.org/2000/svg","path");Ue.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Pe.appendChild(Ue);var Ae=U.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");var Ze=U.createNS("http://www.w3.org/2000/svg","g");Ze.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Ke=U.createNS("http://www.w3.org/2000/svg","circle");Ke.setAttributeNS(null,"fill","#000000"),Ke.setAttributeNS(null,"opacity","0.25"),Ke.setAttributeNS(null,"cx","5.5"),Ke.setAttributeNS(null,"cy","5.5"),Ke.setAttributeNS(null,"r","5.4999962");var mt=U.createNS("http://www.w3.org/2000/svg","circle");mt.setAttributeNS(null,"fill","#FFFFFF"),mt.setAttributeNS(null,"cx","5.5"),mt.setAttributeNS(null,"cy","5.5"),mt.setAttributeNS(null,"r","5.4999962"),Ze.appendChild(Ke),Ze.appendChild(mt),M.appendChild(R),M.appendChild(fe),M.appendChild(Pe),M.appendChild(Ae),M.appendChild(Ze),b.appendChild(M),b.setAttributeNS(null,"height",41*this._scale+"px"),b.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(b),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(St){St.preventDefault()}),this._element.addEventListener("mousedown",function(St){St.preventDefault()}),Ru(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,b=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&b!==32&&b!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,b=this._element;this._popup&&(d===b||b.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Qs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,Bs[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+b+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),pf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},lc=0,Nl=!1,Vf=function(l){function f(c){l.call(this),this.options=v.extend({},pf,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,mu!==void 0?d(mu):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(b){d(mu=b.state!=="denied")}):d(mu=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,lc=0,Nl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),b=c.coords;return d&&(b.longitude<d.getWest()||b.longitude>d.getEast()||b.latitude<d.getSouth()||b.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude),b=c.coords.accuracy,C=this._map.getBearing(),M=v.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(b),M,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),b=this._map.unproject([1,c]),C=d.distanceTo(b),M=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Nl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=U.create("button","mapboxgl-ctrl-geolocate",this._container),U.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ks(this._dotElement),this._circleElement=U.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ks({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||d._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":lc--,Nl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++lc>1?(c={maximumAge:6e5,timeout:0},Nl=!0):(c=this.options.positionOptions,Nl=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),ml={maxWidth:100,unit:"metric"},gl=function(l){this.options=v.extend({},ml,l),v.bindAll(["_onMove","setUnit"],this)};function df(l,f,c){var d=c&&c.maxWidth||100,b=l._container.clientHeight/2,C=l.unproject([0,b]),M=l.unproject([d,b]),R=C.distanceTo(M);if(c&&c.unit==="imperial"){var z=3.2808*R;z>5280?Xu(f,d,z/5280,l._getUIString("ScaleControl.Miles")):Xu(f,d,z,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Xu(f,d,R/1852,l._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Xu(f,d,R/1e3,l._getUIString("ScaleControl.Kilometers")):Xu(f,d,R,l._getUIString("ScaleControl.Meters"))}function Xu(l,f,c,d){var b,C,M,R=(b=c,(C=Math.pow(10,(""+Math.floor(b)).length-1))*(M=(M=b/C)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(z){var H=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*H)/H}(M)));l.style.width=f*(R/c)+"px",l.innerHTML=R+"&nbsp;"+d}gl.prototype.getDefaultPosition=function(){return"bottom-left"},gl.prototype._onMove=function(){df(this._map,this._container,this.options)},gl.prototype.onAdd=function(l){return this._map=l,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},gl.prototype.onRemove=function(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},gl.prototype.setUnit=function(l){this.options.unit=l,df(this._map,this._container,this.options)};var Ns=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ns.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ns.prototype.onRemove=function(){U.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ns.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},Ns.prototype._setupUI=function(){var l=this._fullscreenButton=U.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ns.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Ns.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ns.prototype._isFullscreen=function(){return this._fullscreen},Ns.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ns.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var vf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},cc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ku=function(l){function f(c){l.call(this),this.options=v.extend(Object.create(vf),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,b=v.window.document.createDocumentFragment(),C=v.window.document.createElement("body");for(C.innerHTML=c;d=C.firstChild;)b.appendChild(d);return this.setDOMContent(b)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=U.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=U.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=U.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ue){return d._container.classList.add(ue)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qs(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var b=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),C=this.options.anchor,M=function ue(fe){if(fe){if(typeof fe=="number"){var Ce=Math.round(Math.sqrt(.5*Math.pow(fe,2)));return{center:new v.Point(0,0),top:new v.Point(0,fe),"top-left":new v.Point(Ce,Ce),"top-right":new v.Point(-Ce,Ce),bottom:new v.Point(0,-fe),"bottom-left":new v.Point(Ce,-Ce),"bottom-right":new v.Point(-Ce,-Ce),left:new v.Point(fe,0),right:new v.Point(-fe,0)}}if(fe instanceof v.Point||Array.isArray(fe)){var Pe=v.Point.convert(fe);return{center:Pe,top:Pe,"top-left":Pe,"top-right":Pe,bottom:Pe,"bottom-left":Pe,"bottom-right":Pe,left:Pe,right:Pe}}return{center:v.Point.convert(fe.center||[0,0]),top:v.Point.convert(fe.top||[0,0]),"top-left":v.Point.convert(fe["top-left"]||[0,0]),"top-right":v.Point.convert(fe["top-right"]||[0,0]),bottom:v.Point.convert(fe.bottom||[0,0]),"bottom-left":v.Point.convert(fe["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(fe["bottom-right"]||[0,0]),left:v.Point.convert(fe.left||[0,0]),right:v.Point.convert(fe.right||[0,0])}}return ue(new v.Point(0,0))}(this.options.offset);if(!C){var R,z=this._container.offsetWidth,H=this._container.offsetHeight;R=b.y+M.bottom.y<H?["top"]:b.y>this._map.transform.height-H?["bottom"]:[],b.x<z/2?R.push("left"):b.x>this._map.transform.width-z/2&&R.push("right"),C=R.length===0?"bottom":R.join("-")}var ne=b.add(M[C]).round();U.setTransform(this._container,Bs[C]+" translate("+ne.x+"px,"+ne.y+"px)"),Ru(this._container,C,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(cc);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),zl={version:v.version,supported:de,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:vl,NavigationControl:ou,GeolocateControl:Vf,AttributionControl:us,ScaleControl:gl,FullscreenControl:Ns,Popup:ku,Marker:ks,Style:ms,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){wt().acquire(Lt)},clearPrewarmedResources:function(){var l=yn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Lt),yn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return vr.workerCount},set workerCount(l){vr.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return zl}),ce})},28660:function(It,$,V){var ce=V(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var pe;(function(v){(function(de){var U=typeof V.g=="object"?V.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),te=se(v);typeof U.Reflect=="undefined"?U.Reflect=v:te=se(U.Reflect,te),de(te);function se(Re,he){return function($e,tt){typeof Re[$e]!="function"&&Object.defineProperty(Re,$e,{configurable:!0,writable:!0,value:tt}),he&&he($e,tt)}}})(function(de){var U=Object.prototype.hasOwnProperty,te=typeof Symbol=="function",se=te&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Re=te&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",he=typeof Object.create=="function",$e={__proto__:[]}instanceof Array,tt=!he&&!$e,gt={create:he?function(){return ru(Object.create(null))}:$e?function(){return ru({__proto__:null})}:function(){return ru({})},has:tt?function(Vt,ar){return U.call(Vt,ar)}:function(Vt,ar){return ar in Vt},get:tt?function(Vt,ar){return U.call(Vt,ar)?Vt[ar]:void 0}:function(Vt,ar){return Vt[ar]}},Jt=Object.getPrototypeOf(Function),ir=typeof ce=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",yt=!ir&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ge(),Qt=!ir&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ui(),Ct=!ir&&typeof WeakMap=="function"?WeakMap:no(),st=new Ct;function ht(Vt,ar,Ar,on){if(gn(Ar)){if(!ji(Vt))throw new TypeError;if(!ga(ar))throw new TypeError;return Dr(Vt,ar)}else{if(!ji(Vt))throw new TypeError;if(!ii(ar))throw new TypeError;if(!ii(on)&&!gn(on)&&!ea(on))throw new TypeError;return ea(on)&&(on=void 0),Ar=zi(Ar),Kr(Vt,ar,Ar,on)}}de("decorate",ht);function Wt(Vt,ar){function Ar(on,In){if(!ii(on))throw new TypeError;if(!gn(In)&&!vo(In))throw new TypeError;Ft(Vt,ar,on,In)}return Ar}de("metadata",Wt);function X(Vt,ar,Ar,on){if(!ii(Ar))throw new TypeError;return gn(on)||(on=zi(on)),Ft(Vt,ar,Ar,on)}de("defineMetadata",X);function Xt(Vt,ar,Ar){if(!ii(ar))throw new TypeError;return gn(Ar)||(Ar=zi(Ar)),A(Vt,ar,Ar)}de("hasMetadata",Xt);function ft(Vt,ar,Ar){if(!ii(ar))throw new TypeError;return gn(Ar)||(Ar=zi(Ar)),_e(Vt,ar,Ar)}de("hasOwnMetadata",ft);function He(Vt,ar,Ar){if(!ii(ar))throw new TypeError;return gn(Ar)||(Ar=zi(Ar)),Et(Vt,ar,Ar)}de("getMetadata",He);function lt(Vt,ar,Ar){if(!ii(ar))throw new TypeError;return gn(Ar)||(Ar=zi(Ar)),dt(Vt,ar,Ar)}de("getOwnMetadata",lt);function Qe(Vt,ar){if(!ii(Vt))throw new TypeError;return gn(ar)||(ar=zi(ar)),qt(Vt,ar)}de("getMetadataKeys",Qe);function Ut(Vt,ar){if(!ii(Vt))throw new TypeError;return gn(ar)||(ar=zi(ar)),Sr(Vt,ar)}de("getOwnMetadataKeys",Ut);function xr(Vt,ar,Ar){if(!ii(ar))throw new TypeError;gn(Ar)||(Ar=zi(Ar));var on=Me(ar,Ar,!1);if(gn(on)||!on.delete(Vt))return!1;if(on.size>0)return!0;var In=st.get(ar);return In.delete(Ar),In.size>0||st.delete(ar),!0}de("deleteMetadata",xr);function Dr(Vt,ar){for(var Ar=Vt.length-1;Ar>=0;--Ar){var on=Vt[Ar],In=on(ar);if(!gn(In)&&!ea(In)){if(!ga(In))throw new TypeError;ar=In}}return ar}function Kr(Vt,ar,Ar,on){for(var In=Vt.length-1;In>=0;--In){var Rn=Vt[In],bi=Rn(ar,Ar,on);if(!gn(bi)&&!ea(bi)){if(!ii(bi))throw new TypeError;on=bi}}return on}function Me(Vt,ar,Ar){var on=st.get(Vt);if(gn(on)){if(!Ar)return;on=new yt,st.set(Vt,on)}var In=on.get(ar);if(gn(In)){if(!Ar)return;In=new yt,on.set(ar,In)}return In}function A(Vt,ar,Ar){var on=_e(Vt,ar,Ar);if(on)return!0;var In=Ts(ar);return ea(In)?!1:A(Vt,In,Ar)}function _e(Vt,ar,Ar){var on=Me(ar,Ar,!1);return gn(on)?!1:Wn(on.has(Vt))}function Et(Vt,ar,Ar){var on=_e(Vt,ar,Ar);if(on)return dt(Vt,ar,Ar);var In=Ts(ar);if(!ea(In))return Et(Vt,In,Ar)}function dt(Vt,ar,Ar){var on=Me(ar,Ar,!1);if(!gn(on))return on.get(Vt)}function Ft(Vt,ar,Ar,on){var In=Me(Ar,on,!0);In.set(Vt,ar)}function qt(Vt,ar){var Ar=Sr(Vt,ar),on=Ts(Vt);if(on===null)return Ar;var In=qt(on,ar);if(In.length<=0)return Ar;if(Ar.length<=0)return In;for(var Rn=new Qt,bi=[],gi=0,En=Ar;gi<En.length;gi++){var Oi=En[gi],Ii=Rn.has(Oi);Ii||(Rn.add(Oi),bi.push(Oi))}for(var ja=0,ps=In;ja<ps.length;ja++){var Oi=ps[ja],Ii=Rn.has(Oi);Ii||(Rn.add(Oi),bi.push(Oi))}return bi}function Sr(Vt,ar){var Ar=[],on=Me(Vt,ar,!1);if(gn(on))return Ar;for(var In=on.keys(),Rn=la(In),bi=0;;){var gi=ra(Rn);if(!gi)return Ar.length=bi,Ar;var En=Ui(gi);try{Ar[bi]=En}catch(Oi){try{qi(Rn)}finally{throw Oi}}bi++}}function Qn(Vt){if(Vt===null)return 1;switch(typeof Vt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Vt===null?1:6;default:return 6}}function gn(Vt){return Vt===void 0}function ea(Vt){return Vt===null}function wn(Vt){return typeof Vt=="symbol"}function ii(Vt){return typeof Vt=="object"?Vt!==null:typeof Vt=="function"}function Si(Vt,ar){switch(Qn(Vt)){case 0:return Vt;case 1:return Vt;case 2:return Vt;case 3:return Vt;case 4:return Vt;case 5:return Vt}var Ar=ar===3?"string":ar===5?"number":"default",on=Va(Vt,se);if(on!==void 0){var In=on.call(Vt,Ar);if(ii(In))throw new TypeError;return In}return si(Vt,Ar==="default"?"number":Ar)}function si(Vt,ar){if(ar==="string"){var Ar=Vt.toString;if(Wi(Ar)){var on=Ar.call(Vt);if(!ii(on))return on}var In=Vt.valueOf;if(Wi(In)){var on=In.call(Vt);if(!ii(on))return on}}else{var In=Vt.valueOf;if(Wi(In)){var on=In.call(Vt);if(!ii(on))return on}var Rn=Vt.toString;if(Wi(Rn)){var on=Rn.call(Vt);if(!ii(on))return on}}throw new TypeError}function Wn(Vt){return!!Vt}function ma(Vt){return""+Vt}function zi(Vt){var ar=Si(Vt,3);return wn(ar)?ar:ma(ar)}function ji(Vt){return Array.isArray?Array.isArray(Vt):Vt instanceof Object?Vt instanceof Array:Object.prototype.toString.call(Vt)==="[object Array]"}function Wi(Vt){return typeof Vt=="function"}function ga(Vt){return typeof Vt=="function"}function vo(Vt){switch(Qn(Vt)){case 3:return!0;case 4:return!0;default:return!1}}function Va(Vt,ar){var Ar=Vt[ar];if(Ar!=null){if(!Wi(Ar))throw new TypeError;return Ar}}function la(Vt){var ar=Va(Vt,Re);if(!Wi(ar))throw new TypeError;var Ar=ar.call(Vt);if(!ii(Ar))throw new TypeError;return Ar}function Ui(Vt){return Vt.value}function ra(Vt){var ar=Vt.next();return ar.done?!1:ar}function qi(Vt){var ar=Vt.return;ar&&ar.call(Vt)}function Ts(Vt){var ar=Object.getPrototypeOf(Vt);if(typeof Vt!="function"||Vt===Jt||ar!==Jt)return ar;var Ar=Vt.prototype,on=Ar&&Object.getPrototypeOf(Ar);if(on==null||on===Object.prototype)return ar;var In=on.constructor;return typeof In!="function"||In===Vt?ar:In}function ge(){var Vt={},ar=[],Ar=function(){function bi(gi,En,Oi){this._index=0,this._keys=gi,this._values=En,this._selector=Oi}return bi.prototype["@@iterator"]=function(){return this},bi.prototype[Re]=function(){return this},bi.prototype.next=function(){var gi=this._index;if(gi>=0&&gi<this._keys.length){var En=this._selector(this._keys[gi],this._values[gi]);return gi+1>=this._keys.length?(this._index=-1,this._keys=ar,this._values=ar):this._index++,{value:En,done:!1}}return{value:void 0,done:!0}},bi.prototype.throw=function(gi){throw this._index>=0&&(this._index=-1,this._keys=ar,this._values=ar),gi},bi.prototype.return=function(gi){return this._index>=0&&(this._index=-1,this._keys=ar,this._values=ar),{value:gi,done:!0}},bi}();return function(){function bi(){this._keys=[],this._values=[],this._cacheKey=Vt,this._cacheIndex=-2}return Object.defineProperty(bi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),bi.prototype.has=function(gi){return this._find(gi,!1)>=0},bi.prototype.get=function(gi){var En=this._find(gi,!1);return En>=0?this._values[En]:void 0},bi.prototype.set=function(gi,En){var Oi=this._find(gi,!0);return this._values[Oi]=En,this},bi.prototype.delete=function(gi){var En=this._find(gi,!1);if(En>=0){for(var Oi=this._keys.length,Ii=En+1;Ii<Oi;Ii++)this._keys[Ii-1]=this._keys[Ii],this._values[Ii-1]=this._values[Ii];return this._keys.length--,this._values.length--,gi===this._cacheKey&&(this._cacheKey=Vt,this._cacheIndex=-2),!0}return!1},bi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Vt,this._cacheIndex=-2},bi.prototype.keys=function(){return new Ar(this._keys,this._values,on)},bi.prototype.values=function(){return new Ar(this._keys,this._values,In)},bi.prototype.entries=function(){return new Ar(this._keys,this._values,Rn)},bi.prototype["@@iterator"]=function(){return this.entries()},bi.prototype[Re]=function(){return this.entries()},bi.prototype._find=function(gi,En){return this._cacheKey!==gi&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=gi)),this._cacheIndex<0&&En&&(this._cacheIndex=this._keys.length,this._keys.push(gi),this._values.push(void 0)),this._cacheIndex},bi}();function on(bi,gi){return bi}function In(bi,gi){return gi}function Rn(bi,gi){return[bi,gi]}}function ui(){return function(){function Vt(){this._map=new yt}return Object.defineProperty(Vt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Vt.prototype.has=function(ar){return this._map.has(ar)},Vt.prototype.add=function(ar){return this._map.set(ar,ar),this},Vt.prototype.delete=function(ar){return this._map.delete(ar)},Vt.prototype.clear=function(){this._map.clear()},Vt.prototype.keys=function(){return this._map.keys()},Vt.prototype.values=function(){return this._map.values()},Vt.prototype.entries=function(){return this._map.entries()},Vt.prototype["@@iterator"]=function(){return this.keys()},Vt.prototype[Re]=function(){return this.keys()},Vt}()}function no(){var Vt=16,ar=gt.create(),Ar=on();return function(){function En(){this._key=on()}return En.prototype.has=function(Oi){var Ii=In(Oi,!1);return Ii!==void 0?gt.has(Ii,this._key):!1},En.prototype.get=function(Oi){var Ii=In(Oi,!1);return Ii!==void 0?gt.get(Ii,this._key):void 0},En.prototype.set=function(Oi,Ii){var ja=In(Oi,!0);return ja[this._key]=Ii,this},En.prototype.delete=function(Oi){var Ii=In(Oi,!1);return Ii!==void 0?delete Ii[this._key]:!1},En.prototype.clear=function(){this._key=on()},En}();function on(){var En;do En="@@WeakMap@@"+gi();while(gt.has(ar,En));return ar[En]=!0,En}function In(En,Oi){if(!U.call(En,Ar)){if(!Oi)return;Object.defineProperty(En,Ar,{value:gt.create()})}return En[Ar]}function Rn(En,Oi){for(var Ii=0;Ii<Oi;++Ii)En[Ii]=Math.random()*255|0;return En}function bi(En){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(En)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(En)):Rn(new Uint8Array(En),En):Rn(new Array(En),En)}function gi(){var En=bi(Vt);En[6]=En[6]&79|64,En[8]=En[8]&191|128;for(var Oi="",Ii=0;Ii<Vt;++Ii){var ja=En[Ii];(Ii===4||Ii===6||Ii===8)&&(Oi+="-"),ja<16&&(Oi+="0"),Oi+=ja.toString(16).toLowerCase()}return Oi}}function ru(Vt){return Vt.__=void 0,delete Vt.__,Vt}})})(pe||(pe={}))},69848:function(It){(function($,V){It.exports=V()})(this,function(){"use strict";function $(ft,He,lt,Qe,Ut,xr){if(!(Ut-Qe<=lt)){var Dr=Qe+Ut>>1;V(ft,He,Dr,Qe,Ut,xr%2),$(ft,He,lt,Qe,Dr-1,xr+1),$(ft,He,lt,Dr+1,Ut,xr+1)}}function V(ft,He,lt,Qe,Ut,xr){for(;Ut>Qe;){if(Ut-Qe>600){var Dr=Ut-Qe+1,Kr=lt-Qe+1,Me=Math.log(Dr),A=.5*Math.exp(2*Me/3),_e=.5*Math.sqrt(Me*A*(Dr-A)/Dr)*(Kr-Dr/2<0?-1:1),Et=Math.max(Qe,Math.floor(lt-Kr*A/Dr+_e)),dt=Math.min(Ut,Math.floor(lt+(Dr-Kr)*A/Dr+_e));V(ft,He,lt,Et,dt,xr)}var Ft=He[2*lt+xr],qt=Qe,Sr=Ut;for(ce(ft,He,Qe,lt),He[2*Ut+xr]>Ft&&ce(ft,He,Qe,Ut);qt<Sr;){for(ce(ft,He,qt,Sr),qt++,Sr--;He[2*qt+xr]<Ft;)qt++;for(;He[2*Sr+xr]>Ft;)Sr--}He[2*Qe+xr]===Ft?ce(ft,He,Qe,Sr):(Sr++,ce(ft,He,Sr,Ut)),Sr<=lt&&(Qe=Sr+1),lt<=Sr&&(Ut=Sr-1)}}function ce(ft,He,lt,Qe){pe(ft,lt,Qe),pe(He,2*lt,2*Qe),pe(He,2*lt+1,2*Qe+1)}function pe(ft,He,lt){var Qe=ft[He];ft[He]=ft[lt],ft[lt]=Qe}function v(ft,He,lt,Qe,Ut,xr,Dr){for(var Kr=[0,ft.length-1,0],Me=[],A,_e;Kr.length;){var Et=Kr.pop(),dt=Kr.pop(),Ft=Kr.pop();if(dt-Ft<=Dr){for(var qt=Ft;qt<=dt;qt++)A=He[2*qt],_e=He[2*qt+1],A>=lt&&A<=Ut&&_e>=Qe&&_e<=xr&&Me.push(ft[qt]);continue}var Sr=Math.floor((Ft+dt)/2);A=He[2*Sr],_e=He[2*Sr+1],A>=lt&&A<=Ut&&_e>=Qe&&_e<=xr&&Me.push(ft[Sr]);var Qn=(Et+1)%2;(Et===0?lt<=A:Qe<=_e)&&(Kr.push(Ft),Kr.push(Sr-1),Kr.push(Qn)),(Et===0?Ut>=A:xr>=_e)&&(Kr.push(Sr+1),Kr.push(dt),Kr.push(Qn))}return Me}function de(ft,He,lt,Qe,Ut,xr){for(var Dr=[0,ft.length-1,0],Kr=[],Me=Ut*Ut;Dr.length;){var A=Dr.pop(),_e=Dr.pop(),Et=Dr.pop();if(_e-Et<=xr){for(var dt=Et;dt<=_e;dt++)U(He[2*dt],He[2*dt+1],lt,Qe)<=Me&&Kr.push(ft[dt]);continue}var Ft=Math.floor((Et+_e)/2),qt=He[2*Ft],Sr=He[2*Ft+1];U(qt,Sr,lt,Qe)<=Me&&Kr.push(ft[Ft]);var Qn=(A+1)%2;(A===0?lt-Ut<=qt:Qe-Ut<=Sr)&&(Dr.push(Et),Dr.push(Ft-1),Dr.push(Qn)),(A===0?lt+Ut>=qt:Qe+Ut>=Sr)&&(Dr.push(Ft+1),Dr.push(_e),Dr.push(Qn))}return Kr}function U(ft,He,lt,Qe){var Ut=ft-lt,xr=He-Qe;return Ut*Ut+xr*xr}var te=function(ft){return ft[0]},se=function(ft){return ft[1]},Re=function(He,lt,Qe,Ut,xr){lt===void 0&&(lt=te),Qe===void 0&&(Qe=se),Ut===void 0&&(Ut=64),xr===void 0&&(xr=Float64Array),this.nodeSize=Ut,this.points=He;for(var Dr=He.length<65536?Uint16Array:Uint32Array,Kr=this.ids=new Dr(He.length),Me=this.coords=new xr(He.length*2),A=0;A<He.length;A++)Kr[A]=A,Me[2*A]=lt(He[A]),Me[2*A+1]=Qe(He[A]);$(Kr,Me,Ut,0,Kr.length-1,0)};Re.prototype.range=function(He,lt,Qe,Ut){return v(this.ids,this.coords,He,lt,Qe,Ut,this.nodeSize)},Re.prototype.within=function(He,lt,Qe){return de(this.ids,this.coords,He,lt,Qe,this.nodeSize)};var he={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ft){return ft}},$e=Math.fround||function(ft){return function(He){return ft[0]=+He,ft[0]}}(new Float32Array(1)),tt=function(He){this.options=Wt(Object.create(he),He),this.trees=new Array(this.options.maxZoom+1)};tt.prototype.load=function(He){var lt=this.options,Qe=lt.log,Ut=lt.minZoom,xr=lt.maxZoom,Dr=lt.nodeSize;Qe&&console.time("total time");var Kr="prepare "+He.length+" points";Qe&&console.time(Kr),this.points=He;for(var Me=[],A=0;A<He.length;A++)!He[A].geometry||Me.push(Jt(He[A],A));this.trees[xr+1]=new Re(Me,X,Xt,Dr,Float32Array),Qe&&console.timeEnd(Kr);for(var _e=xr;_e>=Ut;_e--){var Et=+Date.now();Me=this._cluster(Me,_e),this.trees[_e]=new Re(Me,X,Xt,Dr,Float32Array),Qe&&console.log("z%d: %d clusters in %dms",_e,Me.length,+Date.now()-Et)}return Qe&&console.timeEnd("total time"),this},tt.prototype.getClusters=function(He,lt){var Qe=((He[0]+180)%360+360)%360-180,Ut=Math.max(-90,Math.min(90,He[1])),xr=He[2]===180?180:((He[2]+180)%360+360)%360-180,Dr=Math.max(-90,Math.min(90,He[3]));if(He[2]-He[0]>=360)Qe=-180,xr=180;else if(Qe>xr){var Kr=this.getClusters([Qe,Ut,180,Dr],lt),Me=this.getClusters([-180,Ut,xr,Dr],lt);return Kr.concat(Me)}for(var A=this.trees[this._limitZoom(lt)],_e=A.range(Qt(Qe),Ct(Dr),Qt(xr),Ct(Ut)),Et=[],dt=0,Ft=_e;dt<Ft.length;dt+=1){var qt=Ft[dt],Sr=A.points[qt];Et.push(Sr.numPoints?ir(Sr):this.points[Sr.index])}return Et},tt.prototype.getChildren=function(He){var lt=this._getOriginId(He),Qe=this._getOriginZoom(He),Ut="No cluster with the specified id.",xr=this.trees[Qe];if(!xr)throw new Error(Ut);var Dr=xr.points[lt];if(!Dr)throw new Error(Ut);for(var Kr=this.options.radius/(this.options.extent*Math.pow(2,Qe-1)),Me=xr.within(Dr.x,Dr.y,Kr),A=[],_e=0,Et=Me;_e<Et.length;_e+=1){var dt=Et[_e],Ft=xr.points[dt];Ft.parentId===He&&A.push(Ft.numPoints?ir(Ft):this.points[Ft.index])}if(A.length===0)throw new Error(Ut);return A},tt.prototype.getLeaves=function(He,lt,Qe){lt=lt||10,Qe=Qe||0;var Ut=[];return this._appendLeaves(Ut,He,lt,Qe,0),Ut},tt.prototype.getTile=function(He,lt,Qe){var Ut=this.trees[this._limitZoom(He)],xr=Math.pow(2,He),Dr=this.options,Kr=Dr.extent,Me=Dr.radius,A=Me/Kr,_e=(Qe-A)/xr,Et=(Qe+1+A)/xr,dt={features:[]};return this._addTileFeatures(Ut.range((lt-A)/xr,_e,(lt+1+A)/xr,Et),Ut.points,lt,Qe,xr,dt),lt===0&&this._addTileFeatures(Ut.range(1-A/xr,_e,1,Et),Ut.points,xr,Qe,xr,dt),lt===xr-1&&this._addTileFeatures(Ut.range(0,_e,A/xr,Et),Ut.points,-1,Qe,xr,dt),dt.features.length?dt:null},tt.prototype.getClusterExpansionZoom=function(He){for(var lt=this._getOriginZoom(He)-1;lt<=this.options.maxZoom;){var Qe=this.getChildren(He);if(lt++,Qe.length!==1)break;He=Qe[0].properties.cluster_id}return lt},tt.prototype._appendLeaves=function(He,lt,Qe,Ut,xr){for(var Dr=this.getChildren(lt),Kr=0,Me=Dr;Kr<Me.length;Kr+=1){var A=Me[Kr],_e=A.properties;if(_e&&_e.cluster?xr+_e.point_count<=Ut?xr+=_e.point_count:xr=this._appendLeaves(He,_e.cluster_id,Qe,Ut,xr):xr<Ut?xr++:He.push(A),He.length===Qe)break}return xr},tt.prototype._addTileFeatures=function(He,lt,Qe,Ut,xr,Dr){for(var Kr=0,Me=He;Kr<Me.length;Kr+=1){var A=Me[Kr],_e=lt[A],Et=_e.numPoints,dt=void 0,Ft=void 0,qt=void 0;if(Et)dt=yt(_e),Ft=_e.x,qt=_e.y;else{var Sr=this.points[_e.index];dt=Sr.properties,Ft=Qt(Sr.geometry.coordinates[0]),qt=Ct(Sr.geometry.coordinates[1])}var Qn={type:1,geometry:[[Math.round(this.options.extent*(Ft*xr-Qe)),Math.round(this.options.extent*(qt*xr-Ut))]],tags:dt},gn=void 0;Et?gn=_e.id:this.options.generateId?gn=_e.index:this.points[_e.index].id&&(gn=this.points[_e.index].id),gn!==void 0&&(Qn.id=gn),Dr.features.push(Qn)}},tt.prototype._limitZoom=function(He){return Math.max(this.options.minZoom,Math.min(+He,this.options.maxZoom+1))},tt.prototype._cluster=function(He,lt){for(var Qe=[],Ut=this.options,xr=Ut.radius,Dr=Ut.extent,Kr=Ut.reduce,Me=Ut.minPoints,A=xr/(Dr*Math.pow(2,lt)),_e=0;_e<He.length;_e++){var Et=He[_e];if(!(Et.zoom<=lt)){Et.zoom=lt;for(var dt=this.trees[lt+1],Ft=dt.within(Et.x,Et.y,A),qt=Et.numPoints||1,Sr=qt,Qn=0,gn=Ft;Qn<gn.length;Qn+=1){var ea=gn[Qn],wn=dt.points[ea];wn.zoom>lt&&(Sr+=wn.numPoints||1)}if(Sr>qt&&Sr>=Me){for(var ii=Et.x*qt,Si=Et.y*qt,si=Kr&&qt>1?this._map(Et,!0):null,Wn=(_e<<5)+(lt+1)+this.points.length,ma=0,zi=Ft;ma<zi.length;ma+=1){var ji=zi[ma],Wi=dt.points[ji];if(!(Wi.zoom<=lt)){Wi.zoom=lt;var ga=Wi.numPoints||1;ii+=Wi.x*ga,Si+=Wi.y*ga,Wi.parentId=Wn,Kr&&(si||(si=this._map(Et,!0)),Kr(si,this._map(Wi)))}}Et.parentId=Wn,Qe.push(gt(ii/Sr,Si/Sr,Wn,Sr,si))}else if(Qe.push(Et),Sr>1)for(var vo=0,Va=Ft;vo<Va.length;vo+=1){var la=Va[vo],Ui=dt.points[la];Ui.zoom<=lt||(Ui.zoom=lt,Qe.push(Ui))}}}return Qe},tt.prototype._getOriginId=function(He){return He-this.points.length>>5},tt.prototype._getOriginZoom=function(He){return(He-this.points.length)%32},tt.prototype._map=function(He,lt){if(He.numPoints)return lt?Wt({},He.properties):He.properties;var Qe=this.points[He.index].properties,Ut=this.options.map(Qe);return lt&&Ut===Qe?Wt({},Ut):Ut};function gt(ft,He,lt,Qe,Ut){return{x:$e(ft),y:$e(He),zoom:Infinity,id:lt,parentId:-1,numPoints:Qe,properties:Ut}}function Jt(ft,He){var lt=ft.geometry.coordinates,Qe=lt[0],Ut=lt[1];return{x:$e(Qt(Qe)),y:$e(Ct(Ut)),zoom:Infinity,index:He,parentId:-1}}function ir(ft){return{type:"Feature",id:ft.id,properties:yt(ft),geometry:{type:"Point",coordinates:[st(ft.x),ht(ft.y)]}}}function yt(ft){var He=ft.numPoints,lt=He>=1e4?Math.round(He/1e3)+"k":He>=1e3?Math.round(He/100)/10+"k":He;return Wt(Wt({},ft.properties),{cluster:!0,cluster_id:ft.id,point_count:He,point_count_abbreviated:lt})}function Qt(ft){return ft/360+.5}function Ct(ft){var He=Math.sin(ft*Math.PI/180),lt=.5-.25*Math.log((1+He)/(1-He))/Math.PI;return lt<0?0:lt>1?1:lt}function st(ft){return(ft-.5)*360}function ht(ft){var He=(180-ft*360)*Math.PI/180;return 360*Math.atan(Math.exp(He))/Math.PI-90}function Wt(ft,He){for(var lt in He)ft[lt]=He[lt];return ft}function X(ft){return ft.x}function Xt(ft){return ft.y}return tt})},75752:function(It){It.exports.RADIUS=6378137,It.exports.FLATTENING=1/298.257223563,It.exports.POLAR_RADIUS=63567523142e-4}}]);
